<!DOCTYPE html>
<html>
 <body>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Week 1
     </h1>
    </div>
    <div class="row spy-padding" id="block_250">
     <div class="col-11">
      <h3>
       1.1 Introduction
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This week is about refreshing your python skills.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_250">
      </div>
      <div class="comments" id="issues_250">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_251">
     <div class="col-11">
      <h3>
       1.2 First TØ
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read whatever you feel you need to read again on Numpy and animations,
        </p>
        <p>
         Solve exercise 1. Note, we'll return to the contents of this exercise
when making object-oriented Python programs.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_251">
      </div>
      <div class="comments" id="issues_251">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_252">
     <div class="col-11">
      <h3>
       1.3 Second TØ
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read about differential equations and object-oriented Python-programming.
        </p>
        <p>
         Solve exercise 2 and be prepared that this will also be done with
object-oriented Python programming.
        </p>
        <p>
         Solve exercise 3 as your first object-oriented Python program.
        </p>
        <p>
         Most likely, you will not have more time, but if you have: Solve
exercises 4+5. These exercises will be used for demonstration of
object-oriented Python-programming at the lecture on Thursday, so it
is not important to complete them.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_252">
      </div>
      <div class="comments" id="issues_252">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1 id="chapCOLONnumerical_python">
      External resources
     </h1>
    </div>
    <div class="row spy-padding" id="block_124">
     <div class="col-11">
      <h3>
       2.1 Numpy
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Refresh
         <code class="prettyprint python">
          Numpy
         </code>
         here:
        </p>
        <p>
         <a href="https://numpy.org/doc/stable/user/absolute_beginners.html" target="_blank">
          numpy.org web pages
         </a>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_124">
      </div>
      <div class="comments" id="issues_124">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_125">
     <div class="col-11">
      <h3>
       2.2 Animations
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Refresh how to make animations in
         <code class="prettyprint python">
          Matplotlib
         </code>
         here:
        </p>
        <p>
         <a href="https://matplotlib.org/stable/users/explain/animations/animations.html" target="_blank">
          Official
  Matplotlib documentation
         </a>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_125">
      </div>
      <div class="comments" id="issues_125">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_126">
     <div class="col-11">
      <h3>
       2.3 Differential equations
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Learn about solving differential equations with
         <code class="prettyprint python">
          solve_ivp
         </code>
         here:
        </p>
        <p>
         <a href="https://medium.com/@bldevries/simply-solving-differential-equations-using-python-scipy-and-solve-ivp-f6185da2572d" target="_blank">
          Blog by Ben de Vries
         </a>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_126">
      </div>
      <div class="comments" id="issues_126">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_127">
     <div class="col-11">
      <h3>
       2.4 Object-oriented Python
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Learn about classes and instances (objects) in Python here:
        </p>
        <p>
         <a href="https://www.programiz.com/python-programming/object-oriented-programming" target="_blank">
          Link to Programiz
         </a>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_127">
      </div>
      <div class="comments" id="issues_127">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1 id="howtoCOLONanimations">
      Numerical Python
     </h1>
    </div>
    <div class="row spy-padding" id="block_128">
     <div class="col-11">
      <h3>
       3.1 Intro
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The
         <i>
          NumPy
         </i>
         package provides most of the functionality
one needs to do numerical manipulations and handling datasets in Python. Recall that the package is
imported with the statement:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
import numpy as np
</pre>
        <p>
         after which one may start working with numerical values in Python in all sorts of ways. For instance, creating a list of eight numbers
from 0 to 1 is done with the
         <code class="prettyprint python">
          linspace
         </code>
         function:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="linspace_code">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
x = np.linspace(0,1,8)
x
</pre>
          </p>
         </div>
        </div>
        <p>
         that outputs:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([0.        , 0.14285714, 0.28571429, 0.42857143, 0.57142857, 0.71428571, 0.85714286, 1.        ]) 
</pre>
        <p>
         Notice how it may be a little annoying to get very many decimals on the printed values. To avoid that
you may change the default printing behavior of NumPy, with this function call:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="set_printoptions">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
np.set_printoptions(precision=3)
</pre>
          </p>
         </div>
        </div>
        <p>
         after which you will get only 3 decimals:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([0.   , 0.143, 0.286, 0.429, 0.571, 0.714, 0.857, 1.   ])
</pre>
        <p>
         The content of the variable
         <code class="prettyprint python">
          x
         </code>
         remains unchanged. It is only the printing of it that is affected.
The
         <code class="prettyprint python">
          array(...)
         </code>
         part of the print reveals that the variable
         <code class="prettyprint python">
          x
         </code>
         is a
         <i>
          NumPy array
         </i>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="array_to_list">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
type(x)
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
numpy.ndarray
</pre>
        <p>
         In many contexts, a
         <i>
          NumPy array
         </i>
         is precisely what you want, but if you want a
         <i>
          Python list
         </i>
         you may use the method
         <code class="prettyprint python">
          tolist
         </code>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
x.tolist()
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
  
[0.0,
 0.14285714285714285,
 0.2857142857142857,
 0.42857142857142855,
 0.5714285714285714,
 0.7142857142857142,
 0.8571428571428571,
 1.0]
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_128">
      </div>
      <div class="comments" id="issues_128">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_129">
     <div class="col-11">
      <h3 id="book_python_numpy_array">
       3.2 NumPy array vs Python list I
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         A one dimensional
         <i>
          NumPy array
         </i>
         is not just a
         <i>
          Python list
         </i>
         . In fact, a
         <i>
          NumPy array
         </i>
         has the properties
you would like in order to do numerical manipulations of a list of numbers. To illustrate this, assume you have the same list of numbers
both as a
         <i>
          Python list
         </i>
         ,
         <code class="prettyprint python">
          x_list
         </code>
         , and as a
         <i>
          NumPy array
         </i>
         ,
         <code class="prettyprint python">
          x_array
         </code>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
x_list = [1, 4, 9]
x_array = np.array(x_list)
print('x_list:          ',x_list)
print('x_array:         ',x_array)
print('x_array.tolist():',x_array.tolist())
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
x_list:           [1, 4, 9]
x_array:          [1 4 9]
x_array.tolist(): [1, 4, 9]
</pre>
        <p>
         Then multiplying each list with 2 gives two different results:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="np_array_elementwise">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
print('2 * x_list: ',2 * x_list)
print('2 * x_array:',2 * x_array)
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
2 * x_list:  [1, 4, 9, 1, 4, 9]
2 * x_array: [ 2  8 18]
</pre>
        <p>
         The
         <i>
          Python list
         </i>
         is repeated twice, while the
         <i>
          NumPy array
         </i>
         has all its elements doubled, i.e. the
operations on the
         <i>
          NumPy array
         </i>
         are done element wise.
        </p>
        <p>
         Another example of a numerical manipulation possible for a NumPy array
is the adding a constant to it:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="np_array_adding_constant">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
x_array + 100
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([101, 104, 109])
</pre>
        <p>
         If you provide a
         <i>
          Python list
         </i>
         as the argument for a
         <i>
          NumPy
         </i>
         function,
the function first converts the input to a
         <i>
          NumPy array
         </i>
         and then does its action element wise on the array. Thus the
         <i>
          NumPy
         </i>
         function
         <code class="prettyprint python">
          np.sqrt
         </code>
         applied to either a
         <i>
          Python list
         </i>
         or a
         <i>
          NumPy array
         </i>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
np.sqrt(x_list)
np.sqrt(x_array)
</pre>
        <p>
         gives the same result:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([1., 2., 3.])
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_129">
      </div>
      <div class="comments" id="issues_129">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_130">
     <div class="col-11">
      <h3>
       3.3 NumPy array vs Python list II
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Another reason to work with
         <i>
          NumPy arrays
         </i>
         rather than
with
         <i>
          Python lists
         </i>
         is that the former are much faster.
Consider that you have 10000 numbers in either type of
list and wish to evaluate the sum, then with a
         <i>
          NumPy array
         </i>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="timing_python">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
an_array = np.arange(10000)
print(len(an_array))
print(np.sum(an_array))
%timeit np.sum(an_array)
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
10000
49995000
11.3 µs ± 575 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
        <p>
         it takes: 11 micro seconds for such an evaluation, while with a
         <i>
          Python list
         </i>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
a_list = list(an_array)
print(len(a_list))
print(sum(a_list))
%timeit sum(a_list)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
10000
49995000
1.02 ms ± 5.48 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre>
        <p>
         it takes 1 millisecond, i.e. about a hundred times longer.
         <code class="prettyprint python">
          %timeit
         </code>
         is a so-called
         <i>
          magic command
         </i>
         of the Jupyter Notebook. It repeats
the following
         <i>
          Python statement
         </i>
         a great number of
times and evaluates the average time it takes to execute it. The output
obviously depends on your hardware.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_130">
      </div>
      <div class="comments" id="issues_130">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_131">
     <div class="col-11">
      <h3>
       3.4 Accessing elements
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
import numpy as np
a = np.arange(6)*20
a
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([ 0, 20, 40, 60, 80, 100])
</pre>
        <p>
         As with ordinary lists, you may pick out elements of the one-dimensional
         <i>
          NumPy array
         </i>
         :
        </p>
        <p>
         One element is picked like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
a[2]
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
40
</pre>
        <p>
         Elements up till some index like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
a[:2]
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([ 0, 20])
</pre>
        <p>
         Elements from some index and up like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
a[3:]
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([60, 80, 100])
</pre>
        <p>
         The last element like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="last_element">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
a[-1]
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
100
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_131">
      </div>
      <div class="comments" id="issues_131">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_132">
     <div class="col-11">
      <h3>
       3.5 Arrays vs lists
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         So why are they called
         <i>
          NumPy arrays
         </i>
         and not
just
         <i>
          NumPy lists
         </i>
         ? Well, that is because you can add more
dimensions.  If you have a one-dimensional
         <i>
          NumPy arrays
         </i>
         , it
may look like this:
See
         <a href="https://www.pluralsight.com/guides/different-ways-create-numpy-arrays" target="_blank">
          here
         </a>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_132">
      </div>
      <div class="comments" id="issues_132">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_133">
     <div class="col-11">
      <h3>
       3.6 Changing NumPy arrays
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Two
         <i>
          NumPy arrays
         </i>
         can be combined into one:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="arange">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
a = np.arange(6)*20
a
b = (np.arange(2)+1)*30
b
np.concatenate( (a,b) )
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([  0,  20,  40,  60,  80, 100])
array([30, 60])
array([  0,  20,  40,  60,  80, 100,  30,  60])
</pre>
        <p>
         If you need to delete entries in a
         <i>
          NumPy array
         </i>
         , you use the
         <code class="prettyprint python">
          np.delete
         </code>
         function that takes as arguments the existing
         <i>
          NumPy array
         </i>
         and indices of elements to delete.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="np_array_delete">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
a
np.delete(a,3)
np.delete(a,(1,2))
np.delete(a,range(len(a)-2))
a
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([  0,  20,  40,  60,  80, 100])
array([  0,  20,  40,  80, 100])
array([  0,  60,  80, 100])
array([ 80, 100])
array([  0,  20,  40,  60,  80, 100])
</pre>
        <p>
         Note that
         <code class="prettyprint python">
          np.delete
         </code>
         returns a
         <i>
          new
         </i>
         <i>
          NumPy array
         </i>
         , so if you just
want to delete the element in place, you have to reassign the variable:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
a = np.delete(a,range(len(a)-2))
a
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([ 80, 100])
</pre>
        <p>
         See more on the topic
         <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.delete.html" target="_blank">
          here
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_133">
      </div>
      <div class="comments" id="issues_133">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_134">
     <div class="col-11">
      <h3 id="random_numbers">
       3.7 Random numbers
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         <i>
          NumPy
         </i>
         has a module,
         <code class="prettyprint python">
          random
         </code>
         ,
that provides random numbers.
You get a single random number by calling the
function
         <code class="prettyprint python">
          rand()
         </code>
         from the module:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="random_rand">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
import numpy as np
np.random.rand()
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
0.4375872112626925
</pre>
        <p>
         Calling the function again gives a new random number:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
np.random.rand()
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
0.8917730007820798
</pre>
        <p>
         You may also get a whole list of random numbers by providing an integer argument while calling:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
np.set_printoptions(precision=3) # only 3 decimals in print
np.random.rand(5)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([0.964, 0.383, 0.792, 0.529, 0.568])
</pre>
        <p>
         Often, when developing some
         <i>
          Python
         </i>
         code, it is helpful to get the
         <i>
          same
         </i>
         random numbers everytime the code is run.
You can do that by providing a
         <i>
          seed
         </i>
         to the
         <code class="prettyprint python">
          random
         </code>
         module:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="random_seed">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
np.random.seed(0)
np.random.rand(2)
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([0.549, 0.715])
</pre>
        <p>
         You still get random numbers:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
np.random.rand(2)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([0.603, 0.545])
</pre>
        <p>
         But once you provide the seed again, you start over and the same random numbers in the same sequence once more:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
np.random.seed(0)
np.random.rand(2)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([0.549, 0.715])
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_134">
      </div>
      <div class="comments" id="issues_134">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_135">
     <div class="col-11">
      <h3 id="uniform distribution">
       3.8 Uniform distribution
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The random numbers that are provided by
calling
         <code class="prettyprint python">
          np.random.rand()
         </code>
         are
         <i>
          uniformly distributed
         </i>
         between 0 and 1. It means that the likelihood of getting
a random number between
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          t+\delta
         </script>
         is independent on
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         as
long as
         <span class="matematik">
         </span>
         <script type="math/tex">
          0\le t<1-\delta
         </script>
         . Making histograms of 100 or 10000 random numbers
illustrates how a uniform distribution looks like. Writing this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="hist">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
%matplotlib inline
import matplotlib.pyplot as plt
import numpy as np
fig, ax = plt.subplots()

r = np.random.rand(100)
ax.hist(r)
</pre>
          </p>
         </div>
        </div>
        <p>
         in one cell and this in another cell:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
r = np.random.rand(10000)
ax.hist(r)
</pre>
        <p>
         and we get plots like these:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/rand100.png">
              <img class="img-fluid" src="images/2.png" style="max-width: 49.0%"/>
             </a>
             <a href="/media/2/img/rand10000.png">
              <img class="img-fluid" src="images/2.png" style="max-width: 49.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
         <p class="text-center">
          Figure 1: First plot: 100 random numbers, second plot: 10000 random numbers.
         </p>
        </div>
        <p>
         With just 100 random numbers, there is a great variation in each of
the ten bins of the histogram from 0 to 1. With 10000 random numbers,
there is almost the same amount of random numbers in each bin.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_135">
      </div>
      <div class="comments" id="issues_135">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_136">
     <div class="col-11">
      <h3 id="pyth_numpy_arrays_II">
       3.9 NumPy arrays II
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The following commands build a non-trivial, one-dimensional
         <i>
          NumPy array
         </i>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="arange_concatenate">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
a1 = np.arange(10,14)
a2 = np.arange(20,24)
a12 = np.concatenate((a1,a2))
print(a1)
print(a2)
print(a12)
a = np.concatenate((a12,20+a1))
print(a)
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
  
[10 11 12 13]
[20 21 22 23]
[10 11 12 13 20 21 22 23]
[10 11 12 13 20 21 22 23 30 31 32 33]
</pre>
        <p>
         which can be turned into a two-dimensional
         <i>
          NumPy array
         </i>
         , e.g with 3 lists of each 4 elements:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="reshape">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
a = a.reshape(3,4)
a
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([[10, 11, 12, 13],
       [20, 21, 22, 23],
       [30, 31, 32, 33]])
</pre>
        <p>
         The dimensions of a
         <i>
          NumPy array
         </i>
         can be queried with the
         <code class="prettyprint python">
          shape
         </code>
         attribute:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
a.shape
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
(3, 4)
</pre>
        <p>
         A two-dimensional
         <i>
          NumPy array
         </i>
         can be thought of as a list of lists. Printing the 1st and
second (inner) list of the (outer) list supports this notion:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
print(a[0])
print(a[1])
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
  
[10 11 12 13]
[20 21 22 23]
</pre>
        <p>
         And one may loop through the (inner) lists in the (other list) like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="row">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
for row in a:
    print(row)
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
  
[10 11 12 13]
[20 21 22 23]
[30 31 32 33]
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_136">
      </div>
      <div class="comments" id="issues_136">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_137">
     <div class="col-11">
      <h3 id="two_dimensional_array">
       3.10 NumPy arrays III
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Consider the two-dimensional
         <i>
          NumPy array
         </i>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
a = np.array([[10, 11, 12, 13],
              [20, 21, 22, 23],
              [30, 31, 32, 33]])
</pre>
        <p>
         Selecting the rows (the inner lists) of the array with an index, as in
         <code class="prettyprint python">
          a[0]
         </code>
         ,
         <code class="prettyprint python">
          a[1]
         </code>
         , and
         <code class="prettyprint python">
          a[2]
         </code>
         ,
one may inspect the individual members of the inner lists, by adding another index in square brackets, e.g.
         <code class="prettyprint python">
          [2]
         </code>
         that will select for the 3rd element in every row:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
print(a[0][2])
print(a[1][2])
print(a[2][2])
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
12
22
32
</pre>
        <p>
         Together, the three
         <code class="prettyprint python">
          print
         </code>
         statements effectively select
the 3rd row of the array
         <code class="prettyprint python">
          a
         </code>
         . However, getting three
separate numbers is rather impractical. A more rational way to get the 3rd
coloumn is the following:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="select_a_coloumn">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
print(a[:,2])
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
  
[12 22 32]
</pre>
        <p>
         where the colon,
         <code class="prettyprint python">
          :
         </code>
         , means that all rows (i.e. elements of the outer list) should be considered, while
         <code class="prettyprint python">
          ,2
         </code>
         means that all 3rd
elements of these rows are selected. One may get inspired and use the
         <code class="prettyprint python">
          :
         </code>
         for the second coordinate, selecting all elements
in a given row:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
print(a[1,:])
print(a[1])
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
  
[20 21 22 23]
[20 21 22 23]
</pre>
        <p>
         That works fine, but as seen, the
         <code class="prettyprint python">
          ,:
         </code>
         is not required to pick out a row, since
         <code class="prettyprint python">
          [1]
         </code>
         already is sufficient.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_137">
      </div>
      <div class="comments" id="issues_137">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_138">
     <div class="col-11">
      <h3>
       3.11 NumPy arrays IV
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         A
         <i>
          NumPy array
         </i>
         ,
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
a = np.array([[10, 11, 12, 13],
              [20, 21, 22, 23],
              [30, 31, 32, 33]])
a
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([[10, 11, 12, 13],
       [20, 21, 22, 23],
       [30, 31, 32, 33]])
</pre>
        <p>
         may be transposed, meaning that rows and coloumns are interchanged:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="transpose">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
np.transpose(a)
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([[10, 20, 30],
       [11, 21, 31],
       [12, 22, 32],
       [13, 23, 33]])
</pre>
        <p>
         and meaning that the first dimension is now indexing what used to be the coloumns:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="coloumn">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
for col in np.transpose(a):
    print(col)
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
  
[10 20 30]
[11 21 31]
[12 22 32]
[13 23 33]
</pre>
        <p>
         These
         <i>
          "used to be coloumns"
         </i>
         -rows may of course be indexed. E.g. the 3rd coloumn of
         <code class="prettyprint python">
          a
         </code>
         can be gotten like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
np.transpose(a)[2]
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([12, 22, 32])
</pre>
        <p>
         Note that it does not matter whether the
         <code class="prettyprint python">
          transpose
         </code>
         function from the
         <i>
          NumPy package
         </i>
         is passed an
array as done above, or the
         <code class="prettyprint python">
          transpose
         </code>
         method on a
         <i>
          NumPy object
         </i>
         is invoked as done here:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
a.transpose()[2]
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([12, 22, 32])
</pre>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_138">
      </div>
      <div class="comments" id="issues_138">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_139">
     <div class="col-11">
      <h3>
       3.12 NumPy arrays V
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         A two-dimensional
         <i>
          NumPy array
         </i>
         , may be converted to a one-dimensional
one with the
         <code class="prettyprint python">
          flatten
         </code>
         method:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="flatten">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
a = np.array([[10, 11, 12, 13],
              [20, 21, 22, 23],
              [30, 31, 32, 33]])
a.flatten()
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([10, 11, 12, 13, 20, 21, 22, 23, 30, 31, 32, 33])
</pre>
        <p>
         Note how none of the methods,
         <a data-poload="transpose" href="#transpose">
          <code class="prettyprint python">
           transpose
          </code>
         </a>
         and
         <a data-poload="flatten" href="#flatten">
          <code class="prettyprint python">
           flatten
          </code>
         </a>
         , lead to an actual change of the
         <i>
          NumPy object
         </i>
         ,
which maintains its original shape:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
a
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([[10, 11, 12, 13],
       [20, 21, 22, 23],
       [30, 31, 32, 33]])
</pre>
        <p>
         Sometime, you may encounter a two-dimensional
         <i>
          NumPy array
         </i>
         with just one coloumn. Here we construct it deliberately:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
a = a.reshape(12,1)
a 
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([[10],
       [11],
       [12],
       [13],
       [20],
       [21],
       [22],
       [23],
       [30],
       [31],
       [32],
       [33]])
</pre>
        <p>
         Whenever that happens, you might consider calling the
         <code class="prettyprint python">
          squeeze
         </code>
         method to reduce the dimensionality:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="squeeze">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
a.squeeze()
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([10, 11, 12, 13, 20, 21, 22, 23, 30, 31, 32, 33])
</pre>
        <p>
         However, you may also take direct action and invoke the
         <code class="prettyprint python">
          reshape
         </code>
         method:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
a
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([[10, 11, 12, 13],
       [20, 21, 22, 23],
       [30, 31, 32, 33]])
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
a.reshape(12)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([10, 11, 12, 13, 20, 21, 22, 23, 30, 31, 32, 33])
</pre>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_139">
      </div>
      <div class="comments" id="issues_139">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1 id="how_to_do_an_ode">
      Matplotlib animations
     </h1>
    </div>
    <div class="row spy-padding" id="block_140">
     <div class="col-11">
      <h3>
       4.1 Example: Ball
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Here is a simple illustration of how to make an animation with matplotlib.
Some big chunks of code will be given in this section, and then every
bit will be explained in the next section.
We start by generating some data and plotting it as usual:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
import numpy as np
import matplotlib.pyplot as plt
plt.rc('font', size=16)

N = 101
xs = np.linspace(0,90,N)
ys = (100-((xs+10)%20-10)**2) * np.exp(-xs/30)
xs = xs * np.exp(-xs/200)

fig, ax = plt.subplots(figsize=(4, 6))
ax.axis('equal')
ax.plot(xs,ys)
</pre>
        <p>
         which produces this figure:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/bouncing_ball_figure.png">
              <img class="img-fluid" src="images/3.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Now to make an animation, we must import and use the
         <code class="prettyprint python">
          animation
         </code>
         module from
         <i>
          Matplotlib
         </i>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
from matplotlib import animation
plt.rc('animation', html='jshtml')

ball = ax.plot([],[],'ro')[0]

def update(i):
    ball.set_data(xs[i],ys[i])
    return [ball]

anim = animation.FuncAnimation(fig,
                               update,
                               frames=N,
                               interval=10,
                               blit=True)
anim
</pre>
        <p>
         where the final
         <code class="prettyprint python">
          anim
         </code>
         evaluation creates an animation widget that opens in the
         <i>
          Jupyter Notebook
         </i>
         like this (
         <i>
          You cannot click on the buttons of the widget in this book - only in the Jupyter Notebook
         </i>
         ):
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/bouncing_ball_widget.png">
              <img class="img-fluid" src="images/3.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         That behaves like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/bouncing_ball.gif">
              <img class="img-fluid" src="images/3.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_140">
      </div>
      <div class="comments" id="issues_140">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_141">
     <div class="col-11">
      <h3>
       4.2 Walk through
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Lets take the steps in the creation of the animation one by one. First, the
         <code class="prettyprint python">
          animation
         </code>
         module is imported
and some display setting is changed which enables the Jupyter Notebook to render the animation in a browser:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
from matplotlib import animation
plt.rc('animation', html='jshtml')
</pre>
        <p>
         Next, a
         <code class="prettyprint python">
          matplotlib.lines.Line2D
         </code>
         object is created when
calling
         <code class="prettyprint python">
          ax.plot
         </code>
         . The object is to become a red filled
circle because of the
         <code class="prettyprint python">
          'ro'
         </code>
         argument, but
to begin with it has no
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         - or
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         -coordinates (because of the
two empty list,
         <code class="prettyprint python">
          []
         </code>
         , arguments,
and will hence not show
up yet. Note the
         <code class="prettyprint python">
          [0]
         </code>
         that picks the first element of
the list returned by
         <code class="prettyprint python">
          ax.plot
         </code>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
ball = ax.plot([],[],'ro')[0]
</pre>
        <p>
         <code class="prettyprint python">
          ball
         </code>
         is now a
         <i>
          Python
         </i>
         object variable that allows us access the (not yet drawn) red filled circle. To do so, we
write a function,
         <code class="prettyprint python">
          update
         </code>
         , that takes an index
         <code class="prettyprint python">
          i
         </code>
         as an argument and changes the
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         coordinates of the red filled circle to the
         <span class="matematik">
         </span>
         <script type="math/tex">
          i
         </script>
         'th value in the two lists,
         <code class="prettyprint python">
          xs
         </code>
         and
         <code class="prettyprint python">
          ys
         </code>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="howto_code_update">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
def update(i):
    ball.set_data(xs[i],ys[i])
    return [ball]
</pre>
          </p>
         </div>
        </div>
        <p>
         Note how
         <code class="prettyprint python">
          update
         </code>
         returns
         <code class="prettyprint python">
          ball
         </code>
         as the only
element in a list
of drawing objects, i.e. it returns
         <code class="prettyprint python">
          [ball]
         </code>
         and not just
         <code class="prettyprint python">
          ball
         </code>
         .
        </p>
        <p>
         Now, all that remains to get the animation is to make the animation object like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="howto_code_animation_FuncAnimation">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
anim = animation.FuncAnimation(fig, # figure canvas as returned by plt.subplots()
                               update, # update and return a list of drawing objects
                               frames=N, # i in range(N), i passed to update 
                               interval=10, # delay between frames in ms
                               blit=True)
anim
</pre>
          </p>
         </div>
        </div>
        <p>
         where the
         <code class="prettyprint python">
          FuncAnimation
         </code>
         method calls our
         <code class="prettyprint python">
          update
         </code>
         function
         <code class="prettyprint python">
          frames=N
         </code>
         times
with the arguments from
         <span class="matematik">
         </span>
         <script type="math/tex">
          0
         </script>
         to
         <span class="matematik">
         </span>
         <script type="math/tex">
          N-1
         </script>
         , whereby the red filled circle gets all the calculated coordinates one by one. When
the call of
         <code class="prettyprint python">
          update
         </code>
         returns with the list
         <code class="prettyprint python">
          [ball]
         </code>
         ,
         <code class="prettyprint python">
          FuncAnimation
         </code>
         is advised
that the drawing object
         <code class="prettyprint python">
          ball
         </code>
         has changed and should be redrawn in the figure.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_141">
      </div>
      <div class="comments" id="issues_141">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_142">
     <div class="col-11">
      <h3>
       4.3 Creating a gif-file
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The animation can be stored as an animated gif-file with the following method. First we
check for the availability of an animation-write:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
print('Available writers:', animation.writers.list())
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
Available writers: ['pillow', 'html']
</pre>
        <p>
         and if
         <code class="prettyprint celloutput">
          'pillow'
         </code>
         is present, one may proceed with these two commands:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
writer = animation.writers['pillow'](fps=50) # frames per second
anim.save('bouncing_ball.gif', writer=writer)
</pre>
        <p>
         If
         <code class="prettyprint celloutput">
          'pillow'
         </code>
         is absent, you'll need to install it on your system.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_142">
      </div>
      <div class="comments" id="issues_142">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_143">
     <div class="col-11">
      <h3 id="how_to_rotate_square">
       4.4 Example: Square
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Figure elements of any shape may be animated. Here is an example for a
square that has one corner at the origin, side lengths of
         <span class="matematik">
         </span>
         <script type="math/tex">
          1
         </script>
         , and an
angle to the
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -axis of
         <span class="matematik">
         </span>
         <script type="math/tex">
          \theta
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/pyth21_square_schematic.png">
              <img class="img-fluid" src="images/3.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Naming the four corners
         <code class="prettyprint python">
          P0
         </code>
         ,
         <code class="prettyprint python">
          P1
         </code>
         ,
         <code class="prettyprint python">
          P2
         </code>
         ,
and
         <code class="prettyprint python">
          P3
         </code>
         , the coordinates for a given angle
may be calculated with
the
         <code class="prettyprint python">
          xy_of_theta
         </code>
         function as defined here:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
%matplotlib inline
import numpy as np
import matplotlib.pyplot as plt
np.set_printoptions(precision=3)
plt.rc('font', size=16)

def xy_of_theta(theta):
    vec1 = np.array([np.cos(theta),np.sin(theta)])
    vec2 = np.array([-np.sin(theta),np.cos(theta)])
    P0 = [0,0]
    P1 = vec1
    P2 = vec1 + vec2
    P3 = vec2
    x_of_theta = [P0[0],P1[0],P2[0],P3[0],P0[0]]
    y_of_theta = [P0[1],P1[1],P2[1],P3[1],P0[1]]
    return x_of_theta,y_of_theta
</pre>
        <p>
         Note how the coordinates of
         <code class="prettyprint python">
          P0
         </code>
         appear both at the beginning and at the
end of the returned coordinate lists. This means that the square can
be plotted  with Matplotlibs
         <code class="prettyprint python">
          pyplot.plot
         </code>
         function as done here:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
fig, ax = plt.subplots()
ax.axis('equal')
ax.grid()
ax.set_xlim(-3,3)
ax.set_ylim(-2,2)
ax.set_yticks(range(-1,2))

xs, ys = xy_of_theta(np.pi/6)
square = ax.plot(xs,ys)[0]
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/pyth21_rotating_square_01.png">
              <img class="img-fluid" src="images/3.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         When the square is plotted with
         <code class="prettyprint python">
          plot
         </code>
         , the first element
of the returned list is captured in
         <code class="prettyprint python">
          square
         </code>
         which
reveals that it is a Line2D object:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
square
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
&lt;matplotlib.lines.Line2D at 0x7fbc989f7850&gt;
</pre>
        <p>
         One may inspect the coordinates of the Line2D object with its
         <code class="prettyprint python">
          get_data
         </code>
         method:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
square.get_data()
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
(array([ 0.   ,  0.866,  0.366, -0.5  ,  0.   ]),
 array([0.   , 0.5  , 1.366, 0.866, 0.   ]))
</pre>
        <p>
         And the coordinates may be altered with the
         <code class="prettyprint python">
          set_data
         </code>
         method:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="linedd_set_data">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
xs, ys = xy_of_theta(np.pi/3) # new angle
square.set_data((xs,ys))
fig
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/pyth21_rotating_square_02.png">
              <img class="img-fluid" src="images/3.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         The
         <code class="prettyprint python">
          set_data
         </code>
         method can be used to make an animation,
where the square is being rotated:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
from matplotlib import animation
plt.rc('animation', html='jshtml')

N = 50

def update(i):
    theta = i * 2*np.pi/N
    xs, ys = xy_of_theta(theta)
    square.set_data((xs,ys))

    return [square]

anim = animation.FuncAnimation(fig,
                               update,
                               frames=N,
                               interval=10,
                               blit=True)
anim
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/rotating_square.gif">
              <img class="img-fluid" src="images/3.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Note, that this time, the counter,
         <code class="prettyprint python">
          i
         </code>
         , is used to
calculate a new angle that the first side of the square forms with the
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -axis.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_143">
      </div>
      <div class="comments" id="issues_143">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1 id="chapCOLONadvanced_python">
      Ordinary differential equations (ODEs)
     </h1>
    </div>
    <div class="row spy-padding" id="block_144">
     <div class="col-11">
      <h3 id="first_order_ode">
       5.1 A single ODE
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Here is an example of a first order
         <i>
          ordinary differential equation (ODE)
         </i>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="one_dim_ODE">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          \frac{dy}{dt}=0.9 y^2\cos t
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         The ODE is a so-called
         <i>
          initial value problem (IVP)
         </i>
         whose solution is well-defined once the initial value condition is specified. That may
e.g. be that the point:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="initial_value">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          (t,y)=(0,1)
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         is part of the solution.
        </p>
        <p>
         Assume we want to solve the
         <a data-poload="one_dim_ODE" href="#one_dim_ODE">
          ODE
         </a>
         for
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         -values fulfilling
         <span class="matematik">
         </span>
         <script type="math/tex">
          0\le t\le 3
         </script>
         , we may
start by declaring a
         <i>
          list
         </i>
         (or
         <i>
          tuple
         </i>
         or
         <i>
          NumPy array
         </i>
         ) with the initial and final
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         -values:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="solve_ivp_trange">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
tinit = 0
tfinal = 3
trange = [tinit,tfinal]
</pre>
          </p>
         </div>
        </div>
        <p>
         and a
         <i>
          list
         </i>
         (or
         <i>
          NumPy array
         </i>
         , but not a
         <i>
          tuple
         </i>
         ) with the
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         -value dictated by the initial value condition:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="solve_ivp_yinit">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
yinit = [1]
</pre>
          </p>
         </div>
        </div>
        <p>
         At this point, it may seem unnecessary to declare this value as a list, but that will turn out logical
once we are to solve several differential equations at the same time.
        </p>
        <p>
         As a final preparation, let us define a function that given
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         evaluates
         <span class="matematik">
         </span>
         <script type="math/tex">
          \displaystyle\frac{dy}{dt}
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="solve_ivp_dydt">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
import numpy as np
dydt = lambda t, y: 0.9 * y**2 * np.cos(t)
</pre>
          </p>
         </div>
        </div>
        <p>
         We are now ready to import
         <code class="prettyprint python">
          solve_ivp
         </code>
         from
         <code class="prettyprint python">
          scipy.integrate
         </code>
         and call
it like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="solve_ivp">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
from scipy.integrate import solve_ivp

mysol = solve_ivp(dydt, trange, yinit)
ts = mysol.t
ys = mysol.y[0]
</pre>
          </p>
         </div>
        </div>
        <p>
         There are three arguments for
         <code class="prettyprint python">
          solve_ivp
         </code>
         :
         <ul>
          <p>
          </p>
          <li>
           <p>
            <a data-poload="solve_ivp_dydt" href="#solve_ivp_dydt">
             <code class="prettyprint python">
              dydt
             </code>
            </a>
            is the function that implements the
            <a data-poload="one_dim_ODE" href="#one_dim_ODE">
             differential equation
            </a>
           </p>
          </li>
          <li>
           <p>
            <a data-poload="solve_ivp_trange" href="#solve_ivp_trange">
             <code class="prettyprint python">
              trange
             </code>
            </a>
            is a list with the starting and ending
            <span class="matematik">
            </span>
            <script type="math/tex">
             t
            </script>
            -values for which the differential equation
should be solved. Importantly, the first element of
            <code class="prettyprint python">
             trange
            </code>
            has to conform with that of the
            <a data-poload="initial_value" href="#initial_value">
             initial values
            </a>
            .
           </p>
          </li>
          <li>
           <p>
            <a data-poload="solve_ivp_yinit" href="#solve_ivp_yinit">
             <code class="prettyprint python">
              yinit
             </code>
            </a>
            is a list with the
            <span class="matematik">
            </span>
            <script type="math/tex">
             y
            </script>
            -value dictated by the
            <a data-poload="initial_value" href="#initial_value">
             initial values
            </a>
            .
           </p>
          </li>
         </ul>
         The
         <a data-poload="solve_ivp" href="#solve_ivp">
          <code class="prettyprint python">
           ts = mysol.t
          </code>
         </a>
         and
         <a data-poload="solve_ivp" href="#solve_ivp">
          <code class="prettyprint python">
           ys = mysol.y[0]
          </code>
         </a>
         following the call of
         <a data-poload="solve_ivp" href="#solve_ivp">
          <code class="prettyprint python">
           solve_ivp
          </code>
         </a>
         select from the output of the function,
the
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         values for which the differential equation was actually solved.
        </p>
        <p>
         These
         <span class="matematik">
         </span>
         <script type="math/tex">
          (t,y)
         </script>
         values may then be plotted with:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
import matplotlib.pyplot as plt

plt.rc('font', size=16)
fig,ax = plt.subplots(1,1)
ax.plot(ts,ys,'o',linestyle='--')
ax.grid()
ax.set_ylim([0,11])
ax.set_xlabel('$t$')
ax.set_ylabel('$y$')
</pre>
       </div>
       <div class="i2latextext mb-2">
        <div id="figure_one_dim_ODE">
         <div>
          <p>
           <div class="text-center">
            <p>
             <p>
              <a href="/media/2/img/one_dim_ode_1.png">
               <img class="img-fluid" src="images/4.png" style="max-width: 50%"/>
              </a>
             </p>
            </p>
           </div>
          </p>
         </div>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_144">
      </div>
      <div class="comments" id="issues_144">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_145">
     <div class="col-11">
      <h3 id="section_ode_more_datapoints">
       5.2 ODE: More datapoints
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Using
         <code class="prettyprint python">
          solve_ivp
         </code>
         to solve a differential equation, the user may
specify for which
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         -values, the solution is sought. That is done by adding
a keyword-argument
         <code class="prettyprint python">
          t_eval
         </code>
         with a
         <i>
          Python list
         </i>
         (or
         <i>
          NumPy array
         </i>
         )
containing the
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         values:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="t_eval">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
ts = np.linspace(tinit, tfinal, 100)
mysol = solve_ivp(dydt,
                  trange,
                  yinit,
                  t_eval=ts)
ts = mysol.t
ys = mysol.y[0]

ax.plot(ts,ys)
fig
</pre>
          </p>
         </div>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/one_dim_ode_2.png">
              <img class="img-fluid" src="images/4.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_145">
      </div>
      <div class="comments" id="issues_145">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_146">
     <div class="col-11">
      <h3 id="section_ode_backwards">
       5.3 ODE: Backwards integration
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Assume the
         <a data-poload="one_dim_ODE" href="#one_dim_ODE">
          differential equation
         </a>
         is to be solved with this initial value condition:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="new_initial_value">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          (t,y)=(9,\frac{5}{4})
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         and for
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         -values fulfilling
         <span class="matematik">
         </span>
         <script type="math/tex">
          4\le t\le 9
         </script>
         , i.e. for
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         values
         <i>
          before
         </i>
         that of the initial condition.
Well, it makes no difference to
         <code class="prettyprint python">
          solve_ivp
         </code>
         , that the integration now takes place from large
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         values to smaller ones. Only, it is important that the
         <i>
          first
         </i>
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         -value given conforms with that of
the
         <a data-poload="new_initial_value" href="#new_initial_value">
          initial value condition
         </a>
         . Thus, the
         <code class="prettyprint python">
          trange
         </code>
         and
         <code class="prettyprint python">
          yinit
         </code>
         must be changed into:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="new_ts">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
tinit = 9
tfinal = 4
trange = (tinit,tfinal)
yinit = [5/4]
</pre>
          </p>
         </div>
        </div>
        <p>
         After which, the same call of
         <a data-poload="solve_ivp" href="#solve_ivp">
          <code class="prettyprint python">
           solve_ivp
          </code>
         </a>
         can be made and the result be plotted:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
mysol = solve_ivp(dydt, trange, yinit)
ts = mysol.t
ys = mysol.y[0]

ax.plot(ts,ys,'o',linestyle='--')
ax.set_xlim([-1,10])
fig
</pre>
        <p>
         Note how
         <a data-poload="new_ts" href="#new_ts">
          <code class="prettyprint python">
           trange
          </code>
         </a>
         is defined so that the first
value is the one conforming with the new
         <a data-poload="new_initial_value" href="#new_initial_value">
          initial values
         </a>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="figure_one_dim_ODE_3">
         <div>
          <p>
           <div class="text-center">
            <p>
             <p>
              <a href="/media/2/img/one_dim_ode_3.png">
               <img class="img-fluid" src="images/4.png" style="max-width: 50%"/>
              </a>
             </p>
            </p>
           </div>
          </p>
         </div>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_146">
      </div>
      <div class="comments" id="issues_146">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_147">
     <div class="col-11">
      <h3 id="section_ode_accuracy">
       5.4 ODE: Accuracy
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The
         <a data-poload="one_dim_ODE" href="#one_dim_ODE">
          differential equation
         </a>
         above can be solve
by separation of the variables and integration. It turns out to have the exact
solution:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         y(t) = \frac{10 y_0}{10-9 y_0\left(\sin(t)-\sin(t_0)\right)}.
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Using initial values,
         <span class="matematik">
         </span>
         <script type="math/tex">
          (t_0,y_0)=(0,1)
         </script>
         , and solving until
         <span class="matematik">
         </span>
         <script type="math/tex">
          t=\pi
         </script>
         one
should thus get:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         y(t=\pi) = \frac{10}{10-9\left(\sin(\pi)-\sin(0)\right)} = \frac{10}{10} = 1
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         as the final value for
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         . Lets inspect that:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
tinit = 0
tfinal = np.pi
trange = [tinit,tfinal]
yinit = [1]
mysol = solve_ivp(dydt, trange, yinit)

ys = mysol.y[0]

# now print the final value for y, corresponding to y(tfinal) = y(t = pi)
ys[-1]
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
1.0107395513007404
</pre>
        <p>
         Well, that was not exactly the case. This is due to rounding errors
made by
         <code class="prettyprint python">
          solve_ivp
         </code>
         while solving the differential
equation.
        </p>
        <p>
         One may control the accuracy by setting e.g. a maximum step size for
the independent variable, here
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         , during the integration:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="code_max_step">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
mysol = solve_ivp(dydt, trange, yinit, max_step=1e-1)

ys = mysol.y[0]

ys[-1]
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
1.0000016575704107
</pre>
        <p>
         Here the maximum step size was set to
         <span class="matematik">
         </span>
         <script type="math/tex">
          0.1
         </script>
         and the numerical result
for
         <span class="matematik">
         </span>
         <script type="math/tex">
          y(\pi)
         </script>
         came much closer to exact
         <span class="matematik">
         </span>
         <script type="math/tex">
          1
         </script>
         .
        </p>
        <p>
         Using
         <code class="prettyprint python">
          np.logspace
         </code>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
np.logspace(0,-4,5)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
array([1.e+00, 1.e-01, 1.e-02, 1.e-03, 1.e-04])
</pre>
        <p>
         and a
         <a data-poload="list_comprehension" href="#list_comprehension">
          list comprehension
         </a>
         we may construct a
neat list of
         <code class="prettyprint python">
          max_step
         </code>
         -values and
         <span class="matematik">
         </span>
         <script type="math/tex">
          y(\pi)
         </script>
         -values in
this way:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
res = [(max_step, solve_ivp(dydt,trange,yinit,max_step=max_step).y[0][-1]) \
             for max_step in np.logspace(0,-4,5)]
res
</pre>
        <p>
         Perhaps not so easy to read. You might prefer to write it like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
res = []
for max_step in np.logspace(0,-4,5):
  mysol = solve_ivp(dydt, trange, yinit, max_step=max_step)
  ys = mysol.y[0]
  res.append((max_step, ys[-1]))
res
</pre>
        <p>
         They both give the exact same result, namely:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
[(1.0, 1.0107395513007404),
 (0.1, 1.0000016575704107),
 (0.01, 1.0000000000079718),
 (0.001, 0.9999999999999999),
 (0.0001, 0.9999999999999947)]
</pre>
        <p>
         i.e. practically
         <span class="matematik">
         </span>
         <script type="math/tex">
          1
         </script>
         with a sufficiently small value for
         <code class="prettyprint python">
          max_step
         </code>
         .
        </p>
        <p>
         Other arguments can be set when calling
         <code class="prettyprint python">
          solve_ivp
         </code>
         .
These include the
         <i>
          relative tolerance
         </i>
         ,
         <code class="prettyprint python">
          rtol
         </code>
         ,
and the
         <i>
          absolute tolerance
         </i>
         ,
         <code class="prettyprint python">
          atol
         </code>
         . You may find
more information
         <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.solve_ivp.html" target="_blank">
          here
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_147">
      </div>
      <div class="comments" id="issues_147">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_148">
     <div class="col-11">
      <h3 id="section_ode_coupled">
       5.5 ODEs: Coupled
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Consider these two differential equations:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="equations_odes_coupled">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          \begin{array}{rcl}
\displaystyle\frac{dy_0}{dt}&=&y_1\\
&&\\
\displaystyle\frac{dy_1}{dt}&=&-y_0-\displaystyle\frac{1}{10}y_1
\end{array}
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Since the evolution in time of
         <span class="matematik">
         </span>
         <script type="math/tex">
          y_0(t)
         </script>
         depends on
         <span class="matematik">
         </span>
         <script type="math/tex">
          y_1(t)
         </script>
         and vice versa, the equations
constitute a set of
         <i>
          coupled
         </i>
         differential equations.
        </p>
        <p>
         Given some initial value condition, e.g.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="equations_odes_coupled_initial_condition">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          \begin{array}{rcl}
y_0(t=0)&=&1\\
&&\\
y_1(t=0)&=&-1
\end{array}
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         the problem of finding
         <span class="matematik">
         </span>
         <script type="math/tex">
          y_0(t)
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          y_1(t)
         </script>
         until some later time,
e.g.
         <span class="matematik">
         </span>
         <script type="math/tex">
          t_\mathrm{final}=20
         </script>
         , may be solved with
         <code class="prettyprint python">
          solve_ivp
         </code>
         like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="code_odes_coupled">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
from scipy.integrate import solve_ivp

tinit = 0
tfinal = 20
trange = [tinit,tfinal]
yinit = [1,-1]

dydt = lambda t, y: [y[1],-y[0]-1/10*y[1]]
mysol = solve_ivp(dydt, trange, yinit)
ts = mysol.t
y0s = mysol.y[0]
y1s = mysol.y[1]
</pre>
          </p>
         </div>
        </div>
        <p>
         Compared to the situation with
         <a data-poload="solve_ivp" href="#solve_ivp">
          a single ODE
         </a>
         , a number of things has happened:
         <ul>
          <p>
          </p>
          <li>
           <p>
            the function
            <code class="prettyprint python">
             dydt
            </code>
            now assumes that its 2nd argument is a list with two elements,
            <span class="matematik">
            </span>
            <script type="math/tex">
             y_0
            </script>
            and
            <span class="matematik">
            </span>
            <script type="math/tex">
             y_1
            </script>
            .
           </p>
          </li>
          <li>
           <p>
            the function
            <code class="prettyprint python">
             dydt
            </code>
            returns a list of the right-hand sides of
            <i>
             both
            </i>
            differential equations, i.e. it returns
            <span class="matematik">
            </span>
            <script type="math/tex">
             \Bigl[\displaystyle\frac{dy_0}{dt},\frac{dy_1}{dt}\Bigr]
            </script>
            .
           </p>
          </li>
          <li>
           <p>
            the initial value for the dependent variable,
            <code class="prettyprint python">
             yinit
            </code>
            , is now a list
            <span class="matematik">
            </span>
            <script type="math/tex">
             \Bigl[y_0,y_1\Bigr]
            </script>
           </p>
          </li>
          <li>
           <p>
            two lists of solutions (for
            <span class="matematik">
            </span>
            <script type="math/tex">
             y_0
            </script>
            and
            <span class="matematik">
            </span>
            <script type="math/tex">
             y_1
            </script>
            , respectively) are extracted from the result of
            <code class="prettyprint python">
             solve_ivp
            </code>
            with the
            <code class="prettyprint python">
             mysol.y[0]
            </code>
            and
            <code class="prettyprint python">
             mysol.y[1]
            </code>
            statements.
           </p>
          </li>
         </ul>
         When plotted with these commands:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
import matplotlib.pyplot as plt
plt.rc('font', size=16)

fig, ax = plt.subplots()
ax.plot(ts,y0s,linestyle='dashed',marker='o')
ax.plot(ts,y1s,linestyle='dashed',marker='x')
ax.set_xlabel('$t$')
ax.set_ylabel('$y$')
ax.legend(['$y_0$','$y_1$'])
</pre>
        <p>
         the solution looks like this
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="figure_ode_coupled_1">
         <div>
          <p>
           <div class="text-center">
            <p>
             <p>
              <a href="/media/2/img/ode_coupled_1.png">
               <img class="img-fluid" src="images/4.png" style="max-width: 50%"/>
              </a>
             </p>
            </p>
           </div>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_148">
      </div>
      <div class="comments" id="issues_148">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_149">
     <div class="col-11">
      <h3>
       5.6 Different naming of variables
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Consider if we had encounted the exact same set of differential equations, only with another naming of the dependent variables, e.g.:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="coupled_r_w">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          \begin{array}{rcl}
\displaystyle\frac{dr}{dt}&=&w\\
&&\\
\displaystyle\frac{dw}{dt}&=&-r-\displaystyle\frac{1}{10}w
\end{array}
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         with the initial value condition:
         <span class="matematik">
         </span>
         <script type="math/tex">
          r=1
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          w=-1
         </script>
         for
         <span class="matematik">
         </span>
         <script type="math/tex">
          t=0
         </script>
         . Well,
obviously, the solution would be the same, and the
above
         <i>
          Python
         </i>
         program would do the job. However, it would be
neat the write the program with a naming convention for the variables
that is closer to the problem as it is formulated. That could for instance
be achieved by writing:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
tinit = 0
tfinal = 20
trange = [tinit,tfinal]
rinit = 1
winit = -1
yinit = [rinit,winit]

def dydt(t,y):
    r = y[0]
    w = y[1]
    drdt = w
    dwdt = -r - 1/10 * w
    return [drdt,dwdt]
    
mysol = solve_ivp(dydt, trange, yinit)
ts = mysol.t
rs = mysol.y[0]
ws = mysol.y[1]
</pre>
        <p>
         which provides the exact same solution:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="figure_ode_coupled_2">
         <div>
          <p>
           <div class="text-center">
            <p>
             <p>
              <a href="/media/2/img/ode_coupled_2.png">
               <img class="img-fluid" src="images/4.png" style="max-width: 50%"/>
              </a>
             </p>
            </p>
           </div>
          </p>
         </div>
        </div>
        <p>
         Note how the function
         <code class="prettyprint python">
          dydt
         </code>
         evaluating the right-hand side of the differential equations
has been defined at length, rather than in the compact form of a lambda-function. This in particular
allows for the section,
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    r = y[0]
    w = y[1]
</pre>
        <p>
         where the original naming of variables is recoved, so that when the right-hand sides of the differential
equations are evaluated, they become readable:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    drdt = w
    dwdt = -r - 1/10 * w
</pre>
        <p>
         and hence immediately recognizable compared to the
         <a data-poload="coupled_r_w" href="#coupled_r_w">
          problem formulation
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_149">
      </div>
      <div class="comments" id="issues_149">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_150">
     <div class="col-11">
      <h3 id="section_ode_2nd_order">
       5.7 ODE: 2nd order
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         A 2nd order differential equation with one dependent variable generally looks like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \frac{d^2x}{dt^2}=f(x,\frac{dx}{dt}),
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          f(x,\displaystyle\frac{dx}{dt})
         </script>
         may be anything. Consider as an example that we want to solve:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \frac{d^2x}{dt^2}=-x-\frac{1}{10}\frac{dx}{dt}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         and that the initial value condition is specified as
         <span class="matematik">
         </span>
         <script type="math/tex">
          x(t=0)=1
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \displaystyle\left.\frac{dx}{dt}\right|_{t=0}=-1
         </script>
         .
        </p>
        <p>
         Introducing a "helper"-variable,
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         v=\displaystyle\frac{dx}{dt},
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         we may rewrite the 2nd order differential equation as two 1st order differential equations without loss of generality:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
\displaystyle\frac{dx}{dt}&=&v\\
\\
\displaystyle\frac{dv}{dt}&=&-x-\displaystyle\frac{1}{10}v
\end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         whereby the initial value condition becomes
         <span class="matematik">
         </span>
         <script type="math/tex">
          x(t=0)=1
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          v(t=0)=-1
         </script>
         .
        </p>
        <p>
         As a consequence of the rewriting, the 2nd order differential equation has turned into a set of coupled 1st order differential
equations, that looks exactly like
         <a data-poload="equations_odes_coupled" href="#equations_odes_coupled">
          some
         </a>
         we have already solved with
         <a data-poload="code_odes_coupled" href="#code_odes_coupled">
          <code class="prettyprint python">
           solve_ivp
          </code>
         </a>
         . Adopting the same code, but using the present variable names, it may look like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
from scipy.integrate import solve_ivp
import matplotlib.pyplot as plt

tinit = 0
tfinal = 12
trange = [tinit,tfinal]
x0 = 1
v0 = -1
yinit = [x0,v0]

def dydt(t,y):
    x = y[0]
    v = y[1]
    dxdt = v
    dvdt = -x - 1/10 * v
    return [dxdt,dvdt]

mysol = solve_ivp(dydt, trange, yinit)
ts = mysol.t
xs = mysol.y[0]
vs = mysol.y[1]

plt.rc('font', size=16)
fig,ax = plt.subplots(1,1)
ax.plot(ts,xs,'o',linestyle='--')
ax.plot(ts,vs,'x',linestyle='--')
ax.grid()
ax.set_xlim([-1,13])
ax.set_xlabel('$t$')
ax.set_ylabel('$x,v$')
ax.legend(['$x$',r'$v=\frac{dx}{dt}$'])
</pre>
        <p>
         whereby we have solved a 2nd order differential equation. The plot looks like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="figure_ode_2nd_order_1">
         <div>
          <p>
           <div class="text-center">
            <p>
             <p>
              <a href="/media/2/img/ode_2nd_order_1.png">
               <img class="img-fluid" src="images/4.png" style="max-width: 50%"/>
              </a>
             </p>
            </p>
           </div>
          </p>
         </div>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_150">
      </div>
      <div class="comments" id="issues_150">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_151">
     <div class="col-11">
      <h3 id="section_ode_vectors">
       5.8 ODEs: Vectors
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Sometimes your coupled first order differential equations involve vectors.
As an example, consider an object at position
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{r}
         </script>
         moving with some time and position dependent velocity,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{v}(t,\mathbf{r})
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \frac{d}{dt}\mathbf{r} = \mathbf{v}(t,\mathbf{r})
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         It could be a robot at
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{r}
         </script>
         that moves with speed
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="robot_speed">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          v = \sqrt{1-\frac{y^2}{y_0^2}}v_0
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         (
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         is the
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         -coordinate of
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{r}
         </script>
         ,
         <span class="matematik">
         </span>
         <script type="math/tex">
          y_0
         </script>
         is a
length scale, and
         <span class="matematik">
         </span>
         <script type="math/tex">
          v_0
         </script>
         is reference speed)
in the direction of a moving human, who at time
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         is at 
position
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{r}_h
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathbf{r}_h = \left[\begin{array}{c}v_0\cdot t\\0\end{array}\right].
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         The human thus moves with constant speed along the
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -axis.
        </p>
        <p>
         The situation thus looks like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/ode_vector_box_schematic.png">
              <img class="img-fluid" src="images/4.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         The vector
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{d}
         </script>
         connects the robot with the human:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathbf{d} = \mathbf{r}_h - \mathbf{r},
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         and the vector
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{\hat{d}}
         </script>
         is a vector
of unit length in the direction of
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{d}
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathbf{\hat{d}} = \frac{\mathbf{d}}{\left|\mathbf{d}\right|}.
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Now, wrapped together we have:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \frac{d}{dt}\mathbf{r} = 
\sqrt{1-\frac{y^2}{y_0^2}}v_0\>\mathbf{\hat{d}}.
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Solving this equation in Python using
         <code class="prettyprint python">
          solve_ivp
         </code>
         turns
out to be quite simple if the formulation in terms of vectors is
maintained.
It may be done like shown here:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
import numpy as np
from scipy.integrate import solve_ivp

x0 = 0
y0 = 1
rinit = [x0,y0 - 1e-6] # must be smaller than y0 to get non-zero velocity

tinit = 0
tfinal = 20
trange = [tinit,tfinal]

ts = np.linspace(tinit,tfinal,5)

v0 = 0.1

def drdt(t, r):
    r = np.array(r)
    rh = np.array([v0 * t, 0])
    d = rh - r
    dhat = d/np.linalg.norm(d)
    y = r[1]                        # here y is extracted
    v = np.sqrt(1-y**2/y0**2) * v0
    drdt = v * dhat
    return drdt
    
mysol = solve_ivp(drdt, trange, rinit, max_step=1e-2,
                  t_eval=ts)
ts = mysol.t
xs = mysol.y[0]
ys = mysol.y[1]
</pre>
        <p>
         Now the solution may be plotted:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
%matplotlib inline
import matplotlib.pyplot as plt
plt.rc('font', size=16)

fig, ax = plt.subplots()
ax.set_aspect('equal', adjustable='box')
ax.grid()
ax.plot(xs,ys,linestyle='dashed',marker='o')
ax.set_xlabel('$x$')
ax.set_ylabel('$y$')
ax.set_xticks(list(np.arange(0,y0*2.2,y0*0.5)))
ax.set_yticks(list(np.arange(0,y0*1.2,y0*0.5)))

ax.text(xs[-1]+0.1,ys[-1],'({:.3f},{:.3f})'.format(xs[-1],ys[-1]),ha='left')
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/ode_vector_box_constant_proj_vel_1.png">
              <img class="img-fluid" src="images/4.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         And colored lines connecting the robot and the human may be plotted
and their lengths be evaluated and printed:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
lens = []
for t,x,y in zip(ts,xs,ys):
    lxs = [x,v0*t]
    lys = [y,0]
    ax.plot(lxs,lys)
    lens.append(np.linalg.norm([np.diff(lxs),np.diff(lys)]))
print(lens)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
[0.999999, 0.9993456911625648, 0.9989227148074187, 0.9987202276021728, 0.9986372994529613]
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/ode_vector_box_constant_proj_vel_2.png">
              <img class="img-fluid" src="images/4.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         It is seen that with the particular choice of
         <a data-poload="robot_speed" href="#robot_speed">
          speed
         </a>
         , the distance between the robot and the
human remains constant.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_151">
      </div>
      <div class="comments" id="issues_151">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_152">
     <div class="col-11">
      <h3 id="section_second_ode_vectors">
       5.9 Second order ODE with vectors
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Consider two objects in space, a sun at the origin of a coordinate
system, and a planet at position
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{r}
         </script>
         . The sun excerts a
gravitational force on the planet according to:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathbf{F} = -\frac{Gm_{sun}m}{\left|\mathbf{r}\right|^3}\mathbf{r}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          m_{sun}
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          m
         </script>
         are the masses of the sun and the planet,
respectively.
         <span class="matematik">
         </span>
         <script type="math/tex">
          G
         </script>
         is the gravitional force constant.
        </p>
        <p>
         Assuming that the sun remains at the origin, Newtons 2nd law for this
system is:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         m\frac{d^2}{dt^2}\mathbf{r}=\mathbf{F}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         which can be cast in the form of two 1st order differential equations
involving the position and velocity vectors,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{r}
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{v}
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="two_diff_eq_for_solar_system">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          \begin{array}{rcl}
\displaystyle\frac{d}{dt}\mathbf{r}&=&\mathbf{v}\\
&&\\
\displaystyle\frac{d}{dt}\mathbf{v}&=&-\displaystyle\frac{Gm_{sun}}{\left|\mathbf{r}\right|^3}\mathbf{r}
\end{array}
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         These first order differential equations may be solved using
         <code class="prettyprint python">
          solve_ivp
         </code>
         while keeping strictly to the vector
formulation. This will be shown below.
        </p>
        <p>
         We start by the usual import statements and some constants:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
%%capture

import numpy as np
from scipy.integrate import solve_ivp
from scipy.linalg import norm


import matplotlib.pyplot as plt
from matplotlib import animation, rc
rc('animation', html='jshtml')

G=1
m_sun=10
</pre>
        <p>
         Then follows the declaration of the initial condition. Since the
         <a data-poload="two_diff_eq_for_solar_system" href="#two_diff_eq_for_solar_system">
          two first order vectorial differential equations
         </a>
         involve a total of
four dependent variables, the initial condition is a list of four
numbers. Here it is decided that they come in the order
         <span class="matematik">
         </span>
         <script type="math/tex">
          r_x
         </script>
         ,
         <span class="matematik">
         </span>
         <script type="math/tex">
          r_y
         </script>
         ,
         <span class="matematik">
         </span>
         <script type="math/tex">
          v_x
         </script>
         , and
         <span class="matematik">
         </span>
         <script type="math/tex">
          v_y
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
r0=[1,0]
v0=[0,2]
y0=np.concatenate((r0,v0))
</pre>
        <p>
         Having decided on the order in which the dependent variables are stored
in the four membered list, the list must be unpacked like that when
it arrives as
         <code class="prettyprint python">
          y
         </code>
         in the function
         <code class="prettyprint python">
          dydt(t,y)
         </code>
         .
So writing this function, it should start by
acknowledging that its second argument,
         <code class="prettyprint python">
          y
         </code>
         , is a list
whose first two elements are the
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathrm{r}
         </script>
         -vector, and whose two last
elements are the
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathrm{v}
         </script>
         -vector. This is done here and is
followed by the mathematical operations on the vectors according to the
         <a data-poload="two_diff_eq_for_solar_system" href="#two_diff_eq_for_solar_system">
          two differential equations
         </a>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
def dydt(t,y):
    r = y[:2]
    v = y[2:]
    drdt = v
    dvdt = -G*m_sun/np.power(norm(r),3)*r
    return np.concatenate((drdt,dvdt))
</pre>
        <p>
         The function ends by assembling with
         <code class="prettyprint python">
          np.concatenate
         </code>
         the two vectorial differentials,
         <code class="prettyprint python">
          drdt
         </code>
         and
         <code class="prettyprint python">
          dvdt
         </code>
         , into a full four-membered list which is returned
to the calling
         <code class="prettyprint python">
          solve_ivp
         </code>
         .
        </p>
        <p>
         With the chosen constants, the orbital period of the planet around the
sun is
         <span class="matematik">
         </span>
         <script type="math/tex">
          1
         </script>
         time unit. Here we declare that 150 images are wanted per
revolution and that one revolution is desired:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
t_end = 1
steps=150*t_end
times=np.linspace(0,t_end,steps)
</pre>
        <p>
         Finally
         <code class="prettyprint python">
          solve_ivp
         </code>
         is called and the resulting
         <span class="matematik">
         </span>
         <script type="math/tex">
          r_x(t)
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          r_y(t)
         </script>
         coordinates are extracted as the first two lists in the
         <code class="prettyprint python">
          .y
         </code>
         attribute on object returned from
         <code class="prettyprint python">
          solve_ivp
         </code>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
solution = solve_ivp(dydt, [0, t_end], y0, max_step=1e-3, t_eval=times)
xs=solution.y[0]
ys=solution.y[1]
</pre>
        <p>
         Had one desired the
         <span class="matematik">
         </span>
         <script type="math/tex">
          v_x(t)
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          v_y(t)
         </script>
         solutions, they could have
been extracted as
         <code class="prettyprint python">
          solution.y[2]
         </code>
         and
         <code class="prettyprint python">
          solution.y[3]
         </code>
         .
        </p>
        <p>
         Finally follows an animation:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
def update(i):
    line.set_data(xs[0:i+1], ys[0:i+1])
    planet_dot.set_data(xs[i],ys[i])
    return line, planet_dot

fig, ax = plt.subplots(figsize=(4, 4))
line, = ax.plot([], [])
planet_dot, = ax.plot([],[],'ro')
ax.plot(0,0,'bo')
ax.set_xlim([-1.2, 1.2])
ax.set_ylim([-1.2, 1.2])
ax.set_xticks([])
ax.set_yticks([])

anim = animation.FuncAnimation(fig,
                               update,
                               frames=steps,
                               interval=10,
                               blit=True,
                               repeat_delay=0)
anim
</pre>
        <p>
         and the whole thing eventually looks like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/comet_around_sun.gif">
              <img class="img-fluid" src="images/4.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_152">
      </div>
      <div class="comments" id="issues_152">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_153">
     <div class="col-11">
      <h3 id="section_ode_events_introduction">
       5.10 ODE Events
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Solving differential equations, we are often interesting in knowing if certains events occur
and if so at what time. For instance, if you solve a differential
equation for a ball falling in a gravitational field, you might want
to know the time for which the ball hits the ground, and stop the
integration of the differential equation at that time.
        </p>
        <p>
         Using
         <code class="prettyprint python">
          solve_ivp
         </code>
         it is possible to provide extra functions,
         <i>
          event-functions
         </i>
         , that monitor mathematically
if any events occur. Each function must take the same input as the
         <code class="prettyprint python">
          dydt
         </code>
         -function (the first
argument of
         <code class="prettyprint python">
          solve_ivp
         </code>
         ), and must return a float which is a continuous value being
a function of the independent and dependent variables in the problem. Given one or several such event-functions,
         <code class="prettyprint python">
          solve_ivp
         </code>
         will monitor if there are any sign-changes in the floats of the event-functions, while
it solves the differential equations.
If so, the precise times at which that happens will be evaluated and returned in the end. If the event-function
whose float is changing sign has an attribute,
         <code class="prettyprint python">
          .terminal
         </code>
         set to
         <code class="prettyprint python">
          True
         </code>
         , then
         <code class="prettyprint python">
          solve_ivp
         </code>
         will further stop at the time of the event.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_153">
      </div>
      <div class="comments" id="issues_153">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_154">
     <div class="col-11">
      <h3 id="section_ode_events_collect_values">
       5.11 Collect values
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         As a first example consider that we are solving:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \frac{dy}{dt}=0.9 y^2\cos t,\quad (t,y)=(0,1)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         and are interested in knowing at which times,
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         , the variable
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         become
         <span class="matematik">
         </span>
         <script type="math/tex">
          5
         </script>
         . To do this we have to introduce an event function that
changes sign continuously whenever
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         becomes
         <span class="matematik">
         </span>
         <script type="math/tex">
          5
         </script>
         . An obvious choice
would be:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         f(y) = y-5,
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         but other functions would be equally good, e.g.:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         f_\mathrm{alt-1}(y) = 5-y,
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         or
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         f_\mathrm{alt-2}(y) = \exp(y-5) -1.
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Now using the simplest choice,
         <span class="matematik">
         </span>
         <script type="math/tex">
          f
         </script>
         , it looks like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
%matplotlib inline
from scipy.integrate import solve_ivp
import numpy as np
import matplotlib.pyplot as plt
plt.rc('font', size=16)

tinit = 0
tfinal = 10
trange = [tinit,tfinal]
t_eval = np.linspace(tinit,tfinal,100)
yinit = np.array([1]) # the event function requires it to be np.array

dydt = lambda t, y: 0.9 * y**2 * np.cos(t)

# define the event function with the
# independent and dependent variable as input
f = lambda t, y: y - 5

# supply it in a list as value for keyword "events":
mysol = solve_ivp(dydt, trange, yinit, t_eval=t_eval, max_step=1e-2,
                  events=[f])
ts = mysol.t
ys = mysol.y[0]

# now extract the times at which the events occurred
t_events = mysol.t_events[0] # [0] because we want output from the
                             # first (and only) event function
print(t_events)

fig,ax = plt.subplots(1,1)
ax.plot(ts,ys)
ax.grid()
ax.set_ylim([0,11])
ax.set_xlabel('$t$')
ax.set_ylabel('$y$')

ax.scatter(t_events,5 * np.ones(t_events.shape))

fig.tight_layout()
fig.savefig('ode_events_1.png')
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
[1.09491408 2.04667858 7.37809938 8.32986388]
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/ode_events_1.png">
              <img class="img-fluid" src="images/4.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_154">
      </div>
      <div class="comments" id="issues_154">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_155">
     <div class="col-11">
      <h3 id="section_ode_events_two_event_functions">
       5.12 Two event functions
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Here we add one more event function that monitors whenever the
condition:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         y = t
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         if fulfilled.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
%matplotlib inline
from scipy.integrate import solve_ivp
import numpy as np
import matplotlib.pyplot as plt
plt.rc('font', size=16)

tinit = 0
tfinal = 10
trange = [tinit,tfinal]
t_eval = np.linspace(tinit,tfinal,100)
yinit = np.array([1])

dydt = lambda t, y: 0.9 * y**2 * np.cos(t)

# define the event functions 
f = lambda t, y: y - 5
g = lambda t, y: y - t

# supply it in a list as value for keyword "events":
mysol = solve_ivp(dydt, trange, yinit, t_eval=t_eval, max_step=1e-2,
                  events=[f,g]) # provide two event functions
ts = mysol.t
ys = mysol.y[0]

t_events_f = mysol.t_events[0] # times for events with f
t_events_g = mysol.t_events[1] # times for events with g

fig,ax = plt.subplots(1,1)
ax.plot(ts,ys)
ax.grid()
ax.set_ylim([0,11])
ax.set_xlabel('$t$')
ax.set_ylabel('$y$')

print(t_events)
ax.scatter(t_events_f,5 * np.ones(t_events_f.shape))
ax.plot(t_events_g,t_events_g,marker='s',linestyle='dashed')

fig.tight_layout()
fig.savefig('ode_events_2.png')
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/ode_events_2.png">
              <img class="img-fluid" src="images/4.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_155">
      </div>
      <div class="comments" id="issues_155">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_156">
     <div class="col-11">
      <h3 id="section_ode_events_stop_integration">
       5.13 Stop integration
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         When event functions are defined using
         <code class="prettyprint python">
          def
         </code>
         , the
resulting function may be given any of the two attributes
         <code class="prettyprint python">
          .direction
         </code>
         and
         <code class="prettyprint python">
          .terminal
         </code>
         .
        </p>
        <p>
         If the
         <code class="prettyprint python">
          .direction
         </code>
         attribute is set to some
         <i>
          positive
         </i>
         value, it means that
         <code class="prettyprint python">
          solve_ivp
         </code>
         should
only consider an event to occur if the event function changes its
value in ascending direction (from negative to positive). Likewise, if
the
         <code class="prettyprint python">
          .direction
         </code>
         attribute is set to some
         <i>
          negative
         </i>
         value, it means that an event has only occured
whenever
the event function changes in descending direction (from positive to negative).
        </p>
        <p>
         If the
         <code class="prettyprint python">
          .terminal
         </code>
         attribute is set,
         <code class="prettyprint python">
          solve_ivp
         </code>
         should stop its integration whenever the
first event occurs according to this event function.
        </p>
        <p>
         Here is an example:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
%matplotlib inline
from scipy.integrate import solve_ivp
import numpy as np
import matplotlib.pyplot as plt
plt.rc('font', size=16)

tinit = 0
tfinal = 10
trange = [tinit,tfinal]
yinit = np.array([1])

dydt = lambda t, y: 0.9 * y**2 * np.cos(t)

# define an event function 
def f(t,y):
    return y - 5

f.direction = -1    # only event if f changes sign while decreasing
f.terminal = True   # solve_ivp should stop

mysol = solve_ivp(dydt, trange, yinit, max_step=1e-2,
                  events=[f])
ts = mysol.t
ys = mysol.y[0]

t_events = mysol.t_events[0] # times for events with f

fig,ax = plt.subplots(1,1)
ax.plot(ts,ys)
ax.grid()
ax.set_ylim([0,11])
ax.set_xlabel('$t$')
ax.set_ylabel('$y$')

print(t_events)
ax.scatter(t_events,5 * np.ones(t_events.shape))

fig.tight_layout()
fig.savefig('ode_events_3.png')
</pre>
        <p>
         And the differential equation is now only solved up to the point that
the event function,
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         f(y) = y - 5
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         is changing from positive to negative for the first time, as evidenced
by the resulting figure:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/ode_events_3.png">
              <img class="img-fluid" src="images/4.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_156">
      </div>
      <div class="comments" id="issues_156">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Object-oriented Python
     </h1>
    </div>
    <div class="row spy-padding" id="block_157">
     <div class="col-11">
      <h3>
       6.1 Object oriented Python
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Much programming in a computer language like
         <i>
          Python
         </i>
         is about
handling data. Often, when writing such programs, a programmer
wants to be able to:
         <ul>
          <p>
          </p>
          <li>
           <p>
            reuse parts of the code when data or operations on it take a new form, rewriting only the
necessary parts of the code
           </p>
          </li>
          <li>
           <p>
            shield parts of the code (e.g. variables and functions) from other parts of the
code to help collaborators assess the code in self-contained chunks
           </p>
          </li>
          <li>
           <p>
            develop a higher level of abstraction when handling the data, not having to care
everywhere in your code about how exactly data is represented
           </p>
          </li>
         </ul>
         These objectives may be achieved in
         <i>
          Object Oriented Programming
         </i>
         in which
the data is referred to by object variables that are constructed in such a way that
         <i>
          "they know by themselves how operations are made on the data"
         </i>
         .
        </p>
        <p>
         In the following sections, it is shown how this is done in
         <i>
          Python
         </i>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_157">
      </div>
      <div class="comments" id="issues_157">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_158">
     <div class="col-11">
      <h3>
       6.2 Classes and objects
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         A
         <i>
          Python class
         </i>
         is a means to store data in some organized manner.
The simplest possible declaration of a class, one that contains no data looks like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class EmptyClass():
    pass
</pre>
        <p>
         The class has the name
         <code class="prettyprint python">
          EmptyClass
         </code>
         and does nothing because of the
         <code class="prettyprint python">
          pass
         </code>
         statement.
Instances of a class are called
         <i>
          Python objects
         </i>
         . They are created by calling the class as if it were
a function. Here two objects, two instances of class
         <code class="prettyprint python">
          EmptyClass
         </code>
         , are created and inspected with the
         <code class="prettyprint python">
          print
         </code>
         function:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
object1 = EmptyClass()
print(object1)
object2 = EmptyClass()
print(object2)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
&lt;__main__.EmptyClass object at 0x11260dad0&gt;
&lt;__main__.EmptyClass object at 0x1127f1fd0&gt;
</pre>
        <p>
         By default, the
         <code class="prettyprint python">
          print
         </code>
         function reveals the memory location of the objects, and it is seen that
the two empty objects are located at different positions in the memory. Asking if the two objects are the same:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
print('object1 == object2:', object1 == object2)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
object1 == object2: False
</pre>
        <p>
         we get the answer that they
         <i>
          are not
         </i>
         , which is a little funny since they are both empty. We shall return to that below.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_158">
      </div>
      <div class="comments" id="issues_158">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_159">
     <div class="col-11">
      <h3>
       6.3 Methods I
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The class declaration normally involves some definitions of functions, so-called
         <i>
          Python methods
         </i>
         , that
act on the objects. As a first example, consider that a method
         <code class="prettyprint python">
          id_as_string()
         </code>
         is added to
the
         <code class="prettyprint python">
          ClassWithMethod
         </code>
         class:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class ClassWithMethod():
  
    def id_as_string(self):
        return str(hex(id(self)))
</pre>
        <p>
         The method takes one argument,
         <code class="prettyprint python">
          self
         </code>
         , which a reference to the instance of the class. Now, making
one such instance, we may call the method, by adding a
         <code class="prettyprint python">
          .
         </code>
         and the
         <code class="prettyprint python">
          id_as_string()
         </code>
         after the variable name, here
         <code class="prettyprint python">
          object1
         </code>
         , referring to the instance:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
object1 = ClassWithMethod()
print('object1: ',object1)
object1.id_as_string()
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="built_in_str">
         <div>
          <p>
           <pre class="prettyprint celloutput mb-0">
object1:  &lt;__main__.ClassWithMethod object at 0x11260da50&gt;
'0x11260da50'
</pre>
          </p>
         </div>
        </div>
        <p>
         Note how the
         <code class="prettyprint python">
          id_as_string()
         </code>
         method is defined in the class declaration as if it takes an argument,
         <code class="prettyprint python">
          self
         </code>
         while we do not provide that argument when the method is invoked as in
         <code class="prettyprint python">
          object1.id_as_string()
         </code>
         .
This comes about because
         <i>
          Python
         </i>
         is providing that argument for us behind the scene. In fact,
         <code class="prettyprint python">
          object1.id_as_string()
         </code>
         carries enough information to provide the proper value for
         <code class="prettyprint python">
          self
         </code>
         ,
namely the object
         <code class="prettyprint python">
          object1
         </code>
         preceding the
         <code class="prettyprint python">
          .id_as_string()
         </code>
         . Thus
         <i>
          Python
         </i>
         does not
need us to declare that first argument. It is a little funny, but you will get use to it. If you try to give it anyhow:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
object1.id_as_string(object1)
</pre>
        <p>
         You will get this error message:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
TypeError: id_as_string() takes 1 positional argument but 2 were given
</pre>
        <p>
         that tells you that the method got two arguments, which are in fact the
         <code class="prettyprint python">
          object1
         </code>
         that
         <i>
          Python
         </i>
         provided from
         <code class="prettyprint python">
          object1.
         </code>
         and the
         <code class="prettyprint python">
          object1
         </code>
         that you gave in
         <code class="prettyprint python">
          .id_as_string(object1)
         </code>
         .
        </p>
        <p>
         So far, our use of a class and some objects being instances of that class looks ugly, but don't despair, it a minute
it will appear highly logical and useful.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_159">
      </div>
      <div class="comments" id="issues_159">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_160">
     <div class="col-11">
      <h3>
       6.4 Built-in methods
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         It turns out that when the
         <code class="prettyprint python">
          print
         </code>
         function refers to a
         <i>
          Python object
         </i>
         , it calls
a method called
         <code class="prettyprint python">
          __str__()
         </code>
         on the object.
I.e. the
         <a data-poload="built_in_str" href="#built_in_str">
          <code class="prettyprint python">
           &lt;__main__.ClassWithMethod object at 0x11260da50&gt;
          </code>
         </a>
         output is the result of the
         <code class="prettyprint python">
          print
         </code>
         function performing a
         <code class="prettyprint python">
          object1.__str__()
         </code>
         evaluation. We may alter that very method in the class definition e.g. like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class SelfPrintingClass():
    
    def __str__(self):
        return 'an instance of the SelfPrintingClass class at ' + str(hex(id(self)))
    
object1 = SelfPrintingClass()
print(object1)
object2 = SelfPrintingClass()
print(object2)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
an instance of the SelfPrintingClass class at 0x11281d890
an instance of the SelfPrintingClass class at 0x11260dad0
</pre>
        <p>
         Notice how the former output
         <a data-poload="built_in_str" href="#built_in_str">
          <code class="prettyprint python">
           &lt;__main__.ClassWithMethod object at 0x11260da50&gt;
          </code>
         </a>
         has gone and our new layout has now been adopted. Albeit we have no data yet, we get a glimpse of
the idea behind object oriented programming. The two variables,
         <code class="prettyprint python">
          object1
         </code>
         and
         <code class="prettyprint python">
          object2
         </code>
         ,
soon to contain some data,
         <i>
          do know how to present themselves when printed
         </i>
         . I.e. we have stowed away
the problem of how some data is printed and our main program can be ignorant about that. In a minute we will
have some real data to print, and this statement may become more clear.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_160">
      </div>
      <div class="comments" id="issues_160">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_161">
     <div class="col-11">
      <h3>
       6.5 Object attributes
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Okay, time is up for adding some data to objects. Variables that live inside objects are called
         <i>
          attributes
         </i>
         .
They can be referred to as
         <code class="prettyprint python">
          object_name
         </code>
         +
         <code class="prettyprint python">
          .
         </code>
         +
         <code class="prettyprint python">
          attribute_name
         </code>
         . Consider
an empty class:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class EmptyClass():
      pass
</pre>
        <p>
         Some instances of the class, i.e. some objects, may be created, and some attributes set:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="setting_attributes_on_objects">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
object1 = EmptyClass()
object2 = EmptyClass()
object1.data = [1, 2]
object1.more_data = 'hello'
object2.data = [0, 0]
</pre>
          </p>
         </div>
        </div>
        <p>
         Later, the values of the attributes may be retrieved:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
print(object1.data, object1.more_data, object2.data)
for object in [object1, object2]:
    print('    printed in for-loop:',object.data)  
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
[1, 2] hello [0, 0]
    printed in for-loop: [1, 2]
    printed in for-loop: [0, 0]
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_161">
      </div>
      <div class="comments" id="issues_161">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_162">
     <div class="col-11">
      <h3>
       6.6 Object initialization
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Now, the whole idea of objects was to wrap data in clever data
structures. With the
         <a data-poload="setting_attributes_on_objects" href="#setting_attributes_on_objects">
          above
         </a>
         we are not yet obtaining much of that. For instance, the programmer interacting
with our class still has to know the name of the object attribute to
initiate the data. To get one step further, we shall turn to the built-in method,
         <code class="prettyprint python">
          __init__()
         </code>
         , which is called whenever a new object is created, i.e.
whenever a new instance of a class is made. The method takes
         <code class="prettyprint python">
          self
         </code>
         as input followed by any
sequence of arguments, possibly with defaults. It may look like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="objects_with_tag">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
class ClassWithInit():
    
    def __init__(self,tag='no tag'):
        self.tag = tag
    
    def __str__(self):
        return 'an instance of the ' + self.__class__.__name__ + \
            ' class with tag="' + self.tag + '"'
    
object1 = ClassWithInit() # init with no argument, expect 'no tag'
print(object1)
object2 = ClassWithInit() # init with no argument
print(object2)
object3 = ClassWithInit('special tag') # init with an argument
print(object3)
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
an instance of the ClassWithInit class with tag="no tag"
an instance of the ClassWithInit class with tag="no tag"
an instance of the ClassWithInit class with tag="special tag"
</pre>
        <p>
         Now, the assignment of values to the object attribute happens in the
         <code class="prettyprint python">
          __init__()
         </code>
         method. Here, it receives
no argument for the first two objects and one for the last object.
So, the first two objects get created with the default value for the tag, while the
last object gets a tag passed in the creation.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_162">
      </div>
      <div class="comments" id="issues_162">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_163">
     <div class="col-11">
      <h3>
       6.7 Object comparison
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Returning to the question of whether or not two objects are
the same we may test for the objects
         <a data-poload="objects_with_tag" href="#objects_with_tag">
          just created
         </a>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
print('object1 == object2:', object1 == object2)
print('object1 == object3:', object1 == object3)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
object1 == object2: False
object1 == object3: False
</pre>
        <p>
         and find that even the first two,
         <code class="prettyprint python">
          object1
         </code>
         and
         <code class="prettyprint python">
          object2
         </code>
         , that have
similar attribute values (the default
         <code class="prettyprint python">
          'no tag'
         </code>
         ) are not considered the same.
The situation can be changed by modifying the built-in method,
         <code class="prettyprint python">
          __eq__()
         </code>
         , on the
class like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class ClassWithEqual():
    
    def __init__(self,tag='no tag'):
        self.tag = tag
    
    def __str__(self):
        return 'tag="' + self.tag + '" at: ' + str(hex(id(self)))
    
    def __eq__(self, other):
        if isinstance(other, self.__class__):
            # they are of the same class, so result depends on the tag
            return self.tag == other.tag
        else:
            # they are not even of the same class, so cannot be equal    
            return False

object1 = ClassWithEqual()
print(object1)
object2 = ClassWithEqual()
print(object2)
object3 = ClassWithEqual('special tag')
print(object3)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
tag="no tag" at: 0x112827450
tag="no tag" at: 0x11260d810
tag="special tag" at: 0x11281d890
</pre>
        <p>
         Now the comparison gives the expected:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
print('object1 == object2:', object1 == object2)
print('object1 == object3:', object1 == object3)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
object1 == object2: True
object1 == object3: False
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_163">
      </div>
      <div class="comments" id="issues_163">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_164">
     <div class="col-11">
      <h3>
       6.8 Methods II
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         We now know enough about classes to make a non-trivial one. We shall define class
         <code class="prettyprint python">
          Rotor
         </code>
         as one containing and handling lists that contain more than one element. The class has a method,
         <code class="prettyprint python">
          rotate_data()
         </code>
         which makes a cyclic shift of the elements in the list:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class Rotor():
    
    def __init__(self,some_data):
        assert isinstance(some_data,list) and len(some_data) &gt; 1, \
                    'ERROR: invalid data, must be list with len &gt; 1'
        self.data = some_data
        
    def __str__(self):
        if hasattr(self,'data'):
            return '-'.join([str(d) for d in self.data])
        else:
            return 'No data yet'
        
    def rotate_data(self):
        if hasattr(self,'data'):
            self.data = self.data[1:] + [self.data[0]]
        else:
            print('WARNING: no data to rotate')
</pre>
        <p>
         We start by making an instance of the class, an object. If we forget to provide the data we get an
error message:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
rotor1 = Rotor()
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
TypeError: __init__() missing 1 required positional argument: 'some_data'
</pre>
        <p>
         Similarly, if the data
has the wrong format, either like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
rotor1 = Rotor('no list')
</pre>
        <p>
         or this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
rotor1 = Rotor([25])
</pre>
        <p>
         we get our own error message:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
AssertionError: ERROR: invalid data, must be list with len &gt; 1
</pre>
        <p>
         Lets now do it right:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
rotor1 = Rotor([3, 5, 1])
print('rotor1: ',rotor1)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
rotor1:  3-5-1
</pre>
        <p>
         With a proper instance
         <code class="prettyprint python">
          rotor1
         </code>
         of the
         <code class="prettyprint python">
          Rotor
         </code>
         class, we may now
call the
         <code class="prettyprint python">
          rotate_data()
         </code>
         method:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
print('rotor1: ',rotor1)
rotor1.rotate_data()
print('rotor1: ',rotor1)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
rotor1:  3-5-1
rotor1:  5-1-3
</pre>
        <p>
         We may repeat the process on another instance of the class:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
rotor2 = Rotor([2, 4, 1])
print('rotor2: ',rotor2)
rotor2.rotate_data()
print('rotor2: ',rotor2)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
rotor2:  2-4-1
rotor2:  4-1-2
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_164">
      </div>
      <div class="comments" id="issues_164">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_165">
     <div class="col-11">
      <h3 id="section_property_decorator">
       6.9 Decorator: @property
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Here is an example of a class that recalculates a dependent piece of
data, an average of some other data, upon initialization:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="ClassWithAttribute">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
class ClassWithAttribute():
    
    def __init__(self,a,b):
        self.a = a
        self.b = b
        self.average = (a + b)/ 2

    def __str__(self):
        return 'a={}, b={}, average={}'.format(self.a,self.b,self.average)
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
object1 = ClassWithAttribute(1,3)
object2 = ClassWithAttribute(5,7)
print(object1)
print(object2)
print('')
object1.average  # note: no () since it is a value
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
a=1, b=3, average=2.0
a=5, b=7, average=6.0

2.0
</pre>
        <p>
         Here is an example where the dependent piece of data, an average of
some other data, is available via a
         <i>
          method
         </i>
         on the object:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="ClassWithMethod">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
class ClassWithMethod():
    
    def __init__(self,c,d=7):
        self.c = c
        self.d = d
    
    def __str__(self):
        return 'c={}, d={}, average={}'.format(self.c,self.d,self.average())
    
    def average(self):
        return (self.c + self.d) / 2
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
object1 = ClassWithMethod(1,3)
object2 = ClassWithMethod(5)   # note: 7 will be assumed for d
print(object1)
print(object2)
print('')
object1.average()  # note: () since it is a method
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
c=1, d=3, average=2.0
c=5, d=7, average=6.0

2.0
</pre>
        <p>
         Notice how
         <code class="prettyprint python">
          ()
         </code>
         must be given on
         <code class="prettyprint python">
          .average
         </code>
         since it is now a method (= a function) rather than just an attribute.
        </p>
        <p>
         We can get rid of the annoying parentheses,
         <code class="prettyprint python">
          ()
         </code>
         , by
introducing the decorator
         <code class="prettyprint python">
          @property
         </code>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="ClassWithPropertyDecoratedMethod">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
class ClassWithPropertyDecoratedMethod():
    
    def __init__(self,e,f=None):
        self.e = e
        
        if f is not None:
            self.f = f
        else:
            # assume same value twice
            self.f = e
    
    def __str__(self):
        return 'e={}, f={}, average={}'.format(self.e,self.f,self.average)
    
    @property
    def average(self):
        return (self.e + self.f) / 2
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
object1 = ClassWithPropertyDecoratedMethod(1,3)
object2 = ClassWithPropertyDecoratedMethod(5)   # note: same value will be assumed for f
print(object1)
print(object2)
print('')
object1.average  # note: no () since it is a property-decorated method
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
e=1, f=3, average=2.0
e=5, f=5, average=5.0

2.0
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_165">
      </div>
      <div class="comments" id="issues_165">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_166">
     <div class="col-11">
      <h3 id="section_getter_setter">
       6.10 Getter-setter
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In the above example for the
         <a data-poload="ClassWithAttribute" href="#ClassWithAttribute">
          <code class="prettyprint python">
           ClassWithAttribute
          </code>
         </a>
         class
there is one problem. Consider we have an instance of the class:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
object = ClassWithAttribute(1,3)
print(object)  
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
a=1, b=3, average=2.0
</pre>
        <p>
         If one now changes one of the attributes,
         <code class="prettyprint python">
          .a
         </code>
         or
         <code class="prettyprint python">
          .b
         </code>
         on the object, the
         <code class="prettyprint python">
          .average
         </code>
         attribute is not recalculated and will be wrong:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
object.a = 100
print(object)  
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
a=100, b=3, average=2.0
</pre>
        <p>
         Obviously, this problem will not be there with the two other classes,
         <a data-poload="ClassWithMethod" href="#ClassWithMethod">
          <code class="prettyprint python">
           ClassWithMethod
          </code>
         </a>
         and
         <a data-poload="ClassWithPropertyDecoratedMethod" href="#ClassWithPropertyDecoratedMethod">
          <code class="prettyprint python">
           ClassWithPropertyDecoratedMethod
          </code>
         </a>
         ,
but for these classes, the average value is recalculated every time it
is accessed, which might be a waste.
        </p>
        <p>
         The way to resolve these issues is to "hide" the data in the object and
introduce an interface for the external world to access it. Typically,
one would prepend an underscore to the attribute name of a hidden
variable, i.e. one would turn
         <code class="prettyprint python">
          .g
         </code>
         into
         <code class="prettyprint python">
          ._g
         </code>
         . Then one would define a
property-decorated function
         <code class="prettyprint python">
          .g
         </code>
         that returns the value
of the hidden attribute. This functions is called a
         <i>
          getter-function
         </i>
         . We have something like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="code_getter_function">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
class ClassName():
    def __init__(self,g):
        self._g = g
    
    @property
    def g(self):
        return self._g
</pre>
          </p>
         </div>
        </div>
        <p>
         Now for the outside world to be able to change the value of the
date in the object, one then introduces a so-called
         <i>
          setter-function
         </i>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="code_setter_function">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
class ClassName():
    def __init__(self,g):
        self._g = g

    @g.setter
    def g(self,new_g):
        self._g = new_g
</pre>
          </p>
         </div>
        </div>
        <p>
         where the decorator,
         <code class="prettyprint python">
          @g.setter
         </code>
         , is an important part of
the syntax. Here the only thing that happens when an attribute is
changed is that the hidden attribute is updated. However, now the
object may detect that some of its data has changed and make a note
of it. I.e. the
         <code class="prettyprint python">
          def g(self, new_g
         </code>
         could be expanded as:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    @g.setter
    def g(self,new_g):
        self._g = new_g
        self.somehing_happened = True
</pre>
        <p>
         and then the class may react to this in its other methods. Below is
given an example of that.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_166">
      </div>
      <div class="comments" id="issues_166">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_167">
     <div class="col-11">
      <h3 id="section_lazy_calculation">
       6.11 Full example
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Here is a full example, where the data of a class are shielded off
from
the outside world with
         <a data-poload="code_getter_function" href="#code_getter_function">
          getter-
         </a>
         and
         <a data-poload="code_setter_function" href="#code_setter_function">
          setter-functions
         </a>
         , and where the
calculation of some property is delayed until the point, where it is
requested.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="LazyCalculation">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
class LazyCalculation():
    def __init__(self,g,h):
        self._g = g
        self._h = h
        self.average_calculated = False
        
    def __str__(self):
        return 'g={}, h={}, average={}'.format(self._g,self._h,self.average)
    
    @property
    def g(self):
        return self._g
    
    @property
    def h(self):
        return self._h
    
    @g.setter
    def g(self,new_g):
        print('... changing g')
        self._g = new_g
        self.average_calculated = False        
        
    @h.setter
    def h(self,new_h):
        print('... changing h')
        self._h = new_h
        self.average_calculated = False
    
    @property
    def average(self):
        if not self.average_calculated:      
            print('... calculating')
            self._average = (self._g + self._h) / 2
            self.average_calculated = True
        return self._average
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
object = LazyCalculation(1,3)
print(object)
print('')
object.average
object.g = 100
object.h = 300
object.average
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
... calculating
g=1, h=3, average=2.0

... changing g
... changing h
... calculating

200.0
</pre>
        <p>
         Note how the average was not calculated between changing
         <code class="prettyprint python">
          .g
         </code>
         and
         <code class="prettyprint python">
          .h
         </code>
         , but only when the
         <code class="prettyprint python">
          .average
         </code>
         attribute was accessed at the very end.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_167">
      </div>
      <div class="comments" id="issues_167">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_168">
     <div class="col-11">
      <h3>
       6.12 External references
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read more about classes and object oriented programming
         <a href="https://www.programiz.com/python-programming/object-oriented-programming" target="_blank">
          here
         </a>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_168">
      </div>
      <div class="comments" id="issues_168">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 1
     </h1>
    </div>
    <div class="row spy-padding" id="block_199">
     <div class="col-11">
      <h3>
       7.1 Random walkers in Numpy
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise, we shall be practicing the use of Numpy and
animations in Matplotlib.
        </p>
        <p>
         The exercise concerns random walkers. Random walkers perform a
stochastic process that add random steps to a path. They are known
from Brownian motion, where microscopic particles influence a larger
particle, which eventually appears to make moves randomly.
        </p>
        <p>
         In the exercise we shall be limiting ourselves to random walkers in a
two dimensional space. In each timestep
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta t
         </script>
         , the walkers move a
fixed distance
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta d=1
         </script>
         in a random direction.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_199">
      </div>
      <div class="comments" id="issues_199">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_200">
     <div class="col-11">
      <h3>
       7.2 Simulate
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Set up a Numpy array,
         <code class="prettyprint python">
          P
         </code>
         , with the
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         - and
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         -coordinates of
         <span class="matematik">
         </span>
         <script type="math/tex">
          N
         </script>
         random walkers. Initially, all walkers are at the origin.
        </p>
        <p>
         b) Find out how to add to
         <code class="prettyprint python">
          P
         </code>
         a Numpy array
         <code class="prettyprint python">
          DeltaP
         </code>
         so that
all walkers are advanced by
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta d
         </script>
         in each their random direction.
Hint: a random angle can be obtained by rescaling a uniformly
distributed randum number so it goes from 0 to
         <span class="matematik">
         </span>
         <script type="math/tex">
          2\pi
         </script>
         . And a random
vector then follows from use of
         <code class="prettyprint python">
          cos
         </code>
         and
         <code class="prettyprint python">
          sin
         </code>
         . Do not
use a
         <code class="prettyprint python">
          for
         </code>
         -loop for this, since Numpy is meant for
doing these vectorized operations!
        </p>
        <p>
         Make a visual confirmation that you are doing this correctly. Do that
by plotting lines from all coordinate sets in
         <code class="prettyprint python">
          P
         </code>
         to
the corresponding coordinate sets in
         <code class="prettyprint python">
          P+DeltaP
         </code>
         . Here it is ok to use a
         <code class="prettyprint python">
          for
         </code>
         -loop. Do
it a few times.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/exercise_01_fig1.png">
              <img class="img-fluid" src="images/6.png" style="max-width: 50%"/>
             </a>
             <a href="/media/2/img/exercise_01_fig2.png">
              <img class="img-fluid" src="images/6.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         c) Now introduce a
         <code class="prettyprint python">
          for
         </code>
         -loop to perform many
advancements of the walkers. Plot the positions of the walkers at the end.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/exercise_01_fig3.png">
              <img class="img-fluid" src="images/6.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_200">
      </div>
      <div class="comments" id="issues_200">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_201">
     <div class="col-11">
      <h3>
       7.3 Analyze
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Add code so that the distance of each random
walker from the origin is recorded in every timestep. At the end of the simulation,
plot the rms of this distance versus the time. The rms is the
square root of the mean of the square of the property in question:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \left|d\right|_{rms} = \sqrt{\langle d^2\rangle}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Do so in a log-log plot. According to this website:
         <a href="https://mathworld.wolfram.com/RandomWalk2-Dimensional.html" target="_blank">
          Mathworld
         </a>
         ,
you should get a slope of
         <span class="matematik">
         </span>
         <script type="math/tex">
          1/2
         </script>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/exercise_01_fig4.png">
              <img class="img-fluid" src="images/6.png" style="max-width: 65.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_201">
      </div>
      <div class="comments" id="issues_201">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_202">
     <div class="col-11">
      <h3>
       7.4 Animation
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         e) Plot the walkers as points. You can use
         <code class="prettyprint python">
          scatter
         </code>
         and have most
points in one color, and a few points in other colors. Hint: you
specify the color as a list.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/exercise_01_fig5.png">
              <img class="img-fluid" src="images/6.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         f) Animate the motion of the walkers.
        </p>
        <p>
         Hint 1: Do that by storing the positions
of the walkers at all times in a long list. Then, the update function
can get hold of the i'th set of positions via the list. Depending on
how you do, you might need to
         <i>
          copy
         </i>
         the data when you add it
to the list. You can do so with
         <code class="prettyprint python">
          .copy()
         </code>
         on the
Numpy-array with your coordinates.
        </p>
        <p>
         Hint 2:
         <code class="prettyprint python">
          scatter
         </code>
         is a
         <code class="prettyprint python">
          PathCollection
         </code>
         object. You change the coordinate
of the plotted points with:
         <code class="prettyprint python">
          .set_offsets(P)
         </code>
         ,
where
         <code class="prettyprint python">
          P
         </code>
         are the new positions.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/exercise_01_fig6.gif">
              <img class="img-fluid" src="images/6.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_202">
      </div>
      <div class="comments" id="issues_202">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_203">
     <div class="col-11">
      <h3>
       7.5 Challenge
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         g) Extend the exercise to deal with walkers in one and three
dimensions. Extract the slope as in question d).
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_203">
      </div>
      <div class="comments" id="issues_203">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 2
     </h1>
    </div>
    <div class="row spy-padding" id="block_234">
     <div class="col-11">
      <h3>
       8.1 Rolling down ramps
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise, we shall be practicing the use of Numpy,
         <code class="prettyprint python">
          solve_ivp
         </code>
         ,  and
animations in Matplotlib.
        </p>
        <p>
         The exercise is about modeling a box sliding down a ramp. The motion
is frictionless. The shape of the ramp will be varied.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_234">
      </div>
      <div class="comments" id="issues_234">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_235">
     <div class="col-11">
      <h3>
       8.2 Derivation
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         When a box, initially at rest, slides frictionless down a ramp, its
kinetic energy will be the work done by the gravitational force. Given
that the gravitational force is conservative, the work done can be calculated
as the negative change in potential energy. Starting from position
         <span class="matematik">
         </span>
         <script type="math/tex">
          (x_0,y_0)
         </script>
         , the work done until reaching position
         <span class="matematik">
         </span>
         <script type="math/tex">
          (x,y)
         </script>
         is:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
W&=&-\Bigl(U-U_0\Bigr)\\\\
&=&-\Bigl(mgy-mgy_0\Bigr)\\\\
&=&mg(y_0-y)
\end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          U
         </script>
         is the potential energy and where the subscript "0"
indicates the initial value. The work done causes a change in the
kinetic energy of the box:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
\Delta K&=&\displaystyle\frac{1}{2}mv^2-\displaystyle\frac{1}{2}mv_0^2\\\\
&=&\displaystyle\frac{1}{2}mv^2=mg(y_0-y)\\
\end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where it has been used that the box is initially at rest, i.e.
         <span class="matematik">
         </span>
         <script type="math/tex">
          v_0=0
         </script>
         . We have
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         v=\sqrt{2 g}\sqrt{y_0-y}.
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         It is important to understand that
         <span class="matematik">
         </span>
         <script type="math/tex">
          v
         </script>
         is the speed
         <i>
          along
         </i>
         the
path and
         <i>
          not
         </i>
         the time-derivative of
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         . Introducing
         <span class="matematik">
         </span>
         <script type="math/tex">
          s
         </script>
         for the
coordinate along the path, and realizing the height of the ramp
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         must be considered a function of
         <span class="matematik">
         </span>
         <script type="math/tex">
          s
         </script>
         , we arrive at:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="speed_at_height_y">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          \displaystyle\frac{ds}{dt}=\sqrt{2 g}\sqrt{y_0-y(s)}.
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         which mainly just introduces
         <span class="matematik">
         </span>
         <script type="math/tex">
          \displaystyle\frac{ds}{dt}
         </script>
         for the
speed along the path. Separation of the variables and integration leads to:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \int_0^s\frac{1}{\sqrt{2 g}\sqrt{y_0-y(s')}}ds'=\int_0^tdt'.
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         For most ramps,
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         will probably be easier to specify as a function
of
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         rather than as a function of
         <span class="matematik">
         </span>
         <script type="math/tex">
          s
         </script>
         . We can prepare the formula for that by introduction of a change of coordinates:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \int_0^s\frac{1}{\sqrt{2 g}\sqrt{y_0-y(s')}}ds'=\int_{x_0}^x\frac{1}{\sqrt{2 g}\sqrt{y_0-y(x')}}\frac{ds'}{dx'}dx'.
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         whereby we now integrate over
         <span class="matematik">
         </span>
         <script type="math/tex">
          x'
         </script>
         which is typically the coordinate
for which
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         is specified. The only remaining challenge is that now the differential quotient
         <span class="matematik">
         </span>
         <script type="math/tex">
          \displaystyle\frac{ds'}{dx'}
         </script>
         appears. However, its value can be
derived from the formula of curve length:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
s(x)&=&\displaystyle\int_{x_0}^{x}
\sqrt{\Bigl(\frac{dx'}{dx'}\Bigr)^2+\Bigl(\frac{dy}{dx'}\Bigr)^2}dx'\\\\
&=&\displaystyle\int_{x_0}^{x}
\sqrt{1+\Bigl(\frac{dy}{dx'}\Bigr)^2}dx'
\end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         and using the First Fundamental Theorem of Calculus, we get:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \displaystyle\frac{ds}{dx}=
\sqrt{1+\Bigl(\frac{dy}{dx}\Bigr)^2}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Putting it all together,  we have for the time
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         it takes the box to reach
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         t(x) = 
\int_{x_0}^x\frac{1}{\sqrt{2 g}\sqrt{y_0-y(x')}}\sqrt{1+\Bigl(\frac{dy}{dx'}\Bigr)^2}dx'.
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Using the First Fundamental Theorem of Calculus on this expression
gives:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \displaystyle\frac{dt}{dx} = \frac{1}{\sqrt{2 g}\sqrt{y_0-y(x)}}\sqrt{1+\Bigl(\frac{dy}{dx}\Bigr)^2}.
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         This equation can be flipped into:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \displaystyle\frac{dx}{dt} = \sqrt{2 g}\sqrt{y_0-y(x)}\frac{1}{\sqrt{1+\Bigl(\displaystyle\frac{dy}{dx}\Bigr)^2}}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         whereby we have a nice differential equation that can give
         <span class="matematik">
         </span>
         <script type="math/tex">
          (x(t),y(x(t)))
         </script>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_235">
      </div>
      <div class="comments" id="issues_235">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_236">
     <div class="col-11">
      <h3>
       8.3 Linear ramp
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/exercise_02_fig1.png">
              <img class="img-fluid" src="images/7.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         a) Setup a linear ramp with height
         <span class="matematik">
         </span>
         <script type="math/tex">
          22.5
         </script>
         and width
         <span class="matematik">
         </span>
         <script type="math/tex">
          30
         </script>
         . Let the
gravitational acceleration be 9.8. Solve using
         <code class="prettyprint python">
          solve_ivp
         </code>
         the for the motion of a box
on the ramp. Introduce an
         <code class="prettyprint python">
          event
         </code>
         -function and
determine how long it takes for the box to reach the end of the ramp.
Animate the motion of the box. Using a ball centered on the
ramp-curve is ok.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/exercise_02_fig2.gif">
              <img class="img-fluid" src="images/7.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_236">
      </div>
      <div class="comments" id="issues_236">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_237">
     <div class="col-11">
      <h3>
       8.4 Parabola-shaped ramp
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/exercise_02_fig3.png">
              <img class="img-fluid" src="images/7.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         b) Setup a parabola-shaped ramp with the same height and width.
Let it pass through
         <span class="matematik">
         </span>
         <script type="math/tex">
          y=0
         </script>
         at
         <span class="matematik">
         </span>
         <script type="math/tex">
          x=10
         </script>
         . Solve for the motion of a box on
it. Hint: add a tiny amout to
         <span class="matematik">
         </span>
         <script type="math/tex">
          y_0
         </script>
         to avoid dividing by zero
Determine when it reaches the end.
Animate the motion of the box on this ramp together with the motion on
the previous ramp.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/exercise_02_fig4.gif">
              <img class="img-fluid" src="images/7.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_237">
      </div>
      <div class="comments" id="issues_237">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_238">
     <div class="col-11">
      <h3>
       8.5 Brachistochrone curve
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         For fastest arrival of the box, one needs the (inverse) cycloid:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="cycloid_equations">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          \begin{array}{rcl}
x&=&a(\phi-\sin\phi)\\
y&=&a(1+\cos\phi) + y_0

\end{array}
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         and one must start at the cusp (i.e. where
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         is maximized, e.g. for
         <span class="matematik">
         </span>
         <script type="math/tex">
          \phi=0
         </script>
         ).
        </p>
        <p>
         For a cycloid to have the same drop (
         <span class="matematik">
         </span>
         <script type="math/tex">
          22.5
         </script>
         ) over the same width
(
         <span class="matematik">
         </span>
         <script type="math/tex">
          30
         </script>
         ) as the two other ramps, the
         <span class="matematik">
         </span>
         <script type="math/tex">
          \phi
         </script>
         must have a certain value at the end point. One can
prove that this equation specifies it:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \displaystyle\frac{\cos\phi_1-1}{\phi_1-\sin\phi_1}=-\displaystyle\frac{3}{4}.
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         c) Prove this if you find it fun.
        </p>
        <p>
         d) Find
         <span class="matematik">
         </span>
         <script type="math/tex">
          \phi_1
         </script>
         with
         <code class="prettyprint python">
          fsolve
         </code>
         , and use this to find
         <span class="matematik">
         </span>
         <script type="math/tex">
          a
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          y_0
         </script>
         from the
         <a data-poload="cycloid_equations" href="#cycloid_equations">
          cycloid definition
         </a>
         . Plot the ramp while you evaluate
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         from
         <span class="matematik">
         </span>
         <script type="math/tex">
          \phi
         </script>
         ,
         <span class="matematik">
         </span>
         <script type="math/tex">
          0<\phi<\phi_1
         </script>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/exercise_02_fig5.png">
              <img class="img-fluid" src="images/7.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         e) To solve the differential equation for the motion on the ramp, we
need
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \displaystyle\frac{dy}{dx}
         </script>
         as functions of
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         . Therefore, write a python function, that takes
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         and input,
finds the corresponding
         <span class="matematik">
         </span>
         <script type="math/tex">
          \phi
         </script>
         (using
         <code class="prettyprint python">
          fsolve
         </code>
         ) and
returns
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         . You can check your function by plotting some random
points specified by
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         and with
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         given by your function on the
ramp.
        </p>
        <p>
         f) Write a function that provides
         <span class="matematik">
         </span>
         <script type="math/tex">
          \displaystyle\frac{dy}{dx}
         </script>
         as a
function of
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         . This is done by calling the function from e) twice
with
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          x+\Delta x
         </script>
         , and deduce the derivative from that as:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \displaystyle\frac{f(x+\Delta x) - f(x)}{\Delta x}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         which is call
         <i>
          the forward finite difference method
         </i>
         .
        </p>
        <p>
         g) Solve for the motion on the inverse cycloid and demonstrate with an
animation that the box arrives first on the cycloid-shaped ramp.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/exercise_02_fig6.gif">
              <img class="img-fluid" src="images/7.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Read more about it on
         <a href="https://en.wikipedia.org/wiki/Brachistochrone_curve" target="_blank">
          Wikipedia
         </a>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_238">
      </div>
      <div class="comments" id="issues_238">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_239">
     <div class="col-11">
      <h3>
       8.6 Tautochrone curve
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Boxes on the (inverse) cycloid considered in c)-g) have an interesting
behavior. If you start them out at rest at different places, they all
pass the lowest point on the curve at the same time.
        </p>
        <p>
         h) Illustrate the described behavior with a simulation made by you.
        </p>
        <p>
         Read more about it on
         <a href="https://en.wikipedia.org/wiki/Tautochrone_curve" target="_blank">
          Wikipedia
         </a>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_239">
      </div>
      <div class="comments" id="issues_239">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 3
     </h1>
    </div>
    <div class="row spy-padding" id="block_180">
     <div class="col-11">
      <h3 id="exer_obj_trekanter">
       9.1 Opgave
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Skriv en klasse, hvis objekter er trekanter i
         <span class="matematik">
         </span>
         <script type="math/tex">
          xy
         </script>
         -planen. Et objekt
initialiseres ved angivelsen af trekantens tre hjørnepunkter samt evt.
af en farve som trekanten skal tegnes med. Klassen
skal have følgende attributter:
         <ul>
          <p>
          </p>
          <li>
           <p>
            <code class="prettyprint python">
             .points
            </code>
            : de tre hjørner
           </p>
          </li>
          <li>
           <p>
            <code class="prettyprint python">
             .cm
            </code>
            : massemidtpunktet
           </p>
          </li>
          <li>
           <p>
            <code class="prettyprint python">
             .color
            </code>
            : farven tegneobjektet skal have. Hvis objektet
får tildelt en ny værdi til denne attribut (fx som det sker
            <a data-poload="kode_ny_color_vaerdi" href="#kode_ny_color_vaerdi">
             her
            </a>
            )
skal klassen sørge for
at såfremt trekanten allerede er tegnet, så opdateres tegneobjektet
for trekanten med den nye farve (se hvordan farven skiftes for noget
tegnet med
            <code class="prettyprint python">
             fill
            </code>
            i
            <a data-poload="howtoCOLONmanipulate_polygons" href="#howtoCOLONmanipulate_polygons">
             denne how to
            </a>
            ).
           </p>
          </li>
          <li>
           <p>
            <code class="prettyprint python">
             .triangle
            </code>
            : tegneobjektet for trekanten
           </p>
          </li>
          <li>
           <p>
            <code class="prettyprint python">
             .cross
            </code>
            : tegneobjektet for et kryds afsat i massemidtpunktet
           </p>
          </li>
         </ul>
         Klassen skal have følgende metoder:
         <ul>
          <p>
          </p>
          <li>
           <p>
            <code class="prettyprint python">
             .draw(ax)
            </code>
            : tegner trekanten i Axis-objektet
            <code class="prettyprint python">
             ax
            </code>
            . Hvis trekanten allerede er tegnet
            <i>
             flyttes
            </i>
            den. Trekanten tegnes med
            <code class="prettyprint python">
             fill
            </code>
            og der afsættes et kryds på
massemidtpunktet.
           </p>
          </li>
          <li>
           <p>
            <code class="prettyprint python">
             .move(r)
            </code>
            : flytter trekanten vektoren
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathrm{r}=\>
            </script>
            <code class="prettyprint python">
             r
            </code>
            .
           </p>
          </li>
         </ul>
         Tegn en figur med trekanter beskrevet som instanser af ovenstående
klasse. Kald de forskellige metoder og plot figuren. Konstatér at alt
virker som det skal.
        </p>
        <p>
         Så når klassen er skrevet skal du fx kunne gøre følgende:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
P1 = np.array([2,1])
P2 = np.array([4,3])
P3 = np.array([1,4])
points = np.array([P1,P2,P3])
t = Trekant(points)
t.draw(ax)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/uge4_trekanter_1.png">
              <img class="img-fluid" src="images/8.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
r = np.array([2,1])
t.move(r)
fig
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/uge4_trekanter_2.png">
              <img class="img-fluid" src="images/8.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="kode_ny_color_vaerdi">
         <div>
          <p>
           <pre class="prettyprint python mb-0">
t.color = 'orange'
fig
</pre>
          </p>
         </div>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/uge4_trekanter_3.png">
              <img class="img-fluid" src="images/8.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
t2 = Trekant(points)
t2.color = 'chocolate'
t2.draw(ax)
fig
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/uge4_trekanter_4.png">
              <img class="img-fluid" src="images/8.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_180">
      </div>
      <div class="comments" id="issues_180">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 4
     </h1>
    </div>
    <div class="row spy-padding" id="block_181">
     <div class="col-11">
      <h3 id="exer_obj_random_walker">
       10.1 Opgave
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Skriv en klasse, hvis objekter er
         <i>
          random walkers
         </i>
         i
         <span class="matematik">
         </span>
         <script type="math/tex">
          xy
         </script>
         -planen. Alle walkere starter i begyndelsespunktet,
         <span class="matematik">
         </span>
         <script type="math/tex">
          (0.,0.)
         </script>
         .
        </p>
        <p>
         Klassen skal have følgende attributter:
         <ul>
          <p>
          </p>
          <li>
           <p>
            <code class="prettyprint python">
             .r
            </code>
            : walkerens position
           </p>
          </li>
          <li>
           <p>
            <code class="prettyprint python">
             .col
            </code>
            : walkerens farve
           </p>
          </li>
         </ul>
         Klassen skal have følgende metoder:
         <ul>
          <p>
          </p>
          <li>
           <p>
            <code class="prettyprint python">
             .move()
            </code>
            : flytter walkeren distancen
            <span class="matematik">
            </span>
            <script type="math/tex">
             1
            </script>
            i en tilfældig retning
           </p>
          </li>
          <li>
           <p>
            <code class="prettyprint python">
             .distance()
            </code>
            : returnerer hvor langt walkeren er fra
            <span class="matematik">
            </span>
            <script type="math/tex">
             (0,0)
            </script>
           </p>
          </li>
         </ul>
         <b>
          Hint:
         </b>
         Benyt komma-tal når du initialiserer
         <code class="prettyprint python">
          r
         </code>
         ,
altså: skriv
         <code class="prettyprint python">
          np.array([0.,0.])
         </code>
         fremfor
         <code class="prettyprint python">
          np.array([0,0])
         </code>
         . Ellers kan der nemt opstå et
type-problem for
         <code class="prettyprint python">
          NumPy
         </code>
         hvis den skal starte med heltal
og regne videre med kommatal.
        </p>
        <p>
         a) Start 100 random walkere ud. Plot dem med
         <code class="prettyprint python">
          scatter
         </code>
         . Flyt
dem allesammen én gang. Opdatér plottet. Gentag 100
gange.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/uge4_walkers_1.png">
              <img class="img-fluid" src="images/9.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         b) Plot som funktion af tiden hvor langt en walker i middel har
flyttet sig. Du får en monotont stigende kurve. Plot logaritmen af
de to samme størrelser og konstatér at du får en ret linie.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/uge4_walkers_2.png">
              <img class="img-fluid" src="images/9.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         c) Udarbejd en animation af forløbet.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/2/img/uge4_walkers.gif">
              <img class="img-fluid" src="images/9.png" style="max-width: 50%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         <b>
          Hint:
         </b>
         Når man plotter med
         <code class="prettyprint python">
          scatter
         </code>
         får man et
         <code class="prettyprint python">
          PathCollection
         </code>
         objekt retur. Du
kan lave en generel plotte-funktion, der ser således ud, hvor du selv
skal udfylde for
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         - og
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         -værdierne:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
def plot_all_walkers(ax,walkers_to_plot):
    artist = ax.scatter(# x-værdier
                        # y-værdier
                  color=[w.col for w in walkers_to_plot])
    return artist
</pre>
        <p>
         Dette objekt kan du så udskifte
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         - og
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         -værdier for i
din
         <code class="prettyprint python">
          update
         </code>
         -funktion, som du skriver i forbindelse med
animationen. Det kunne se således ud:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
artist.set_offsets([w.r for w in walkers])
</pre>
        <p>
         da den skal have et array af
         <span class="matematik">
         </span>
         <script type="math/tex">
          (x,y)
         </script>
         -værdier.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_181">
      </div>
      <div class="comments" id="issues_181">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 5
     </h1>
    </div>
    <div class="row spy-padding" id="block_185">
     <div class="col-11">
      <h3>
       11.1 Description
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This exercise is about realizing how much nicer one can make the code
when using object-oriented programming.
        </p>
        <p>
         Do the exercise on the Tautochrone curve once again, but this time you
should define a class for generally treating a box on a ramp. Then
when you make the simulation for say five boxes, you will have five
instances of that class, i.e. five objects.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_185">
      </div>
      <div class="comments" id="issues_185">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_186">
     <div class="col-11">
      <h3>
       11.2 The class
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Upon instantiation, the objects should:
         <ul>
          <p>
          </p>
          <li>
           <p>
            Receive and store two functions defining the ramp height and the ramp
  slope.
           </p>
          </li>
          <li>
           <p>
            Receive and store the starting value of
            <span class="matematik">
            </span>
            <script type="math/tex">
             x
            </script>
            for the box
           </p>
          </li>
          <li>
           <p>
            Receive and store the times for which an animation is anticipated to
  be made.
           </p>
          </li>
          <li>
           <p>
            Note that the differential equation has not yet been solved
           </p>
           <p>
            This can e.g. be done with
            <code class="prettyprint python">
             self.xs = None
            </code>
           </p>
          </li>
          <li>
           <p>
            Note that the box has not yet been introduced as a drawing element
  in any axis. Use an empty dictionary for this.
           </p>
          </li>
         </ul>
        </p>
        <p>
         When asked to draw itself at time
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         in axis
         <code class="prettyprint python">
          ax
         </code>
         via a method on the object, the object
should:
         <ul>
          <p>
          </p>
          <li>
           <p>
            check that the time
            <span class="matematik">
            </span>
            <script type="math/tex">
             t
            </script>
            is among the anticipated times indicated upon instantiation
           </p>
          </li>
          <li>
           <p>
            solve the differential equation if
            <span class="matematik">
            </span>
            <script type="math/tex">
             t>0
            </script>
            and store the positions
           </p>
          </li>
          <li>
           <p>
            if the dictionary with figure elements does not contain a key for
  axis
            <code class="prettyprint python">
             ax
            </code>
            ,  draw its box in the figure axis
  provided and store the figure axis and figure element pointer as a
  key-value pair in the dictionary
           </p>
          </li>
          <li>
           <p>
            move the box to the
            <span class="matematik">
            </span>
            <script type="math/tex">
             \left(x(t),y(t)\right)
            </script>
            position.
           </p>
          </li>
          <li>
           <p>
            return the draw-element pointer (so it can be used by a Matplotlib
  animation update-function).
           </p>
          </li>
         </ul>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_186">
      </div>
      <div class="comments" id="issues_186">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_187">
     <div class="col-11">
      <h3>
       11.3 The class
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class Box():

    def __init__(self, y
        self.y =
        self.xs = None
        self.drawing_elements = {}

    def _solve_ode(self, 

    def draw(self, ax, t):

        return self.drawing_elements[ax]
    

</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_187">
      </div>
      <div class="comments" id="issues_187">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_188">
     <div class="col-11">
      <h3>
       11.4 The program
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         With the proper class defined, the animation of the Tautochrone
problem should be done something like:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
times = np.arange(0,10,0.1)

boxes = []
for x0 in np.arange(0,1,0.1):
    box = Box(y, dydx, times, x0=x0)
    boxes.append(box)

def update(i):
    t = times[i]

    updated_drawing_elements = []
    for box in boxes:
        element = box.draw(ax,t)
        updated_drawing_elements.append(elements)
    return updated_drawing_elements

</pre>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_188">
      </div>
      <div class="comments" id="issues_188">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Week 2
     </h1>
    </div>
    <div class="row spy-padding" id="block_256">
     <div class="col-11">
      <h3>
       1.1 Introduction
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This week is about modeling the canonical ensemble at a
temperature. You will work with the Boltzmann distribution for some
one-dimensional problems. You will learn how to perform direct
integration of termodynamic properties and how to sample such
properties using the Metropolis Monte Carlo technique.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_256">
      </div>
      <div class="comments" id="issues_256">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_257">
     <div class="col-11">
      <h3>
       1.2 First TØ
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read some of the material on statistical physics provided.
        </p>
        <p>
         Solve exercise 6 and 7.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_257">
      </div>
      <div class="comments" id="issues_257">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_258">
     <div class="col-11">
      <h3>
       1.3 Second TØ
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read about the Metropolis Monte Carlo method.
        </p>
        <p>
         Solve exercise 8 and 9.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_258">
      </div>
      <div class="comments" id="issues_258">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      External resources
     </h1>
    </div>
    <div class="row spy-padding" id="block_294">
     <div class="col-11">
      <h3>
       2.1 Thermodynamics
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Refresh a little from
         <a href="https://en.wikipedia.org/wiki/Statistical_mechanics" target="_blank">
          Wikipedia
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_294">
      </div>
      <div class="comments" id="issues_294">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_295">
     <div class="col-11">
      <h3>
       2.2 Monte Carlo Sampling
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read until section IIIA of
         <a href="https://doi-org.ez.statsbiblioteket.dk/10.1119/5.0176853" target="_blank">
          Concepts
in Monte Carlo sampling, Am. J. Phys.
          <b>
           92
          </b>
          , 65-77 (2024).
         </a>
        </p>
        <p>
         Read about it on
         <a href="https://en.wikipedia.org/wiki/Monte_Carlo_method_in_statistical_mechanics" target="_blank">
          Wikipedia
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_295">
      </div>
      <div class="comments" id="issues_295">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_296">
     <div class="col-11">
      <h3>
       2.3 Metropolis Monte Carlo Sampling
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read about the method in the web-based book:
         <a href="https://applying-maths-book.com/chapter-12/monte-carlo-D.html" target="_blank">
          Applying Maths in the Chemical and Biomolecular Sciences
         </a>
         .
        </p>
        <p>
         Read about it on
         <a href="https://en.wikipedia.org/wiki/Metropolis-Hastings_algorithm" target="_blank">
          Wikipedia
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_296">
      </div>
      <div class="comments" id="issues_296">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Statistical Mechanics
     </h1>
    </div>
    <div class="row spy-padding" id="block_349">
     <div class="col-11">
      <h3>
       3.1 Intro
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Consider a system in contact with a heat bath at temperature
         <span class="matematik">
         </span>
         <script type="math/tex">
          T
         </script>
         .
A central result of statistical physics is that the probability of the
system being in a state with energy
         <span class="matematik">
         </span>
         <script type="math/tex">
          E_i
         </script>
         is given by:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         P(E_i)=\frac{1}{Z}\exp(-\frac{E_i}{k_BT}),
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          k_B
         </script>
         is the Boltzmann constant.
         <span class="matematik">
         </span>
         <script type="math/tex">
          Z
         </script>
         is the partition function, which ensures normalization of
the probability distribution:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         Z=\sum_i\exp(-\frac{E_i}{k_BT})
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         In statistical mechanics, the thermal average (or ensemble average) of
an observable
         <span class="matematik">
         </span>
         <script type="math/tex">
          \langle O \rangle
         </script>
         is a weighted average over all
possible states of a system, where the weights are given by the
Boltzmann factor. The thermal average of an observable
         <span class="matematik">
         </span>
         <script type="math/tex">
          O
         </script>
         is defined as:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="thermal_average_sum">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          \langle O \rangle = \frac{1}{Z} \sum_i O_i \exp(-\frac{E_i}{k_BT}),
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where the sum runs over all possible states of the system. When the
state space is continuous, the sum (and the corresponding one in
         <span class="matematik">
         </span>
         <script type="math/tex">
          Z
         </script>
         )
turns into an integration.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_349">
      </div>
      <div class="comments" id="issues_349">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_350">
     <div class="col-11">
      <h3>
       3.2 Contributions to
       <span class="matematik">
       </span>
       <script type="math/tex">
        Z
       </script>
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The kinetic and potential contributions to the partition function can
be separated when the Hamiltonian of the system can be expressed as a
sum of a kinetic energy term that depends only on the momenta and a
potential energy term that depends only on the positions. This
situation often arises in classical mechanics as well as in quantum
mechanics, but there may be exceptions, e.g. for charged particles
moving in a magnetic field or when non-cartesian coordinates are used.
        </p>
        <p>
         For a classical system with
         <span class="matematik">
         </span>
         <script type="math/tex">
          N
         </script>
         particles, the Hamiltonian
         <span class="matematik">
         </span>
         <script type="math/tex">
          H
         </script>
         can often be written as:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         H(\mathbf{p}, \mathbf{q}) = T(\mathbf{p}) + V(\mathbf{q})
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          T(\mathbf{p})
         </script>
         is the kinetic energy, which depends only on the
momenta
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{p}
         </script>
         , and
         <span class="matematik">
         </span>
         <script type="math/tex">
          V(\mathbf{q})
         </script>
         is the potential energy, which depends only on the positions
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{q}
         </script>
         .
        </p>
        <p>
         In this case, the classical partition function
         <span class="matematik">
         </span>
         <script type="math/tex">
          Z
         </script>
         can be written as an integral over phase space:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         Z = \frac{1}{h^{3N}} \int d^{3N}p \, d^{3N}q \, \exp\left(-\beta \left[T(\mathbf{p}) + V(\mathbf{q})\right]\right)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Since the kinetic and potential energies are independent of each other, the exponential can be separated:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         Z = \frac{1}{h^{3N}} \left( \int d^{3N}p \, \exp\left(-\beta T(\mathbf{p})\right) \right) \left( \int d^{3N}q \, \exp\left(-\beta V(\mathbf{q})\right) \right)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Thus, the partition function factorizes into a kinetic part and a potential part:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         Z = Z_{\text{kin}} \cdot Z_{\text{pot}}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         In the following we shall be calling the latter
         <span class="matematik">
         </span>
         <script type="math/tex">
          Q
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         Q = Z_{\text{pot}}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         And we shall be more or less neglecting the kinetic contribution,
which, however, for an ideal gas, or a set of decoubled oscillators,
can be evaluated exactly to give:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         Z_{\text{kin}} = \left(\frac{2\pi m k_B T}{h^2}\right)^{dN/2},
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          d
         </script>
         is the dimensionality and N is the number of particles.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_350">
      </div>
      <div class="comments" id="issues_350">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_351">
     <div class="col-11">
      <h3>
       3.3 Harmonic oscillator
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The harmonic oscillator is a fundamental model in both classical and
quantum mechanics, describing a system where a particle experiences a
restoring force proportional to its displacement from an equilibrium
position. The potential energy
         <span class="matematik">
         </span>
         <script type="math/tex">
          V(x)
         </script>
         of a one-dimensional
harmonic oscillator is given by:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="potential_energy_expression">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          V(x) = \frac{1}{2} k x^2
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          k
         </script>
         is the spring constant and
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         is the displacement from the equilibrium position.
        </p>
        <p>
         For a classical harmonic oscillator in thermal equilibrium at
temperature
         <span class="matematik">
         </span>
         <script type="math/tex">
          T
         </script>
         , the probability distribution
         <span class="matematik">
         </span>
         <script type="math/tex">
          P(x)
         </script>
         of finding the
particle at position
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         is given by the Boltzmann distribution:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         P(x) = \frac{1}{Q} \exp\left(-\frac{V(x)}{k_BT}\right)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          Q
         </script>
         is the partition function (pertaining to the positional
degree of freedom), which normalizes the probability distribution.
        </p>
        <p>
         Substituting the expression for the potential energy:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="first_Px_expression">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          P(x) = \frac{1}{Q} \exp\left(-\frac{\frac{1}{2} k x^2}{k_BT}\right)
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         The partition function
         <span class="matematik">
         </span>
         <script type="math/tex">
          Q
         </script>
         for the position variable
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         is given by:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         Q = \int_{-\infty}^{\infty} \exp\left(-\frac{\frac{1}{2} k x^2}{k_BT}\right) dx
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         This is a Gaussian integral, which evaluates to:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         Q = \sqrt{\frac{2\pi k_BT}{k}}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Therefore, the probability distribution
         <span class="matematik">
         </span>
         <script type="math/tex">
          P(x)
         </script>
         becomes:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="normalized_probability">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          P(x) = \sqrt{\frac{k}{2\pi k_BT}} \exp\left(-\frac{\frac{1}{2} k x^2}{k_BT}\right)
         </script>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_351">
      </div>
      <div class="comments" id="issues_351">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_352">
     <div class="col-11">
      <h3>
       3.4 Direct integration
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The thermal average of the potential energy of the harmonic oscillator
follows from the continuous version of
         <a data-poload="thermal_average_sum" href="#thermal_average_sum">
          the
discrete formula
         </a>
         given above:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="thermal_average_integral">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          \langle V(x)\rangle = \int_{-\infty}^{\infty}V(x)P(x)dx.
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Substituting in the expression for the
         <a data-poload="potential_energy_expression" href="#potential_energy_expression">
          potential
         </a>
         and for the
         <a data-poload="normalized_probability" href="#normalized_probability">
          probability
         </a>
         this expression
evaluates to:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \langle V(x)\rangle = \frac{1}{2}k_BT
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Considering now the heat capacity:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="eqCOLONheat_capacity_from_temperature_derivative">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          C_v=\frac{d\langle V(x)\rangle}{d T}=\frac{1}{2}k_B
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         we have the well-known result from statistical physics, that each
degree of freedom entering the Hamiltonian as an uncoupled
quadratic term contributes half a
         <span class="matematik">
         </span>
         <script type="math/tex">
          k_B
         </script>
         to the heat capacity.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_352">
      </div>
      <div class="comments" id="issues_352">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_353">
     <div class="col-11">
      <h3>
       3.5 Heat capacity from fluctuations
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Might be you recall from your statistical physics course that the heat
capacity "controls" the energy fluctuations of a system in thermal
equilibrium. This offers another way to evaluate the heat capacity,
namely:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="eqCOLONheat_capacity_from_thermal_fluctuations">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          C_v=\frac{\langle V(x)^2\rangle - \langle V(x)\rangle^2}{k_B T^2}.
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         The obvious advantage of this formula is that the system need only be
modelled at one temperature, as no temperature dependence needs to be
established as with the first
         <a data-poload="eqCOLONheat_capacity_from_temperature_derivative" href="#eqCOLONheat_capacity_from_temperature_derivative">
          formula
         </a>
         .
        </p>
        <p>
         If you are interested, a proof of the new
         <a data-poload="eqCOLONheat_capacity_from_thermal_fluctuations" href="#eqCOLONheat_capacity_from_thermal_fluctuations">
          formula
         </a>
         it follows here - otherwise, you
can skip to the next section.
        </p>
        <p>
         To improve the readability of the proof, we start by introducing the
inverse temperature with unit of energy:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="eqCOLONinverse_temp">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          \beta = \displaystyle\frac{1}{k_BT}
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         We immediately have:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \displaystyle\frac{d\beta}{d T}=-\displaystyle\frac{1}{(k_BT)^2}\cdot k_B=-k_B\beta^2
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         which can be used when applying the chain rule in the original
         <a data-poload="eqCOLONheat_capacity_from_temperature_derivative" href="#eqCOLONheat_capacity_from_temperature_derivative">
          expression
         </a>
         for the heat capacity:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="eqCOLONvia_beta">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          C_v=\displaystyle\frac{d\langle V(x)\rangle}{d
    T}=\displaystyle\frac{d\beta}{dT}\cdot \displaystyle\frac{d\langle
    V(x)\rangle}{d\beta}=-k_B\beta^2\displaystyle\frac{d\langle
    V(x)\rangle}{d\beta}
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         The last derivative in this expression can now be evaluating, while
using:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
    \langle
  V(x)\rangle&=&\displaystyle\frac{1}{Q}\int_{-\infty}^{\infty}V(x)\exp\left(-\beta
  V(x)\right)dx\\
  &&\\
  Q&=&\displaystyle\int_{-\infty}^{\infty}\exp\left(-\beta V(x)\right)dx
\end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         We have:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="eqCOLONmid_results_for_fluctuations">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          \begin{array}{rcl}
\displaystyle\frac{d\langle
  V(x)\rangle}{d\beta}&=&\displaystyle\frac{d}{d\beta}\left(\displaystyle\frac{1}{Q}\int_{-\infty}^{\infty}V(x)\exp\left(-\beta
                          V(x)\right)dx\right)\\
                      &&\\
                      &=&\displaystyle\frac{1}{Q}\displaystyle\frac{d}{d\beta}\left(\int_{-\infty}^{\infty}V(x)\exp\left(-\beta
                          V(x)\right)dx\right)-\displaystyle\frac{\langle
                          V(x)\rangle}{Q}\frac{d Q}{d\beta}\\

\end{array}
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         The two derivatives can be evaluated like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \displaystyle\frac{d}{d\beta}\left(\int_{-\infty}^{\infty}V(x)\exp\left(-\beta V(x)\right)dx\right)
=\int_{-\infty}^{\infty} V(x) \left(-V(x)\right)\exp\left(-\beta
  V(x)\right)dx
=-\int_{-\infty}^{\infty} V(x)^2\exp\left(-\beta V(x)\right)dx
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         and
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \displaystyle\frac{d
    Q}{d\beta}=\displaystyle\frac{d}{d\beta}\left(\int_{-\infty}^{\infty}\exp\left(-\beta
      V(x)\right)dx\right)
  =-\int_{-\infty}^{\infty}V(x)\exp\left(-\beta V(x)\right)dx
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Inserting these two derivatives into
         <a data-poload="eqCOLONmid_results_for_fluctuations" href="#eqCOLONmid_results_for_fluctuations">
          the result above
         </a>
         we get:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
\displaystyle\frac{d\langle
  V(x)\rangle}{d\beta}&=&
                          \displaystyle\frac{1}{Q}\left(-\int_{-\infty}^{\infty} V(x)^2\exp\left(-\beta V(x)\right)dx\right)
                          -\displaystyle\frac{\langle
                          V(x)\rangle}{Q}\left(-\int_{-\infty}^{\infty}V(x)\exp\left(-\beta
                          V(x)\right)dx\right)\\
                      &&\\
                      &=&-\langle V(x)^2\rangle + \langle V(x)\rangle^2\\
\end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Finally, when substituting into the original
         <a data-poload="eqCOLONvia_beta" href="#eqCOLONvia_beta">
          expression
         </a>
         we have:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
  \displaystyle\frac{d\langle V(x)\rangle}{d
    T}&=&-k_B\beta^2\displaystyle\frac{d\langle
          V(x)\rangle}{d\beta}\\
      &&\\
  &=&k_B\beta^2\left[\langle V(x)^2\rangle - \langle V(x)\rangle^2
      \right]\\
      &&\\
  &=&\displaystyle\frac{1}{k_BT^2}\left[\langle V(x)^2\rangle - \langle V(x)\rangle^2 \right]
\end{array}
        </script>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_353">
      </div>
      <div class="comments" id="issues_353">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_354">
     <div class="col-11">
      <h3>
       3.6 Direct Monte Carlo sampling
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         For more complicated problems than a single harmonic oscillator, one
might not evaluate
         <span class="matematik">
         </span>
         <script type="math/tex">
          Q
         </script>
         and hence
         <span class="matematik">
         </span>
         <script type="math/tex">
          P(x)
         </script>
         . In such cases, it serves to
establish a
         <i>
          sample
         </i>
         of positions,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \left\{x_i\right\}
         </script>
         . To
ensure that the sample accurately represents the thermal distribution,
the positions
         <span class="matematik">
         </span>
         <script type="math/tex">
          \left\{x_i\right\}
         </script>
         must be drawn according to the probability
distribution
         <span class="matematik">
         </span>
         <script type="math/tex">
          P(x)
         </script>
         .
        </p>
        <p>
         In such cases, the sample can be constructed using direct Monte Carlo
sampling. This involves drawing random positions
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_i
         </script>
         from a known
distribution
         <span class="matematik">
         </span>
         <script type="math/tex">
          Y(x)
         </script>
         , which is chosen such that
         <span class="matematik">
         </span>
         <script type="math/tex">
          Y(x)\ge P(x)
         </script>
         for all
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         . For each sample, you accept the position
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_i
         </script>
         if the
condition
         <span class="matematik">
         </span>
         <script type="math/tex">
          0\le \mathrm{RND}\times Y(x_i)\le P(x_i)
         </script>
         is satisfied, where
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathrm{RND}
         </script>
         is a uniformly distributed random number between 0 and
1. This method ensures that the accepted positions are distributed
according to the desired probability distribution
         <span class="matematik">
         </span>
         <script type="math/tex">
          P(x)
         </script>
         .
        </p>
        <p>
         This direct Monte Carlo sampling procedure, while conceptually
straightforward, can be inefficient. The inefficiency arises
from the fact that many proposed positions
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_i
         </script>
         may be rejected,
especially if the trial distribution
         <span class="matematik">
         </span>
         <script type="math/tex">
          Y(x)
         </script>
         differs significantly
from the target distribution
         <span class="matematik">
         </span>
         <script type="math/tex">
          P(x)
         </script>
         .
        </p>
        <p>
         Specifically, if
         <span class="matematik">
         </span>
         <script type="math/tex">
          Y(x)
         </script>
         is much larger than
         <span class="matematik">
         </span>
         <script type="math/tex">
          P(x)
         </script>
         over most of the
range of
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         , the acceptance probability
         <span class="matematik">
         </span>
         <script type="math/tex">
          \displaystyle\frac{P(x)}{Y(x)}
         </script>
         will be low,
leading to a high rejection rate. As a result, many random samples
will be discarded, making the process slow and computationally
expensive. To improve efficiency, it's important to choose a trial
distribution
         <span class="matematik">
         </span>
         <script type="math/tex">
          Y(x)
         </script>
         that closely resembles the shape of the target
distribution
         <span class="matematik">
         </span>
         <script type="math/tex">
          P(x)
         </script>
         , minimizing the difference between them and
thereby increasing the acceptance rate.
        </p>
        <p>
         Once you have established the sample,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \left\{x_i\right\}
         </script>
         , you may
now estimate the value of
         <a data-poload="thermal_average_integral" href="#thermal_average_integral">
          the
  integral
         </a>
         for the thermal average given above:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
  \langle
  V(x)\rangle&=&\displaystyle\int_{-\infty}^{\infty}V(x)P(x)dx\\
  &&\\
  &\simeq&\displaystyle\frac{1}{N}\sum_{i=1}^NV(x_i).
\end{array}
        </script>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_354">
      </div>
      <div class="comments" id="issues_354">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_355">
     <div class="col-11">
      <h3>
       3.7 Non-Boltzmann sampling
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Sometimes it is convenient to construct a sample for one system with
potential
         <span class="matematik">
         </span>
         <script type="math/tex">
          V_0(x)
         </script>
         , while you are actually interested in investigating
another system with potential energy
         <span class="matematik">
         </span>
         <script type="math/tex">
          V(x)
         </script>
         . The potential of the
system of interest may be written:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         V(x)=V_0(x)+\Delta V(x)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         And the Boltzmann term for that system becomes:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \exp\left(-\frac{V(x)}{k_BT}\right)
=
  \exp\left(-\frac{V_0(x)}{k_BT}\right)
  \times
  \exp\left(-\frac{\Delta V(x)}{k_BT}\right)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         The partition function,
         <span class="matematik">
         </span>
         <script type="math/tex">
          Q
         </script>
         , (pertaining to the positional
degree of freedom), for the system of interest thus becomes:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="non_boltzmann_partition_function">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          \begin{array}{rcl}
  Q&=&\displaystyle\int_{-\infty}^\infty\exp\left(-\displaystyle\frac{V(x)}{k_BT}\right)dx\\
  &=&\\
   &=&\frac{\displaystyle\int_{-\infty}^\infty\exp\left(-\displaystyle\frac{V_0(x)}{k_BT}\right)dx}
       {\displaystyle\int_{-\infty}^\infty\exp\left(-\displaystyle\frac{V_0(x)}{k_BT}\right)dx}
       \displaystyle\int_{-\infty}^\infty\exp\left(-\displaystyle\frac{V(x)}{k_BT}\right)dx\\
  &=&\\
   &=&\displaystyle\int_{-\infty}^\infty\exp\left(-\displaystyle\frac{V_0(x)}{k_BT}\right)dx
       \frac{
       \displaystyle\int_{-\infty}^\infty\exp\left(-\displaystyle\frac{\Delta
       V(x)}{k_BT}\right)\exp\left(-\displaystyle\frac{V_0(x)}{k_BT}\right)dx}
       {\displaystyle\int_{-\infty}^\infty\exp\left(-\displaystyle\frac{V_0(x)}{k_BT}\right)dx}\\
  &&\\
   &=&Q_0\left\langle
\exp\left(-\displaystyle\frac{\Delta
       V(x)}{k_BT}\right)
       \right\rangle_0,
       
\end{array}
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          Q_0
         </script>
         is the partition function for the reference system and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \langle\dots\rangle_0
         </script>
         denotes the thermal average taken with a
Boltzmann sample for the reference system.
        </p>
        <p>
         Now that we have the partition function for the system of interest
written in terms of the partion function of another, known system, we
may write the thermal average of an observable,
         <span class="matematik">
         </span>
         <script type="math/tex">
          G(x)
         </script>
         as:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
\langle G(x)\rangle
  &=&\frac
      {\displaystyle\int_{-\infty}^\infty G(x)\exp\left(-\displaystyle\frac{V(x)}{k_BT}\right)dx}
      {\displaystyle\int_{-\infty}^\infty\exp\left(-\displaystyle\frac{V(x)}{k_BT}\right)dx}\\
  &&\\
  &=&\displaystyle\frac{1}{Q}\times
      {\displaystyle\int_{-\infty}^\infty G(x)\exp\left(-\displaystyle\frac{V(x)}{k_BT}\right)dx}\\
  &&\\
  &=&\displaystyle\frac{1}{Q}\times
      \displaystyle\frac{Q_0}{Q_0}\times
      {\displaystyle\int_{-\infty}^\infty
      G(x)\exp\left(-\displaystyle\frac{V_0(x)+\Delta V(x)}{k_BT}\right)dx}\\
  &&\\
  &=&\displaystyle\frac{1}{Q}\times
      \displaystyle\frac{Q_0}{Q_0}\times
      {\displaystyle\int_{-\infty}^\infty
      \left[G(x)\exp\left(-\displaystyle\frac{\Delta
      V(x)}{k_BT}\right)\right]
      \exp\left(-\displaystyle\frac{V_0(x)
      }{k_BT}\right)dx
      }\\
  &&\\
  &=&
      \displaystyle\frac{Q_0}{Q}\times
      \displaystyle\frac
      {\displaystyle\int_{-\infty}^\infty
      \left[G(x)\exp\left(-\displaystyle\frac{\Delta
      V(x)}{k_BT}\right)\right]
      \exp\left(-\displaystyle\frac{V_0(x)
      }{k_BT}\right)dx
      }
      {\displaystyle\int_{-\infty}^\infty
      \exp\left(-\displaystyle\frac{V_0(x)
      }{k_BT}\right)dx
      }
  \\
  &&\\
  &=&
      \displaystyle\frac{Q_0}{Q}
      \left\langle
      G(x)\exp\left(-\displaystyle\frac{\Delta
      V(x)}{k_BT}\right)
\right\rangle_0      
  &&\\
  &&\\
  &=&
      \displaystyle\frac{1}{\left\langle
\exp\left(-\displaystyle\frac{\Delta
       V(x)}{k_BT}\right)
      \right\rangle_0
      }
      \left\langle
      G(x)\exp\left(-\displaystyle\frac{\Delta
      V(x)}{k_BT}\right)
\right\rangle_0      
\end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where the derived expression for the
         <a data-poload="non_boltzmann_partition_function" href="#non_boltzmann_partition_function">
          partition function
         </a>
         has been inserted in the last line. We thus have a means to
evaluate the thermal average of an observable for a system when only
knowing the thermal probability distribution for another system.
        </p>
        <p>
         Beware that if the overlap in the probability distributions of the
known system (that having
         <span class="matematik">
         </span>
         <script type="math/tex">
          V_0(x)
         </script>
         ) is very different from that of the
unknown system (the one with
         <span class="matematik">
         </span>
         <script type="math/tex">
          V(x)
         </script>
         ), the method might be
inefficient.
        </p>
        <p>
         Non-Boltzmann sampling also goes under the name
         <i>
          importance
  sampling
         </i>
         as the known probability distribution usually helps
sampling more relevant positions.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_355">
      </div>
      <div class="comments" id="issues_355">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_356">
     <div class="col-11">
      <h3>
       3.8 Metropolis Monte Carlo sampling
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         To address the inefficiencies of direct Monte Carlo sampling,
Metropolis Monte Carlo sampling offers a more efficient approach. In
this method, you start with an initial position
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_0
         </script>
         and propose a new
position
         <span class="matematik">
         </span>
         <script type="math/tex">
          x'
         </script>
         based on a symmetric proposal distribution
         <span class="matematik">
         </span>
         <script type="math/tex">
          T(x'|x)
         </script>
         , which only depends on the current position
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         . The new
position
         <span class="matematik">
         </span>
         <script type="math/tex">
          x'
         </script>
         is accepted with a probability given by the ratio of the
target distributions:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \textrm{Acceptance probability}=\min(1,\frac{P(x')}{P(x)})
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         If the proposed position
         <span class="matematik">
         </span>
         <script type="math/tex">
          x'
         </script>
         is accepted, it becomes the new current
position; otherwise, the current position is retained. This process is
repeated to generate a sequence of positions
         <span class="matematik">
         </span>
         <script type="math/tex">
          \left\{x_i\right\}
         </script>
         that sample the target distribution
         <span class="matematik">
         </span>
         <script type="math/tex">
          P(x)
         </script>
         . This approach avoids the
need for a trial distribution
         <span class="matematik">
         </span>
         <script type="math/tex">
          Y(x)
         </script>
         that bounds
         <span class="matematik">
         </span>
         <script type="math/tex">
          P(x)
         </script>
         and reduces
the rejection rate, making it more efficient.
        </p>
        <p>
         By
         <i>
          symmetric
         </i>
         proposal distribution is meant that the likehood of
proposing the move from
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         to
         <span class="matematik">
         </span>
         <script type="math/tex">
          x'
         </script>
         is the same as that of proposing
the move from
         <span class="matematik">
         </span>
         <script type="math/tex">
          x'
         </script>
         to
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         T(x'|x) = T(x|x'),
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         (the
         <span class="matematik">
         </span>
         <script type="math/tex">
          T(x'|x)
         </script>
         is read "likelihood of proposing
         <span class="matematik">
         </span>
         <script type="math/tex">
          x'
         </script>
         <i>
          given
         </i>
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         , i.e. given
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         is the current state).
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_356">
      </div>
      <div class="comments" id="issues_356">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_357">
     <div class="col-11">
      <h3>
       3.9 Proof of Metropolis Monte Carlo
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The Metropolis Monte Carlo method acts by generating a so-called
Markov chain.  A Markov chain is a sequence of states where the
probability of moving to the next state depends only on the current
state, not on the preceding states. This property is known as the
Markov property or memorylessness.
        </p>
        <p>
         To prove that the Metropolis Monte Carlo method generates a Boltzmann distribution, we
start by considering the detailed balance condition.
The detailed balance condition states that for any two states
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          x'
         </script>
         in the state space, the probability of being in state
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         and
moving to state
         <span class="matematik">
         </span>
         <script type="math/tex">
          x'
         </script>
         must be equal to the probability of being in
state
         <span class="matematik">
         </span>
         <script type="math/tex">
          x'
         </script>
         and moving to state
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         P(x) T(x'|x) A(x'|x) = P(x') T(x|x') A(x|x'),
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          A(x'|x)
         </script>
         is the acceptance probability of moving from
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         to
         <span class="matematik">
         </span>
         <script type="math/tex">
          x'
         </script>
         .
        </p>
        <p>
         Substituting the Metropolis acceptance probability:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         A(x'|x) = \min\left(1, \frac{P(x')}{P(x)}\right)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         into the detailed balance condition, we consider two cases:
        </p>
        <b>
         Case 1
        </b>
        <p>
         If
         <span class="matematik">
         </span>
         <script type="math/tex">
          \displaystyle\frac{P(x')}{P(x)} \leq 1
         </script>
         , then
         <span class="matematik">
         </span>
         <script type="math/tex">
          A(x'|x) = \displaystyle\frac{P(x')}{P(x)}
         </script>
         , and the detailed balance condition becomes:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         P(x) T(x'|x) \frac{P(x')}{P(x)} = P(x') T(x|x'),
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         which simplifies to:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         P(x') T(x|x') = P(x') T(x|x'),
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         confirming that the detailed balance condition is satisfied.
        </p>
        <b>
         Case 2
        </b>
        <p>
         If
         <span class="matematik">
         </span>
         <script type="math/tex">
          \displaystyle\frac{P(x')}{P(x)} > 1
         </script>
         , then
         <span class="matematik">
         </span>
         <script type="math/tex">
          A(x'|x) = 1
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          A(x|x') = \displaystyle\frac{P(x)}{P(x')}
         </script>
         . The detailed balance condition becomes:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         P(x) T(x'|x) = P(x') T(x|x') \frac{P(x)}{P(x')},
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         which simplifies to the same expression:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         P(x') T(x|x') = P(x') T(x|x'),
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         again confirming that the detailed balance condition is satisfied.
        </p>
        <p>
         Detailed balance is a sufficient condition for ensuring that the
Markov chain is ergodic. Ergodicity implies that the Markov chain is
irreducible (any state can be reached from any other state) and
aperiodic (the chain does not get trapped in cycles). Under these
conditions, the chain will converge to a unique stationary
distribution regardless of the starting state.
        </p>
        <p>
         When detailed balance is satisfied, the stationary distribution,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \pi(x)
         </script>
         ,
of the Markov chain is the distribution for which the
detailed balance equation holds. If the detailed balance condition is
met, the stationary distribution,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \pi(x)
         </script>
         , of the chain is:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \pi(x)=P(x)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Thus, the Markov chain defined by the Metropolis algorithm will
converge to
         <span class="matematik">
         </span>
         <script type="math/tex">
          P(x)
         </script>
         as its stationary distribution.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_357">
      </div>
      <div class="comments" id="issues_357">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 6
     </h1>
    </div>
    <div class="row spy-padding" id="block_326">
     <div class="col-11">
      <h3>
       4.1 Classical harmonic oscillator
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Plot the potential of the harmonic oscillator with some different
values for the force constant,
         <span class="matematik">
         </span>
         <script type="math/tex">
          k
         </script>
         . Plot the probability
distribution. Evaulate the thermally averaged potential energy by
direct integration in a finite range from some
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_{min}
         </script>
         to some
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_{max}
         </script>
         . Neglect for now that this leads to a small error.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/3/img/exercise_06_fig1b.png">
              <img class="img-fluid" src="images/14.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_326">
      </div>
      <div class="comments" id="issues_326">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_327">
     <div class="col-11">
      <h3>
       4.2 Direct Monte Carlo sampling
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Evaluate the thermally averaged potential energy by Monte Carlo
sampling. Use a constant probability distribution in a finite range
(i.e. from some
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_{min}
         </script>
         to some
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_{max}
         </script>
         ) as your known
distribution. Neglect for now that this leads to a small error.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_327">
      </div>
      <div class="comments" id="issues_327">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_328">
     <div class="col-11">
      <h3>
       4.3 Heat capacity
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Evaluate the heat capacity of one of your harmonic oscillators by
evaluating the thermally averaged potential energy at some different
temperatures, and by taking the derivative numerically. Explain the deviation from
the analytic result at large temperatures.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/3/img/exercise_06_fig2.png">
              <img class="img-fluid" src="images/14.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_328">
      </div>
      <div class="comments" id="issues_328">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_329">
     <div class="col-11">
      <h3>
       4.4 Fluctuations
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Evaluate the heat capacity from the fluctuations of the potential energy.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_329">
      </div>
      <div class="comments" id="issues_329">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 7
     </h1>
    </div>
    <div class="row spy-padding" id="block_300">
     <div class="col-11">
      <h3>
       5.1 Two oscillators
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/3/img/exercise_07_fig1.png">
              <img class="img-fluid" src="images/15.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         a) Consider two classical harmonic oscillators with
         <span class="matematik">
         </span>
         <script type="math/tex">
          k=1, x_0=0
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          k=10, x_0=1
         </script>
         , respectively. Plot the potentials.
        </p>
        <p>
         b) The oscillators are in contact with a heat bath with
         <span class="matematik">
         </span>
         <script type="math/tex">
          k_BT=0.15
         </script>
         . Plot the thermal
probability distributions of the two oscillators, and evaluate the
thermally averaged potential energy for both oscillators using
direct Monte Carlo sampling. Only new thing so far compared to
the previous exercise is that one of the oscillators is displaced from
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_0=0
         </script>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_300">
      </div>
      <div class="comments" id="issues_300">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_301">
     <div class="col-11">
      <h3>
       5.2 Non-Boltzmann sampling
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Now use the distribution from the first oscillator (the one at
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_0=0
         </script>
         ) to estimate the thermally averaged potential energy of the
second oscillator (the one at
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_0=1
         </script>
         ). Increase the amount of sample
points until you recover the result from question b).
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_301">
      </div>
      <div class="comments" id="issues_301">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 8
     </h1>
    </div>
    <div class="row spy-padding" id="block_362">
     <div class="col-11">
      <h3>
       6.1 Metropolis Monte Carlo sampling
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise we shall establish the sample,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \left\{x_i\right\}
         </script>
         ,
using the Metropolis Monte Carlo sampling scheme. We will deal with
one classical harmonic oscillator with
         <span class="matematik">
         </span>
         <script type="math/tex">
          k=1
         </script>
         . The temperature in the
illustrations is
         <span class="matematik">
         </span>
         <script type="math/tex">
          k_BT=0.15
         </script>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_362">
      </div>
      <div class="comments" id="issues_362">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_363">
     <div class="col-11">
      <h3>
       6.2 Random walk transitions I
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Evaluate the thermal average of the potential energy using a
proposal distribution with x' emerging from:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         x\rightarrow x + \Delta\cdot\mathrm{RNDn}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathrm{RNDn}
         </script>
         is a normally distributed number and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta=0.1
         </script>
         is an amplitude.
        </p>
        <p>
         Establish your result for samples of different sizes. Compare to the
exact result from direct integration (as in the previous exercises).
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/3/img/exercise_08_fig1.png">
              <img class="img-fluid" src="images/16.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_363">
      </div>
      <div class="comments" id="issues_363">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_364">
     <div class="col-11">
      <h3>
       6.3 Random walk transitions II
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Try modify the value for
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta
         </script>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/3/img/exercise_08_fig2.png">
              <img class="img-fluid" src="images/16.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_364">
      </div>
      <div class="comments" id="issues_364">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_365">
     <div class="col-11">
      <h3>
       6.4 Uniform transitions
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Another obvious proposal distribution is a uniform distribution
between the
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_{min}
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_{max}
         </script>
         limits. I.e.:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         x\rightarrow (x_{max}-x_{min})\cdot\mathrm{RND}+x_{min}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathrm{RND}
         </script>
         is a uniformly distributed number between 0 and 1.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/3/img/exercise_08_fig3.png">
              <img class="img-fluid" src="images/16.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_365">
      </div>
      <div class="comments" id="issues_365">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 9
     </h1>
    </div>
    <div class="row spy-padding" id="block_368">
     <div class="col-11">
      <h3>
       7.1 Metropolis Monte Carlo sampling
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise we continue making the sample,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \left\{x_i\right\}
         </script>
         ,
using the Metropolis Monte Carlo sampling scheme. However, this time
you should invent your own one-dimensional potential. I have made one
from two downward-pointing Gaussians. But, please make your own
personal choice.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_368">
      </div>
      <div class="comments" id="issues_368">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_369">
     <div class="col-11">
      <h3>
       7.2 Random walk transitions I
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Evaluate the thermal average of the potential energy using a
proposal distribution with x' emerging from:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         x\rightarrow x + \Delta\cdot\mathrm{RNDn}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathrm{RNDn}
         </script>
         is a normally distributed number and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta=0.1
         </script>
         is an amplitude.
        </p>
        <p>
         Establish your result for samples of different sizes. Compare to the
exact result from direct integration (as in the previous exercises).
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/3/img/exercise_09_fig1.png">
              <img class="img-fluid" src="images/17.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_369">
      </div>
      <div class="comments" id="issues_369">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_370">
     <div class="col-11">
      <h3>
       7.3 Random walk transitions II
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Try modify the value for
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta
         </script>
         . Especially, try a smaller value for
the amplitude.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/3/img/exercise_09_fig2.png">
              <img class="img-fluid" src="images/17.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_370">
      </div>
      <div class="comments" id="issues_370">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_371">
     <div class="col-11">
      <h3>
       7.4 Uniform transitions
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Establish the sample using the uniform proposal distribution:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         x\rightarrow (x_{max}-x_{min})\cdot\mathrm{RND}+x_{min}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathrm{RND}
         </script>
         is a uniformly distributed number between 0 and
1.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/3/img/exercise_09_fig3.png">
              <img class="img-fluid" src="images/17.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Compare your results with the different proposal distributions. Do you
also sometimes see the "trapping" in higher-lying energy wells that is
apparent in the present figures?
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_371">
      </div>
      <div class="comments" id="issues_371">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 10
     </h1>
    </div>
    <div class="row spy-padding" id="block_347">
     <div class="col-11">
      <h3>
       8.1 Metropolis Monte Carlo sampling
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise we continue making the sample,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \left\{x_i\right\}
         </script>
         ,
using the Metropolis Monte Carlo sampling scheme. Make yet another 
interesting choice of potential. Stick to the uniform transitions.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_347">
      </div>
      <div class="comments" id="issues_347">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_348">
     <div class="col-11">
      <h3>
       8.2 P(x) for different temperatures
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Make the probability distribution for different temperatures.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/3/img/exercise_10_fig1.png">
              <img class="img-fluid" src="images/18.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_348">
      </div>
      <div class="comments" id="issues_348">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Week 3
     </h1>
    </div>
    <div class="row spy-padding" id="block_422">
     <div class="col-11">
      <h3>
       1.1 Introduction
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This week is about modeling performing global optimization. You will
code two methods yourself: Random Structure Search (RSS) and Basin
Hopping (BH). Both methods act by producing new structure, which are
subsequently optimized locally. You will employ two methods for that
local optimization, also referred to as relaxation. The methods are
Monte Carlo quench and line search. The first does not require the
gradient of the object function, the total potential energy, while the
second does. The gradient is the total force vector.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_422">
      </div>
      <div class="comments" id="issues_422">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_423">
     <div class="col-11">
      <h3>
       1.2 First TØ
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read about the Random Structure Search and the Monte Carlo
optimization / Monte Carlo quench methods.
        </p>
        <p>
         Solve exercises 11 and 12. If time permits: Solve exercise 16.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_423">
      </div>
      <div class="comments" id="issues_423">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_424">
     <div class="col-11">
      <h3>
       1.3 Second TØ
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read about the Basin Hopping and the line-search methods.
        </p>
        <p>
         Solve exercises 13, 14, and 15.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_424">
      </div>
      <div class="comments" id="issues_424">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      External resources
     </h1>
    </div>
    <div class="row spy-padding" id="block_366">
     <div class="col-11">
      <h3>
       2.1 Gradient descent
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read about it on
         <a href="https://en.wikipedia.org/wiki/Gradient_descent" target="_blank">
          Wikipedia
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_366">
      </div>
      <div class="comments" id="issues_366">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_367">
     <div class="col-11">
      <h3>
       2.2 Line search
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read about it at this
         <a href="https://optimization.cbe.cornell.edu/index.php?title=Line_search_methods#Steepest_Descent_Method" target="_blank">
          web-book
         </a>
         hosted at Cornell University.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_367">
      </div>
      <div class="comments" id="issues_367">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_433">
     <div class="col-11">
      <h3>
       2.3 Basin hopping
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read (very little) about it on
         <a href="https://en.wikipedia.org/wiki/Basin-hopping" target="_blank">
          Wikipedia
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_433">
      </div>
      <div class="comments" id="issues_433">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_434">
     <div class="col-11">
      <h3>
       2.4 Lennard-Jones potential
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read about it on:
         <a href="https://en.wikipedia.org/wiki/Lennard-Jones_potential" target="_blank">
          Wikipedia
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_434">
      </div>
      <div class="comments" id="issues_434">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_441">
     <div class="col-11">
      <h3>
       2.5 2D clusters
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read about few-atom noble gas clusters in
         <a href="https://www.nature.com/articles/s41563-023-01780-1" target="_blank">
          Nature Materials
         </a>
         .
and in
         <a href="https://www.mdpi.com/2079-4991/10/1/156" target="_blank">
          nanomaterials
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_441">
      </div>
      <div class="comments" id="issues_441">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_442">
     <div class="col-11">
      <h3>
       2.6 Particle swarm optimization
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read about the method in this
         <a href="https://algorithmafternoon.com/books/particle_swarm/" target="_blank">
          web-book
         </a>
         .
        </p>
        <p>
         Read about it on
         <a href="https://en.wikipedia.org/wiki/Particle_swarm_optimization" target="_blank">
          Wikipedia
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_442">
      </div>
      <div class="comments" id="issues_442">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Optimization
     </h1>
    </div>
    <div class="row spy-padding" id="block_451">
     <div class="col-11">
      <h3>
       3.1 Intro
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The Boltzmann factor,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \exp(-V(x)/k_BT)
         </script>
         , strongly favors regions of low
potential energy. This causes the thermal probability distribution to
be highly peaked around the minima in the potential energy
landscape. Depending on the physical system and properties of interest it may
therefore sometimes be of relevance to map out these minima before
studying the properties of the the system further. The lowest energy
minimum is called the
         <i>
          global minimum
         </i>
         and the other minima are referred
to as
         <i>
          local minima
         </i>
         .
        </p>
        <p>
         The chapter is about methods for determining both local and global
minima. The methods are naturally called methods for local and global
optimization. Other often used terms for local optimization are
         <i>
          relaxation
         </i>
         and
         <i>
          quenching
         </i>
         .
        </p>
        <p>
         There are very many optimization methods, and the presently selected
ones only represent a very small subset of these.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_451">
      </div>
      <div class="comments" id="issues_451">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_452">
     <div class="col-11">
      <h3 id="sectionCOLONmetropolis_monte_carlo_search">
       3.2 Metropolis Monte Carlo search
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The acceptance criterion in the Metropolis Monte Carlo
method reads:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathrm{RND} < \min\left(1,\exp(-\Delta E/k_BT)\right)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         i.e. a uniformly distributed random number between 0 and 1 should be
smaller that
         <span class="matematik">
         </span>
         <script type="math/tex">
          \min\left(1,\exp(-\Delta E/k_BT)\right)
         </script>
         . The criterion
can actually be written:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="eqCOLONacceptance_criterion_simple_form">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          \mathrm{RND} < \exp(-\Delta E/k_BT)
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         since the
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathrm{RND}
         </script>
         can never be larger than
         <span class="matematik">
         </span>
         <script type="math/tex">
          1
         </script>
         .
        </p>
        <p>
         When cast in the
         <a data-poload="eqCOLONacceptance_criterion_simple_form" href="#eqCOLONacceptance_criterion_simple_form">
          latter
  form
         </a>
         , the criterion is actually very easy to interpret. Steps, that
decrease the energy will always be accepted, while steps that increase
the energy are accepted with exponentially suppressed smaller
likelihood the higher the energy increase. Thus depending on the
temperature, a Metropolis Monte Carlo trajectory will be able to move
around in an energy landscape and overcome energy barriers between
regions of local energy minima. This may form the basis for a global
optimization method, the so-called Monte Carlo search method. One or several
trajectories are produced with whatever resources are available, and
eventually, the lowest energy structure ever observed is considered
the putative global minimum energy structure.
        </p>
        <p>
         In the limit of zero temperature, the Metropolis Monte Carlo trajectory
will not be able to surpass energy barriers, and it can rather be
considered a local optimization method. With zero temperature, the
method can be characterized as
         <a href="https://en.wikipedia.org/wiki/Random_optimization" target="_blank">
          random
  optimization
         </a>
         with the potential energy being the objective function
and the positional coordinates defining the optimization space.
        </p>
        <p>
         When applied for a many-dimensional problem, the Metropolis Monte Carlo
search might benefit from the trial configurations not involving
changing all coordinates simultaneously.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_452">
      </div>
      <div class="comments" id="issues_452">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_453">
     <div class="col-11">
      <h3>
       3.3 Random Structure Search
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         If one has a method for performing local optimization, a very simple
method for global optimization can be formulated, namely the random structure
search method. The method has these steps:
         <ol>
          <p>
          </p>
          <li>
           <p>
            Generate the system in a completely random configuration. For a
  1-dimensional system that amounts to picking a random coordinate
            <span class="matematik">
            </span>
            <script type="math/tex">
             x
            </script>
            , and for a
            <span class="matematik">
            </span>
            <script type="math/tex">
             d
            </script>
            -dimensional system it corresponds to selecting a
  random multi-dimensional vector,
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathbf{r}\in\mathbb{R}^{d}
            </script>
            .
           </p>
          </li>
          <li>
           <p>
            Perform local optimization of the system.
           </p>
          </li>
          <li>
           <p>
            Keep track of this system if it is the most stable ever seen.
           </p>
          </li>
          <li>
           <p>
            Repeat 1-3 as many times as affordable.
           </p>
          </li>
          <li>
           <p>
            Report the most stable configuration found.
           </p>
          </li>
         </ol>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_453">
      </div>
      <div class="comments" id="issues_453">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_454">
     <div class="col-11">
      <h3>
       3.4 Particle Swarm Optimization
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         As an example of a more advanced optimization method you might want to
study the Particle Swarm Optimization. Read about it in this
         <a href="https://algorithmafternoon.com/books/particle_swarm/" target="_blank">
          web-book
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_454">
      </div>
      <div class="comments" id="issues_454">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_455">
     <div class="col-11">
      <h3>
       3.5 Gradient-based local optimization
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The zero-temperture Metropolis Monte Carlo search introduced
         <a data-poload="sectionCOLONmetropolis_monte_carlo_search" href="#sectionCOLONmetropolis_monte_carlo_search">
          above
         </a>
         as a local
optimization method may be useful whenever the object function (in
this context the potential energy) is the only thing available. Often
times, the gradient or higher-order derivatives of the object function
are, however, available at a low computational cost and then more
efficient optimization methods may be formulated. In the context of
the object-function being the potential energy, the gradient of the
potential is related to the force,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{F}
         </script>
         , on the systems constituents
according to:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathbf{F}(\mathbf{r}) = -\mathbf{\nabla}E(\mathbf{r}),
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          E
         </script>
         represents to total potential energy, and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{r}
         </script>
         is
a vector of all position coordinates. The gradient always points in the
direction that would increase a scalar field, here
         <span class="matematik">
         </span>
         <script type="math/tex">
          E(\mathbf{r})
         </script>
         , the
most, and the force being the negative gradient thus points in the
direction that decreases the energy the most.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_455">
      </div>
      <div class="comments" id="issues_455">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_456">
     <div class="col-11">
      <h3>
       3.6 Steepest and gradient descent
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Whenever the force is available, a local optimization method that
simply takes small steps in the direction of the force can be
formualted:
         <ol>
          <p>
          </p>
          <li>
           <p>
            Start at
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathbf{r}
            </script>
           </p>
          </li>
          <li>
           <p>
            Calculate the direction of the force:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \hat{\mathbf{F}}(\mathbf{r})= \displaystyle\frac{\mathbf{F}(\mathbf{r})}{||\mathbf{F}(\mathbf{r})||}
            </script>
           </p>
          </li>
          <li>
           <p>
            Take a fixed-length step in the direction of the force:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \mathbf{r} \rightarrow \mathbf{r} + \Delta \cdot \hat{\mathbf{F}}(\mathbf{r}),
            </script>
            where
            <span class="matematik">
            </span>
            <script type="math/tex">
             \Delta
            </script>
            is a predetermined step length.
           </p>
          </li>
          <li>
           <p>
            Repeat 2-3 a finite amount of times.
           </p>
          </li>
         </ol>
         In the limit
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta\rightarrow 0
         </script>
         , the method formally traces a path
in the steepest descent direction and it is hence referred to as the
         <i>
          steepest descent
         </i>
         method. An obvious issue is that it is
impractical to have a very small, yet finite value for
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta
         </script>
         , as very many steps are then
needed and as the optimization keeps taking steps of size
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta
         </script>
         even as the force starts to vanish.
        </p>
        <p>
         In practice a slightly modified version of the steepest descent method is often used, namely the
         <i>
          gradient descent
         </i>
         method. Here the update step is taken
according to:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathbf{r} \rightarrow \mathbf{r} + \gamma \cdot \mathbf{F}(\mathbf{r}),
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          \gamma
         </script>
         is a constant. Now the step size vanishes together with
the force as the optimization converges. However, this method may face
other problems as very large steps may be taken in regions where the
force is large. This can be remedied by implementing a maximum step
size.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_456">
      </div>
      <div class="comments" id="issues_456">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_457">
     <div class="col-11">
      <h3>
       3.7 Line search
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The two deficiencies for the steepest and gradient descent methods,
can easily be avoided by exhausting a search direction,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \hat{\mathbf{F}}(\mathbf{r})
         </script>
         whenever it has been establish. That is
done in the
         <i>
          line search
         </i>
         method that has these elements:
         <ol>
          <p>
          </p>
          <li>
           <p>
            Start at
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathbf{r}
            </script>
           </p>
          </li>
          <li>
           <p>
            Calculate the direction of the force:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \hat{\mathbf{F}}(\mathbf{r})= \displaystyle\frac{\mathbf{F}(\mathbf{r})}{||\mathbf{F}(\mathbf{r})||}.
            </script>
           </p>
          </li>
          <li>
           <p>
            Define the energy along that direction:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \tilde{E}(\alpha)= E(\mathbf{r} + \alpha \cdot \hat{\mathbf{F}}(\mathbf{r})).
            </script>
           </p>
          </li>
          <li>
           <p>
            Find
            <span class="matematik">
            </span>
            <script type="math/tex">
             \alpha_\mathrm{opt}
            </script>
            that minimizes
            <span class="matematik">
            </span>
            <script type="math/tex">
             \tilde{E}(\alpha)
            </script>
            and
  update the configuration to:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \mathbf{r} \rightarrow \mathbf{r} + \alpha_\mathrm{opt} \cdot
  \hat{\mathbf{F}}(\mathbf{r}).
            </script>
           </p>
          </li>
          <li>
           <p>
            Repeat 2-4 a finite amount of times or until the magnitude of the
  force is below some preset criterion.
           </p>
          </li>
         </ol>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_457">
      </div>
      <div class="comments" id="issues_457">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_458">
     <div class="col-11">
      <h3>
       3.8 Basin Hopping
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The basin hopping method is the Metropolis Monte Carlo search method
augmented with a local optimization in every step. It takes the form:
         <ol>
          <p>
          </p>
          <li>
           <p>
            Start at
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathbf{r}\in\mathbb{R}^{d}
            </script>
           </p>
          </li>
          <li>
           <p>
            Setup a trial configuration by making a random step:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \mathbf{r}' = \mathbf{r} + \mathbf{r}_\mathrm{RND},
            </script>
            where
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathbf{r}_\mathrm{RND}\in\mathbb{R}^{d}
            </script>
            has normally
distributed values for each coordinate.
           </p>
          </li>
          <li>
           <p>
            Relax the trial step:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \mathbf{r}' \rightarrow \tilde{\mathbf{r}}'
            </script>
            where
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathbf{F}(\tilde{\mathbf{r}}')=0
            </script>
            .
           </p>
          </li>
          <li>
           <p>
            Accept the move
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathbf{r}\rightarrow\tilde{\mathbf{r}}'
            </script>
            if
  the Metropolis Monte Carlo criterion is fulfilled:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \mathrm{RND} < \exp(-\displaystyle\frac{E(\tilde{\mathbf{r}}') - E(\mathbf{r})}{k_BT}),
            </script>
            where
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathrm{RND}
            </script>
            is a random number uniformely distributed
  between 0 and 1.
           </p>
          </li>
          <li>
           <p>
            Repeat 2-4 a finite amount of times.
           </p>
          </li>
         </ol>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_458">
      </div>
      <div class="comments" id="issues_458">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 11
     </h1>
    </div>
    <div class="row spy-padding" id="block_435">
     <div class="col-11">
      <h3>
       4.1 Monte Carlo optimization, 1D
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In exercises 8-10, you used Metropolis Monte Carlo sampling to
assemble position samples,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \left\{x_i\right\}
         </script>
         reflecting the
probability distribution,
         <span class="matematik">
         </span>
         <script type="math/tex">
          P(x)
         </script>
         , associated with various
potentials at given temperatures. In this exercise, we shall use the
same technique, but the goal is not to establish a sample,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \left\{x_i\right\}
         </script>
         , but rather to identify the position,
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_\mathrm{opt}
         </script>
         ,
where the potential has its global minimum value.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_435">
      </div>
      <div class="comments" id="issues_435">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_436">
     <div class="col-11">
      <h3>
       4.2 The potential
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The exercise is concerned with the following potential:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
def V(x):
    return (-1  -np.exp(-((x+15)/10)**2) \
              -2*np.exp(-((x-10)/10)**2) + \
                -np.exp(-((x-35)/10)**2) \
              -3*np.exp(-((x-60)/10)**2) \
                -np.exp(-((x-85)/10)**2)\
              -2*np.exp(-((x-110)/10)**2) \
              ) * \
            (1+1/5*np.cos(2*np.pi/2.5*x))
</pre>
        <p>
         a) Plot the potential.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_11_fig1.png">
              <img class="img-fluid" src="images/22.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_436">
      </div>
      <div class="comments" id="issues_436">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_437">
     <div class="col-11">
      <h3>
       4.3 Short trajectories
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Use the Metropolis Monte Carlo method to create a Markov chain
trajectory at two different temperatures. The two figures to the left, depict the
first 9 states of a low-temperature trajectory. The two figures to the
right depict the trajectory at a higher temperature. The two upper
plots show the sampled points as a function of how many steps have
been taken, the "Monte Carlo time". The two lower plots show the
sampled point in the energy landscape. Make similar
plots and verify thereby that your implementation behaves
qualitatively correct.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_11_fig2.png">
              <img class="img-fluid" src="images/22.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_437">
      </div>
      <div class="comments" id="issues_437">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_438">
     <div class="col-11">
      <h3>
       4.4 Long trajectories
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Start one or several low-temperature walkers and observe that they might
get stuck in local minima.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_11_fig3.gif">
              <img class="img-fluid" src="images/22.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         d) Start one or several high-temperature walkers and observe that they are
less prone to get stuck in local minima, and that more of them
eventually spend some time near the global minimum.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_11_fig4.gif">
              <img class="img-fluid" src="images/22.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_438">
      </div>
      <div class="comments" id="issues_438">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_439">
     <div class="col-11">
      <h3>
       4.5 Success Statistics
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         e) Formalize the observation of the efficiency of the Metropolis Monte
Carlo method for global optimization. Start the search
         <span class="matematik">
         </span>
         <script type="math/tex">
          N_\mathrm{walker}
         </script>
         times, and let each walker do
         <span class="matematik">
         </span>
         <script type="math/tex">
          N_\mathrm{steps}
         </script>
         Metropolis Monte Carlo steps. For each walker, you record how many
steps,
         <span class="matematik">
         </span>
         <script type="math/tex">
          N_\textrm{required}
         </script>
         , it took to observe a potential energy value below
         <span class="matematik">
         </span>
         <script type="math/tex">
          -4.75
         </script>
         , which
means that it has come near the global minimum. Make
a histogram of the distribution of
         <span class="matematik">
         </span>
         <script type="math/tex">
          N_\textrm{required}
         </script>
         for your
         <span class="matematik">
         </span>
         <script type="math/tex">
          N_\mathrm{walker}
         </script>
         walkers.
        </p>
        <p>
         Use the same data, but now show the cumulative success rate as a
function of the Monte Carlo steps.
        </p>
        <p>
         Perform the analysis at different temperatures. Discuss the origin of
the different curve shapes.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_11_fig5.png">
              <img class="img-fluid" src="images/22.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_439">
      </div>
      <div class="comments" id="issues_439">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 12
     </h1>
    </div>
    <div class="row spy-padding" id="block_406">
     <div class="col-11">
      <h3>
       5.1 Monte Carlo optimization, 2D
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise, we shall use global optimization based on the
Metropolis Monte Carlo method to optimize the position of an atom in a
two dimensional space, where two other atoms are placed.
        </p>
        <p>
         The atoms interact via the Lennard-Jones pair potential:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="exercise12_lennard_jones_pair_potential">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          V(r)=4\varepsilon_0
  \Bigl[
  \left(\displaystyle\frac{\sigma}{r}\right)^{12}-
  \left(\displaystyle\frac{\sigma}{r}\right)^6
  \Bigr].
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          \varepsilon_0
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \sigma
         </script>
         are constants, and where
         <span class="matematik">
         </span>
         <script type="math/tex">
          r
         </script>
         are
interatomic separations occuring the the system.
        </p>
        <p>
         The total potential energy of the ensemble of Lennard-Jones atoms is:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="exercise12_lennard_jones_energy">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          E = \sum_i\sum_{j>i}V(r_{ij}),
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          i
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          j
         </script>
         enumerate the atoms.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_406">
      </div>
      <div class="comments" id="issues_406">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_407">
     <div class="col-11">
      <h3>
       5.2 Calculator class
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Finish this class declaration to obtain a "calculator", that can
return the potential energy given a NumPy-array of
         <span class="matematik">
         </span>
         <script type="math/tex">
          N\times 2
         </script>
         coordinates describing the
         <span class="matematik">
         </span>
         <script type="math/tex">
          (x,y)
         </script>
         positions of
         <span class="matematik">
         </span>
         <script type="math/tex">
          N
         </script>
         atoms:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
from scipy.spatial.distance import pdist
class LennardJones():
    def __init__(self,eps0=5,sigma=2**(-1/6)):
        self.eps0 = eps0
        self.sigma = sigma
        
    def _V(self,r):
        YOUR CODE HERE

    def energy(self, pos):
        return np.sum(self._V(pdist(pos)))
</pre>
        <p>
         b) Calculate the energy for some atomic clusters (=ensembles of
atoms). Use for instance these ones:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="three-atom-cluster-orange-blue-orange">
         <div>
          <p>
           <div class="text-center">
            <p>
             <p>
              <a href="/media/4/img/exercise_12_fig1.png">
               <img class="img-fluid" src="images/23.png" style="max-width: 85.0%"/>
              </a>
             </p>
            </p>
           </div>
          </p>
         </div>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_407">
      </div>
      <div class="comments" id="issues_407">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_408">
     <div class="col-11">
      <h3>
       5.3 Energy landscape
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The two atomic clusters in b) have a total of 6 coordinates, and
optimizing the total energy as a function of these coordinates would
therefore be a 6D optimization problem. Assuming that two of the atoms
are
         <i>
          static
         </i>
         , a 2-dimensional restricted optimization problem
emerges, and can be illustrated. Therefore, assume that the two orange
atoms are static and that only the blue atom is allowed to move. Now,
plot the total potential energy of this 3-atomic cluster as a function
of the
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         -coordinates of the blue atom:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_12_fig2.png">
              <img class="img-fluid" src="images/23.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Left plot is a large scale view, right plot is a zoomed view.
        </p>
        <p>
         c) Make a similar contour plot for an atom atomic cluster of your own
choice.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_408">
      </div>
      <div class="comments" id="issues_408">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_409">
     <div class="col-11">
      <h3>
       5.4 Metropolis Monte Carlo optimization
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Perform a Metropolis Monte Carlo optimization at a low temperature
for one of the atoms in your atomic cluster. Here it is done for the
cluster depicted
         <a data-poload="three-atom-cluster-orange-blue-orange" href="#three-atom-cluster-orange-blue-orange">
          above
         </a>
         ,
  where the blue atom is allowed to move.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_12_fig3.png">
              <img class="img-fluid" src="images/23.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_409">
      </div>
      <div class="comments" id="issues_409">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 13
     </h1>
    </div>
    <div class="row spy-padding" id="block_418">
     <div class="col-11">
      <h3>
       6.1 Monte Carlo optimization, high-D
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise, we keep performing global optimization based on the
Metropolis Monte Carlo method to optimize the atomic positions. This
time, however, we do it for several atoms at the same time. Since they
each contribute with two dimensions, we are effectively performing
high-dimensional global optimization.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_418">
      </div>
      <div class="comments" id="issues_418">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_419">
     <div class="col-11">
      <h3>
       6.2 3-atomic cluster
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Performa a Metropolis Monte Carlo optimization for a 3-atomic Lennard-Jones
cluster problem. Start from a random
initial configuration - perhaps having one static atom at
         <span class="matematik">
         </span>
         <script type="math/tex">
          (0,0)
         </script>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_13_fig1.png">
              <img class="img-fluid" src="images/24.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_419">
      </div>
      <div class="comments" id="issues_419">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_420">
     <div class="col-11">
      <h3>
       6.3 6-atomic cluster
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Repeat the optimization, but for a 6-atomic Lennard-Jones
cluster.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_13_fig2.png">
              <img class="img-fluid" src="images/24.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_420">
      </div>
      <div class="comments" id="issues_420">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_421">
     <div class="col-11">
      <h3>
       6.4 7-atomic cluster
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Move on to larger clusters, e.g. to 7-atomic ones. Try restarting several times and see
what kind of global minimum energy contenders you find.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_13_fig3.png">
              <img class="img-fluid" src="images/24.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_421">
      </div>
      <div class="comments" id="issues_421">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 14
     </h1>
    </div>
    <div class="row spy-padding" id="block_463">
     <div class="col-11">
      <h3>
       7.1 Random Structure Search
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise, we augment the Lennard-Jones calculator class from
the previous exercises so as to also offer the calculation of the
force.
        </p>
        <p>
         The Lennard-Jones energy expressions took the form:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         V(r)=4\varepsilon_0
  \Bigl[
  \left(\displaystyle\frac{\sigma}{r}\right)^{12}-
  \left(\displaystyle\frac{\sigma}{r}\right)^6
  \Bigr].
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         and
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         E = \sum_i\sum_{j>i}V(r_{ij}),
        </script>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_463">
      </div>
      <div class="comments" id="issues_463">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_464">
     <div class="col-11">
      <h3>
       7.2 The force
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The force on atom
         <span class="matematik">
         </span>
         <script type="math/tex">
          k
         </script>
         is given by the negative gradient of the energy
with respect to the
         <span class="matematik">
         </span>
         <script type="math/tex">
          k
         </script>
         'th atom:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
    \mathbf{F}_k &=& -\nabla_k E= -\nabla_k \displaystyle\sum_i\displaystyle\sum_{j>i}V(r_{ij})\\
        &&\\
        &=&-\displaystyle\sum_{j\ne k} \nabla_k V(r_{kj})\\
        &&\\
    &=&\displaystyle\sum_{j\ne k}
        \left.\displaystyle\frac{dV}{dr}\right|_{r_{kj}}\displaystyle\frac{1}{r_{kj}}\mathbf{r}_{kj},\quad\mathbf{r}_{kj}=\mathbf{r}_j-\mathbf{r}_k
    \end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         The force on all atoms then becomes:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathbf{F}=\left[
\begin{array}{c}
  \mathbf{F}_1\\
  \mathbf{F}_2\\
  \vdots\\
  \mathbf{F}_N\\
\end{array}
\right]
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Here is a class that implements most of the calculator class:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class LennardJones():
    def __init__(self,eps0=5,sigma=2**(-1/6)):
        self.eps0 = eps0
        self.sigma = sigma
        
    def _V(self,r):
        return 4 * self.eps0 * ( (self.sigma/r)**12 - (self.sigma/r)**6 )

    def _dV_dr(self, r):
        pass

    def energy(self, pos):
        return np.sum(self._V(pdist(pos)))
    
    def forces(self, pos):
        diff = pos[np.newaxis, :, :] - pos[:, np.newaxis, :]
        r = np.sqrt(np.sum(diff**2, axis=-1))
        np.fill_diagonal(r, np.inf)
        force_magnitude = self._dV_dr(r)
        forces = np.sum(force_magnitude[..., np.newaxis] * diff / \
                        r[..., np.newaxis], axis=1)
        return forces
</pre>
        <p>
         a) Implement the missing
         <code class="prettyprint python">
          _dV_dr(self, r)
         </code>
         method.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_464">
      </div>
      <div class="comments" id="issues_464">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_465">
     <div class="col-11">
      <h3>
       7.3 One 3-atom cluster
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Perform a line-search optimization in the force direction.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_14_fig1.png">
              <img class="img-fluid" src="images/25.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_14_fig2.png">
              <img class="img-fluid" src="images/25.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_465">
      </div>
      <div class="comments" id="issues_465">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_466">
     <div class="col-11">
      <h3>
       7.4 Another 3-atom cluster
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Repeat b) for another 3-atom cluster.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_14_fig3.png">
              <img class="img-fluid" src="images/25.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_14_fig4.png">
              <img class="img-fluid" src="images/25.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         d) Explain the zig-zag appearance of the relaxation path.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_466">
      </div>
      <div class="comments" id="issues_466">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 15
     </h1>
    </div>
    <div class="row spy-padding" id="block_467">
     <div class="col-11">
      <h3>
       8.1 Line-search
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Implement the line-search method so all atoms in the cluster are
optimized (you may want to leave one atom fixed at
         <span class="matematik">
         </span>
         <script type="math/tex">
          (0,0)
         </script>
         for plotting purposes).
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_467">
      </div>
      <div class="comments" id="issues_467">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_468">
     <div class="col-11">
      <h3>
       8.2 5-atomic cluster
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Perform relaxation of 8 different random configurations for the
         <span class="matematik">
         </span>
         <script type="math/tex">
          N=5
         </script>
         Lennard-Jones
cluster.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_15_fig1.png">
              <img class="img-fluid" src="images/26.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_468">
      </div>
      <div class="comments" id="issues_468">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_469">
     <div class="col-11">
      <h3>
       8.3 7-atomic cluster
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Perform relaxation of 8 different random configurations for the
         <span class="matematik">
         </span>
         <script type="math/tex">
          N=7
         </script>
         Lennard-Jones
cluster.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_15_fig2.png">
              <img class="img-fluid" src="images/26.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_469">
      </div>
      <div class="comments" id="issues_469">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_470">
     <div class="col-11">
      <h3>
       8.4 10-atomic cluster
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Perform relaxation of 8 different random configurations for the
         <span class="matematik">
         </span>
         <script type="math/tex">
          N=10
         </script>
         Lennard-Jones
cluster.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_15_fig3.png">
              <img class="img-fluid" src="images/26.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_470">
      </div>
      <div class="comments" id="issues_470">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_471">
     <div class="col-11">
      <h3>
       8.5 12-atomic cluster
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Perform relaxation of 8 different random configurations for the
         <span class="matematik">
         </span>
         <script type="math/tex">
          N=12
         </script>
         Lennard-Jones
cluster.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_15_fig4.png">
              <img class="img-fluid" src="images/26.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_471">
      </div>
      <div class="comments" id="issues_471">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 16
     </h1>
    </div>
    <div class="row spy-padding" id="block_450">
     <div class="col-11">
      <h3>
       9.1 Particle Swarm Optimization
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Solve exercise 12 again, but this time using the particle swarm method.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_16_fig1.gif">
              <img class="img-fluid" src="images/27.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_450">
      </div>
      <div class="comments" id="issues_450">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 17
     </h1>
    </div>
    <div class="row spy-padding" id="block_472">
     <div class="col-11">
      <h3>
       10.1 Basin hopping
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Implement the Basin Hopping method.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_472">
      </div>
      <div class="comments" id="issues_472">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_473">
     <div class="col-11">
      <h3>
       10.2 3-atomic cluster
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Perform 8 independent searches for the
         <span class="matematik">
         </span>
         <script type="math/tex">
          N=5
         </script>
         Lennard-Jones
cluster.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_17_fig1.png">
              <img class="img-fluid" src="images/28.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_473">
      </div>
      <div class="comments" id="issues_473">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_474">
     <div class="col-11">
      <h3>
       10.3 7-atomic cluster
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Perform 8 independent searches for the
         <span class="matematik">
         </span>
         <script type="math/tex">
          N=7
         </script>
         Lennard-Jones
cluster.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_17_fig2.png">
              <img class="img-fluid" src="images/28.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_474">
      </div>
      <div class="comments" id="issues_474">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_475">
     <div class="col-11">
      <h3>
       10.4 10-atomic cluster
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Perform 8 independent searches for the
         <span class="matematik">
         </span>
         <script type="math/tex">
          N=10
         </script>
         Lennard-Jones
cluster.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_17_fig3.png">
              <img class="img-fluid" src="images/28.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_475">
      </div>
      <div class="comments" id="issues_475">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_476">
     <div class="col-11">
      <h3>
       10.5 12-atomic cluster
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Perform 8 independent searches for the
         <span class="matematik">
         </span>
         <script type="math/tex">
          N=12
         </script>
         Lennard-Jones
cluster.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/4/img/exercise_17_fig4.png">
              <img class="img-fluid" src="images/28.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_476">
      </div>
      <div class="comments" id="issues_476">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Week 4
     </h1>
    </div>
    <div class="row spy-padding" id="block_546">
     <div class="col-11">
      <h3>
       1.1 Introduction
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This week is about:
         <ul>
          <p>
          </p>
          <li>
           <p>
            Representation
           </p>
          </li>
          <li>
           <p>
            Dimensionality reduction
           </p>
          </li>
          <li>
           <p>
            Clustering
           </p>
          </li>
         </ul>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_546">
      </div>
      <div class="comments" id="issues_546">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_547">
     <div class="col-11">
      <h3>
       1.2 First TØ
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Work on exercisese 18-23.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_547">
      </div>
      <div class="comments" id="issues_547">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_548">
     <div class="col-11">
      <h3>
       1.3 Second TØ
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Continue working on the exercises.
        </p>
        <p>
         Update your portfolio with what you have learnt about the three topics
listed above.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_548">
      </div>
      <div class="comments" id="issues_548">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      External resources
     </h1>
    </div>
    <div class="row spy-padding" id="block_516">
     <div class="col-11">
      <h3>
       2.1 Clustering
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read about it at
         <a href="https://en.wikipedia.org/wiki/Cluster_analysis" target="_blank">
          Wikipedia
         </a>
         .
        </p>
        <p>
         Read about it in the
         <a href="https://scikit-learn.org/stable/modules/clustering.html" target="_blank">
          scikit learn documentation
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_516">
      </div>
      <div class="comments" id="issues_516">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_517">
     <div class="col-11">
      <h3>
       2.2 Collection of inter-atomic distances
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this weeks work, we use the set of inter-atomic distances of some
atomic clusters. Working with solids, the distances are usually
described via their probability distribution, which is normalized with
a volume element that scales with
         <span class="matematik">
         </span>
         <script type="math/tex">
          r^2
         </script>
         . Read more at
         <a href="https://en.wikipedia.org/wiki/Radial_distribution_function" target="_blank">
          Wikipedia
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_517">
      </div>
      <div class="comments" id="issues_517">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_518">
     <div class="col-11">
      <h3>
       2.3 Moments
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The average and the standard deviation represent the first and second
moments of a set (or distribution), respectively. Read more about
moments at
         <a href="https://en.wikipedia.org/wiki/Moment_(physics)" target="_blank">
          Wikipedia
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_518">
      </div>
      <div class="comments" id="issues_518">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_519">
     <div class="col-11">
      <h3>
       2.4 Adjacency matrix
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read about it at
         <a href="https://en.wikipedia.org/wiki/Adjacency_matrix" target="_blank">
          Wikipedia
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_519">
      </div>
      <div class="comments" id="issues_519">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Clustering
     </h1>
    </div>
    <div class="row spy-padding" id="block_530">
     <div class="col-11">
      <h3>
       3.1 Intro
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         A very important discipline in machine learning is that of
clustering. In clustering, unlabeled data is organized by algorithms
that have access to a representation of the data, but no specific
insight into the meaning of the data. Clustering does not use labels
on the data, and as such clustering is part of
         <span style="color:green">
          <i>
           unsupervised
          </i>
         </span>
         machine learning.
Since the representation of
the data may be high-dimensional, it is often useful when assessing
the quality of a clustering process to perform a dimensionality
reduction so as to enable a visualization in low-dimensions (typically
two dimensions).
        </p>
        <p>
         In this chapter, we shall be introducing different representation
measures and see how they support clustering of data for atomic
clusters. Also, the method of principal component analysis will be
introduced. Throughout, the domain considered will be that of
two-dimensional atomic clusters. Note that
         <span style="color:orange">
          atomic
  clusters
         </span>
         and
         <span style="color:green">
          clusters
         </span>
         refer to two completely different things
in this chapter.
        </p>
        <p>
         In cartesian coordinates, two-dimensional, i.e. "flat", atomic clusters with
         <span class="matematik">
         </span>
         <script type="math/tex">
          N
         </script>
         atoms have
         <span class="matematik">
         </span>
         <script type="math/tex">
          N\times
2
         </script>
         coordinates. These coordinates already constitute a
representation. The representation is unique, as any set of
coordinates only encode one atomic cluster. The cartesian
representation, however, is not very useful for  machine learning since
lateral translation, rotation, and mirroring of an atomic cluster
leads to a new set of cartesian coordinates while the physical
properties of the atomic cluster remain unchanged. A representation which is
good for machine learning must be invariant under such
transformations, and it must retain as much uniqueness as possible.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_530">
      </div>
      <div class="comments" id="issues_530">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_531">
     <div class="col-11">
      <h3>
       3.2 Some 2D representations
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         For the sake of simplicity, we start with some representations that
are over-simplified. These will be two 2D-representations that are
easy to plot. As will be clear from the exercises, they will lack the
uniqueness property.
        </p>
        <b>
         Distance moments representation
        </b>
        <p>
         This representation brings the
         <span class="matematik">
         </span>
         <script type="math/tex">
          N\times2
         </script>
         cartesian representation of
an atomic cluster to a
         <span class="matematik">
         </span>
         <script type="math/tex">
          2
         </script>
         -dimensional representation consisting of
the mean,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mu
         </script>
         , and standard deviation,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \sigma
         </script>
         , of all interatomic distances within
the atomic cluster:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \left[\mu,\sigma\right]
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         To establish this representation, all inter-atomic distances must be
evaluated e.g. using
         <code class="prettyprint python">
          scipy.spatial.distance.pdist
         </code>
         .
        </p>
        <b>
         Extreme neighbor count representation
        </b>
        <p>
         This is another
         <span class="matematik">
         </span>
         <script type="math/tex">
          2
         </script>
         -dimensional representation, which describes the
atomic cluster via the lowest and highest coordination experienced by
any atom:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \left[N_\mathrm{lowest},N_\mathrm{highest}\right]
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         To set up this representation, the number of nearest neighbors must be
found for every atom, and the extreme values must be identified. A
nearest neighbor is an atom that lies within a cutoff distance. For the
Lennard-Jones potential e.g.:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="eqCOLONnearest_neighbor_cutoff">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          r_{cut}=A r_{min},
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          r_{min}=2^{1/6}\sigma
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          A=1.2
         </script>
         can be used.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_531">
      </div>
      <div class="comments" id="issues_531">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_532">
     <div class="col-11">
      <h3>
       3.3 Interatomic Distance Distribution
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This representation involves:
         <ul>
          <p>
          </p>
          <li>
           <p>
            Evalute all inter-atomic distances. For an
            <span class="matematik">
            </span>
            <script type="math/tex">
             N
            </script>
            -atomic cluster there
  will be
            <span class="matematik">
            </span>
            <script type="math/tex">
             \displaystyle\frac{N(N-1)}{2}
            </script>
            such distances. Thus for
  e.g.
            <span class="matematik">
            </span>
            <script type="math/tex">
             N=10
            </script>
            there are
            <span class="matematik">
            </span>
            <script type="math/tex">
             45
            </script>
            distances.
           </p>
          </li>
          <li>
           <p>
            Form a histogram of the inter-atomic distances and use the vector
  containing the height of each bar as the representation. If e.g. the
  histogram has bin-edges at
            <span class="matematik">
            </span>
            <script type="math/tex">
             0, 0.5, 1, \dots 7
            </script>
            , this will become a
            <span class="matematik">
            </span>
            <script type="math/tex">
             14
            </script>
            -dimensional representation.
           </p>
          </li>
         </ul>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_532">
      </div>
      <div class="comments" id="issues_532">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_533">
     <div class="col-11">
      <h3>
       3.4 Coordination Number Profile
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This representation involves:
         <ul>
          <p>
          </p>
          <li>
           <p>
            Find the number of nearest neighbors for each atom. The cutoff
criterion introduced
            <a data-poload="eqCOLONnearest_neighbor_cutoff" href="#eqCOLONnearest_neighbor_cutoff">
             above
            </a>
            may be used. For an
            <span class="matematik">
            </span>
            <script type="math/tex">
             N=10
            </script>
            atomic cluster, there will be
            <span class="matematik">
            </span>
            <script type="math/tex">
             10
            </script>
            such
values of nearest neighbor counts.
           </p>
          </li>
          <li>
           <p>
            Form a histogram of the nearest neighbor values and use the vector
  of bar heights as the representation. With bins centered
  on
            <span class="matematik">
            </span>
            <script type="math/tex">
             0, 1, 2, \dots, 7
            </script>
            , the representation becomes 8-dimensional.
           </p>
          </li>
         </ul>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_533">
      </div>
      <div class="comments" id="issues_533">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_534">
     <div class="col-11">
      <h3>
       3.5 Connectivity Graph Spectrum
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This representation involves:
         <ul>
          <p>
          </p>
          <li>
           <p>
            Set up a connectivity matrix,
            <span class="matematik">
            </span>
            <script type="math/tex">
             M
            </script>
            , that reflects whether or not two atoms
are nearest neighbors. If atom
            <span class="matematik">
            </span>
            <script type="math/tex">
             i
            </script>
            and atom
            <span class="matematik">
            </span>
            <script type="math/tex">
             j
            </script>
            , are nearest
neighbors,
            <span class="matematik">
            </span>
            <script type="math/tex">
             M_{ij}=M_{ji}
            </script>
            is set to
            <span class="matematik">
            </span>
            <script type="math/tex">
             1
            </script>
            otherwise it is set to 0.
Use the same cutoff criterion as
            <a data-poload="eqCOLONnearest_neighbor_cutoff" href="#eqCOLONnearest_neighbor_cutoff">
             above
            </a>
            . For an
            <span class="matematik">
            </span>
            <script type="math/tex">
             N=10
            </script>
            atomic
cluster, the matrix will be
            <span class="matematik">
            </span>
            <script type="math/tex">
             N\times N
            </script>
            .
           </p>
          </li>
          <li>
           <p>
            Find the eigenvalues of the connectivity matrix.
           </p>
          </li>
          <li>
           <p>
            Use the vector of sorted eigenvalues as the representation. Since an
            <span class="matematik">
            </span>
            <script type="math/tex">
             N\times N
            </script>
            matrix has
            <span class="matematik">
            </span>
            <script type="math/tex">
             N
            </script>
            eigenvalues, the representation for a
            <span class="matematik">
            </span>
            <script type="math/tex">
             10
            </script>
            -atomic cluster will be
            <span class="matematik">
            </span>
            <script type="math/tex">
             10
            </script>
            -dimensional.
           </p>
          </li>
         </ul>
         The reason why the eigenvalue spectrum is used rather than the matrix
itself is that the spectrum is invariant with respect to permutation
of the order of the atoms, while the matrix is not. Also, it is a nice
dimensionality reduction. The sorting of the eigenvalues is done as
two instances of the same atomic cluster could otherwise have two
different representations.
        </p>
        <p>
         Note: the connectivity matrix is symmetric
and therefore has real (as opposed to complex)
eigenvalues. Numerically, they may, however, come out slightly complex
from a linear algebra library call. The imaginary part of such
eigenvalues can be ignored.
        </p>
        <p>
         Also note: Practitioners of tight-binding modeling or Hückel-theory
will appreciate using the eigenvalues of
         <span class="matematik">
         </span>
         <script type="math/tex">
          -M
         </script>
         since they behave as the
energy of the electrons bound to the atomic cluster.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_534">
      </div>
      <div class="comments" id="issues_534">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_535">
     <div class="col-11">
      <h3>
       3.6 Coulomb Matrix Spectrum
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This representation resembles the connectivity matrix spectrum. Only
it has the inverse distance in the off-diagonal and 1's in the diagonal
of the matrix:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         M_{ij} = 
\begin{cases} 
1 & \text{for } i = j \\
\frac{1}{r_{ij}} & \text{for } i \neq j
\end{cases}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Again, the eigenvalues of the matrix are found and sorted in ascending
order. The resulting
         <span class="matematik">
         </span>
         <script type="math/tex">
          N
         </script>
         -dimensional vector is the descriptor for an
         <span class="matematik">
         </span>
         <script type="math/tex">
          N
         </script>
         -atomic cluster.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_535">
      </div>
      <div class="comments" id="issues_535">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_536">
     <div class="col-11">
      <h3>
       3.7 Principal Component Analysis
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Principal Component Analysis (PCA) is a technique used to reduce the
dimensionality of data while preserving as much variance as
possible. Given a dataset, PCA finds new variables, called
         <i>
          principal components
         </i>
         , which are linear combinations of the
original variables and are uncorrelated. These principal components
capture the directions of maximum variance in the data.
        </p>
        <b>
         Steps to Perform PCA
        </b>
        <ul>
         <p>
         </p>
         <li>
          <p>
           Mean Centering the Data:
          </p>
          <p>
           Given a dataset with
           <span class="matematik">
           </span>
           <script type="math/tex">
            M
           </script>
           observations and
           <span class="matematik">
           </span>
           <script type="math/tex">
            p
           </script>
           variables, represented as a matrix
           <span class="matematik">
           </span>
           <script type="math/tex">
            \mathbf{X} \in \mathbb{R}^{M \times p}
           </script>
           , the first step is to center the data by subtracting the mean of each variable:
           <div class="matematik">
           </div>
           <script type="math/tex; mode=display">
            \mathbf{X}_{\text{centered}} = \mathbf{X} - \mathbf{1}_M \mathbf{\mu}^\top
           </script>
           where
           <span class="matematik">
           </span>
           <script type="math/tex">
            \mathbf{\mu} \in \mathbb{R}^{p}
           </script>
           is the vector of means of each variable, and
           <span class="matematik">
           </span>
           <script type="math/tex">
            \mathbf{1}_M
           </script>
           is a column vector of ones of length
           <span class="matematik">
           </span>
           <script type="math/tex">
            M
           </script>
           .
          </p>
         </li>
         <li>
          <p>
           Covariance Matrix
          </p>
          <p>
           Compute the covariance matrix
           <span class="matematik">
           </span>
           <script type="math/tex">
            \mathbf{C} \in \mathbb{R}^{p \times p}
           </script>
           of the centered data:
           <div class="matematik">
           </div>
           <script type="math/tex; mode=display">
            \mathbf{C} = \frac{1}{M-1} \mathbf{X}_{\text{centered}}^\top \mathbf{X}_{\text{centered}}
           </script>
           The covariance matrix describes how the variables are correlated with each other.
          </p>
         </li>
         <li>
          <p>
           Eigenvalue Decomposition
          </p>
          <p>
           Perform the eigenvalue decomposition of the covariance matrix:
           <div class="matematik">
           </div>
           <script type="math/tex; mode=display">
            \mathbf{C} = \mathbf{Q} \mathbf{\Lambda} \mathbf{Q}^\top
           </script>
           where
           <span class="matematik">
           </span>
           <script type="math/tex">
            \mathbf{Q} \in \mathbb{R}^{p \times p}
           </script>
           is the matrix of
   eigenvectors (principal components), and
           <span class="matematik">
           </span>
           <script type="math/tex">
            \mathbf{\Lambda} \in
   \mathbb{R}^{p \times p}
           </script>
           is a diagonal matrix of eigenvalues
           <span class="matematik">
           </span>
           <script type="math/tex">
            \lambda_1, \lambda_2, \dots, \lambda_p
           </script>
           (which represent the
   amount of variance captured by each principal component). The
   decomposition must be done for the
           <span class="matematik">
           </span>
           <script type="math/tex">
            \mathbf{\Lambda}
           </script>
           in which the
   eigenvalues are ordered in descending order.
          </p>
         </li>
         <li>
          <p>
           Principal Components
          </p>
          <p>
           The principal components are given by projecting the centered data onto the eigenvectors:
           <div class="matematik">
           </div>
           <script type="math/tex; mode=display">
            \mathbf{Z} = \mathbf{X}_{\text{centered}} \mathbf{Q}
           </script>
           The matrix
           <span class="matematik">
           </span>
           <script type="math/tex">
            \mathbf{Z} \in \mathbb{R}^{M \times p}
           </script>
           contains the principal components. The first column corresponds to the first principal component (the direction of maximum variance), the second column corresponds to the second principal component, and so on.
          </p>
         </li>
         <li>
          <p>
           Dimensionality Reduction
          </p>
          <p>
           To reduce the dimensionality of the data, we can select the first
           <span class="matematik">
           </span>
           <script type="math/tex">
            k
           </script>
           principal components, where
           <span class="matematik">
           </span>
           <script type="math/tex">
            k < p
           </script>
           , and project the data onto these components. The reduced data is:
           <div class="matematik">
           </div>
           <script type="math/tex; mode=display">
            \mathbf{Z}_k = \mathbf{X}_{\text{centered}} \mathbf{Q}_k
           </script>
           where
           <span class="matematik">
           </span>
           <script type="math/tex">
            \mathbf{Q}_k \in \mathbb{R}^{p \times k}
           </script>
           contains the first
           <span class="matematik">
           </span>
           <script type="math/tex">
            k
           </script>
           eigenvectors.
          </p>
         </li>
         <li>
          <p>
           Explained Variance
          </p>
          <p>
           The total variance in the data is the sum of the eigenvalues
           <span class="matematik">
           </span>
           <script type="math/tex">
            \lambda_1 + \lambda_2 + \dots + \lambda_p
           </script>
           . The proportion of variance explained by the
           <span class="matematik">
           </span>
           <script type="math/tex">
            i
           </script>
           -th principal component is given by:
           <div class="matematik">
           </div>
           <script type="math/tex; mode=display">
            \frac{\lambda_i}{\sum_{j=1}^{p} \lambda_j}
           </script>
           By choosing the first few principal components, we can retain most of the variance in the data while reducing its dimensionality.
          </p>
         </li>
        </ul>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_536">
      </div>
      <div class="comments" id="issues_536">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_537">
     <div class="col-11">
      <h3>
       3.8 k-means clustering
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         K-means clustering is a widely-used unsupervised learning algorithm
that partitions a dataset into
         <span class="matematik">
         </span>
         <script type="math/tex">
          k
         </script>
         clusters, where
         <span class="matematik">
         </span>
         <script type="math/tex">
          k
         </script>
         is a
user-defined parameter. The objective of the algorithm is to minimize
the within-cluster variance, or equivalently, to minimize the sum of
squared distances between each data point and the centroid of its
assigned cluster.
        </p>
        <b>
         Steps of the K-means Algorithm
        </b>
        <p>
         <ol>
          <p>
          </p>
          <li>
           <p>
            Initialization:
           </p>
           <p>
            The algorithm begins by selecting
            <span class="matematik">
            </span>
            <script type="math/tex">
             k
            </script>
            initial centroids, denoted
            <span class="matematik">
            </span>
            <script type="math/tex">
             \boldsymbol{\mu}_1, \boldsymbol{\mu}_2, \dots, \boldsymbol{\mu}_k
            </script>
            , which represent the centers of the clusters. These centroids can be selected randomly from the dataset or initialized in other ways.
           </p>
          </li>
          <li>
           <p>
            Assignment Step:
           </p>
           <p>
            Each data point
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathbf{x}_i
            </script>
            is assigned to the cluster whose centroid is closest in terms of Euclidean distance. This step minimizes the within-cluster variance for a fixed set of centroids. Mathematically, for each data point
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathbf{x}_i
            </script>
            , its cluster assignment
            <span class="matematik">
            </span>
            <script type="math/tex">
             C_i
            </script>
            is given by:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             C_i = \arg \min_{j \in \{\dots, k\}} \|\mathbf{x}_i - \boldsymbol{\mu}_j\|^2
            </script>
            where
            <span class="matematik">
            </span>
            <script type="math/tex">
             \|\mathbf{x}_i - \boldsymbol{\mu}_j\|^2
            </script>
            is the squared Euclidean distance between the data point
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathbf{x}_i
            </script>
            and the centroid
            <span class="matematik">
            </span>
            <script type="math/tex">
             \boldsymbol{\mu}_j
            </script>
            .
           </p>
          </li>
          <li>
           <p>
            Update Step:
   After assigning each data point to a cluster, the centroids are updated by calculating the mean of all the points in each cluster. The new centroid
            <span class="matematik">
            </span>
            <script type="math/tex">
             \boldsymbol{\mu}_j
            </script>
            of cluster
            <span class="matematik">
            </span>
            <script type="math/tex">
             j
            </script>
            is given by:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \boldsymbol{\mu}_j = \frac{1}{|C_j|} \sum_{\mathbf{x}_i \in C_j} \mathbf{x}_i
            </script>
            where
            <span class="matematik">
            </span>
            <script type="math/tex">
             C_j
            </script>
            is the set of points assigned to cluster
            <span class="matematik">
            </span>
            <script type="math/tex">
             j
            </script>
            , and
            <span class="matematik">
            </span>
            <script type="math/tex">
             |C_j|
            </script>
            is the number of points in that cluster.
           </p>
          </li>
          <li>
           <p>
            Convergence:
           </p>
           <p>
            The assignment and update steps are repeated iteratively until the cluster assignments no longer change, or equivalently, until the centroids stabilize. This usually indicates that a local minimum of the within-cluster variance has been reached.
           </p>
          </li>
         </ol>
        </p>
        <b>
         Objective Function
        </b>
        <p>
         The objective of k-means clustering is to minimize the total within-cluster sum of squared distances, given by:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         J = \sum_{j=1}^{k} \sum_{\mathbf{x}_i \in C_j} \|\mathbf{x}_i - \boldsymbol{\mu}_j\|^2
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          J
         </script>
         represents the sum of squared distances between each point and its assigned centroid, and the goal of the algorithm is to minimize this objective function.
        </p>
        <b>
         Limitations
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            The k-means algorithm is sensitive to the initial selection of
centroids, which may lead to suboptimal clustering results. Different
initializations can result in different final clusterings.
           </p>
          </li>
          <li>
           <p>
            The algorithm assumes that clusters are spherical and equally sized,
which may not hold true for all datasets.
           </p>
          </li>
          <li>
           <p>
            K-means can get stuck in local minima, and it is often beneficial to run the algorithm multiple times with different initializations.
           </p>
          </li>
         </ul>
        </p>
        <p>
         Despite these limitations, k-means remains a simple and effective clustering method for many practical applications.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_537">
      </div>
      <div class="comments" id="issues_537">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_538">
     <div class="col-11">
      <h3>
       3.9 DBSCAN clustering
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         DBSCAN (Density-Based Spatial Clustering of Applications with Noise)
is a popular density-based clustering algorithm. Unlike K-means, which
partitions the data into a predetermined number of clusters, DBSCAN
can discover clusters of arbitrary shapes and handle noise (outliers)
effectively.
        </p>
        <b>
         Key Parameters
        </b>
        <p>
         DBSCAN requires two input parameters:
         <ul>
          <p>
          </p>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             \epsilon
            </script>
            (eps): The maximum distance between two points for them to
be considered neighbors.
           </p>
          </li>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             \text{minPts}
            </script>
            : The minimum number of points required to form a dense
region (i.e., a cluster).
           </p>
          </li>
         </ul>
        </p>
        <b>
         Core Concepts
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            Core Point: A point
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            is a core point if at least
            <span class="matematik">
            </span>
            <script type="math/tex">
             \text{minPts}
            </script>
            points, including
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            , are within a distance
            <span class="matematik">
            </span>
            <script type="math/tex">
             \epsilon
            </script>
            of it. This
means that the neighborhood of
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            contains at least
            <span class="matematik">
            </span>
            <script type="math/tex">
             \text{minPts}
            </script>
            points.
           </p>
          </li>
          <li>
           <p>
            Border Point: A point
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            is a border point if it is within the
            <span class="matematik">
            </span>
            <script type="math/tex">
             \epsilon
            </script>
            -neighborhood of a core point but has fewer than
            <span class="matematik">
            </span>
            <script type="math/tex">
             \text{minPts}
            </script>
            neighbors within
            <span class="matematik">
            </span>
            <script type="math/tex">
             \epsilon
            </script>
            .
           </p>
          </li>
          <li>
           <p>
            Noise Point: A point
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            that is neither a core point nor a border
point is classified as noise.
           </p>
          </li>
         </ul>
        </p>
        <b>
         Algorithm
        </b>
        <p>
         <ol>
          <p>
          </p>
          <li>
           <p>
            For each point
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            in the dataset:
            <ul>
             <p>
             </p>
             <li>
              <p>
               If
               <span class="matematik">
               </span>
               <script type="math/tex">
                p
               </script>
               is already assigned to a cluster, skip it.
              </p>
             </li>
             <li>
              <p>
               Otherwise, retrieve all points within the
               <span class="matematik">
               </span>
               <script type="math/tex">
                \epsilon
               </script>
               -neighborhood of
               <span class="matematik">
               </span>
               <script type="math/tex">
                p
               </script>
               (i.e., points within a distance
               <span class="matematik">
               </span>
               <script type="math/tex">
                \epsilon
               </script>
               of
               <span class="matematik">
               </span>
               <script type="math/tex">
                p
               </script>
               ).
              </p>
             </li>
            </ul>
           </p>
          </li>
          <li>
           <p>
            If
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            is a core point:
            <ul>
             <p>
             </p>
             <li>
              <p>
               Create a new cluster and recursively find all points that are
   density-reachable from
               <span class="matematik">
               </span>
               <script type="math/tex">
                p
               </script>
               . This means finding all points within
   the
               <span class="matematik">
               </span>
               <script type="math/tex">
                \epsilon
               </script>
               -neighborhood of core points and their neighbors.
              </p>
             </li>
             <li>
              <p>
               Density-reachability ensures that clusters are formed by connecting
   core points that are close to each other and any border points
   within their reach.
              </p>
             </li>
            </ul>
           </p>
           <p>
           </p>
          </li>
          <li>
           <p>
            If
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            is a border point, skip it temporarily, it might be picked
   up by a yet unvisited core point.
           </p>
          </li>
          <li>
           <p>
            If
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            is a noise point, classify it as such.
           </p>
          </li>
          <li>
           <p>
            Repeat until all points have been visited. Assign remaining
  border-points as noise points.
           </p>
          </li>
         </ol>
        </p>
        <b>
         Density-Reachability
        </b>
        <p>
         A point
         <span class="matematik">
         </span>
         <script type="math/tex">
          q
         </script>
         is said to be density-reachable from
         <span class="matematik">
         </span>
         <script type="math/tex">
          p
         </script>
         if there exists a chain of points
         <span class="matematik">
         </span>
         <script type="math/tex">
          p_1, p_2, \dots, p_n
         </script>
         , where
         <span class="matematik">
         </span>
         <script type="math/tex">
          p_1 = p
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          p_n = q
         </script>
         , such that each point is within the
         <span class="matematik">
         </span>
         <script type="math/tex">
          \epsilon
         </script>
         -neighborhood of the previous point, and all points in the chain are core points (except possibly
         <span class="matematik">
         </span>
         <script type="math/tex">
          q
         </script>
         , which can be a border point).
        </p>
        <b>
         Result
        </b>
        <p>
         The result of DBSCAN is a set of clusters and a set of noise points. Points classified as noise do not belong to any cluster.
        </p>
        <b>
         Advantages of DBSCAN
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            DBSCAN does not require the number of clusters
            <span class="matematik">
            </span>
            <script type="math/tex">
             k
            </script>
            to be specified a
priori.
           </p>
          </li>
          <li>
           <p>
            It can find clusters of arbitrary shape and size.
           </p>
          </li>
          <li>
           <p>
            It is robust to noise and outliers, as these points are simply
classified as noise and do not affect the clustering.
           </p>
          </li>
         </ul>
        </p>
        <b>
         Limitations of DBSCAN
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            DBSCAN struggles with datasets of varying density, as the choice of
            <span class="matematik">
            </span>
            <script type="math/tex">
             \epsilon
            </script>
            may not be optimal for all parts of the data.
           </p>
          </li>
          <li>
           <p>
            The algorithm's performance is sensitive to the selection of
            <span class="matematik">
            </span>
            <script type="math/tex">
             \epsilon
            </script>
            and
            <span class="matematik">
            </span>
            <script type="math/tex">
             \text{minPts}
            </script>
            .
           </p>
          </li>
         </ul>
        </p>
        <b>
         Mathematical Formulation
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            For each point
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            in the dataset, let
            <span class="matematik">
            </span>
            <script type="math/tex">
             N_\epsilon(p)
            </script>
            denote the set of points within the
            <span class="matematik">
            </span>
            <script type="math/tex">
             \epsilon
            </script>
            -neighborhood of
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            :
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             N_\epsilon(p) = \{\in \text{dataset} \mid d(p, q) \leq \epsilon \}
            </script>
            where
            <span class="matematik">
            </span>
            <script type="math/tex">
             d(p, q)
            </script>
            is the distance between points
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            and
            <span class="matematik">
            </span>
            <script type="math/tex">
             q
            </script>
            .
           </p>
          </li>
          <li>
           <p>
            A point
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            is a core point if:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             |N_\epsilon(p)| \geq \text{minPts}
            </script>
           </p>
          </li>
          <li>
           <p>
            A point
            <span class="matematik">
            </span>
            <script type="math/tex">
             q
            </script>
            is directly density-reachable from
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            if
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            is a core point and
            <span class="matematik">
            </span>
            <script type="math/tex">
             q \in N_\epsilon(p)
            </script>
            .
           </p>
          </li>
          <li>
           <p>
            A point
            <span class="matematik">
            </span>
            <script type="math/tex">
             q
            </script>
            is density-reachable from
            <span class="matematik">
            </span>
            <script type="math/tex">
             p
            </script>
            if there exists a sequence
of points
            <span class="matematik">
            </span>
            <script type="math/tex">
             p_1, p_2, \dots, p_n
            </script>
            , such that
            <span class="matematik">
            </span>
            <script type="math/tex">
             p_1 = p
            </script>
            ,
            <span class="matematik">
            </span>
            <script type="math/tex">
             p_n = q
            </script>
            , and
            <span class="matematik">
            </span>
            <script type="math/tex">
             p_{i+1}
            </script>
            is directly density-reachable from
            <span class="matematik">
            </span>
            <script type="math/tex">
             p_i
            </script>
            for all
            <span class="matematik">
            </span>
            <script type="math/tex">
             i
            </script>
            .
           </p>
          </li>
         </ul>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_538">
      </div>
      <div class="comments" id="issues_538">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 18
     </h1>
    </div>
    <div class="row spy-padding" id="block_502">
     <div class="col-11">
      <h3>
       4.1 Representing 10-atomic clusters
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise you will work with some structures for 10-atomic
Lennard-Jones clusters. You will be tasked with representing the
atomic clusters with a 2-dimensional descriptor. This will allow you
to plot the position of all atomic clusters in a descriptor space. You
will see that something can be understood about the atomic clusters
from their distribution in descriptor space.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_502">
      </div>
      <div class="comments" id="issues_502">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_503">
     <div class="col-11">
      <h3>
       4.2 The data
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Get hold of the coordinates for some 10-atomic Lennard-Jones
clusters from the previous exercises or use 
these coordinates:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
0.000000 0.000000 -1.418965 -1.390737 -1.688972 -0.423876 -0.733005 -0.675280 -0.964995 0.283667 0.184026 -1.008160 0.933780 -0.372159 1.720143 0.231825 0.790685 0.610041 -1.929761 0.539521
0.000000 0.000000 1.594452 2.096896 0.975689 0.204527 1.282223 1.144364 -1.124972 -0.363558 -1.766903 0.406248 0.306625 0.946902 -1.522667 -1.289906 0.614859 1.892383 -2.137872 -0.513459
0.000000 0.000000 0.825937 0.555271 1.563504 2.115362 -0.068715 0.993453 2.464694 1.687123 -0.895309 0.438379 -0.961979 1.433116 -0.135114 1.989666 0.752189 1.547342 1.648064 1.116315
0.000000 0.000000 -0.329527 -1.966106 -1.098189 -1.331234 -0.934150 -0.347817 -0.165895 -0.981661 1.351292 -2.255604 2.289408 -1.915120 1.530826 -1.269672 0.597116 -1.612932 0.767015 -0.632757
0.000000 0.000000 1.695806 0.216090 0.095760 -0.984724 -0.817110 -0.560625 1.821847 -0.774670 0.779182 0.602348 -0.884509 0.440227 1.569083 1.205714 0.903848 -0.392989 -1.639775 1.090493
0.000000 0.000000 0.386270 1.952290 0.191871 0.976331 0.939956 0.319890 -0.557936 1.630655 -0.364034 2.608028 1.883031 0.641596 -0.750700 0.656588 1.133543 1.298326 -0.943267 -0.321140
0.000000 0.000000 0.056521 0.994073 0.110763 1.990370 0.889156 0.448210 -0.896128 -0.440886 0.944477 1.443742 -0.830055 0.549379 -1.601141 2.085894 -0.772695 1.539444 -1.663670 1.087998
0.000000 0.000000 1.063970 1.676171 1.988892 -0.090756 0.994333 -0.049050 -0.449589 0.896327 2.522928 0.751033 1.528080 0.792103 0.538893 0.835352 2.059754 1.633891 -0.994560 0.060639
0.000000 0.000000 0.995858 0.035431 0.923376 1.757822 1.527692 -0.806710 -0.462950 -0.882118 1.459766 0.917354 1.990955 0.075652 -0.075629 1.703794 0.466484 0.872852 0.532977 -0.844247
0.000000 0.000000 0.130795 -1.724604 1.883554 1.844408 0.888534 1.782526 0.446662 0.890686 -0.548252 0.830008 1.440485 0.951972 0.997655 0.064435 -0.104205 1.721547 0.558013 -0.825520
0.000000 0.000000 -0.132422 -1.703296 -1.125868 -1.617227 -1.545386 -0.707910 -1.334903 1.058403 0.438136 -0.888977 -0.356371 0.911440 -0.563468 -0.803344 -0.982442 0.117994 -0.700666 1.840825
0.000000 0.000000 -1.324426 1.481956 1.599205 2.094009 1.288205 1.147275 0.975470 0.202372 0.623345 1.892517 -0.349780 1.690490 -1.623476 0.527505 0.314537 0.947583 -0.655025 0.744064
0.000000 0.000000 -0.977042 -0.182627 0.648771 -0.755726 0.644817 1.875096 0.979514 0.182920 -0.330645 -0.939578 -1.624646 0.574891 0.328599 0.934612 -0.645569 0.759230 1.306414 1.124727
0.000000 0.000000 -0.807474 2.085676 -0.447610 1.163508 -1.423960 1.281009 0.492154 0.903456 0.088640 -0.999133 -0.983376 0.365681 0.197207 1.904952 -0.815246 -0.598326 -0.729619 -1.583292
0.000000 0.000000 0.851902 -0.514632 -0.020255 -0.997591 -0.843388 1.501822 0.870898 0.482304 -1.734613 -0.965206 -1.722460 0.034566 -0.867645 -0.482115 0.017693 0.995755 -0.850935 0.509463
0.000000 0.000000 0.954280 -0.280083 0.467460 -1.935616 -0.486711 -1.654805 -0.718955 -0.687419 1.188234 -1.248191 -0.953960 0.281170 -1.674798 -0.406115 0.232299 -0.967203 -1.440974 -1.374306
0.000000 0.000000 0.700346 0.711286 0.433504 1.679768 -1.507077 -1.315299 -0.562080 -1.624147 -0.761599 -0.652232 -0.976865 0.308906 -1.722718 -0.347473 -0.259215 0.969945 0.186200 -0.970367
0.000000 0.000000 -0.061261 0.992650 -1.659949 -1.099909 -0.767830 -1.542854 -1.783567 0.885506 -0.829906 -0.548372 -0.891519 0.441191 -0.953283 1.435692 -1.721576 -0.107190 0.062345 -0.992583
0.000000 0.000000 1.859458 1.847365 -0.203708 -0.958117 0.769267 -0.604871 0.972297 1.403098 1.795191 0.848900 1.021978 2.393779 0.076864 0.984957 0.562683 -1.581547 0.902302 0.401274
0.000000 0.000000 0.908847 1.466048 -1.721642 0.075810 0.880846 0.466986 0.843883 -0.527850 0.036599 0.992604 -0.037552 -0.994335 -0.839486 0.529991 -0.803860 1.524148 -0.881028 -0.464517
0.000000 0.000000 -0.314524 -0.943521 0.660612 -0.746235 -0.629482 -1.886899 0.346848 -1.686746 1.636936 -0.546076 0.975921 0.198943 1.321982 -1.489462 0.031528 -2.631920 1.007449 -2.432990
0.000000 0.000000 -0.200704 2.015475 -1.011694 1.434716 0.705176 1.604595 0.166003 -0.980408 0.783475 0.618935 -0.904379 0.435894 0.941970 -0.356583 1.714729 0.286443 -0.107052 1.018793
0.000000 0.000000 -0.985621 0.128704 -1.983561 0.150564 2.065380 -1.629472 1.069134 -1.670748 1.596377 -2.512066 1.531238 -0.788659 0.535943 -0.833341 0.074551 -1.714510 0.996375 0.051264
0.000000 0.000000 1.861627 -0.668032 -0.198476 0.974892 0.194092 -0.981941 -0.747748 -0.662027 0.933801 -0.322889 0.748496 0.655551 -1.858372 0.689651 1.689826 0.319434 -0.940631 0.312183
0.000000 0.000000 1.205157 -1.327039 0.449976 -1.966994 1.011090 -0.360529 -0.707088 -0.686087 0.254921 -0.979823 0.813169 0.603285 -0.090503 0.995210 -0.488160 -1.651588 1.770003 0.304437
0.000000 0.000000 -0.955933 0.258622 0.461726 1.658832 -1.915834 0.525718 0.959721 -0.269118 0.711419 0.695656 -1.206421 1.225325 0.239820 -0.963040 -0.248428 0.960114 -0.498374 1.924703
0.000000 0.000000 0.841842 -0.525853 1.719584 -0.057626 0.804156 -1.522864 0.873549 0.470829 -0.880627 -0.467606 -0.904739 -1.466392 -0.033533 -0.991416 1.684697 -1.054667 -0.839093 0.530196
0.000000 0.000000 -0.109582 -0.987477 0.912379 0.394738 1.715232 -0.186958 1.033491 1.379930 -0.217957 -1.977892 0.112779 0.989897 0.802050 -0.590216 0.695213 -1.578553 1.606317 -1.177461
0.000000 0.000000 0.095310 -1.705367 0.973890 0.111786 -0.989086 -0.030805 -2.122258 -1.648189 0.348648 0.918931 1.531134 -0.717578 0.548273 -0.814021 -1.445005 -0.915190 -0.455949 -0.877141
0.000000 0.000000 0.291061 3.428259 1.987294 -0.170641 -0.278712 2.608356 1.564647 0.731362 0.717222 2.527443 0.145922 1.708275 1.141978 1.630711 0.572812 0.813463 0.993898 -0.088350
0.000000 0.000000 -1.192631 -1.584425 -0.200728 -1.712218 -0.399523 0.912291 -0.992161 0.111287 0.396419 -0.914406 0.589599 0.800295 -0.590800 -0.795290 0.987507 -0.115621 1.579600 0.685713
0.000000 0.000000 1.359615 0.981432 1.941998 0.155939 0.489264 -0.841195 1.473842 -0.776634 0.377485 0.907296 -0.026286 -1.693524 0.982449 -1.680148 2.339986 1.084635 0.957326 0.072341
0.000000 0.000000 -1.947917 1.834735 -0.560214 0.825832 -0.958943 1.728373 0.407314 0.932120 0.985685 0.126729 1.908452 -0.241173 -1.553930 0.914099 -1.098075 0.007301 -0.561961 -0.822396
0.000000 0.000000 2.446095 2.575239 -0.073732 0.993697 0.895223 -0.434341 1.565541 2.111207 0.823366 0.559215 1.648490 1.119058 1.719460 0.125408 -0.897181 0.433915 0.747975 1.550465
0.000000 0.000000 0.843636 -0.518551 -0.876368 -0.473114 1.696341 -1.022279 -0.847076 0.523311 0.879721 0.472211 0.821627 -1.512414 -0.029224 -0.995761 1.679133 -2.019869 0.031196 0.995115
0.000000 0.000000 1.054614 1.361292 0.134230 0.984866 -0.645953 1.598463 0.780120 -0.613604 -1.569899 1.216568 0.918872 0.375719 1.704070 -0.231715 -0.784695 0.609170 -0.920453 -0.376400
0.000000 0.000000 1.396444 -1.010304 0.585325 0.804499 1.575095 0.703892 1.169522 1.611994 0.989839 -0.100605 1.981138 -0.204003 0.178795 1.714223 0.405693 -0.908097 -0.405952 0.907949
0.000000 0.000000 0.842172 -1.803626 -0.281751 2.614796 1.414482 -0.984104 -0.851524 1.794893 0.991835 -0.082101  0.14441 1.71398 -0.42689 0.894812 0.569166 0.817248 0.421086 -0.901813
</pre>
        <p>
         by storing them as a file with filename
         <code class="prettyprint python">
          lj10clusters.txt
         </code>
         in the
same directory as where your
         <code class="prettyprint python">
          .ipynb
         </code>
         files are
stored. They can then be read in like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
pos_flat = np.loadtxt('lj10clusters.txt')
positions = pos_flat.reshape(-1,pos_flat.shape[1]//2,2)
</pre>
        <p>
         which will give you an array with 38 sets of
         <span class="matematik">
         </span>
         <script type="math/tex">
          10\times 2
         </script>
         coordinates for
some clusters.
        </p>
        <p>
         For your information: The file was written in this way in the first place:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
np.savetxt('lj10clusters.txt', positions.reshape(positions.shape[0], -1), fmt='%f')
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_503">
      </div>
      <div class="comments" id="issues_503">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_504">
     <div class="col-11">
      <h3>
       4.3 Descriptor class
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Complete this descriptor class that implements the distance moments
representation:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class DistanceMoments():
    
    def __init__(self, color='C4'):
        self.xwidth = 1
        self.color = color
        self.bin_centers = range(2)
    
    def descriptor(self,pos):
        all_distances = YOUR CODE
        YOUR CODE
        YOUR CODE
        return np.array([mean,std])
    
    def draw(self,pos,ax):
        vector = self.descriptor(pos)
        ax.bar(self.bin_centers,vector,width=0.8 * self.xwidth,color=self.color)
        ax.xaxis.set_major_locator(plt.MultipleLocator(1.0))
        ax.set_ylim([0,2.3])
        xticklabels = ['$\mu$','$\sigma$']
        ax.set_xticks(range(len(xticklabels)))
        ax.set_xticklabels(xticklabels)
        ax.set_title(self.__class__.__name__)
</pre>
        <p>
         c) Use it to plot descriptors for some of the clusters whose position
you handled in a).
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_18_fig1.png">
              <img class="img-fluid" src="images/32.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_504">
      </div>
      <div class="comments" id="issues_504">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_505">
     <div class="col-11">
      <h3>
       4.4 Descriptor space
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Plot the descriptors for all 38 clusters in descriptor space,
i.e. in a
         <span class="matematik">
         </span>
         <script type="math/tex">
          (\mu,\sigma)
         </script>
         -coordinate system. Use one of the coordinates
to divide the atomic clusters in 6 different clusters by "human
learning", i.e. use the insight you get from looking at the figure to
group the descriptors. Give each group its own color.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_18_fig2.png">
              <img class="img-fluid" src="images/32.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Note: "atomic cluster"="aggregate of atoms" vs "cluster"="group of such aggregates".
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_505">
      </div>
      <div class="comments" id="issues_505">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_506">
     <div class="col-11">
      <h3>
       4.5 Inspect atomic clusters
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         e) Sort the atomic clusters according to the group they belong to
following your division in d). Inspect atomic clusters in the same
group. Perhaps by plotting them like here:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_18_fig3.png">
              <img class="img-fluid" src="images/32.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Discuss whether you find the descriptor useful.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_506">
      </div>
      <div class="comments" id="issues_506">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 19
     </h1>
    </div>
    <div class="row spy-padding" id="block_507">
     <div class="col-11">
      <h3>
       5.1 Extreme neighbor count
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Complete this class that implements the extreme neighbor count representation:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
from scipy.spatial.distance import pdist,squareform

class ExtremeNeighborCount():
    
    def __init__(self, color='C5'):
        self.xwidth = 1
        self.color = color
        self.bin_centers = range(2)
    
    def descriptor(self,pos):
        connectivity_matrix = (squareform(pdist(pos)) YOUR CODE ).astype(int)
        np.fill_diagonal( YOUR CODE )
        YOUR CODE
        return np.array([Nlowest,Nhighest])

    def draw(self,pos,ax):
        vector = self.descriptor(pos)
        ax.bar(self.bin_centers,vector,width=0.8 * self.xwidth,color=self.color)
        ax.xaxis.set_major_locator(plt.MultipleLocator(1.0))
        ax.set_ylim([0,7])
        xticklabels = ['$N_{lowest}$','$N_{highest}$']
        ax.set_xticks(range(len(xticklabels)))
        ax.set_xticklabels(xticklabels)
        ax.set_title(self.__class__.__name__)
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_507">
      </div>
      <div class="comments" id="issues_507">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_508">
     <div class="col-11">
      <h3>
       5.2 Histograms
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Plot the descriptor for some 10-atomic Lennard-Jones clusters.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_19_fig1.png">
              <img class="img-fluid" src="images/33.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_508">
      </div>
      <div class="comments" id="issues_508">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_509">
     <div class="col-11">
      <h3>
       5.3 Descriptor space
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Place the descriptors in descriptor space and realize that there
are only six different descriptors. It would therefore be natural to
define six clusters.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_19_fig3.png">
              <img class="img-fluid" src="images/33.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_509">
      </div>
      <div class="comments" id="issues_509">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_510">
     <div class="col-11">
      <h3>
       5.4 Inspect atomic clusters
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Now, inspect atomic clusters that share descriptor. E.g. by
plotting them sorted and colored according to the cluster they belong to:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_19_fig4.png">
              <img class="img-fluid" src="images/33.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_510">
      </div>
      <div class="comments" id="issues_510">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 20
     </h1>
    </div>
    <div class="row spy-padding" id="block_520">
     <div class="col-11">
      <h3>
       6.1 Multi-dimensional descriptors
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise we shall work with the more rich multi-dimensional
descriptors: The Interatomic Distance Distribution, the Coordination Number
Profile, the Connectivity Graph Spectrum, and the Coulomb Matrix
Spectrum  descriptors. If you are
pressed for time, the last one of them is the more important. Using
some of the 10-atomic Lennard-Jones clusters that you worked with
previously, you will be able to compare the descriptors:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_20_fig1.png">
              <img class="img-fluid" src="images/34.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_520">
      </div>
      <div class="comments" id="issues_520">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_521">
     <div class="col-11">
      <h3>
       6.2 Interatomic Distance Distribution
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Implement the Interatomic Distance Distribution descriptor by
completing this class:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class PairDistances():
    
    def __init__(self, color='C1'):
        self.xwidth = 0.5
        self.color = color
        self.bin_edges = np.arange(0,7.01,self.xwidth)
        self.bin_centers = (self.bin_edges[:-1] + self.bin_edges[1:]) /2
    
    def descriptor(self,pos):
        YOUR CODE
    
    def draw(self,pos,ax):
        vector = self.descriptor(pos)
        ax.bar(self.bin_centers,vector,width=0.8 * self.xwidth,color=self.color)
        ax.xaxis.set_major_locator(plt.MultipleLocator(1.0))
        ax.set_title(self.__class__.__name__)
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_521">
      </div>
      <div class="comments" id="issues_521">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_522">
     <div class="col-11">
      <h3>
       6.3 Coordination Number Profile
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Implement the Coordination Number Profile
descriptor by
completing this class:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class CoordinationNumbers():
    
    def __init__(self, color='C2'):
        self.xwidth = 1
        self.color = color
    
    def descriptor(self,pos):
        YOUR CODE
    
    def draw(self,pos,ax):
        vector = self.descriptor(pos)
        N = len(vector)
        xcenters = np.linspace(0,N-1,N) * self.xwidth
        ax.bar(xcenters,vector,width=0.8 * self.xwidth,color=self.color)
        ax.xaxis.set_major_locator(plt.MultipleLocator(1.0))
        ax.set_title(self.__class__.__name__)
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_522">
      </div>
      <div class="comments" id="issues_522">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_523">
     <div class="col-11">
      <h3>
       6.4 Connectivity Graph Spectrum
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Implement the Connectivity Graph Spectrum
descriptor by
completing this class:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class ConnectivityGraphSpectrum():
    
    def __init__(self, color='C3'):
        self.xwidth = 1
        self.color = color
    
    def descriptor(self,pos):
        YOUR CODE
    
    def draw(self,pos,ax):
        vector = self.descriptor(pos)
        N = len(vector)
        xcenters = np.linspace(0,N-1,N) * self.xwidth
        ax.bar(xcenters,vector,width=0.8 * self.xwidth,color=self.color)
        ax.xaxis.set_major_locator(plt.MultipleLocator(1.0))
        ax.set_title(self.__class__.__name__)
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_523">
      </div>
      <div class="comments" id="issues_523">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_524">
     <div class="col-11">
      <h3>
       6.5 Coulomb Matrix Spectrum
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Implement the Coulomb Matrix Spectrum
descriptor by
completing this class:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class CoulombMatrixSpectrum():
    
    def __init__(self, color='C4'):
        self.xwidth = 1
        self.color = color
    
    def descriptor(self,pos):
        YOUR CODE

    def draw(self,pos,ax):
        vector = self.descriptor(pos)
        N = len(vector)
        xcenters = np.linspace(0,N-1,N) * self.xwidth
        ax.bar(xcenters,vector,width=0.8 * self.xwidth,color=self.color)
        ax.xaxis.set_major_locator(plt.MultipleLocator(1.0))
        ax.set_ylim([-2,8])
        ax.set_title(self.__class__.__name__)
</pre>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_524">
      </div>
      <div class="comments" id="issues_524">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 21
     </h1>
    </div>
    <div class="row spy-padding" id="block_525">
     <div class="col-11">
      <h3>
       7.1 Principal Component Analysis
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise, we shall be using a multi-dimensional descriptor and
perform a dimensionality reduction in order to be able to visualize
the descriptor-space.
        </p>
        <p>
         a) Implement the Principal Component Analysis (PCA) method by
completing this class:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class PCA():

    def __init__(self, n_components):
        YOUR CODE
    
    def fit(self, X):
        YOUR CODE
    
    def transform(self, X):
        YOUR CODE
    
</pre>
        <p>
         b) Test it with this data:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
np.array([[2.5, 2.4],
          [2.0, 1.0],
          [2.2, 2.9],
          [1.4, 2.2],
          [1.1, 0.9]])  
</pre>
        <p>
         You should get this figure:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_21_fig1.png">
              <img class="img-fluid" src="images/35.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Notice how the data is rotated so that the direction with the largest
spread aligns with the
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -axis. That is indeed the effect of
performing principal component analysis on a 2D object: It is simply
rotated. This can be used to rotate clusters.
        </p>
        <p>
         c) Try doing such a rotation for one of
the 10-atomic Lennard-Jones clusters:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_21_fig2.png">
              <img class="img-fluid" src="images/35.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         I.e. you use the cartesian coordinates of the atomic cluster to define
your principal directions, and you then make the transformation on the
same coordinates.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_525">
      </div>
      <div class="comments" id="issues_525">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_526">
     <div class="col-11">
      <h3>
       7.2 Relaxed atomic clusters
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Consider again the 38 relaxed 10-atomic Lennard-Jones clusters from the previous
exercises. Use the the Coulomb Matrix Spectrum descriptor
(implemented as
         <code class="prettyprint python">
          CoulombMatrixSpectrum()
         </code>
         ) as their
descriptor method. Plot the descriptor for some of them:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_21_fig3.png">
              <img class="img-fluid" src="images/35.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         e) Use your PCA implementation to plot the two-first PCA dimensions
for these 38 atomic clusters using their descriptors (i.e. their
cartesian coordinates as in question c). You should get
this figure (left-hand image):
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_21_fig4.png">
              <img class="img-fluid" src="images/35.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         f) Compare your PCA plot with what you would get if your were using the
         <code class="prettyprint python">
          sklearn
         </code>
         method for performing PCA (right-hand
image above).
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_526">
      </div>
      <div class="comments" id="issues_526">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_527">
     <div class="col-11">
      <h3>
       7.3 Rattled atomic clusters
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         g) Take one or several of the 38 relaxed 10-atomic Lennard-Jones
clusters. Add random noise to their coordinates. Use a small
amplitude, so they still "look like themselves", but have their
descriptors changed. Here are one relaxed structure and 3 rattled
copies of it:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_21_fig5.png">
              <img class="img-fluid" src="images/35.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Notice how the small noise on the atoms is barely visible in the
descriptor.
        </p>
        <p>
         e) Insert the rattled clusters in the PCA plot. Repeat for several
atomic clusters:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_21_fig6.png">
              <img class="img-fluid" src="images/35.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Notice how the descriptors for the original relaxed atomic cluster and
the rattled versions of it end up in the same neighborhood in
descriptor space. Inverting this statement, one may derive the
following conjecture: By grouping structures that are close in
descriptor space, one may compose groups of equal-looking atomic
clusters. This will be explored in the next exercise.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_527">
      </div>
      <div class="comments" id="issues_527">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 22
     </h1>
    </div>
    <div class="row spy-padding" id="block_528">
     <div class="col-11">
      <h3>
       8.1 KMeans in 2D
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Implement the KMeans clustering method by completing this class:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class KMeans:
    def __init__(self, n_clusters, max_iter=100, tol=1e-4):
        YOUR CODE

    def fit(self, X):    
        YOUR CODE

    def predict(self, X):        
        YOUR CODE
</pre>
        <p>
         and test it by running this code:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
X = np.random.rand(1000, 2)  # 1000 data points, 2 features
kmeans = KMeans(n_clusters=8)
kmeans.fit(X)
labels = kmeans.predict(X)
ax.scatter(X[:,0],X[:,1],c=[f'C{l}' for l in labels])
ax.set_aspect('equal')
</pre>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_22_fig1.png">
              <img class="img-fluid" src="images/36.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_528">
      </div>
      <div class="comments" id="issues_528">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_529">
     <div class="col-11">
      <h3>
       8.2 DBSCAN in 2D
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Use the scikit learn implementation of the DBSCAN method to do a
DBSCAN clustering of the same type of data.
        </p>
        <p>
         c) Familiarize yourself with the consequences from choosing varying
parameters for the DBSCAN method.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_529">
      </div>
      <div class="comments" id="issues_529">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 23
     </h1>
    </div>
    <div class="row spy-padding" id="block_543">
     <div class="col-11">
      <h3>
       9.1 Coulomb Matrix Spectrum + PCA
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Take a sample of relaxed atomic clusters. Rattle each of them a
number of times. Use the Coulomb Matrix Spectrum descriptor and plot
the two first PCA dimensions.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_23_fig1.png">
              <img class="img-fluid" src="images/37.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_543">
      </div>
      <div class="comments" id="issues_543">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_544">
     <div class="col-11">
      <h3>
       9.2 K-means clustering
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Perform a clustering using the full Coulomb Matrix
Spectrum-descriptor. Now, color the structures in 2D-PCA-space
according the K-means cluster they belong to.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_23_fig2.png">
              <img class="img-fluid" src="images/37.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_544">
      </div>
      <div class="comments" id="issues_544">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_545">
     <div class="col-11">
      <h3>
       9.3 Plot structures
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Sample some structures from each K-means cluster. Plot them, while
using the same color as for the clusters in question b).
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/5/img/exercise_23_fig3.png">
              <img class="img-fluid" src="images/37.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_545">
      </div>
      <div class="comments" id="issues_545">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Week 5
     </h1>
    </div>
    <div class="row spy-padding" id="block_581">
     <div class="col-11">
      <h3>
       1.1 Introduction
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This week is about:
         <ul>
          <p>
          </p>
          <li>
           <p>
            Constant energy molecular dynamics simulations. For this you need to
  implement the velocity-Verlet algorithm for integrating the
  equations of motion.
           </p>
          </li>
          <li>
           <p>
            Constant temperature molecular dynamics simulations. Here a
  thermostat is required.
           </p>
          </li>
          <li>
           <p>
            Simulated annealing. Now, a temperature profile is needed.
           </p>
          </li>
         </ul>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_581">
      </div>
      <div class="comments" id="issues_581">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_582">
     <div class="col-11">
      <h3>
       1.2 First TØ
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Work on exercisese 24-28.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_582">
      </div>
      <div class="comments" id="issues_582">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_583">
     <div class="col-11">
      <h3>
       1.3 Second TØ
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Continue working on the exercises.
        </p>
        <p>
         Update your portfolio with what you have learnt about the three topics
listed above.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_583">
      </div>
      <div class="comments" id="issues_583">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      External resources
     </h1>
    </div>
    <div class="row spy-padding" id="block_561">
     <div class="col-11">
      <h3>
       2.1 Molecular dynamics
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read about it in this
         <a href="https://doi-org.ez.statsbiblioteket.dk/10.1119/10.0000654" target="_blank">
          article
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_561">
      </div>
      <div class="comments" id="issues_561">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Molecular dynamics
     </h1>
    </div>
    <div class="row spy-padding" id="block_568">
     <div class="col-11">
      <h3>
       3.1 Euler integration
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In the Euler method, we update the position and velocity using:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         x(t + \Delta t) = x(t) + v(t) \Delta t
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         v(t + \Delta t) = v(t) + a(t) \Delta t
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          a(t)
         </script>
         is the acceleration, given by
         <span class="matematik">
         </span>
         <script type="math/tex">
          a(t) = \displaystyle\frac{d^2}{dt^2}x(t) = \displaystyle\frac{1}{m}F_{res}(x(t))
         </script>
         .
        </p>
        <b>
         Taylor Expansion for Position
        </b>
        <p>
         Let's start by writing the Taylor series expansion of
         <span class="matematik">
         </span>
         <script type="math/tex">
          x(t + \Delta t)
         </script>
         around
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         x(t + \Delta t) = x(t) + v(t) \Delta t + \frac{1}{2} a(t) \Delta t^2 + \mathcal{O}(\Delta t^3)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Now compare this to the Euler method update for position:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         x_{\text{Euler}}(t + \Delta t) = x(t) + v(t) \Delta t
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         The Euler method
         <b>
          neglects
         </b>
         the higher-order terms starting from
         <span class="matematik">
         </span>
         <script type="math/tex">
          \frac{1}{2} a(t) \Delta t^2
         </script>
         , so the error in the Euler position update is:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \text{Error}_{\text{Euler}} = \frac{1}{2} a(t) \Delta t^2 + \mathcal{O}(\Delta t^3)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         And the Euler method can only be considered accurate to first order in
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta t
         </script>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_568">
      </div>
      <div class="comments" id="issues_568">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_569">
     <div class="col-11">
      <h3>
       3.2 Velocity-Verlet
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The velocity-Verlet method updates the position and velocity as follows:
        </p>
        <ol>
         <p>
         </p>
         <li>
          <p>
           Position update:
           <div class="matematik">
           </div>
           <script type="math/tex; mode=display">
            x(t + \Delta t) = x(t) + v(t) \Delta t + \frac{1}{2} a(t) \Delta t^2
           </script>
          </p>
         </li>
         <li>
          <p>
           Velocity update:
           <div class="matematik">
           </div>
           <script type="math/tex; mode=display">
            v(t + \Delta t) = v(t) + \frac{1}{2} \left( a(t) + a(t + \Delta t) \right) \Delta t
           </script>
          </p>
         </li>
        </ol>
        <b>
         Taylor Expansion for Position
        </b>
        <p>
         Using the same Taylor expansion for position around
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         x(t + \Delta t) = x(t) + v(t) \Delta t + \frac{1}{2} a(t) \Delta t^2 + \mathcal{O}(\Delta t^3)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         This is exactly the update that velocity-Verlet uses for position, so the
         <b>
          local error
         </b>
         in position is
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathcal{O}(\Delta t^3)
         </script>
         . This shows that the position update is accurate to second order.
        </p>
        <b>
         Taylor Expansion for Velocity
        </b>
        <p>
         Now let's look at the velocity. First, expand
         <span class="matematik">
         </span>
         <script type="math/tex">
          v(t + \Delta t)
         </script>
         around
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         v(t + \Delta t) = v(t) + a(t) \Delta t + \frac{1}{2} \frac{da}{dt} \Delta t^2 + \mathcal{O}(\Delta t^3)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         In the velocity-Verlet method, we use the average of the acceleration at
         <span class="matematik">
         </span>
         <script type="math/tex">
          t
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          t + \Delta t
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         v_{\text{Verlet}}(t + \Delta t) = v(t) + \frac{1}{2} \left( a(t) + a(t + \Delta t) \right) \Delta t
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Now expand
         <span class="matematik">
         </span>
         <script type="math/tex">
          a(t + \Delta t)
         </script>
         using a Taylor expansion:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         a(t + \Delta t) = a(t) + \frac{da}{dt} \Delta t + \mathcal{O}(\Delta t^2)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Substitute this into the velocity update:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
v_{\text{Verlet}}(t + \Delta t)&=& v(t) + \displaystyle\frac{1}{2} \left( a(t) +
  a(t) + \displaystyle\frac{da}{dt} \Delta t  + \mathcal{O}(\Delta t^2) \right)
\Delta t\\
&&\\
& =& v(t) + a(t) \Delta t + \displaystyle\frac{1}{2} \displaystyle\frac{da}{dt} \Delta t^2 +
     \mathcal{O}(\Delta t^3)
     \end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         This matches the full Taylor expansion of
         <span class="matematik">
         </span>
         <script type="math/tex">
          v(t + \Delta t)
         </script>
         , and the
error is
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathcal{O}(\Delta t^3)
         </script>
         , confirming that the
velocity-Verlet method is accurate to
         <b>
          second order
         </b>
         in
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta
t
         </script>
         .
        </p>
        <b>
         Recap
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            <b>
             Euler method
            </b>
            : The position update neglects the
            <span class="matematik">
            </span>
            <script type="math/tex">
             \frac{1}{2}
a(t) \Delta t^2
            </script>
            term, so its error is
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathcal{O}(\Delta t^2)
            </script>
            ,
making the method
            <b>
             first-order accurate
            </b>
            .
           </p>
          </li>
          <li>
           <p>
            <b>
             Velocity-Verlet method
            </b>
            : Both the position and velocity
updates match their respective Taylor expansions up to
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathcal{O}(\Delta t^3)
            </script>
            , so the method is
            <b>
             second-order
accurate
            </b>
            .
           </p>
          </li>
         </ul>
        </p>
        <p>
         Thus, the velocity-Verlet method is more accurate than the Euler
method for the same time step
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta t
         </script>
         , and the higher accuracy
comes from capturing the second-order effects in both position and
velocity updates.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_569">
      </div>
      <div class="comments" id="issues_569">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_570">
     <div class="col-11">
      <h3>
       3.3 Thermostat
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The method of molecular dynamics is nicely introduced in the paper by
Katharina Vollmayr-Lee, and there is only little to add. One thing,
however is important: The choice of thermostat.
        </p>
        <p>
         In the paper, the Andrea-Anderson thermostat is introduced. It has the
following steps:
         <ol>
          <p>
          </p>
          <li>
           <p>
            For all atoms
            <span class="matematik">
            </span>
            <script type="math/tex">
             i
            </script>
            and spatial directions,
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mu\in\left\{x, y,
    z\right\}
            </script>
            draw
            <span class="matematik">
            </span>
            <script type="math/tex">
             v_{i,\mu}
            </script>
            from a Normal distribution with standard
  deviation
            <span class="matematik">
            </span>
            <script type="math/tex">
             \sigma_i=1
            </script>
            .
           </p>
          </li>
          <li>
           <p>
            Rescale the velocities:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             v_{i,\mu}\rightarrow\frac{1}{\sqrt{m_i}}v_{i,\mu}
            </script>
           </p>
          </li>
          <li>
           <p>
            Ensure that the center of mass remains unchanged:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             v_{i,\mu}\rightarrow v_{i,\mu}-\frac{1}{m_i}\frac{\sum_i m_i v_{i,\mu}}{N}
            </script>
           </p>
          </li>
          <li>
           <p>
            Rescale the velocities to set the temperature:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             v_{i,\mu}\rightarrow \bigl(\frac{3Nk_BT}{\sum_i m_i v_{i,\mu}^2}\bigr)
    v_{i,\mu}
            </script>
           </p>
          </li>
         </ol>
         The procedure is most adequate for simulations with very many atoms,
but in this course, where we deal with only few degrees of freedom, a
modification is required.
        </p>
        <p>
         First of all, the rescaling factor in step 4 can be rewritten:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \bigl(\frac{3Nk_BT}{\sum_i m_i v_{i,\mu}^2}\bigr)=
\bigl(\frac{3N\frac{1}{2}k_BT}{\sum_i \frac{1}{2}m_i v_{i,\mu}^2}\bigr)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         so that it becomes clear that its numerator represents the energy in
         <span class="matematik">
         </span>
         <script type="math/tex">
          3N
         </script>
         degrees of freedom at thermal equilibrium, while the denominator
represents the kinetic energy of the particles before the rescaling.
        </p>
        <p>
         Thus, it appears that the Andrea-Andersen thermostat can be used for,
say,
         <span class="matematik">
         </span>
         <script type="math/tex">
          Q
         </script>
         particles in two-dimensions by simply substituting
         <span class="matematik">
         </span>
         <script type="math/tex">
          2Q
         </script>
         for
         <span class="matematik">
         </span>
         <script type="math/tex">
          3N
         </script>
         or for
         <span class="matematik">
         </span>
         <script type="math/tex">
          P
         </script>
         particles in one-dimension by substituting
         <span class="matematik">
         </span>
         <script type="math/tex">
          P
         </script>
         for
         <span class="matematik">
         </span>
         <script type="math/tex">
          3N
         </script>
         . However, this approach is problematic for small
         <span class="matematik">
         </span>
         <script type="math/tex">
          N
         </script>
         when step 1
has given velocities close to zero, whereby the formula ends up
involving dividing a small number
         <span class="matematik">
         </span>
         <script type="math/tex">
          v_{i,\mu}
         </script>
         with the square of a
small number,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \sum_i \frac{1}{2}m_i v_{i,\mu}^2
         </script>
         causing the rescaled
velocities to become very large. For many particles and dimensions this
is a rare event and the thermostat works well.
        </p>
        <p>
         The solution for small
         <span class="matematik">
         </span>
         <script type="math/tex">
          N
         </script>
         in few dimensions is to simply draw the
velocities from a normal distribution with the correct standard
deviation and to ignore the drift of the center of mass:
         <ol>
          <p>
          </p>
          <li>
           <p>
            Draw
            <span class="matematik">
            </span>
            <script type="math/tex">
             v_{i,\mu}
            </script>
            from a Normal distribution with standard
  deviation:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \sigma_i=\sqrt{\displaystyle\frac{k_BT}{m_i}}
            </script>
           </p>
          </li>
         </ol>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_570">
      </div>
      <div class="comments" id="issues_570">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_571">
     <div class="col-11">
      <h3>
       3.4 Simulated annealing
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In molecular dynamics (MD) simulations, simulated annealing is a
technique used to find low-energy conformations of molecular systems
by mimicking the physical process of annealing in materials
science. The basic idea is to heat the system to a high temperature,
allowing it to overcome energy barriers and explore a wide range of
configurations, and then gradually cool it down to "freeze" the system
into a low-energy state.
        </p>
        <p>
         The procedure involves the following steps:
         <ol>
          <p>
          </p>
          <li>
           <p>
            <b>
             Initialization:
            </b>
            The system is initialized at a high
  temperature, typically much higher than the expected final
  temperature, and the atoms or molecules are given random velocities
  according to a Maxwell-Boltzmann distribution.
           </p>
          </li>
          <li>
           <p>
            <b>
             High-temperature dynamics:
            </b>
            The system is allowed to
  evolve at the high temperature using standard molecular dynamics
  integration methods (e.g., velocity-Verlet). At this stage, the
  system can overcome potential energy barriers and explore different
  regions of the potential energy surface.
           </p>
          </li>
          <li>
           <p>
            <b>
             Cooling schedule:
            </b>
            The temperature of the system is
  gradually reduced according to a predefined cooling schedule, such
  as exponential or linear decay. This allows the system to settle
  into lower-energy states as it cools.
           </p>
          </li>
          <li>
           <p>
            <b>
             Low-temperature dynamics:
            </b>
            As the system cools, it
  explores finer details of the energy landscape, potentially settling
  into a global or near-global minimum of the potential energy.
           </p>
          </li>
          <li>
           <p>
            <b>
             Final state:
            </b>
            Once the system has reached a sufficiently
  low temperature, the simulation is stopped, and the final
  configuration is analyzed. The resulting structure should represent
  a stable, low-energy configuration.
           </p>
          </li>
         </ol>
        </p>
        <p>
         Simulated annealing in MD can be applied to a wide range of problems,
including protein folding, ligand binding, and the optimization of
material structures. The success of the method depends on the choice
of the cooling schedule and the initial temperature, as well as the
ability of the system to explore a broad region of the energy
landscape at higher temperatures.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_571">
      </div>
      <div class="comments" id="issues_571">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 24
     </h1>
    </div>
    <div class="row spy-padding" id="block_549">
     <div class="col-11">
      <h3>
       4.1 1D Harmonic oscillator
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise we consider the 1-dimensional harmonic
oscillator. The aim is to demonstrate that a molecular dynamics
approach with a thermostat results in the same thermal ensemble of
position observations as did the Metropolis Monte Carlo approach.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_549">
      </div>
      <div class="comments" id="issues_549">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_550">
     <div class="col-11">
      <h3>
       4.2 Metropolis Monte Carlo sampling
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Repeat your Metropolis Monte Carlo sampling of the position of the
harmonic oscillator, (
         <span class="matematik">
         </span>
         <script type="math/tex">
          m=1
         </script>
         ,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \omega=1
         </script>
         ), at some different
temperatures. Establish the thermal average of the potential energy at
         <span class="matematik">
         </span>
         <script type="math/tex">
          k_BT=0.15
         </script>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/6/img/exercise_24_fig1.png">
              <img class="img-fluid" src="images/41.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_550">
      </div>
      <div class="comments" id="issues_550">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_551">
     <div class="col-11">
      <h3>
       4.3 Constant energy MD
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Implement the velocity Verlet algorithm. Run it with
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta t=0.01
         </script>
         and plot the position as a function of time. Also, make observations
at regular time intervals and plot the distribution of positions observed.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/6/img/exercise_24_fig2.png">
              <img class="img-fluid" src="images/41.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_551">
      </div>
      <div class="comments" id="issues_551">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_552">
     <div class="col-11">
      <h3>
       4.4 Constant temperature MD
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Implement an NVT thermostat, i.e. draw a random velocity from
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathcal{N}(0, \sigma^2),
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \sigma = \sqrt{\displaystyle\frac{k_BT}{m}}.
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Run the MD simulation for 50 timestep after each velocity adjustment,
and sample the position at the end of these timesteps.
        </p>
        <p>
         Evaluate the thermal average,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \langle V_{pot}\rangle
         </script>
         , of the
potential energy and estimate the heat capacity (in units of
         <span class="matematik">
         </span>
         <script type="math/tex">
          k_B
         </script>
         ),
         <span class="matematik">
         </span>
         <script type="math/tex">
          C_v/k_B
         </script>
         , via the observed fluctuations in the potential energy.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/6/img/exercise_24_fig3.png">
              <img class="img-fluid" src="images/41.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_552">
      </div>
      <div class="comments" id="issues_552">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 25
     </h1>
    </div>
    <div class="row spy-padding" id="block_553">
     <div class="col-11">
      <h3>
       5.1 1D Double well
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise, a one-dimensional potential with two energy minima
is considered with molecular dynamics. The exercise will demonstrate
that thermal samples can be establish, only trapping in the local
minimum at low temperatures may constitute a problem
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_553">
      </div>
      <div class="comments" id="issues_553">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_554">
     <div class="col-11">
      <h3>
       5.2 The potential
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The potential takes this form:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         E_{pot}(x) = \frac{1}{2}k\left(x-x_0\right)^2 + A\exp\left(-\displaystyle\frac{(x-x_1)^2}{\lambda^2}\right)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         a) Plot the potential
        </p>
        <p>
         b) Evaluate analytically the force and implement it. Plot ontop of the
potential energy plot, the integrated (negative) force:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         E_{pot}(x_0) -\displaystyle\int_{x_0}^x f(x')dx'
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/6/img/exercise_25_fig1.png">
              <img class="img-fluid" src="images/42.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_554">
      </div>
      <div class="comments" id="issues_554">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_555">
     <div class="col-11">
      <h3>
       5.3 Metropolis Monte Carlo
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Perform direct integration and Metropolis Monte Carlo estimation of
the thermally averaged potential energy of this oscillator. Also, plot
the distribution probability function. Repeat for some different temperatures.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/6/img/exercise_25_fig2.png">
              <img class="img-fluid" src="images/42.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_555">
      </div>
      <div class="comments" id="issues_555">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_556">
     <div class="col-11">
      <h3>
       5.4 Molecular dynamics
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Do the sampling with Molecular Dynamics. Start the oscillator at
         <span class="matematik">
         </span>
         <script type="math/tex">
          x=x_0
         </script>
         . Perform runs of
50 velocity Verlet steps with
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta t=0.01
         </script>
         after each
thermalization step. Let the sample be composed of the
end-points of 10000 such 50-step runs.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/6/img/exercise_25_fig3.png">
              <img class="img-fluid" src="images/42.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         d) Repeat c), but let the oscillator start at
         <span class="matematik">
         </span>
         <script type="math/tex">
          x=x_1
         </script>
         . Observed that
at low temperatures, the oscillator may be trapped in the local
minimum energy state.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/6/img/exercise_25_fig4.png">
              <img class="img-fluid" src="images/42.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_556">
      </div>
      <div class="comments" id="issues_556">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 26
     </h1>
    </div>
    <div class="row spy-padding" id="block_557">
     <div class="col-11">
      <h3>
       6.1 Constant Energy MD in 4D
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise, we shall perform molecular dynamics for
Lennard-Jones atoms. You would probably like to extend the previous
class for describing atomic clusters with attributes and methods to
cover the velocities and the kinetic energy. Something like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    def __init__( ... , ... , ... ):
        ...
        self.velocities = np.zeros(self.pos.shape)
    
    @property
    def kinetic_energy(self):
        return 0.5 * np.sum(self.velocities**2)
    
    def set_velocities(self,velocities):
        self.velocities = np.where(self.filter,0,velocities)

    def get_velocities(self):
        return self.velocities.copy()
</pre>
        <p>
         where
         <code class="prettyprint python">
          self.filter
         </code>
         is
         <code class="prettyprint python">
          True
         </code>
         for the coordinates of static atoms.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_557">
      </div>
      <div class="comments" id="issues_557">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_558">
     <div class="col-11">
      <h3>
       6.2 Relaxation
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Decide on a structure with some static atoms and two dynamic
atoms. Set it up and perform a relaxation of the two dynamic atoms so
that you get to know their equilibrium positions.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/6/img/exercise_26_fig1.png">
              <img class="img-fluid" src="images/43.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_558">
      </div>
      <div class="comments" id="issues_558">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_559">
     <div class="col-11">
      <h3>
       6.3 Molecular dynamics
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Displace the atoms slightly from their equilibrium positions. Perform
a constant energy molecular dynamics simulation, i.e.:
         <ul>
          <p>
          </p>
          <li>
           <p>
            propagate the atoms according to the velovity Verlet algorithm. Use
            <span class="matematik">
            </span>
            <script type="math/tex">
             \Delta t=0.01
            </script>
            .
           </p>
          </li>
         </ul>
         Note that in a constant energy molecular dynamics simulation, no
thermostat is used.
        </p>
        <p>
         Observe that the atoms vibrate around
their equilibrium positions. Check that the total energy is conserved.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/6/img/exercise_26_fig2.png">
              <img class="img-fluid" src="images/43.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_559">
      </div>
      <div class="comments" id="issues_559">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_560">
     <div class="col-11">
      <h3>
       6.4 Animation
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Make an animation of the molecular dynamics simulation.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/6/img/exercise_26_fig3.gif">
              <img class="img-fluid" src="images/43.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_560">
      </div>
      <div class="comments" id="issues_560">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 27
     </h1>
    </div>
    <div class="row spy-padding" id="block_563">
     <div class="col-11">
      <h3>
       7.1 Constant Temperature MD in 6D
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Perform molecular dynamics simulations for a 3-atomic Lennard-Jones
cluster in two dimensions.
        </p>
        <p>
         Hint:
         <ul>
          <p>
          </p>
          <li>
           <p>
            start in the equilibrium state
           </p>
          </li>
          <li>
           <p>
            perform 50 velocity Verlet timesteps with
            <span class="matematik">
            </span>
            <script type="math/tex">
             \Delta t=0.01
            </script>
            .
           </p>
          </li>
          <li>
           <p>
            apply the thermostat (use the few-atom one that simply draws velocity
  components from a Normal distribution)
           </p>
          </li>
          <li>
           <p>
            store the total energy for later inspection
           </p>
          </li>
          <li>
           <p>
            repeat 1000 times
           </p>
          </li>
         </ul>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/6/img/exercise_27_fig1.gif">
              <img class="img-fluid" src="images/44.png" style="max-width: 100.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_563">
      </div>
      <div class="comments" id="issues_563">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_564">
     <div class="col-11">
      <h3>
       7.2 Inspect energy versus temperature
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The total energies collected during the simulation shows convergence
toward some different values depending on the temperatures. If the
simulation has run long enough, the thermal average of the total
energy can be obtained as a mean value over the last observations.
        </p>
        <p>
         b) Plot the thermally averaged total energy as a function of
temperature.
        </p>
        <p>
         c) Find
         <span class="matematik">
         </span>
         <script type="math/tex">
          C_v
         </script>
         at temperature
         <span class="matematik">
         </span>
         <script type="math/tex">
          T_{i,i+1}=\frac{1}{2}(T_i + T_{i+1})
         </script>
         via:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         C_v(T_{i,i+1})=\displaystyle\frac{\langle E\rangle_{T_{i+1}}-\langle E\rangle_{T_i}}{T_{i+1}-T_i}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Observe that before evaporation, you have a behavior of
         <span class="matematik">
         </span>
         <script type="math/tex">
          C_v
         </script>
         corresponding to having 12 degrees of freedom with
squared terms in the energy, while after the evaporation, you have 6
degrees of freedom.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/6/img/exercise_27_fig2.png">
              <img class="img-fluid" src="images/44.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_564">
      </div>
      <div class="comments" id="issues_564">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 28
     </h1>
    </div>
    <div class="row spy-padding" id="block_575">
     <div class="col-11">
      <h3>
       8.1 Constant Temperature MD in many-D
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise, you will perform constant temperature MD in
many dimensions. The purpose of the exercise is to show the importance of the
starting configuration. If you start very far from the global minimum
energy structure, you might miss that region in configuration
space and rather get a thermal equilibrium around a meta-stable state.
        </p>
        <p>
         This is very akin to daily life, where matter is not
always found in the ground state. Graphite is more stable than diamond
at ambient pressures, yet, if diamond was formed (under high pressure)
it may remain in its meta-stable state, and it may be of relevance to
model its properties (e.g. heat capacity and vibrational modes).
        </p>
        <p>
         Simialarly, snowflakes (of a given size) come in many
shapes, reflecting the kinetic details of how they were formed. Yet,
only one snowflake can be considered the most stable, and most likely,
it is a dull one where the constituing water molecules have rolled up
in a sphere.
        </p>
        <p>
         If you perform a molecular dynamics simulation
starting in a meta-stable state, it may take while before the expected
transitions happen, and rather the simulation may equilibrate around the
meta-stable state.
        </p>
        <p>
         The exercise ends with applying simulated annealing, which aims at
finding the global minimum energy structure.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_575">
      </div>
      <div class="comments" id="issues_575">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_576">
     <div class="col-11">
      <h3>
       8.2 Initial states
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Setup a system of a large number of particles contained in 2D
inside a corral of static atoms. Feel free to choose your own shape
for the corral (circular, elliptic, quadratic, rectangular,
rhombic?). Follow two strategies, where the
atoms are either placed ordered along the corral or at random in the
middle of the corral. Relax the two structures to obtain two types of
starting configurations for the next exercises.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/6/img/exercise_28_fig1.png">
              <img class="img-fluid" src="images/45.png" style="max-width: 50.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_576">
      </div>
      <div class="comments" id="issues_576">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_577">
     <div class="col-11">
      <h3>
       8.3 Heating up
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Perform the MD at increasing temperatures for the two types of
starting configurations:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/6/img/exercise_28_fig2.gif">
              <img class="img-fluid" src="images/45.png" style="max-width: 100.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/6/img/exercise_28_fig3.gif">
              <img class="img-fluid" src="images/45.png" style="max-width: 100.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_577">
      </div>
      <div class="comments" id="issues_577">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_578">
     <div class="col-11">
      <h3>
       8.4 Simulated annealing
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Perform the simulated annealing and determine the global minimum
energy structure.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_578">
      </div>
      <div class="comments" id="issues_578">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Regression
     </h1>
    </div>
    <div class="row spy-padding" id="block_609">
     <div class="col-11">
      <h3>
       3.1 Ordinary Least Squares (OLS)
      </h3>
      <div class="text-justify">
       <b>
        Minimization of Sum of Squared Residuals
       </b>
       <div class="i2latextext mb-2">
        <p>
         Given
         <span class="matematik">
         </span>
         <script type="math/tex">
          N
         </script>
         data points and
         <span class="matematik">
         </span>
         <script type="math/tex">
          p
         </script>
         predictors, the linear regression model can be written in matrix form as:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathbf{y} = X \boldsymbol{\beta}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where:
         <ul>
          <p>
          </p>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathbf{y} \in \mathbb{R}^N
            </script>
            is the vector of observed dependent variables (responses):
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathbf{y} = [y_1, y_2, \dots, y_N]^T
            </script>
            ,
           </p>
          </li>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             X \in \mathbb{R}^{N \times (p+1)}
            </script>
            is the design matrix of independent variables (the first column is filled with ones for the intercept),
           </p>
          </li>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             \boldsymbol{\beta} \in \mathbb{R}^{p+1}
            </script>
            is the vector of regression coefficients:
            <span class="matematik">
            </span>
            <script type="math/tex">
             \boldsymbol{\beta} = [\beta_0, \beta_1, \dots, \beta_p]^T
            </script>
            .
           </p>
          </li>
         </ul>
        </p>
        <p>
         The goal is to minimize the sum of squared residuals:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \min_{\boldsymbol{\beta}} \|\mathbf{y} - X \boldsymbol{\beta}\|^{2}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         This objective function is the squared Euclidean norm of the residuals, and can be expanded as:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
\|\mathbf{y} - X \boldsymbol{\beta}\|^{2}&=& (\mathbf{y} - X
                                             \boldsymbol{\beta})^T
                                             (\mathbf{y} - X
                                             \boldsymbol{\beta})\\
                                         &&\\
&=& \mathbf{y}^T \mathbf{y} - 2 \mathbf{y}^T X \boldsymbol{\beta} +
    \boldsymbol{\beta}^T X^T X \boldsymbol{\beta}
\end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Next, take the derivative of the objective function with respect to
         <span class="matematik">
         </span>
         <script type="math/tex">
          \beta_i
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \frac{\partial}{\partial \beta_i}
\|\mathbf{y} - X \boldsymbol{\beta}\|^{2}
  = -2 \left[X^T \mathbf{y}\right]_i + 2 \left[X^T X \boldsymbol{\beta}\right]_i
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         For
         <span class="matematik">
         </span>
         <script type="math/tex">
          \boldsymbol{\beta}
         </script>
         to be optimal, this must be equal to zero:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         0 = -2 \left[X^T \mathbf{y}\right]_i + 2 \left[X^T X
    \boldsymbol{\beta}\right]_i
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Meaning that:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \left[X^T X    \boldsymbol{\beta}\right]_i =  \left[X^T \mathbf{y}\right]_i
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Since this applies for every entry in
         <span class="matematik">
         </span>
         <script type="math/tex">
          \boldsymbol{\beta}
         </script>
         , i.e. for every value of
         <span class="matematik">
         </span>
         <script type="math/tex">
          i
         </script>
         , one gets:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         X^T X    \boldsymbol{\beta} =  X^T \mathbf{y}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Thus, the OLS solution is given by:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \boldsymbol{\beta} = (X^T X)^{-1} X^T \mathbf{y}
        </script>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_609">
      </div>
      <div class="comments" id="issues_609">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_610">
     <div class="col-11">
      <h3>
       3.2 Maximization of Log-Likelihood
      </h3>
      <div class="text-justify">
       <b>
        Gaussian Error Model
       </b>
       <div class="i2latextext mb-2">
        <p>
         It is instructive to assume that the observed dependent variables contain errors,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \boldsymbol{\epsilon}
         </script>
         , that are normally distributed:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \boldsymbol{\epsilon} \sim \mathcal{N}(0, \sigma^2 I)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          \sigma^2
         </script>
         is the variance of the error terms and
         <span class="matematik">
         </span>
         <script type="math/tex">
          I
         </script>
         is the
identity matrix.
        </p>
        <p>
         The likelihood of observing the data
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{y}
         </script>
         given the parameters
         <span class="matematik">
         </span>
         <script type="math/tex">
          \boldsymbol{\beta}
         </script>
         is:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         p(\mathbf{y} | X, \boldsymbol{\beta}) = \prod_{i=1}^{N} \frac{1}{\sqrt{2 \pi \sigma^2}} \exp \left( -\frac{(y_i - X_i^T \boldsymbol{\beta})^2}{2 \sigma^2} \right)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Taking the logarithm of the likelihood function:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \log \mathcal{L}(\boldsymbol{\beta}) = \sum_{i=1}^{N} \log \left( \frac{1}{\sqrt{2 \pi \sigma^2}} \exp \left( -\frac{(y_i - X_i^T \boldsymbol{\beta})^2}{2 \sigma^2} \right) \right)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Simplifying the log-likelihood:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \log \mathcal{L}(\boldsymbol{\beta}) = -\frac{N}{2} \log(2 \pi \sigma^2) - \frac{1}{2 \sigma^2} \sum_{i=1}^{N} (y_i - X_i^T \boldsymbol{\beta})^2
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Maximizing the log-likelihood is equivalent to minimizing the sum of squared residuals:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \min_{\boldsymbol{\beta}} \sum_{i=1}^{N} (y_i - X_i^T \boldsymbol{\beta})^2
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         This is exactly the same objective function as in OLS, which leads us back to the normal equation:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \boldsymbol{\beta} = (X^T X)^{-1} X^T \mathbf{y}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Hence, maximizing the log-likelihood of a Gaussian error model leads
to the same solution as minimizing the sum of squared residuals.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_610">
      </div>
      <div class="comments" id="issues_610">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_611">
     <div class="col-11">
      <h3>
       3.3 Linear regression example
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         <b>
          Example
         </b>
        </p>
        <p>
         Consider a simple linear regression with one predictor (i.e.,
         <span class="matematik">
         </span>
         <script type="math/tex">
          p = 1
         </script>
         ). The design matrix
         <span class="matematik">
         </span>
         <script type="math/tex">
          X
         </script>
         might look like this for three data points:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         X = \begin{pmatrix}
1 & x_1 \\
1 & x_2 \\
1 & x_3
\end{pmatrix}, \quad
\mathbf{y} = \begin{pmatrix}
y_1 \\
y_2 \\
y_3
\end{pmatrix}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         The normal equation becomes:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \boldsymbol{\beta} = \begin{pmatrix} \beta_0 \\ \beta_1 \end{pmatrix} = (X^T X)^{-1} X^T \mathbf{y}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Solving this system gives the best-fit intercept
         <span class="matematik">
         </span>
         <script type="math/tex">
          \beta_0
         </script>
         and slope
         <span class="matematik">
         </span>
         <script type="math/tex">
          \beta_1
         </script>
         .
        </p>
        <p>
         This matrix formulation of OLS is efficient for solving linear regression problems and forms the basis of more advanced methods in machine learning and statistical modeling.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_611">
      </div>
      <div class="comments" id="issues_611">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_612">
     <div class="col-11">
      <h3>
       3.4 Ridge Regression
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Ridge Regression, also known as Tikhonov regularization, is a linear
regression technique that includes a penalty term to prevent
overfitting. The goal of Ridge Regression is to find a balance between
fitting the data well and keeping the model coefficients small, which
helps prevent large fluctuations in predictions due to small changes
in the input.
        </p>
        <b>
         Objective Function
        </b>
        <p>
         Given a dataset with features
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{X} \in \mathbb{R}^{n \times p}
         </script>
         and target values
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{y} \in \mathbb{R}^n
         </script>
         , the linear regression model predicts the target values using the formula:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathbf{y} = \mathbf{X} \boldsymbol{\beta}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          \boldsymbol{\beta} \in \mathbb{R}^p
         </script>
         represents the model coefficients. The Ordinary Least Squares (OLS) solution minimizes the sum of squared residuals:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \min_{\boldsymbol{\beta}} \| \mathbf{y} - \mathbf{X} \boldsymbol{\beta} \|^{2}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         However, OLS can lead to overfitting, especially when there is multicollinearity or when the number of features
         <span class="matematik">
         </span>
         <script type="math/tex">
          p
         </script>
         is large. To address this, Ridge Regression modifies the OLS objective function by adding an
         <span class="matematik">
         </span>
         <script type="math/tex">
          L_2
         </script>
         regularization term:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \min_{\boldsymbol{\beta}} \left( \| \mathbf{y} - \mathbf{X} \boldsymbol{\beta} \|^{2} + \lambda \| \boldsymbol{\beta} \|^{2} \right)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Here,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \lambda \geq 0
         </script>
         is a regularization parameter that controls the trade-off between fitting the data (minimizing residuals) and keeping the model coefficients small (shrinking
         <span class="matematik">
         </span>
         <script type="math/tex">
          \boldsymbol{\beta}
         </script>
         ). When
         <span class="matematik">
         </span>
         <script type="math/tex">
          \lambda = 0
         </script>
         , Ridge Regression reduces to OLS. As
         <span class="matematik">
         </span>
         <script type="math/tex">
          \lambda
         </script>
         increases, the model coefficients shrink toward zero, reducing the variance of the model.
        </p>
        <b>
         Closed-Form Solution
        </b>
        <p>
         Ridge Regression has a closed-form solution, which can be derived by taking the gradient of the objective function and setting it to zero:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \boldsymbol{\beta}_{\text{ridge}} = \left( \mathbf{X}^\top \mathbf{X} + \lambda \mathbf{I} \right)^{-1} \mathbf{X}^\top \mathbf{y}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{I}
         </script>
         is the identity matrix of size
         <span class="matematik">
         </span>
         <script type="math/tex">
          p \times p
         </script>
         . This solution is similar to OLS, but with an additional term
         <span class="matematik">
         </span>
         <script type="math/tex">
          \lambda \mathbf{I}
         </script>
         in the matrix inversion, which stabilizes the computation when
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{X}^\top \mathbf{X}
         </script>
         is ill-conditioned or singular.
        </p>
        <b>
         Impact of Regularization
        </b>
        <p>
         The regularization term in Ridge Regression discourages large values of
         <span class="matematik">
         </span>
         <script type="math/tex">
          \boldsymbol{\beta}
         </script>
         , helping to avoid overfitting. The parameter
         <span class="matematik">
         </span>
         <script type="math/tex">
          \lambda
         </script>
         controls the strength of this penalty:
         <ul>
          <p>
          </p>
          <li>
           <p>
            If
            <span class="matematik">
            </span>
            <script type="math/tex">
             \lambda = 0
            </script>
            , Ridge Regression becomes OLS, and the model may
overfit the data.
           </p>
          </li>
          <li>
           <p>
            If
            <span class="matematik">
            </span>
            <script type="math/tex">
             \lambda
            </script>
            is very large, the coefficients
            <span class="matematik">
            </span>
            <script type="math/tex">
             \boldsymbol{\beta}
            </script>
            shrink significantly, leading to underfitting.
           </p>
          </li>
          <li>
           <p>
            Typically,
            <span class="matematik">
            </span>
            <script type="math/tex">
             \lambda
            </script>
            is chosen using cross-validation to find the best trade-off between bias and variance.
           </p>
          </li>
         </ul>
        </p>
        <b>
         Example
        </b>
        <p>
         Consider a simple regression problem with data points
         <span class="matematik">
         </span>
         <script type="math/tex">
          (x_1, y_1), (x_2, y_2), \dots, (x_n, y_n)
         </script>
         and a linear model:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         y = \beta_0 + \beta_1 x
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Ridge Regression minimizes the following cost function:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \min_{\beta_0, \beta_1} \left( \sum_{i=1}^n (y_i - \beta_0 - \beta_1 x_i)^2 + \lambda (\beta_0^2 + \beta_1^2) \right)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         By solving this equation, we obtain the optimal values for
         <span class="matematik">
         </span>
         <script type="math/tex">
          \beta_0
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \beta_1
         </script>
         , while regularization helps to prevent overfitting.
        </p>
        <b>
         Conclusion
        </b>
        <p>
         Ridge Regression introduces an
         <span class="matematik">
         </span>
         <script type="math/tex">
          L_2
         </script>
         penalty on the coefficients to address overfitting in linear models. This regularization technique is especially useful when multicollinearity is present or when the number of features is large compared to the number of observations. Ridge Regression serves as a foundation for more advanced techniques like Kernel Ridge Regression.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_612">
      </div>
      <div class="comments" id="issues_612">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_613">
     <div class="col-11">
      <h3>
       3.5 Non-linear fit with OLS
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In ordinary least squares (OLS) regression, the design matrix can
include non-linear terms to capture non-linear relationships between
the independent variables and the dependent variable, even though the
OLS method itself solves a linear equation in terms of the
parameters. By introducing non-linear transformations of the original
input variables as additional features, we can fit more complex,
non-linear models.
        </p>
        <b>
         Example: Quadratic Fit with Non-Linear Terms in OLS
        </b>
        <p>
         Suppose we have one independent variable
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         , and we suspect that the
relationship between
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         and the dependent variable
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         is
quadratic. To fit a quadratic model, we can construct a design matrix
that includes both linear and quadratic terms, such as:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \Phi(x) = 
\begin{pmatrix}
  1 & \sqrt{2}x_1 & x_1^2 \\
  &&\\
1 & \sqrt{2}x_2 & x_2^2 \\
  &&\\
1 & \sqrt{2}x_3 & x_3^2 \\
  &&\\
\vdots & \vdots & \vdots \\
  &&\\
1 & \sqrt{2}x_n & x_n^2
\end{pmatrix}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         In this case:
         <ul>
          <p>
          </p>
          <li>
           <p>
            The first column corresponds to the intercept term (constant
            <span class="matematik">
            </span>
            <script type="math/tex">
             1
            </script>
            ).
           </p>
          </li>
          <li>
           <p>
            The second column corresponds to the linear term, scaled by a factor
            <span class="matematik">
            </span>
            <script type="math/tex">
             \sqrt{2}
            </script>
            to standardize or balance the contributions of different
features.
           </p>
          </li>
          <li>
           <p>
            The third column corresponds to the quadratic term,
            <span class="matematik">
            </span>
            <script type="math/tex">
             x^2
            </script>
            , capturing
the non-linear relationship.
           </p>
          </li>
         </ul>
        </p>
        <p>
         We can write the model as:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
  y&=&\beta_0 + \beta_1 \cdot \sqrt{2}x + \beta_2 \cdot x^2\\
  &&\\
   &=&

       \begin{bmatrix}
         1&\sqrt{2}x&x^2
\end{bmatrix}
       \begin{bmatrix}
         \beta_0\\
         \beta_1\\
         \beta_2
\end{bmatrix}
       
       \end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          \beta_0
         </script>
         ,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \beta_1
         </script>
         , and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \beta_2
         </script>
         are the parameters to be estimated.
        </p>
        <b>
         Solving the OLS Problem
        </b>
        <p>
         Once the design matrix
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Phi(x)
         </script>
         is constructed, the OLS problem is formulated as minimizing the sum of squared residuals:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \boldsymbol{\beta} = (\Phi^T \Phi)^{-1} \Phi^T y
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          \boldsymbol{\beta}
         </script>
         is the vector of estimated parameters
         <span class="matematik">
         </span>
         <script type="math/tex">
          \beta_0
         </script>
         ,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \beta_1
         </script>
         , and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \beta_2
         </script>
         .
        </p>
        <p>
         This allows us to fit a quadratic model to the data, even though the
OLS method itself remains linear in the parameters. By introducing
higher-order polynomial terms, we can extend this approach to fit any
degree of polynomial, capturing increasingly complex relationships
between
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_613">
      </div>
      <div class="comments" id="issues_613">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_614">
     <div class="col-11">
      <h3>
       3.6 Kernel Ridge Regression
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
        </p>
        <b>
         Non-linearity from data
        </b>
        <p>
         Consider the previous example, where we had a model:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         y_\ast = \begin{bmatrix}
         1 & \sqrt{2}x_\ast & x_\ast^2
       \end{bmatrix}
       \begin{bmatrix}
         \beta_0 \\
         \beta_1 \\
         \beta_2
       \end{bmatrix}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         In that example, we assumed that the dependent variable had a constant, a
linear, and a quadratic dependence on the independent variable. It
would, however, be desirable if we did not have to make such a
specific choice. To see how this can be avoided, it is instructive to
first rewrite the model in the following way:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         y_\ast =
\phi(x_\ast) \cdot \begin{bmatrix} 1 \\ 0 \\ 0 \end{bmatrix}\beta_0
+ \phi(x_\ast) \cdot \begin{bmatrix} 0 \\ 1 \\ 0 \end{bmatrix}\beta_1
+ \phi(x_\ast) \cdot \begin{bmatrix} 0 \\ 0 \\ 1 \end{bmatrix}\beta_2
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          \phi
         </script>
         is a mapping of the independent variable into a
higher-dimensional space:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \phi(x) = \begin{bmatrix} 1 & \sqrt{2}x & x^2 \end{bmatrix}.
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         When written in this way, it becomes apparent that the fit picks up
contributions of strength
         <span class="matematik">
         </span>
         <script type="math/tex">
          \beta_i
         </script>
         in the various basis directions,
e.g.
         <span class="matematik">
         </span>
         <script type="math/tex">
          \begin{bmatrix}1 & 0 & 0\end{bmatrix}^T
         </script>
         , weighted by the
dot-products between the transformed query point,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \phi(x_\ast)
         </script>
         , and those
basis directions.
        </p>
        <p>
         Now, if we abandon the normalized basis directions and
instead use the directions of the transformed data points, a somewhat
similar fit can be written:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         y_\ast =
     \phi(x_\ast) \cdot \phi(x_1)\alpha_1
  + \phi(x_\ast) \cdot \phi(x_2)\alpha_2
  + \phi(x_\ast) \cdot \phi(x_3)\alpha_3
  + \cdots 
  + \phi(x_\ast) \cdot \phi(x_N)\alpha_N
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          N
         </script>
         is the number of data points. So far, we would still have to
specify the mapping,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \phi
         </script>
         , but we will eliminate this when
         <b>
          kernels
         </b>
         are introduced.
        </p>
        <p>
         What has been obtained so far is:
         <ul>
          <p>
          </p>
          <li>
           <p>
            The mapping to the higher-dimensional space,
            <span class="matematik">
            </span>
            <script type="math/tex">
             \phi
            </script>
            , now only
  appears in dot-products.
           </p>
          </li>
          <li>
           <p>
            There are now as many coefficients as data points.
           </p>
          </li>
         </ul>
        </p>
        <b>
         Kernel
        </b>
        <p>
         The dot-products in the transformed high-dimensional space are called
kernel values and are written as:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         K(x_1, x_2) = \phi(x_1) \cdot \phi(x_2).
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         With this, the prediction is written:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         y_\ast = \sum_i K(x_\ast, x_i)\alpha_i
        = K(x_\ast, \mathbf{X}^T)\boldsymbol{\alpha}.
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Making the prediction for all the data points, we have:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         y \simeq \mathbf{K}\boldsymbol{\alpha}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          K_{ij} = K(x_i, x_j)
         </script>
         , and
         <span class="matematik">
         </span>
         <script type="math/tex">
          i,j
         </script>
         run over the indices
of all data points.
        </p>
        <b>
         Finding the coefficients
        </b>
        <p>
         A loss function can now be written:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \|\mathbf{y} - \mathbf{K} \boldsymbol{\alpha}\|^{2}
+ \lambda\boldsymbol{\alpha}^T \mathbf{K} \boldsymbol{\alpha}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where the first term measures the deviation of the model from the
values at the data points, and the second term penalizes large
coefficients in
         <span class="matematik">
         </span>
         <script type="math/tex">
          \boldsymbol{\alpha}
         </script>
         . This second term is not just
         <span class="matematik">
         </span>
         <script type="math/tex">
          \|\boldsymbol{\alpha}\|^{2}
         </script>
         , reflecting that for directions that
are shared by several data points, the coefficients must be suppressed
further.
        </p>
        <p>
         To find the coefficients,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \boldsymbol{\alpha}
         </script>
         , the first term of the
loss function is rewritten:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
  \|\mathbf{y} - \mathbf{K} \boldsymbol{\alpha}\|^{2}
  &=& (\mathbf{y} - \mathbf{K} \boldsymbol{\alpha})^T(\mathbf{y} -
      \mathbf{K} \boldsymbol{\alpha})\\
  &&\\
  &=&\mathbf{y}^T\mathbf{y}
      -\mathbf{y}^T\mathbf{K}\boldsymbol{\alpha}
      -\boldsymbol{\alpha}^T\mathbf{K}^T\mathbf{y}
      +\boldsymbol{\alpha}^T\mathbf{K}^T
      \mathbf{K}\boldsymbol{\alpha}
\end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         The loss function can now be optimized by taking the derivative with
respect to each of the entries in
         <span class="matematik">
         </span>
         <script type="math/tex">
          \alpha_i
         </script>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \frac{d}{d\alpha_i}Loss = 0 -[\mathbf{y}^T\mathbf{K}]_i -
  [\mathbf{K}^T\mathbf{y}]_i
  +[\mathbf{K}^T                                                                         
      \mathbf{K}\boldsymbol{\alpha}]_i + [\boldsymbol{\alpha}^T\mathbf{K}^T                                                                         
      \mathbf{K}]_i + \lambda[\mathbf{K}\boldsymbol{\alpha}]_i +
      \lambda[\boldsymbol{\alpha}^T\mathbf{K}]_i
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         which when set equal to zero provides the solution:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
  0&=&\displaystyle\frac{d}{d\alpha_i}Loss\\
&&\\ %
  [\mathbf{K}^T\mathbf{y}]_i&=&[\mathbf{K}^T
      \mathbf{K}\boldsymbol{\alpha}]_i +
                                \lambda[\mathbf{K}\boldsymbol{\alpha}]_i  \\
&&\\ %
  [\mathbf{K}\mathbf{y}]_i &=&[\mathbf{K}
      (\mathbf{K}+\lambda\mathbf{I})\boldsymbol{\alpha}]_i
\end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where the last line emerges from realizing that
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{K}^T=\mathbf{K}
         </script>
         . Since this result applies for all
         <span class="matematik">
         </span>
         <script type="math/tex">
          i
         </script>
         , we
have:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathbf{K}\mathbf{y} =\mathbf{K}
    (\mathbf{K}+\lambda\mathbf{I})\boldsymbol{\alpha}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         which is fulfilled if either
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{K}=0
         </script>
         (which is not possible
  as its diagonal is always
         <span class="matematik">
         </span>
         <script type="math/tex">
          \ne 0
         </script>
         )  or:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathbf{y} =
    (\mathbf{K}+\lambda\mathbf{I})\boldsymbol{\alpha}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Finally, we have the solutions for the coefficients:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \boldsymbol{\alpha} = (\mathbf{K}+\lambda\mathbf{I})^{-1}\mathbf{y}
        </script>
       </div>
       <b>
        Recap
       </b>
       <div class="i2latextext mb-2">
        <p>
         We now have the elements of the Kernel Ridge Regression method:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div id="kernel_ridge_solution">
         <div class="matematik">
         </div>
         <script type="math/tex; mode=display">
          \begin{array}{rcl}
\boldsymbol{\alpha} &=&
(\mathbf{K}+\lambda\mathbf{I})^{-1}\mathbf{y}\\
                      &&\\
  y_\ast&=&K(x_\ast, \mathbf{X}^T)\boldsymbol{\alpha}
\end{array}
         </script>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Remember that the kernel was introduced as a dot-product in
the high-dimensional space that the independent variable(s),
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         , was
projected to:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         K_{ij} = \phi(x_i)\cdot\phi(x_j)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         But observe, that the
         <a data-poload="kernel_ridge_solution" href="#kernel_ridge_solution">
          Kernel Ridge
  Regression solution
         </a>
         does not refer explicitly to the mapping
function,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \phi
         </script>
         . This means that if the kernel is evaluated by some
other means than a mapping to a high-dimensional space and the
evaluation of the dot-product in that space, the non-linear fitting
that was the goal can be obtained implicitly. This is the:
         <div class="text-center">
          <p>
           <p>
            <span style="color:green">
             <b>
              Kernel Trick
             </b>
            </span>
           </p>
          </p>
         </div>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_614">
      </div>
      <div class="comments" id="issues_614">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_615">
     <div class="col-11">
      <h3>
       3.7 Example
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Assume we are in a 1-dimensional space, i.e. we have one independent
variable:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathbf{x}=\begin{bmatrix}x\end{bmatrix}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Then if the kernel is evaluated according to the square-kernel expression:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         K_{ij}=\left(1+\mathbf{x_i}^T\mathbf{x_j}\right)^2
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         we specifically get:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
  K(x_1,x_2)&=&\left(1+x_1x_2\right)^2\\
            &&\\
  &=&1+2x_1x_2 + x_1^2x_2^2
\end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         which "happens to be" exactly the dot-product in the
higher-dimensional space that
         <span class="matematik">
         </span>
         <script type="math/tex">
          \phi
         </script>
         maps
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         to:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
\phi(x_1)\cdot\phi(x_2) &=& \begin{bmatrix}
         1 & \sqrt{2}x_1 & x_1^2
       \end{bmatrix}
       \begin{bmatrix}
         1 \\
         \sqrt{2}x_2 \\
         x_2^2
       \end{bmatrix}\\
  &&\\
  &=&1+2x_1x_2 + x_1^2x_2^2
\end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Notice how the explicit projection and dot-product evaluation involves
more computational evaluations that the implicit variant, using the
square-kernel. This rationalizes why the kernel trick is useful.
        </p>
        <p>
         If for some reason one would like to use kernel ridge regression
without the implicit mapping to a higher-dimensional space, one may
use the linear kernel:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         K_{ij}=\mathbf{x_i}^T\mathbf{x_j}
        </script>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_615">
      </div>
      <div class="comments" id="issues_615">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_616">
     <div class="col-11">
      <h3>
       3.8 Example: Discrete Radial Basis Function
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         By discretizing the
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -axis and simplifying the radial basis
functions, one can provide an illustration of the kernel trick for the
Gaussian (RBF) kernel in a finite-dimensional space. This approach can
give a concrete understanding of how the kernel trick avoids the need
to explicitly calculate the feature mapping into the
higher-dimensional space.
        </p>
        <b>
         Step-by-Step Illustration of the Kernel Trick
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            Discretizing the Input Space:
           </p>
           <p>
            Let’s discretize the input space
            <span class="matematik">
            </span>
            <script type="math/tex">
             x
            </script>
            such that:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             x=x_0 + i\cdot \Delta x,
            </script>
           </p>
           <p>
            where
            <span class="matematik">
            </span>
            <script type="math/tex">
             i
            </script>
            is an integer.
For simplicity, assume that
            <span class="matematik">
            </span>
            <script type="math/tex">
             \Delta x
            </script>
            is a fixed interval, and the input points lie on a discrete grid along the
            <span class="matematik">
            </span>
            <script type="math/tex">
             x
            </script>
            -axis.
           </p>
          </li>
          <li>
           <p>
            Radial Basis Function (RBF) Approximation:
           </p>
           <p>
            The Gaussian kernel can be viewed as applying a radial basis function
(RBF) to the input points. Normally, the RBF has a continuous shape,
but for the sake of illustrating the point, here is a simplified version:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \phi(x)=\left[\dots, 0,0,0.1,0.8,0.1,0,0, \dots \right]
            </script>
           </p>
           <p>
            This simplified radial basis function has a peak value at the grid
point
            <span class="matematik">
            </span>
            <script type="math/tex">
             x_i
            </script>
            , which is closest to the input
            <span class="matematik">
            </span>
            <script type="math/tex">
             x
            </script>
            , and smaller values at
neighboring points. The function is centered on the closest grid point
to
            <span class="matematik">
            </span>
            <script type="math/tex">
             x_1
            </script>
            and decays symmetrically around it.
           </p>
          </li>
          <li>
           <p>
            Mapping to a Higher-Dimensional Space:
           </p>
           <p>
            In this scenario, the feature space is the set of weights applied to
these discretized radial basis functions. Suppose we have two points
            <span class="matematik">
            </span>
            <script type="math/tex">
             x_1
            </script>
            and
            <span class="matematik">
            </span>
            <script type="math/tex">
             x_2
            </script>
            . Instead of working with the original 1D inputs, we map
them into a higher-dimensional space where each dimension corresponds
to the weight of the RBF at a particular grid point.
           </p>
           <p>
            For example,
            <span class="matematik">
            </span>
            <script type="math/tex">
             \phi(x_1)
            </script>
            might look like this in the higher-dimensional space:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \phi(x_1)=\left[0,0,0.1,0.8,0.1,0,0,\dots  \right]
            </script>
           </p>
           <p>
            And
            <span class="matematik">
            </span>
            <script type="math/tex">
             \phi(x_2)
            </script>
            might look like:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \phi(x_2)=\left[0,0.1,0.8,0.1,0,0,\dots  \right]
            </script>
            where
            <span class="matematik">
            </span>
            <script type="math/tex">
             x_2
            </script>
            is centered around a different grid point.
           </p>
          </li>
          <li>
           <p>
            Calculating the Inner Product in the Higher-Dimensional Space:
           </p>
           <p>
            The dot product
            <span class="matematik">
            </span>
            <script type="math/tex">
             \phi(x_1)\cdot \phi(x_2)
            </script>
            would involve calculating
the sum of element-wise products of these two vectors. However, since
the radial basis functions are localized and decay quickly, many of
the terms in this sum will be zero or very small.  In this case, we’re
still computing an inner product in the transformed feature space.
           </p>
          </li>
          <li>
           <p>
            Using the Kernel Trick:
           </p>
           <p>
            Instead of explicitly computing the transformation into the
higher-dimensional space and performing the dot product, the kernel
trick allows us to compute the same result directly using the Gaussian
kernel function:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             K(x1,x2)=\exp(-\displaystyle\frac{(x_1-x_2)^2}{2\sigma^2}).
            </script>
            The kernel function gives us the value of the inner product in the
infinite-dimensional space without having to construct the explicit
mapping. In our discretized example, this means that we don’t need to
store or compute the radial basis function values for each point; we
can just evaluate the kernel function.
           </p>
          </li>
         </ul>
        </p>
        <b>
         Key Insight
        </b>
        <p>
         The kernel trick saves computation by directly providing the inner
product between two points in the higher-dimensional space without
needing to calculate their individual projections. In the Gaussian
kernel case, the mapping would typically involve an infinite number of
dimensions (basis functions), but the kernel function provides the
result in constant time.
        </p>
        <p>
         By discretizing the space and simplifying the RBFs, we’ve approximated
the transformation into a finite-dimensional space. In this
approximation, the kernel trick still avoids the need to explicitly
construct and manipulate the feature vectors, illustrating its
computational efficiency.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_616">
      </div>
      <div class="comments" id="issues_616">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_617">
     <div class="col-11">
      <h3>
       3.9 Gaussian Process Regression: Mean and Variance
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In Gaussian Process Regression (GPR), the goal is to predict the value
of a function at new points based on observed data. The predictions
are in the form of a
         <b>
          mean
         </b>
         function and a
         <b>
          variance
         </b>
         function, which represent the most probable value of the function and
the uncertainty at each prediction point, respectively.
        </p>
        <b>
         Given Data
        </b>
        <p>
         Assume we have observed data points
         <span class="matematik">
         </span>
         <script type="math/tex">
          (X, \mathbf{y})
         </script>
         , where:
         <ul>
          <p>
          </p>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             X = [x_1, x_2, \dots, x_n]^\top
            </script>
            are the input data points (of
dimension
            <span class="matematik">
            </span>
            <script type="math/tex">
             n \times d
            </script>
            , where
            <span class="matematik">
            </span>
            <script type="math/tex">
             d
            </script>
            is the number of features),
           </p>
          </li>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathbf{y} = [y_1, y_2, \dots, y_n]^\top
            </script>
            are the corresponding
target values.
           </p>
          </li>
         </ul>
        </p>
        <p>
         We are interested in making predictions at new input points
         <span class="matematik">
         </span>
         <script type="math/tex">
          X_* = [x_1^*, x_2^*, \dots, x_m^*]^\top
         </script>
         .
        </p>
        <b>
         Joint Distribution
        </b>
        <p>
         We assume that the joint distribution of the observed outputs
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{y}
         </script>
         and the predicted values
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{y}_*
         </script>
         follows a multivariate Gaussian distribution:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{bmatrix}
\mathbf{y} \\
\mathbf{y}_*
\end{bmatrix}
\sim \mathcal{N} \left( 0, \begin{bmatrix}
K(X, X) + \sigma^2 I & K(X, X_*) \\
K(X_*, X) & K(X_*, X_*)
\end{bmatrix} \right)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where:
         <ul>
          <p>
          </p>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             K(X, X)
            </script>
            is the covariance matrix of the training data, given by
the kernel function
            <span class="matematik">
            </span>
            <script type="math/tex">
             K(x, x')
            </script>
            applied to each pair of points in
            <span class="matematik">
            </span>
            <script type="math/tex">
             X
            </script>
            .
           </p>
          </li>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             K(X, X_*)
            </script>
            is the covariance between the training points and the
new points.
           </p>
          </li>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             K(X_*, X_*)
            </script>
            is the covariance matrix of the new points.
           </p>
          </li>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             \sigma^2
            </script>
            is the noise variance in the observed data.
           </p>
          </li>
         </ul>
        </p>
        <b>
         Mean and Variance of Predictions
        </b>
        <p>
         The conditional distribution of the predicted values
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathbf{y}_*
         </script>
         given the observed data
         <span class="matematik">
         </span>
         <script type="math/tex">
          (X, \mathbf{y})
         </script>
         is Gaussian with the
following
         <b>
          mean
         </b>
         and
         <b>
          variance
         </b>
         :
        </p>
        <p>
         Mean:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathbb{E}[\mathbf{y}_*] = \mathbf{m}_* = K(X_*, X) \left( K(X, X) + \sigma^2 I \right)^{-1} \mathbf{y}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         This gives the predicted mean (or expected value) at the new points
         <span class="matematik">
         </span>
         <script type="math/tex">
          X_*
         </script>
         .
        </p>
        <p>
         Variance:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \text{Var}[\mathbf{y}_*] = K(X_*, X_*) - K(X_*, X) \left( K(X, X) + \sigma^2 I \right)^{-1} K(X, X_*)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         This provides the uncertainty (variance) of the predictions at the new points
         <span class="matematik">
         </span>
         <script type="math/tex">
          X_*
         </script>
         .
        </p>
        <b>
         Interpretation
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            The predicted
            <b>
             mean
            </b>
            function
            <span class="matematik">
            </span>
            <script type="math/tex">
             \mathbf{m}_*
            </script>
            is a linear combination
of the kernel function applied to the training points and the new
points.
           </p>
          </li>
          <li>
           <p>
            The predicted
            <b>
             variance
            </b>
            gives a measure of how uncertain we are
about the predicted values, which depends on the distance between the
new points and the observed data, as captured by the kernel function.
           </p>
          </li>
         </ul>
        </p>
        <p>
         In practice, Gaussian Process Regression provides both the prediction
and the uncertainty around the prediction, which makes it a powerful
tool for regression tasks where uncertainty estimation is important.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_617">
      </div>
      <div class="comments" id="issues_617">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 29
     </h1>
    </div>
    <div class="row spy-padding" id="block_627">
     <div class="col-11">
      <h3>
       4.1 Ordinary least squares regression
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This exercise is about applying the OLS regression method. Do not use
ridge regression or kernel ridge regression yet.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_627">
      </div>
      <div class="comments" id="issues_627">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_628">
     <div class="col-11">
      <h3>
       4.2 Linear function
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Define a linear function and sample it for some values of
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         , e.g.
         <span class="matematik">
         </span>
         <script type="math/tex">
          x\in\left\{1, 2, 4, 5\right\}
         </script>
         . Plot
the function and indicate the sampled points.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_29_fig1.png">
              <img class="img-fluid" src="images/47.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         b) Introduce a function:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \Phi: x\rightarrow \begin{bmatrix}1&x\end{bmatrix}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         and use
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Phi
         </script>
         to construct the matrix:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         X =  \begin{bmatrix}
    \Phi(x_1)\\
    \Phi(x_2)\\
    \vdots\\
    \Phi(x_N)\\
  \end{bmatrix}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         meaning that in Python you'll have a numpy-array,
         <code class="prettyprint python">
          X
         </code>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
array([[1., 1.],
       [1., 2.],
       [1., 4.],
       [1., 5.]])
</pre>
        <p>
         c) Use
         <span class="matematik">
         </span>
         <script type="math/tex">
          X
         </script>
         and a column vector,
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         , of the observed variables,
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         y =  \begin{bmatrix}
y_1\\
y_2\\
  \vdots\\
y_N\\
  \end{bmatrix}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         to solve for the parameters in a linear OLS model (the
         <span class="matematik">
         </span>
         <script type="math/tex">
          \beta_0
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \beta_1
         </script>
         's). Draw some random values of
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         and plot
the model predictions for those
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -values.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_29_fig2.png">
              <img class="img-fluid" src="images/47.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_628">
      </div>
      <div class="comments" id="issues_628">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_629">
     <div class="col-11">
      <h3>
       4.3 Quadratic function
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Choose a parabola. Plot it. Sample it at some values of
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_29_fig3.png">
              <img class="img-fluid" src="images/47.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         b) Perform linear regression using the sampled points. Plot the result.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_29_fig4.png">
              <img class="img-fluid" src="images/47.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         c) Introduce a function:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \Phi: x\rightarrow \begin{bmatrix}1&x&x^2\end{bmatrix}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         and use
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Phi
         </script>
         to construct the matrix:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         X =  \begin{bmatrix}
    \Phi(x_1)\\
    \Phi(x_2)\\
    \vdots\\
    \Phi(x_N)\\
  \end{bmatrix}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         meaning that in Python you'll have a numpy-array,
         <code class="prettyprint python">
          X
         </code>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
array([[ 1.,  1.,  1.],
       [ 1.,  2.,  4.],
       [ 1.,  4., 16.],
       [ 1.,  5., 25.]])
</pre>
        <p>
         (if
         <span class="matematik">
         </span>
         <script type="math/tex">
          x\in\left\{1, 2, 4, 5\right\}
         </script>
         ).
Use this
         <span class="matematik">
         </span>
         <script type="math/tex">
          X
         </script>
         to find the parameters for a quadratic OLS fit. Plot it at some
random points.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_29_fig5.png">
              <img class="img-fluid" src="images/47.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_629">
      </div>
      <div class="comments" id="issues_629">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 30
     </h1>
    </div>
    <div class="row spy-padding" id="block_630">
     <div class="col-11">
      <h3>
       5.1 Ordinary and ridge regression
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This exercise concerns performing ridge regression and 
identifying the role of the regularization term. Do not use kernel
ridge regression when solving this exercise.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_630">
      </div>
      <div class="comments" id="issues_630">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_631">
     <div class="col-11">
      <h3>
       5.2 Target function
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Define a non-trivial function and sample it for some values of
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         , e.g.
         <span class="matematik">
         </span>
         <script type="math/tex">
          x\in\left\{-1, 1, 2, 4, 5\right\}
         </script>
         . Plot
the function and indicate the sampled points.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_30_fig1.png">
              <img class="img-fluid" src="images/48.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_631">
      </div>
      <div class="comments" id="issues_631">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_632">
     <div class="col-11">
      <h3>
       5.3 OLS regression
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Do with OLS regression a non-linear fit with polynomial terms up to order 3.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_30_fig2.png">
              <img class="img-fluid" src="images/48.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Check that:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         (X^T X)^{-1} (X^T X) = \mathbf{I}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         c) Repeat b) but with terms up to order 8.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_30_fig3.png">
              <img class="img-fluid" src="images/48.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Inspect if:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         (X^T X)^{-1} (X^T X) = \mathbf{I}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Conclude: Ordinary least square regression is unstable when there are
more parameters than data points.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_632">
      </div>
      <div class="comments" id="issues_632">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_633">
     <div class="col-11">
      <h3>
       5.4 Ridge regression
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Apply ridge regression for the polynomial fit to order 8. Try
different values for the regularization parameter,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \lambda
         </script>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_30_fig4.png">
              <img class="img-fluid" src="images/48.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Conclude: The fit becomes stable in ridge regression, but of course
very uncertain (if not random) in regions with no data. For very large
values of the regularization parameter, the fit will not reproduce the
data points very accurately (the green line misses the first two data points).
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_633">
      </div>
      <div class="comments" id="issues_633">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_634">
     <div class="col-11">
      <h3>
       5.5 Data with noise
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         e) Sample the function at more
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -values and add a little noise term
to the observed values:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathbf{y} = f(\mathbf{x}) + \mathcal{N}(0, \sigma^2 \mathbf{1})
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_30_fig5.png">
              <img class="img-fluid" src="images/48.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         f) Use ordinary least squares and ridge regression to fit the function.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_30_fig6.png">
              <img class="img-fluid" src="images/48.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_634">
      </div>
      <div class="comments" id="issues_634">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 31
     </h1>
    </div>
    <div class="row spy-padding" id="block_637">
     <div class="col-11">
      <h3>
       6.1 Kernel Ridge Regression
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Consider the function:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         f: y(x) = \sin(x-1) + \displaystyle\frac{1}{4}.
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Sample it at
         <span class="matematik">
         </span>
         <script type="math/tex">
          x\in\left\{-1, 1, 2, 4, 5\right\}
         </script>
         . Plot the function
and the sampled data points.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_31_fig1.png">
              <img class="img-fluid" src="images/49.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         b) Do kernel ridge regression with these kernels:
         <ul>
          <p>
          </p>
          <li>
           <p>
            the 2nd order polynomial kernel,
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             K_{ij}=\left(1+\mathbf{x_i}^T\mathbf{x_j}\right)^2
            </script>
           </p>
          </li>
          <li>
           <p>
            the 8th order polynomial kernel,
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             K_{ij}=\left(1+\mathbf{x_i}^T\mathbf{x_j}\right)^8
            </script>
           </p>
          </li>
          <li>
           <p>
            the Gaussian kernel:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             K_{ij}=\exp(-\displaystyle\frac{\|\mathbf{x}_i-\mathbf{x}_j\|^2}{2\sigma^2}).
            </script>
           </p>
          </li>
         </ul>
         For the regularization parameter use e.g.
         <span class="matematik">
         </span>
         <script type="math/tex">
          \lambda=10^{-4}
         </script>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_31_fig2.png">
              <img class="img-fluid" src="images/49.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_637">
      </div>
      <div class="comments" id="issues_637">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_638">
     <div class="col-11">
      <h3>
       6.2 Data with noise
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Sample a lot more data points, but add noise:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_31_fig3.png">
              <img class="img-fluid" src="images/49.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         d) Perform the kernel ridge regression with the various kernels. Try
perhaps to vary the
         <span class="matematik">
         </span>
         <script type="math/tex">
          \sigma
         </script>
         hyperparameter of the Gaussian kernel.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_31_fig4.png">
              <img class="img-fluid" src="images/49.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_638">
      </div>
      <div class="comments" id="issues_638">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 32
     </h1>
    </div>
    <div class="row spy-padding" id="block_639">
     <div class="col-11">
      <h3>
       7.1 The Lennard-Jones potential
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Sample the Lennard-Jones potential with the
         <span class="matematik">
         </span>
         <script type="math/tex">
          \varepsilon_0
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \sigma
         </script>
         values we have used previously. Get four
         <span class="matematik">
         </span>
         <script type="math/tex">
          r
         </script>
         -values for which
         <span class="matematik">
         </span>
         <script type="math/tex">
          0.85<r<1
         </script>
         and eight
         <span class="matematik">
         </span>
         <script type="math/tex">
          r
         </script>
         -values for which
         <span class="matematik">
         </span>
         <script type="math/tex">
          1<r<2
         </script>
         . Plot the data.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_32_fig1.png">
              <img class="img-fluid" src="images/50.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_639">
      </div>
      <div class="comments" id="issues_639">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_640">
     <div class="col-11">
      <h3>
       7.2 OLS regression
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Fit the data with some series of
         <span class="matematik">
         </span>
         <script type="math/tex">
          r
         </script>
         to negative powers. Observe
that you can only determine less parameters than you have data.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_32_fig2.png">
              <img class="img-fluid" src="images/50.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_640">
      </div>
      <div class="comments" id="issues_640">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_641">
     <div class="col-11">
      <h3>
       7.3 Ridge regression
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Now fit with ridge regression so that you can have more parameters
than data. Use a series of
         <span class="matematik">
         </span>
         <script type="math/tex">
          r
         </script>
         to positive powers and a series of
         <span class="matematik">
         </span>
         <script type="math/tex">
          r
         </script>
         to negative powers.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_32_fig3.png">
              <img class="img-fluid" src="images/50.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_641">
      </div>
      <div class="comments" id="issues_641">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_642">
     <div class="col-11">
      <h3>
       7.4 Kernel ridge regression
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Do kernel ridge regression with different kernels and different hyperparameters.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_32_fig4.png">
              <img class="img-fluid" src="images/50.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_642">
      </div>
      <div class="comments" id="issues_642">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 33
     </h1>
    </div>
    <div class="row spy-padding" id="block_643">
     <div class="col-11">
      <h3>
       8.1 The implicit projection
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This exercise is about illustrating the implicit projection to a
higher-dimensional space that goes on within the kernel when applying
kernel ridge regression.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_643">
      </div>
      <div class="comments" id="issues_643">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_644">
     <div class="col-11">
      <h3>
       8.2 The const-lin-quadratic descriptor
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Start by considering the 2nd order polynomial kernel:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         K(x_1,x_2)=\left(1+x_1x_2\right)^2
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         It has been postulated a number of times by now that this kernel
effectively performs the projection:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \phi: x\rightarrow \begin{bmatrix}1&\sqrt{2}x&x^2\end{bmatrix}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         a) Set
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_1=2
         </script>
         and let
         <span class="matematik">
         </span>
         <script type="math/tex">
          -5<x_2<5
         </script>
         . Evaluate the
         <span class="matematik">
         </span>
         <script type="math/tex">
          \phi(x_1)\cdot\phi(x_2)
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          K(x_1,x_2)
         </script>
         terms directly and plot
them in the same diagram. Observe that they are identical.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_33_fig1.png">
              <img class="img-fluid" src="images/51.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         b) Draw
         <span class="matematik">
         </span>
         <script type="math/tex">
          (x_1,x_2)
         </script>
         from a uniform distribution
         <span class="matematik">
         </span>
         <script type="math/tex">
          x\in\left[-5,5\right[
         </script>
         . Make the parity plot of
         <span class="matematik">
         </span>
         <script type="math/tex">
          K(x_1,x_2)
         </script>
         as a
function of
         <span class="matematik">
         </span>
         <script type="math/tex">
          \phi(x_1)\cdot\phi(x_2)
         </script>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_33_fig2.png">
              <img class="img-fluid" src="images/51.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_644">
      </div>
      <div class="comments" id="issues_644">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_645">
     <div class="col-11">
      <h3>
       8.3 The RBF descriptor
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Consider the Gaussian kernel:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         K(x_1,x_2)=\exp(-\displaystyle\frac{\left|x_1-x_2\right|^2}{2\sigma^2}).
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         To illustrate the implicit projection, we introduce:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \phi_i(x)=A\displaystyle\frac{1}{\sqrt{2\pi}\sigma_\phi}
  \exp(-\displaystyle\frac{|x-x_i|^2}{2\sigma_\phi^2})\sqrt{\Delta x}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where
         <span class="matematik">
         </span>
         <script type="math/tex">
          \sigma_\phi = \displaystyle\frac{\sigma}{\sqrt{2}}
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          A=\sqrt{\sqrt{2\pi}\sigma}
         </script>
         . The
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_i
         </script>
         must be chosen so:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         x_{i+1}=x_i + \Delta x
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Now the projection becomes:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \Phi: x\rightarrow \begin{bmatrix}\dots&\phi_{i-1}(x)&\phi_i(x)&\phi_{i+1}(x)&\dots\end{bmatrix}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         c) Implement
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Phi
         </script>
         so that you can obtain it for different values of
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta x
         </script>
         . Test that the dot-product is unity for the same
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         , i.e. that
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Phi(x)\cdot\Phi(x)=1
         </script>
         . If you implement it as python
         <code class="prettyprint python">
          class
         </code>
         like we did for other descriptors a while
back, the code could look like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
x1 = 0.25
x2 = 0.5
for dx in [0.1, 0.02, 0.04, 0.008, 0.0016, 0.00032, 0.000064]:
    discrete_rbf = DiscreteRBF(xwidth=dx)
    print(discrete_rbf.descriptor(x1) @ discrete_rbf.descriptor(x1),
          discrete_rbf.descriptor(x2) @ discrete_rbf.descriptor(x2),
          discrete_rbf.descriptor(x1) @ discrete_rbf.descriptor(x2))
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint text mb-0">
1.0143837720632465 0.9856162386399131 0.04393693338836188
1.0000000000010218 1.0000000000010218 0.043936933623452315
1.0000000000010218 1.0000000000011025 0.04393693362345482
1.0000000000011107 1.0000000000011107 0.043936933623456215
1.0000000000011104 1.0000000000011102 0.0439369336234562
1.0000000000000002 1.0000000000000002 0.04393693362340743
1.0 0.9999999999999998 0.04393693362340743
</pre>
        <p>
         where the 3rd column is
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Phi(x_1)\cdot\Phi(x_2)
         </script>
         .
        </p>
        <p>
         d) Plot the high-dimensional descriptor for different values of
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Delta x
         </script>
         . The code could look like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint text mb-0">
fig, axes = plt.subplots(1,4,figsize=(16,4))
for ax, dx in zip(axes,[0.2,0.15,0.1,0.05]):
    discrete_rbf = DiscreteRBF(xwidth=dx)
    discrete_rbf.draw(0.5,ax)
    discrete_rbf.draw(0.25,ax)
    ax.text(0.05,0.8,f'$\Delta x={dx:.2f}$',transform = ax.transAxes)
</pre>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_33_fig3.png">
              <img class="img-fluid" src="images/51.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         e) Now compare the
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Phi(x_1)\cdot\Phi(x_2)
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          K(x_1,x_2)
         </script>
         for
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_1=2
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          1<x_2<3
         </script>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_33_fig4.png">
              <img class="img-fluid" src="images/51.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         f) Establish the parity relation between
         <span class="matematik">
         </span>
         <script type="math/tex">
          \Phi(x_1)\cdot\Phi(x_2)
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          K(x_1,x_2)
         </script>
         when drawing the components of
         <span class="matematik">
         </span>
         <script type="math/tex">
          (x_1,x_2)
         </script>
         as random
numbers between
         <span class="matematik">
         </span>
         <script type="math/tex">
          -5
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          5
         </script>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_33_fig5.png">
              <img class="img-fluid" src="images/51.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_645">
      </div>
      <div class="comments" id="issues_645">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 34
     </h1>
    </div>
    <div class="row spy-padding" id="block_646">
     <div class="col-11">
      <h3>
       9.1 Kernel Ridge Regression with Descriptors
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise we shall see the effect of a descriptor for a
regression. Data will be established that only has one independent
degree of freedom, our usual
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -coordinate. The data is for an atomic
cluster, where only one atom has its
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -coordinate changed. We have
seen previously in connection with the topic clustering, that it is
useful to create a high-dimensional descriptor for an atomic
cluster. Such a high-dimensional descriptor will have many of its
components (the features) changed as a consequence of the change of
that one original
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -coordinate. Using the high-dimensional
descriptor thus provides more information for a subsequent regression
as will be seen in this exercise.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_646">
      </div>
      <div class="comments" id="issues_646">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_647">
     <div class="col-11">
      <h3>
       9.2 The data
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Setup an atomic cluster, where one atom is allowed to move along
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_34_fig1.png">
              <img class="img-fluid" src="images/52.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Establish three datasets:
         <ul>
          <p>
          </p>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             \left(x_i,E_i\right)
            </script>
           </p>
          </li>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             \left(f_\mathrm{PairDistances}(x_i),E_i\right)
            </script>
           </p>
          </li>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             \left(f_\mathrm{CoulombMatrixSpectrum}(x_i),E_i\right)
            </script>
           </p>
          </li>
         </ul>
         Where
         <span class="matematik">
         </span>
         <script type="math/tex">
          i
         </script>
         enumerates the data,
         <span class="matematik">
         </span>
         <script type="math/tex">
          f_\mathrm{PairDistances}(x)
         </script>
         provides
(as a vector) the histogram of all interatomic distances when the
dynamic atom is at the position
         <span class="matematik">
         </span>
         <script type="math/tex">
          (x,0)
         </script>
         , and
         <span class="matematik">
         </span>
         <script type="math/tex">
          f_\mathrm{CoulombMatrixSpectrum}(x)
         </script>
         correspondingly the vector of
the coulomb matrix spectrum.
        </p>
        <p>
         b) Plot the energy for
         <span class="matematik">
         </span>
         <script type="math/tex">
          -2<x<2
         </script>
         and indicate the sampled points.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_34_fig2.png">
              <img class="img-fluid" src="images/52.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_647">
      </div>
      <div class="comments" id="issues_647">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_648">
     <div class="col-11">
      <h3>
       9.3 Fit without descriptor
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Use the first dataset to make a kernel ridge regression fit with
the Gaussian kernel. In
this fit, the regression will only have the
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -value to base the
prediction on.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_34_fig3.png">
              <img class="img-fluid" src="images/52.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_648">
      </div>
      <div class="comments" id="issues_648">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_649">
     <div class="col-11">
      <h3>
       9.4 Fit with pair distribution descriptor
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Use the second dataset to make a kernel ridge regression fit. Now,
the fit is based on the pair distribution descriptor which has 14 features (if distances up to 7 with
intervals of 0.5 are used). Note that the Gaussian kernel,
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         K_{ij}=\exp(-\displaystyle\frac{\|\mathbf{x}_i-\mathbf{x}_j\|^2}{2\sigma^2}).
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         evaluates the Euclidean distance in the 14-dimensional space via the
         <span class="matematik">
         </span>
         <script type="math/tex">
          \|\mathbf{x}_i-\mathbf{x}_j\|
         </script>
         term.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_34_fig4.png">
              <img class="img-fluid" src="images/52.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_649">
      </div>
      <div class="comments" id="issues_649">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_650">
     <div class="col-11">
      <h3>
       9.5 Fit with Coulomb Matrix Spectrum descriptor
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         e) Repeat d) with the third dataset containing the coulomb matrix
spectrum descriptor.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/7/img/exercise_34_fig5.png">
              <img class="img-fluid" src="images/52.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_650">
      </div>
      <div class="comments" id="issues_650">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 35
     </h1>
    </div>
    <div class="row spy-padding" id="block_688">
     <div class="col-11">
      <h3>
       10.1 The non-existing exercise
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Gotcha!
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_688">
      </div>
      <div class="comments" id="issues_688">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Week 7
     </h1>
    </div>
    <div class="row spy-padding" id="block_717">
     <div class="col-11">
      <h3>
       1.1 Introduction
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This week is about:
         <ul>
          <p>
          </p>
          <li>
           <p>
            Introducing periodicity
           </p>
          </li>
          <li>
           <p>
            Introducing pressure
           </p>
          </li>
          <li>
           <p>
            Perform constant pressure simulations
           </p>
          </li>
          <li>
           <p>
            Find crystal structures
           </p>
          </li>
          <li>
           <p>
            Observe melting transitions
           </p>
          </li>
         </ul>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_717">
      </div>
      <div class="comments" id="issues_717">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_718">
     <div class="col-11">
      <h3>
       1.2 TØ programme
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
        </p>
        <b>
         TØ 1
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            Read about periodic boundary conditions and the minimum image convention in the paper on molecular
  dynamics from week 5.
           </p>
          </li>
          <li>
           <p>
            Do exercises 36-37 where atoms see periodic boundary conditions
  during the simulations
           </p>
          </li>
         </ul>
        </p>
        <b>
         TØ 2
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            Do exercises 38-40 where atoms are described by the
  Lennard-Jones-Gauss interatomic potential and new physics emerges.
           </p>
          </li>
         </ul>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_718">
      </div>
      <div class="comments" id="issues_718">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_719">
     <div class="col-11 bg-warning">
      <h3>
       1.3 Help to exercise 36: Find
       <code class="prettyprint python">
        class NonPeriodicSystem
       </code>
       at Brightspace
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         You do not have permission to see this section.
        </p>
       </div>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      External resources
     </h1>
    </div>
    <div class="row spy-padding" id="block_667">
     <div class="col-11">
      <h3>
       2.1 Periodic boundary conditions
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Read about periodic boundary conditions and minimum image convention
in this
         <a href="https://pubs.aip.org/aapt/ajp/article/88/5/401/1056833" target="_blank">
          article
         </a>
         that we also used when Molecular Dynamics was introduced.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_667">
      </div>
      <div class="comments" id="issues_667">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_668">
     <div class="col-11">
      <h3>
       2.2 Lennard-Jones-Gauss potential
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         A modfied Lennard-Jones potential is used for 2D clusters in this
         <a href="https://pubs.aip.org/aip/jcp/article/149/13/134104/196997" target="_blank">
          article
         </a>
         .
        </p>
        <p>
         In this
         <a href="https://journals.aps.org/prl/abstract/10.1103/PhysRevLett.98.225505" target="_blank">
          article
         </a>
         the 2D solids of the modfied Lennard-Jones potential are investigated
and new crystal structures are found. Some of these are approximants
to quasi-crystal structures.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_668">
      </div>
      <div class="comments" id="issues_668">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Periodic systems
     </h1>
    </div>
    <div class="row spy-padding" id="block_673">
     <div class="col-11">
      <h3>
       3.1 Lennard-Jones-Gauss potential
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The
         <b>
          Lennard-Jones-Gauss (LJG) potential
         </b>
         is an extension of
the classic Lennard-Jones (LJ) potential. It incorporates a Gaussian
term to account for more specific interactions between particles.
This often leads to more complex structural patterns formed by the
particles.  The LJG potential models systems where particles have both
short-range and longer-range attractions, and effectively, it encodes
two preferred length-scale for the interactions. This means that patterns
will form that show extra preferred particle separation distances.
        </p>
        <p>
         The LJG potential takes the form:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         V(r) = \left( \frac{1}{r} \right)^{12} - 2 \left( \frac{1}{r}
\right)^6 - \varepsilon \cdot \exp\left(-\frac{(r - r_0)^2}{2\sigma^2}\right)
        </script>
       </div>
       <b>
        Components
       </b>
       <div class="i2latextext mb-2">
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            <b>
             Lennard-Jones Part
            </b>
            : The first two terms describe the standard LJ interaction, with:
            <ul>
             <p>
             </p>
             <li>
              <p>
               The minimum of the potential well occuring at
               <span class="matematik">
               </span>
               <script type="math/tex">
                r_{min}= 1
               </script>
               .
              </p>
             </li>
             <li>
              <p>
               A depth of the potential well of 1.
              </p>
             </li>
            </ul>
           </p>
          </li>
          <li>
           <p>
            <b>
             Gaussian Part
            </b>
            : The second term introduces a Gaussian modulation that enhances or suppresses interactions at specific distances
            <span class="matematik">
            </span>
            <script type="math/tex">
             r_0
            </script>
            :
            <ul>
             <p>
             </p>
             <li>
              <p>
               <span class="matematik">
               </span>
               <script type="math/tex">
                \varepsilon
               </script>
               : Amplitude of the Gaussian, determining its impact on the
overall potential.
              </p>
             </li>
             <li>
              <p>
               <span class="matematik">
               </span>
               <script type="math/tex">
                r_0
               </script>
               : The preferred inter-particle separation distance.
              </p>
             </li>
             <li>
              <p>
               <span class="matematik">
               </span>
               <script type="math/tex">
                \sigma
               </script>
               : Width of the Gaussian, controlling how sharply the
   potential peaks around
               <span class="matematik">
               </span>
               <script type="math/tex">
                r_0
               </script>
               . Usually,
               <span class="matematik">
               </span>
               <script type="math/tex">
                \sigma^2=0.02
               </script>
               is used
   meaning that the Gaussian term only changes the LJ potential
   locally around
               <span class="matematik">
               </span>
               <script type="math/tex">
                r_0
               </script>
               .
              </p>
             </li>
            </ul>
           </p>
          </li>
         </ul>
        </p>
        <b>
         Motivation for
         <span class="matematik">
         </span>
         <script type="math/tex">
          r_0
         </script>
        </b>
        <p>
         The choice of
         <span class="matematik">
         </span>
         <script type="math/tex">
          r_0
         </script>
         determines where the Gaussian correction modulates the LJ interaction. Depending on the system's physical properties, certain values of
         <span class="matematik">
         </span>
         <script type="math/tex">
          r_0
         </script>
         can be "magic" values, corresponding to the preferred structural arrangements in the material (e.g., packing in clusters or phases). These values can align with nearest-neighbor distances in crystal structures or metastable configurations. In practice,
         <span class="matematik">
         </span>
         <script type="math/tex">
          r_0
         </script>
         is often selected based on known experimental or theoretical distances between particles in the system, such as lattice constants.
        </p>
        <p>
         The LJG potential is useful for studying systems where the competition between different inter-particle distances leads to phase transitions or complex structural arrangements, like in soft matter, colloids, or certain molecular systems.
        </p>
        <p>
         By adjusting
         <span class="matematik">
         </span>
         <script type="math/tex">
          \varepsilon
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          r_0
         </script>
         , one can control the stability of phases at
different temperatures or densities, making the LJG potential a
versatile tool in computational material science and condensed matter
physics. Below is an example from a scientific
         <a href="https://journals.aps.org/prl/abstract/10.1103/PhysRevLett.98.225505" target="_blank">
          article
         </a>
         ,
where a large number of phases for 2-dimensional LJG crystals have been identified through simulated
annealing at different sets of (
         <span class="matematik">
         </span>
         <script type="math/tex">
          \varepsilon
         </script>
         ,
         <span class="matematik">
         </span>
         <script type="math/tex">
          r_0
         </script>
         ):
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/ljg_article_fig2.png">
              <img class="img-fluid" src="images/56.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_673">
      </div>
      <div class="comments" id="issues_673">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_674">
     <div class="col-11">
      <h3>
       3.2 Pressure
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The evaluation of pressure from the stress tensor using finite difference of the energy with respect to strain is a technique often employed in molecular dynamics and materials simulations. It connects mechanical deformation to the system's thermodynamic state, making it a key method for understanding stress-strain relationships, elastic properties, and material responses under deformation.
        </p>
        <b>
         Key Concepts
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            <b>
             Stress Tensor
            </b>
            :
   The stress tensor
            <span class="matematik">
            </span>
            <script type="math/tex">
             \sigma_{ij}
            </script>
            represents the internal forces acting on a material's infinitesimal element in various directions. It's a symmetric matrix where each component represents force per unit area in specific directions. The diagonal elements correspond to normal stresses (e.g.,
            <span class="matematik">
            </span>
            <script type="math/tex">
             \sigma_{xx}
            </script>
            ), while the off-diagonal elements represent shear stresses (e.g.,
            <span class="matematik">
            </span>
            <script type="math/tex">
             \sigma_{xy}
            </script>
            ).
           </p>
          </li>
          <li>
           <p>
            <b>
             Strain
            </b>
            :
   Strain is a measure of deformation in response to stress, and it is quantified by the fractional change in shape or size of a system. Applying a strain changes the simulation box or atomic positions, allowing us to compute how the energy responds to this perturbation.
           </p>
          </li>
          <li>
           <p>
            <b>
             Finite Difference of Energy
            </b>
            :
   To compute stress, we can perturb the system by applying small strains to the simulation cell and observe how the total energy changes. This method assumes the strain is small, allowing for a linear relationship between stress and strain.
           </p>
           <p>
            The finite difference approach approximates the derivative of the energy with respect to strain:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \sigma_{ij} = -\frac{1}{V} \frac{\partial E}{\partial \epsilon_{ij}}
            </script>
            where
            <span class="matematik">
            </span>
            <script type="math/tex">
             E
            </script>
            is the total energy,
            <span class="matematik">
            </span>
            <script type="math/tex">
             V
            </script>
            is the system volume, and
            <span class="matematik">
            </span>
            <script type="math/tex">
             \epsilon_{ij}
            </script>
            is the strain tensor component.
           </p>
          </li>
         </ul>
        </p>
        <b>
         Step-by-Step Procedure
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            <b>
             Initial Energy Calculation
            </b>
            :
   First, compute the total energy
            <span class="matematik">
            </span>
            <script type="math/tex">
             E_0
            </script>
            of the system in the reference state.
           </p>
          </li>
          <li>
           <p>
            <b>
             Apply Strain
            </b>
            :
   Apply a small strain
            <span class="matematik">
            </span>
            <script type="math/tex">
             \epsilon_{ij}
            </script>
            to the simulation box. For
   instance, to apply strain in the
            <span class="matematik">
            </span>
            <script type="math/tex">
             x
            </script>
            -direction, the simulation box
   may be stretched or compressed by a fraction
            <span class="matematik">
            </span>
            <script type="math/tex">
             (1+\epsilon_{xx})
            </script>
            along the
            <span class="matematik">
            </span>
            <script type="math/tex">
             x
            </script>
            -axis. The atomic positions must be scaled accordingly.
           </p>
          </li>
          <li>
           <p>
            <b>
             Energy Calculation with Strain
            </b>
            :
   Compute the new total energy
            <span class="matematik">
            </span>
            <script type="math/tex">
             E(\epsilon_{ij})
            </script>
            after applying the strain. The difference between the energies before and after strain gives the change in energy due to deformation.
           </p>
          </li>
          <li>
           <p>
            <b>
             Stress Tensor Evaluation
            </b>
            :
   The stress tensor component
            <span class="matematik">
            </span>
            <script type="math/tex">
             \sigma_{ij}
            </script>
            is computed by taking the finite difference of the energy:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \sigma_{ij} = -\frac{E(\epsilon_{ij}) - E_0}{V \cdot \epsilon_{ij}}
            </script>
            This calculation is repeated for each component of the strain tensor.
           </p>
          </li>
          <li>
           <p>
            <b>
             Pressure Evaluation
            </b>
            :
   In two dimensions, the pressure is related to the stress tensor by averaging the diagonal components:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             P = \frac{1}{2} (\sigma_{xx} + \sigma_{yy})
            </script>
            In three dimensions, pressure is given by:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             P = \frac{1}{3} (\sigma_{xx} + \sigma_{yy} + \sigma_{zz})
            </script>
            Negative values of pressure indicate tensile stress (expansion), while positive values represent compressive stress (compression).
           </p>
          </li>
         </ul>
        </p>
        <b>
         Advantages of the Method
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            While the stress and hence pressure can also be obtained from the
virial theorem involving
            <span class="matematik">
            </span>
            <script type="math/tex">
             \sum_i\mathbf{r}_i\cdot \mathbf{F}_i
            </script>
            terms,
the present finite difference approach avoids explicitly evaluating
the virial terms by leveraging total energy, making it useful for
small simulations, where many total energy calculations are doable.
           </p>
          </li>
          <li>
           <p>
            It directly relates mechanical deformations to macroscopic
properties like pressure and elastic constants.
           </p>
          </li>
         </ul>
        </p>
        <b>
         Considerations
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            The strain applied should be small enough to remain in the linear
regime, where the stress-strain relationship is valid.
           </p>
          </li>
          <li>
           <p>
            Accurate energy minimization and system equilibration are crucial for
obtaining reliable stress values.
           </p>
          </li>
         </ul>
        </p>
        <p>
         This method is particularly useful when handling complex interatomic potentials or when the virial theorem might be challenging to apply directly.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_674">
      </div>
      <div class="comments" id="issues_674">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_675">
     <div class="col-11">
      <h3>
       3.3 Barostat
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         A barostat is a method used in molecular dynamics (MD) simulations to
control the pressure by adjusting the simulation cell volume. One of
the common approaches is to employ a first-order differential
equation, which provides a way to dynamically change the volume in
response to pressure fluctuations. Here, we'll first discuss the first-order
differential equation governing a barostat, using the isotropic
         <b>
          Berendsen barostat
         </b>
         as an example, which adjusts the volume in
a manner similar to a first-order response. Then we'll consider how to
make a barostat for anisotropic systems.
        </p>
        <b>
         Berendsen Barostat
        </b>
        <p>
         In the Berendsen barostat, the pressure
         <span class="matematik">
         </span>
         <script type="math/tex">
          P
         </script>
         is controlled by adjusting
the volume
         <span class="matematik">
         </span>
         <script type="math/tex">
          V
         </script>
         of the system to reach a target pressure
         <span class="matematik">
         </span>
         <script type="math/tex">
          P_{\text{target}}
         </script>
         . The adjustment is based on the difference between
the instantaneous pressure
         <span class="matematik">
         </span>
         <script type="math/tex">
          P_{\text{inst}}
         </script>
         and the target pressure,
using a relaxation time
         <span class="matematik">
         </span>
         <script type="math/tex">
          \tau_p
         </script>
         that controls how quickly the volume
responds.
        </p>
        <p>
         For an isotropic volume change, the equation governing the volume
would be:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \frac{dV}{dt} = \frac{V}{\tau_p} \left( \frac{P_{\text{inst}}}{P_{\text{target}}} - 1 \right)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where:
         <ul>
          <p>
          </p>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             V
            </script>
            is the current volume of the simulation box.
           </p>
          </li>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             P_{\text{inst}}
            </script>
            is the instantaneous pressure of the system,
calculated using methods like the virial theorem or stress tensor.
           </p>
          </li>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             P_{\text{target}}
            </script>
            is the target (desired) pressure.
           </p>
          </li>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             \tau_p
            </script>
            is the barostat relaxation time, which controls how quickly
the volume changes in response to pressure differences.
           </p>
          </li>
         </ul>
        </p>
        <b>
         Steps in the Berendsen Barostat
        </b>
        <ul>
         <p>
         </p>
         <li>
          <p>
           <b>
            Compute Instantaneous Pressure
           </b>
           : At each time step in the simulation, calculate the instantaneous pressure
           <span class="matematik">
           </span>
           <script type="math/tex">
            P_{\text{inst}}
           </script>
           , using methods like the virial theorem or stress tensor from the interatomic forces.
          </p>
         </li>
         <li>
          <p>
           <b>
            Update Volume
           </b>
           : The volume is adjusted according to the differential equation, which changes depending on how far the system's current pressure is from the target pressure.
          </p>
         </li>
         <li>
          <p>
           <b>
            Volume Scaling
           </b>
           : Once the volume is updated, atomic positions must be scaled accordingly to preserve the relative geometry within the box. If the box volume changes by a factor
           <span class="matematik">
           </span>
           <script type="math/tex">
            \lambda
           </script>
           , then the positions of the atoms must be scaled by
           <span class="matematik">
           </span>
           <script type="math/tex">
            \lambda^{1/3}
           </script>
           in three dimensions, or
           <span class="matematik">
           </span>
           <script type="math/tex">
            \lambda^{1/2}
           </script>
           in two dimensions.
          </p>
         </li>
         <li>
          <p>
           <b>
            Update Simulation Box
           </b>
           : Adjust the simulation box dimensions (e.g., for cubic or orthorhombic cells) based on the new volume.
          </p>
         </li>
        </ul>
        <b>
         Anisotropic barostat
        </b>
        <p>
         The
         <b>
          pressure
         </b>
         is a scalar quantity, which in isotropic systems
represents the average normal stress (trace of the stress tensor
divided by the dimensionality). However, in an anisotropic system
(e.g., crystals), each strain component can evolve independently,
meaning different directions may experience different stresses (normal
and shear components).
        </p>
        <p>
         For example:
         <ul>
          <p>
          </p>
          <li>
           <p>
            A cubic crystal might experience different normal stresses along the
x, y, and z directions.
           </p>
          </li>
          <li>
           <p>
            Shear stresses could also exist if the crystal experiences deformation
that isn't just a uniform expansion or compression.
           </p>
          </li>
         </ul>
        </p>
        <p>
         To evolve the system in a physically consistent manner, the
         <b>
          stress tensor
         </b>
         (which includes both normal and shear
components) should be used, and the corresponding
         <b>
          strain
  tensor
         </b>
         (which includes both volumetric and shear strains) should be
adjusted accordingly.
        </p>
        <b>
         Barostat Based on Stress Tensor
        </b>
        <p>
         A barostat that responds to the full
         <b>
          stress tensor
         </b>
         would
adjust the simulation cell (via the strain tensor) in all six
independent directions:
         <ul>
          <p>
          </p>
          <li>
           <p>
            Three normal components (xx, yy, zz) related to normal stresses.
           </p>
          </li>
          <li>
           <p>
            Three shear components (xy, xz, yz) related to shear stresses.
           </p>
          </li>
         </ul>
        </p>
        <p>
         For each step in the simulation, the barostat would:
         <ul>
          <p>
          </p>
          <li>
           <p>
            Calculate the
            <b>
             stress tensor
            </b>
            (which includes all six
components).
           </p>
          </li>
          <li>
           <p>
            Compare the calculated stress tensor to the target stress tensor
(e.g., zero stress for constant pressure).
           </p>
          </li>
          <li>
           <p>
            Adjust the strain components based on this comparison using a
first-order differential equation or a related update scheme.
           </p>
          </li>
         </ul>
        </p>
        <b>
         Barostat Differential Equation
        </b>
        <p>
         For a barostat that includes the full stress tensor, the evolution of the simulation cell
         <span class="matematik">
         </span>
         <script type="math/tex">
          h(t)
         </script>
         (a matrix representing the cell vectors) could follow a first-order differential equation like:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \frac{d h(t)}{dt} = \gamma \cdot \left( \boldsymbol{\sigma}(t) - \boldsymbol{\sigma}_{\text{target}} \right) \cdot h(t)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         where:
         <ul>
          <p>
          </p>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             \boldsymbol{\sigma}(t)
            </script>
            is the current stress tensor.
           </p>
          </li>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             \boldsymbol{\sigma}_{\text{target}}
            </script>
            is the target stress tensor
(e.g., the identity matrix for zero stress or constant pressure).
           </p>
          </li>
          <li>
           <p>
            <span class="matematik">
            </span>
            <script type="math/tex">
             \gamma
            </script>
            is a scaling factor that controls how fast the barostat
adjusts the simulation box.
           </p>
          </li>
         </ul>
        </p>
        <p>
         This approach allows the simulation box to evolve in a way that accommodates both
         <b>
          normal stresses
         </b>
         (which change the volume) and
         <b>
          shear stresses
         </b>
         (which distort the shape of the box).
        </p>
        <b>
         Conclusion
        </b>
        <p>
         In anisotropic systems or crystals, using only the scalar pressure is insufficient to describe the full state of the system's stress. A
         <b>
          stress tensor-based barostat
         </b>
         is necessary to account for both normal and shear stresses, ensuring that the simulation can evolve strain components independently and appropriately.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_675">
      </div>
      <div class="comments" id="issues_675">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_676">
     <div class="col-11">
      <h3>
       3.4 T-V phase diagram
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In a constant temperature (
         <span class="matematik">
         </span>
         <script type="math/tex">
          T
         </script>
         ) and constant pressure (
         <span class="matematik">
         </span>
         <script type="math/tex">
          p = 0
         </script>
         )
simulation, the system is allowed to adjust its volume while
maintaining the target temperature and pressure conditions. This type
of simulation is often performed to construct
         <b>
          T-V phase
  diagrams
         </b>
         , which map the volume (
         <span class="matematik">
         </span>
         <script type="math/tex">
          V
         </script>
         ) as a function of temperature (
         <span class="matematik">
         </span>
         <script type="math/tex">
          T
         </script>
         )
for different phases of a material, such as crystal structures.
        </p>
        <b>
         Procedure
        </b>
        <ul>
         <p>
         </p>
         <li>
          <p>
           <b>
            Initialization
           </b>
           : Begin with a crystal structure at a low temperature and pressure set to zero (p = 0). You adjust the volume and let the system equilibrate.
          </p>
         </li>
         <li>
          <p>
           <b>
            Heating phase
           </b>
           : Gradually increase the temperature step-by-step, allowing the system to reach equilibrium at each new temperature. As you heat the system, the crystal structure can undergo a
           <b>
            phase transition
           </b>
           (e.g., from a solid to a liquid phase or between different crystal structures) at a certain critical temperature.
          </p>
         </li>
         <li>
          <p>
           <b>
            Cooling phase
           </b>
           : After reaching a high temperature, you gradually cool the system down. During this process, the system may return to its initial phase or get trapped in a
           <b>
            meta-stable state
           </b>
           (i.e., a state that is not the global free energy minimum but is locally stable). This is where hysteresis can appear: the phase transition temperatures during heating and cooling may differ, showing history dependence of the process.
          </p>
         </li>
        </ul>
        <b>
         Explanation of the Phase Transition
        </b>
        <p>
         The phase transition occurs during heating due to the competition between
         <b>
          thermal energy
         </b>
         and the
         <b>
          potential energy
         </b>
         of the crystal lattice. At low temperatures, the system favors configurations that minimize the potential energy, i.e., ordered crystal phases. As temperature increases, the system's thermal energy increases, and this causes atoms or molecules to vibrate more vigorously. Eventually, thermal energy becomes comparable to or exceeds the energy barrier between different phases, causing the system to transition to a new phase that is more thermodynamically favorable at higher temperatures.
        </p>
        <p>
         The temperature at which this phase transition occurs depends on the interplay between entropic and enthalpic contributions to the free energy. High temperatures favor phases with higher entropy, such as liquid phases or disordered crystals.
        </p>
        <b>
         Impact of Simulation Cell Size
        </b>
        <p>
         The
         <b>
          finite size
         </b>
         of the simulation cell can significantly
affect the observed phase transitions:
         <ul>
          <p>
          </p>
          <li>
           <p>
            In small systems,
            <b>
             finite-size effects
            </b>
            cause the system to
fluctuate more and may alter the temperature at which a phase
transition occurs. This is because phase transitions in finite systems
are smoother compared to sharp transitions in bulk materials.
           </p>
          </li>
          <li>
           <p>
            <b>
             Nucleation
            </b>
            : For phase transitions to occur, regions of the
new phase need to nucleate and grow. In a small simulation cell, these
nucleation events are constrained, which can delay or prevent the
phase transition, leading to
            <b>
             superheating
            </b>
            or
            <b>
             supercooling
            </b>
            (i.e., the system staying in the original phase
longer than expected).
           </p>
          </li>
         </ul>
        </p>
        <p>
         Due to these factors, the observed
         <b>
          transition temperatures
         </b>
         and behaviors in finite systems might differ from those expected in a large bulk system. This often results in
         <b>
          hysteresis
         </b>
         , where the transition temperature during heating does not match the transition temperature during cooling.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/chap7_cover.png">
              <img class="img-fluid" src="images/56.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_676">
      </div>
      <div class="comments" id="issues_676">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 36
     </h1>
    </div>
    <div class="row spy-padding" id="block_702">
     <div class="col-11">
      <h3>
       4.1 Periodicity
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Implement the periodicity in your simulation code. Use the minimum
image convention as explained in the molecular dynamics
         <a href="https://pubs.aip.org/aapt/ajp/article/88/5/401/1056833" target="_blank">
          article
         </a>
         . Here
is figure 2 from that paper:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/md_article_fig2.jpeg">
              <img class="img-fluid" src="images/57.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_702">
      </div>
      <div class="comments" id="issues_702">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_703">
     <div class="col-11">
      <h3>
       4.2 Cluster
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Test your implementation by setting up a cluster with the class you
had before implementing the periodicity:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_36_fig1b.png">
              <img class="img-fluid" src="images/57.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Now do the same with your new class:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_36_fig2b.png">
              <img class="img-fluid" src="images/57.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         and verify that you get the same energy irrespective of where you
place the cluster. The right-most plot is further plotting atoms
through the periodic boundary conditions to help humans assess the structure.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_703">
      </div>
      <div class="comments" id="issues_703">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_704">
     <div class="col-11">
      <h3>
       4.3 Crystal
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Setup a cell with
         <span class="matematik">
         </span>
         <script type="math/tex">
          N
         </script>
         atoms in a periodic arrangement as a
crystal. Duplicate the cell in both directions and place
         <span class="matematik">
         </span>
         <script type="math/tex">
          4N
         </script>
         atoms at
positions so that the same system is modelled.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_36_fig3.png">
              <img class="img-fluid" src="images/57.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Explain why the energy is not just increased by a factor 4.
        </p>
        <p>
         d) Repeat for a larger system:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_36_fig4.png">
              <img class="img-fluid" src="images/57.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         and see that you get closer to a factor 4 increase in energy.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_704">
      </div>
      <div class="comments" id="issues_704">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_705">
     <div class="col-11">
      <h3>
       4.4 Forces
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         e) Relax some of your systems under periodic boundary conditions and
observed that the forces respect the periodic boundary
conditions.
        </p>
        <p>
         Here for instance, one atom is moved (the middle image) and in the
subsequent relaxation, it relaxes back.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_36_fig5.png">
              <img class="img-fluid" src="images/57.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         It might be easier to plot (or
print out) the forces and see that they are correct compared to what
you get with the non-periodic code you have been using up to now.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_705">
      </div>
      <div class="comments" id="issues_705">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 37
     </h1>
    </div>
    <div class="row spy-padding" id="block_694">
     <div class="col-11">
      <h3>
       5.1 Thermal expansion
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This exercise is about modeling the thermal expansion of a crystal
that is heated up while allowed to expand.
        </p>
        <p>
         a) Implement the stress and pressure evaluation. Test it on the
perfect crystal structure you formed in the previous exercise. When
you vary the volume around the equilibrium volume, the energy should
go up and the sign of the pressure should be correct.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_37_fig1.png">
              <img class="img-fluid" src="images/58.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         b) Implement a
         <span class="matematik">
         </span>
         <script type="math/tex">
          p=0
         </script>
         -barostat and test that it will bring the pressure
to zero by adjusting the volume
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_37_fig2.png">
              <img class="img-fluid" src="images/58.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_37_fig3.png">
              <img class="img-fluid" src="images/58.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_694">
      </div>
      <div class="comments" id="issues_694">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_695">
     <div class="col-11">
      <h3>
       5.2 Heating and melting
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Setup a system with at least 20-30 Lennard-Jones atoms in two
dimensions. Run it at pressure
         <span class="matematik">
         </span>
         <script type="math/tex">
          p=0
         </script>
         at subsequently increasing temperatures. Plot the
thermally averaged energy and volume at the considered temperatures.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_37_fig4.png">
              <img class="img-fluid" src="images/58.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         d) Inspect the structure to see what happened during the heating
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_37_fig5.png">
              <img class="img-fluid" src="images/58.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         e) Consider determining from the volume curve at small temperatures the linear expansion
coefficient of this material.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_695">
      </div>
      <div class="comments" id="issues_695">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_696">
     <div class="col-11">
      <h3>
       5.3 Cooling
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         f) Now cool the system again and look for hysteresis behavior. Perhaps
relate the result to your experience with simulated annealing.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_696">
      </div>
      <div class="comments" id="issues_696">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 38
     </h1>
    </div>
    <div class="row spy-padding" id="block_698">
     <div class="col-11">
      <h3>
       6.1 Lennard-Jones-Gauss clusters
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This exercise is about implementing the Lennard-Jones-Gauss potential
and collecting some relaxed clusters for further analysis.
        </p>
        <p>
         a) Use the parameters that Meldgaard uses for LJG
         <span class="matematik">
         </span>
         <script type="math/tex">
          _{19}
         </script>
         .
        </p>
        <p>
         b) Verify that the global minimum energy structure reported is better
that anything you find with your preferred global optimization method
applied to this systems.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_38_fig1.png">
              <img class="img-fluid" src="images/59.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_698">
      </div>
      <div class="comments" id="issues_698">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_699">
     <div class="col-11">
      <h3>
       6.2 Smaller LJG clusters
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Run searches a large number of times for a smaller LJG-particle. Relax the found structures
fully.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_38_fig2.png">
              <img class="img-fluid" src="images/59.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_699">
      </div>
      <div class="comments" id="issues_699">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_700">
     <div class="col-11">
      <h3>
       6.3 Clustering
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Cluster them into groups (="clusters", but the term will be
avoided for clarity).
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_38_fig3.png">
              <img class="img-fluid" src="images/59.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         e) Form a histogram where each bar shows how many
members the groups have, i.e. how many times a search led to finding
an atomic cluster belonging to that group. Have the bars placed
according to the energy of the most stable atomic cluster in each
group.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_38_fig4.png">
              <img class="img-fluid" src="images/59.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_700">
      </div>
      <div class="comments" id="issues_700">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_701">
     <div class="col-11">
      <h3>
       6.4 Save the results
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         f) Keep the structures for the next exercise. Remember this writes the
positions to the disk:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
positions = np.array([cluster.get_positions() for cluster in annealed_clusters])
np.savetxt('ljg12clusters.txt', positions.reshape(positions.shape[0], -1), fmt='%f')
</pre>
        <p>
         and this reads them in again:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
pos_flat = np.loadtxt('ljg12clusters.txt')
positions_in_file = pos_flat.reshape(-1,pos_flat.shape[1]//2,2)
</pre>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_701">
      </div>
      <div class="comments" id="issues_701">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 39
     </h1>
    </div>
    <div class="row spy-padding" id="block_709">
     <div class="col-11">
      <h3>
       7.1 Bundled energies
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this execise you will implement the method of Meldgaard
         <i>
          et al
         </i>
         for extracting local energies from
data only containing global energies. You will be using the atomic
clusters from the previous exercise.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_709">
      </div>
      <div class="comments" id="issues_709">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_710">
     <div class="col-11">
      <h3>
       7.2 Load data
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Start by loading the data from the previous exercise and reconstruct
the clusters. Plot some of them to be sure that this has been successful.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_39_fig1.png">
              <img class="img-fluid" src="images/60.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_710">
      </div>
      <div class="comments" id="issues_710">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_711">
     <div class="col-11">
      <h3>
       7.3 Local descriptor
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         So far, the descriptor we have used were
         <b>
          global
         </b>
         meaning that
they described the entire cluster. To implement the method for finding
local energies we need a
         <b>
          local
         </b>
         descriptor, where every atom
is characterized on its own.
        </p>
        <p>
         Start from the
         <code class="prettyprint python">
          PairDistances
         </code>
         class of exercise 20:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class PairDistances():
    
    def __init__(self, color='C1'):
        self.xwidth = 0.5
        self.color = color
        self.bin_edges = np.arange(0,7.01,self.xwidth)
        self.bin_centers = (self.bin_edges[:-1] + self.bin_edges[1:]) /2
    
    def descriptor(self,pos):
        bars, _ = np.histogram(pdist(pos),self.bin_edges)
        return bars
    
    def draw(self,pos,ax):
        vector = self.descriptor(pos)
        ax.bar(self.bin_centers,vector,width=0.8 * self.xwidth,color=self.color)
        ax.xaxis.set_major_locator(plt.MultipleLocator(1.0))
        ax.set_ylim([0,20.1])
        ax.set_title(self.__class__.__name__)
    
pair_distances = PairDistances()
</pre>
        <p>
         but rewrite it so it returns a list of 14-component vectors, one for
each atom. I.e. the output could look like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
&gt;&gt; read_in_clusters[0].descriptor
[array([0, 3, 0, 4, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0]),
 array([0, 2, 2, 2, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0]),
 array([0, 3, 0, 4, 0, 2, 1, 1, 0, 0, 0, 0, 0, 0]),
 array([0, 2, 0, 3, 0, 4, 0, 1, 1, 0, 0, 0, 0, 0]),
 array([0, 0, 0, 3, 3, 0, 3, 1, 1, 0, 0, 0, 0, 0]),
 array([0, 1, 1, 3, 1, 2, 2, 1, 0, 0, 0, 0, 0, 0]),
 array([0, 2, 0, 4, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0]),
 array([0, 2, 0, 4, 0, 3, 2, 0, 0, 0, 0, 0, 0, 0]),
 array([0, 4, 0, 5, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0]),
 array([0, 4, 0, 4, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0]),
 array([0, 4, 1, 5, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0]),
 array([0, 3, 0, 7, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0])]
</pre>
        <p>
         where
         <code class="prettyprint python">
          read_in_clusters
         </code>
         are all your reconstructed
atomic clusters, and
         <code class="prettyprint python">
          read_in_clusters[0]
         </code>
         hence
just a single of them.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_711">
      </div>
      <div class="comments" id="issues_711">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_712">
     <div class="col-11">
      <h3>
       7.4 Clustering
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Collect all local descriptors for all atomic clusters in one array. If
you have 100 atomic clusters with 12 atoms, this array has 1200
descriptors (each with 14 features). Do K-means clustering of these
descriptors. Plot again the atomic clusters, but color the atoms
according to the cluster they belong to.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_39_fig2.png">
              <img class="img-fluid" src="images/60.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_712">
      </div>
      <div class="comments" id="issues_712">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_713">
     <div class="col-11">
      <h3>
       7.5 Extract local energies
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Fit the global energies of the atomic clusters with energies for each k-means
cluster using ridge regression as outlined in the Meldgaard
paper. Plot the correlation of the exact Lennard-Jones-Gauss local
energies with the extracted local energies. The exact local energies
are calculated as the sum of half the bond energy for each bond
an atom is involed in.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_39_fig3.png">
              <img class="img-fluid" src="images/60.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_713">
      </div>
      <div class="comments" id="issues_713">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 40
     </h1>
    </div>
    <div class="row spy-padding" id="block_723">
     <div class="col-11">
      <h3>
       8.1 LJG
       <span class="matematik">
       </span>
       <script type="math/tex">
        (r_0,\varepsilon)
       </script>
       -diagram
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Use simulated annealing and/or volume-controlled simulations (cycles
of expansion/compression at constant
         <span class="matematik">
         </span>
         <script type="math/tex">
          T
         </script>
         ) to identify some of the
known crystal structures that LJG atoms form in 2D. Pick the
parameters in interesting regions from this plot:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/ljg_article_fig2.png">
              <img class="img-fluid" src="images/61.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_723">
      </div>
      <div class="comments" id="issues_723">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_724">
     <div class="col-11">
      <h3>
       8.2 Constant pressure
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this approach, you use the NpT-thermostat (= simultaneous
application of a thermostat and a
barostat) with a target pressure of
zero. The temperature is your controlable and the simulation adjusts
the volume to have zero pressure.
        </p>
        <p>
         To keep the simulation time small, you might want to start from a
guesses solution, like e.g.:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_40_fig1.png">
              <img class="img-fluid" src="images/61.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         which is the equilibrium crystal structure at
         <span class="matematik">
         </span>
         <script type="math/tex">
          \varepsilon=2
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          r_0=1.9
         </script>
         .
        </p>
        <p>
         Now heating and cooling the crystal you would expect to recover this
structure. However, due to the finite simulation times we can afford,
that is often not the case and the preferred structure is not found
during the cooling. This is a general problem with the simulated annealing approach.
        </p>
        <p>
         For one particular run, it may look like:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_40_fig4.png">
              <img class="img-fluid" src="images/61.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Clearly  we end up in a less stable structure after the cooling. Here are
snapshots of the 19 structures behind the above diagram:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_40_fig5.png">
              <img class="img-fluid" src="images/61.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_724">
      </div>
      <div class="comments" id="issues_724">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_725">
     <div class="col-11">
      <h3>
       8.3 Volume-controlled
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         As an alternative, we can use the volume as the controlable variable
and run with an NVT thermostat. With this approach, the pressure can
become large during a compression phase and help force the atoms into
favorable crystal structures that remain during a subsequent expansion
phase.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_40_fig8.png">
              <img class="img-fluid" src="images/61.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         With these snapshots:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/8/img/exercise_40_fig9.png">
              <img class="img-fluid" src="images/61.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Notice how this approach finds two crystal structures (the square and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \sigma
         </script>
         -1 phases from the
         <a href="https://journals.aps.org/prl/abstract/10.1103/PhysRevLett.98.225505" target="_blank">
          article
         </a>
         ).
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_725">
      </div>
      <div class="comments" id="issues_725">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Week 8
     </h1>
    </div>
    <div class="row spy-padding" id="block_771">
     <div class="col-11">
      <h3>
       1.1 Introduction
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This week is about:
         <ul>
          <p>
          </p>
          <li>
           <p>
            Installing and using
            <code class="prettyprint python">
             pytorch
            </code>
           </p>
          </li>
          <li>
           <p>
            Get derivatives automatically, i.e. without evaluating them analytically.
           </p>
          </li>
          <li>
           <p>
            Use the derivatives in optimization problems involving masses
  connected by springs or atoms interacting via Lennard-Jones-Gauss
  potentials.
           </p>
          </li>
          <li>
           <p>
            All this will prepare you to work with deep learning neural networks
  in week 9.
           </p>
          </li>
         </ul>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_771">
      </div>
      <div class="comments" id="issues_771">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_772">
     <div class="col-11">
      <h3>
       1.2 TØ programme
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
        </p>
        <b>
         Before TØ 1
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            Install
            <code class="prettyprint python">
             pytorch
            </code>
            .
           </p>
          </li>
          <li>
           <p>
            Read some of the official pytorch tutorial website or watch some of the
  official pytorch tutorial video.
           </p>
          </li>
         </ul>
        </p>
        <b>
         TØ 1
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            Run the
            <code class="prettyprint python">
             .ipynb
            </code>
            -Notebook from the
  lecture. Available at Brightspace.
           </p>
          </li>
          <li>
           <p>
            Do exercises 41-43.
           </p>
          </li>
         </ul>
        </p>
        <b>
         TØ 2
        </b>
        <p>
         <ul>
          <p>
          </p>
          <li>
           <p>
            Do exercises 44-47.
           </p>
          </li>
         </ul>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_772">
      </div>
      <div class="comments" id="issues_772">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      External resources
     </h1>
    </div>
    <div class="row spy-padding" id="block_720">
     <div class="col-11">
      <h3>
       2.1 pytorch vs tensorflow
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         If you heard about tensorflow and wonder why we do not use that in
this course, you can get a comparison of the two methods in this
         <a href="https://opencv.org/blog/pytorch-vs-tensorflow/" target="_blank">
          blog post
         </a>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_720">
      </div>
      <div class="comments" id="issues_720">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_721">
     <div class="col-11">
      <h3>
       2.2 Pytorch
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Here is a
         <a href="https://pytorch.org/tutorials/beginner/basics/intro.html" target="_blank">
          tutorial
         </a>
        </p>
        <p>
         Here is a
         <a href="https://pytorch.org/tutorials/beginner/introyt.html" target="_blank">
          video
  tutorial
         </a>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_721">
      </div>
      <div class="comments" id="issues_721">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_722">
     <div class="col-11">
      <h3>
       2.3 Installing pytorch
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Choose "Environments" in Anaconda:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/uge8_install_1.png">
              <img class="img-fluid" src="images/63.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         If you want a new environment, create that! Otherwise, proceed!
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/uge8_install_2.png">
              <img class="img-fluid" src="images/63.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Choose the environment for which you want to install pytorch:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/uge8_install_3.png">
              <img class="img-fluid" src="images/63.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Open a terminal:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/uge8_install_4.png">
              <img class="img-fluid" src="images/63.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Write the install commands in the terminal:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/uge8_install_5.png">
              <img class="img-fluid" src="images/63.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Launch a jupyter notebook with this environment:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/uge8_install_6.png">
              <img class="img-fluid" src="images/63.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_722">
      </div>
      <div class="comments" id="issues_722">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Tutorial
     </h1>
    </div>
    <div class="row spy-padding" id="block_879">
     <div class="col-11">
      <h3>
       3.1
       <code class="prettyprint python">
        tensor
       </code>
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Working with
         <code class="prettyprint python">
          PyTorch
         </code>
         is to a large extend like
working with
         <code class="prettyprint python">
          numpy
         </code>
         . You can write:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
import torch
import matplotlib.pyplot as plt

xs = torch.tensor([1, 2, 3])
ys = xs**2
print(xs,ys)

fig, ax = plt.subplots()
ax.plot(xs,ys)
</pre>
        <p>
         and get some arrays, now called
         <b>
          tensors
         </b>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
tensor([1, 2, 3]) tensor([1, 4, 9])
</pre>
        <p>
         There are many helper functions for making tensors in PyTorch, e.g.:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
torch.zeros(2)
torch.ones(3)
torch.linspace(1, 2, 3)
torch.arange(1, 2, 0.5)
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_879">
      </div>
      <div class="comments" id="issues_879">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_880">
     <div class="col-11">
      <h3>
       3.2
       <code class="prettyprint python">
        autograd.grad
       </code>
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The whole point of
         <code class="prettyprint python">
          PyTorch
         </code>
         is that you can get
the derivative of some calculated expression. To get that you indicate
that your tensor is part of a graph by adding
         <code class="prettyprint python">
          requires_grad=True
         </code>
         when defining it, and you use
         <code class="prettyprint python">
          torch.autograd.grad
         </code>
         like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
ps = torch.tensor([1.0, 2, 3], requires_grad=True)
qs = ps**2
print(ps)
print(qs)
dq_dp = torch.autograd.grad(qs, ps, torch.ones_like(ps))[0]
print(dq_dp)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
tensor([1., 2., 3.], requires_grad=True)
tensor([1., 4., 9.], grad_fn=&lt;PowBackward0&gt;)
tensor([2., 4., 6.])
</pre>
        <p>
         If you inspect the numbers you can see that PyTorch evaluated:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
    p&=&\begin{bmatrix}1,&2,&3\end{bmatrix}\\
    &&\\
    q&=&p^2\\
    &&\\
    \displaystyle\frac{dq}{dp}&=&2p
  \end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Beware:
         <ul>
          <p>
          </p>
          <li>
           <p>
            The
            <code class="prettyprint python">
             ps
            </code>
            -tensor deliberately has a non-integer
  element in its definition as autodifferentiation requires
  floating-points. This could also be achieved by writing:
            <pre class="prettyprint python mb-0">
    ps = torch.tensor([1, 2, 3], requires_grad=True, dtype=torch.float32)
</pre>
           </p>
          </li>
          <li>
           <p>
            The
            <code class="prettyprint python">
             ps
            </code>
            and
            <code class="prettyprint python">
             qs
            </code>
            tensors are
  now part of graphs, and as such they cannot be used directly for
  e.g. plotting. See more in the next section.
           </p>
          </li>
          <li>
           <p>
            The
            <code class="prettyprint python">
             torch.autograd.grad
            </code>
            method can do a lot of
  things, and by providing the third argument,
            <code class="prettyprint python">
             torch.ones_like(ps)
            </code>
            , we force it to return:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \begin{bmatrix}
      \displaystyle\frac{d q_0}{d p_0},&
      \displaystyle\frac{d q_1}{d p_1},&
      \dots
      \displaystyle\frac{d q_N}{d p_N}
    \end{bmatrix}
            </script>
            which is the desired
            <span class="matematik">
            </span>
            <script type="math/tex">
             q(p)
            </script>
            evaluated at
            <span class="matematik">
            </span>
            <script type="math/tex">
             p=\begin{bmatrix}p_0,&p_1,&\dots p_N\end{bmatrix}
            </script>
            and does not
  contain elements such as
            <span class="matematik">
            </span>
            <script type="math/tex">
             \displaystyle\frac{d q_i}{d p_j}, i\ne j
            </script>
            that
            <code class="prettyprint python">
             torch.autograd.grad
            </code>
            can also calculate.
           </p>
          </li>
          <li>
           <p>
            The
            <code class="prettyprint python">
             [0]
            </code>
            after
            <code class="prettyprint python">
             torch.autograd.grad
            </code>
            is required since a tuple
  with the derivative inside is returned.
           </p>
          </li>
          <li>
           <p>
            <code class="prettyprint python">
             torch.autograd.grad
            </code>
            is a wrapper that does a
  number of things. You can actually build the derivative
  element-by-element in the following way:
            <pre class="prettyprint python mb-0">
ps = torch.tensor([1.0, 2, 3])
qs = []
dq_dps = []
for p in ps:
    p.requires_grad_(True)
    q = p**2     # this is the forward-part of the derivative evaluation
    q.backward()
    dq_dp = p.grad
    qs.append(q.detach())
    dq_dps.append(dq_dp.detach())
print(ps)
print(qs)
print(dq_dps)
</pre>
            and get the same result:
            <pre class="prettyprint celloutput mb-0">
tensor([1., 2., 3.])
[tensor(1.), tensor(4.), tensor(9.)]
[tensor(2.), tensor(4.), tensor(6.)]
</pre>
           </p>
          </li>
         </ul>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_880">
      </div>
      <div class="comments" id="issues_880">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_881">
     <div class="col-11">
      <h3>
       3.3
       <code class="prettyprint python">
        with torch.no_grad():
       </code>
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         As noted above, torch tensors that are part of a graph cannot be used
directly for e.g. plotting with matplotlib. This can be remedied in
various ways, e.g.:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
fig, ax = plt.subplots()
with torch.no_grad():
    ax.plot(ps,qs)
</pre>
        <p>
         or:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
fig, ax = plt.subplots()
ax.plot(ps.detach(),qs.detach())
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_881">
      </div>
      <div class="comments" id="issues_881">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_882">
     <div class="col-11">
      <h3>
       3.4 Higher derivatives
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         If you find the first derivative with
         <code class="prettyprint python">
          autograd.grad
         </code>
         with the intension of later on
taking higher derivatives, you need to tell
         <code class="prettyprint python">
          autograd.grad
         </code>
         to build a graph while
evaluating.
        </p>
        <p>
         Without telling, the first derivative has no graph:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
xs = torch.tensor([1.0, 2, 3], requires_grad=True)
fs = xs**3 / 3
dfdxs_no_graph = torch.autograd.grad(fs, xs, grad_outputs=torch.ones_like(xs))[0]
print(dfdxs_no_graph)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
tensor([1., 4., 9.])
</pre>
        <p>
         But adding
         <code class="prettyprint python">
          create_graph=True
         </code>
         to
         <code class="prettyprint python">
          autograd.grad
         </code>
         it has and the second derivative
can be taken:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
fs = xs**3 / 3 # must be calculated a 2nd time since the above torch.autograd.grad already did a backward pass
dfdxs = torch.autograd.grad(fs, xs, grad_outputs=torch.ones_like(xs), create_graph=True)[0]
d2fdx2s = torch.autograd.grad(dfdxs, xs, grad_outputs=torch.ones_like(xs))[0]
print(dfdxs)
print(d2fdx2s)
</pre>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
tensor([1., 4., 9.], grad_fn=&lt;MulBackward0&gt;)
tensor([2., 4., 6.])
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_882">
      </div>
      <div class="comments" id="issues_882">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_883">
     <div class="col-11">
      <h3>
       3.5
       <code class="prettyprint python">
        torch.nn.Module
       </code>
       I
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Whenever you want to use PyTorch for optimization, it is convenient to
introduce a model using the
         <code class="prettyprint python">
          torch.nn.Module
         </code>
         class. An example implementing a method fitting a straight line would
look like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class Line(torch.nn.Module):
    
    def __init__(self, w=1, b=0):
        super().__init__()
        self.b = torch.nn.Parameter(torch.tensor(float(w)))
        self.w = torch.nn.Parameter(torch.tensor(float(b)))

    def forward(self, x):
        y = self.w * x + self.b
        return y
</pre>
        <p>
         The values for
         <code class="prettyprint python">
          w
         </code>
         and
         <code class="prettyprint python">
          b
         </code>
         are
set during instantiation. The
         <code class="prettyprint python">
          torch.nn.Parameter()
         </code>
         statements take care of storing these variables with the
         <code class="prettyprint python">
          .requires_grad=True
         </code>
         setting so that
autodifferentiation can be done on whatever the model (and outside
code-pieces) calculate based on these parameters.
        </p>
        <p>
         The model has a
         <code class="prettyprint python">
          forward
         </code>
         -method, which is the one
that is used if the model is called. Here, the method receives some
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -values and calculates what the linear function
         <span class="matematik">
         </span>
         <script type="math/tex">
          f: f(x)=wx+b
         </script>
         would give for them with the current values of
         <span class="matematik">
         </span>
         <script type="math/tex">
          w
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          b
         </script>
         . A tensor
with the results is returned.
        </p>
        <p>
         As an example, we now let the straight line be defined by four data points without noise:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
xs = torch.arange(1, 2, 0.25)
w_target = 4
b_target = -2
ys =  w_target * xs + b_target
xs, ys
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
(tensor([1.0000, 1.2500, 1.5000, 1.7500]), tensor([2., 3., 4., 5.]))
</pre>
        <p>
         Instantiating the model, we can pass it our
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -values and see what
it predits with its initial parameters.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
line = Line()
line(xs)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
tensor([1., 1., 1., 1.], grad_fn=&lt;AddBackward0&gt;)
</pre>
        <p>
         which matches that the model has
         <span class="matematik">
         </span>
         <script type="math/tex">
          w=1
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          b=0
         </script>
         initially.
        </p>
        <p>
         An optimizer is introduced:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
optimizer = torch.optim.Adam(line.parameters(), lr=0.01)
</pre>
        <p>
         and the
         <code class="prettyprint python">
          line.parameters()
         </code>
         lets our instance of
the model
         <code class="prettyprint python">
          Line
         </code>
         inform the optimizer about what
parameters may be optimized.
        </p>
        <p>
         With the optimizer instantiated and informed about free parameters,
a loop can be conducted in which:
         <ul>
          <p>
          </p>
          <li>
           <p>
            the optimizer prepares for a new calculation of the gradient
  of a loss function
           </p>
          </li>
          <li>
           <p>
            the model calculates the
            <span class="matematik">
            </span>
            <script type="math/tex">
             f(x)
            </script>
            for all
            <span class="matematik">
            </span>
            <script type="math/tex">
             x
            </script>
            -values and a loss
  function is contructed:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \mathcal{Loss}=\sum_i\left|f(x_i) - y_i\right|^2
            </script>
            where
            <span class="matematik">
            </span>
            <script type="math/tex">
             \{y_i\}
            </script>
            are the known function values corresponding to
            <span class="matematik">
            </span>
            <script type="math/tex">
             \{x_i\}
            </script>
            .
           </p>
          </li>
          <li>
           <p>
            autodifferentiation is used to calculate the gradient of the loss
  with respect to the optimizable parameters (here with respect to
            <code class="prettyprint python">
             w
            </code>
            and
            <code class="prettyprint python">
             b
            </code>
            on the model):
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \left(\displaystyle\frac{d}{dw}\mathcal{Loss}, \displaystyle\frac{d}{db}\mathcal{Loss}\right)
            </script>
           </p>
          </li>
          <li>
           <p>
            the optimizer updates the optimizable parameters
           </p>
          </li>
         </ul>
         It looks like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
steps = 10000
for step in range(steps):
    optimizer.zero_grad()

    ys_model = line(xs)
    loss = torch.mean((ys_model - ys)**2)
    loss.backward()
    
    optimizer.step()

    if step % 1000 == 0:
        print(f'Step {step}, Loss: {loss.item()}')
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
Step 0, Loss: 7.5
Step 1000, Loss: 0.345175564289093
Step 2000, Loss: 0.06778551638126373
Step 3000, Loss: 0.0036803651601076126
Step 4000, Loss: 2.5285717129008844e-05
Step 5000, Loss: 5.567969196818012e-09
Step 6000, Loss: 5.286437954055145e-12
Step 7000, Loss: 9.805489753489383e-13
Step 8000, Loss: 1.1368683772161603e-13
Step 9000, Loss: 1.1368683772161603e-13
</pre>
        <p>
         After the completion of the loop, the optimized parameters can be
inspected directly via the attributes we know they are stored under:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
line.w, line.b
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
(Parameter containing:
 tensor(4.0000, requires_grad=True),
 Parameter containing:
 tensor(-2.0000, requires_grad=True))
</pre>
        <p>
         Or one can do it more elegantly in this way:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
for name, parameter in line.named_parameters():
    print(name,':',parameter.data)
</pre>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
b : tensor(-2.0000)
w : tensor(4.0000)
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_883">
      </div>
      <div class="comments" id="issues_883">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_884">
     <div class="col-11">
      <h3>
       3.6
       <code class="prettyprint python">
        torch.nn.Module
       </code>
       II
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Here is a 2nd example of a PyTorch model used for optimization. This
time, the objective is to find the center of mass of a set of (equally
heavy) particles in one dimension.
        </p>
        <p>
         The model looks like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class CM(torch.nn.Module):
    
    def __init__(self, cm=1):
        super().__init__()
        self.cm = torch.nn.Parameter(torch.tensor(float(cm)))
        
    def forward(self, x):
        distances = x - self.cm
        return distances
</pre>
        <p>
         To use the model, we make eight random
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -positions and let them have
a center of mass of 5, so that we know what to expect from the optimization:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
xs = torch.randn(8)
xs -= torch.mean(xs)
xs *= 2
xs += 5
xs
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
tensor([5.0007, 3.2004, 8.3075, 6.3952, 4.2812, 2.4183, 5.7610, 4.6357])
</pre>
        <p>
         The model can now be instantiated and its forward-method called:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
cm = CM()
cm(xs)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
tensor([4.0007, 2.2004, 7.3075, 5.3952, 3.2812, 1.4183, 4.7610, 3.6357],
       grad_fn=&lt;SubBackward0&gt;)
</pre>
        <p>
         An optimizer is introduced and made aware of the adjustable parameters
in our instance of the CM class:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
optimizer = torch.optim.Adam(cm.parameters(), lr=0.01)
</pre>
        <p>
         Now, the optimization loop can be written and executed:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
steps = 2000
for step in range(steps):
    optimizer.zero_grad()

    ds = cm(xs)               # all distances with sign
    loss = torch.mean(ds**2)  # mean of squared distances
    loss.backward()
    
    optimizer.step()

    if step % 200 == 0:
        print(f'Step {step}, Loss: {loss.item()}')
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
Step 0, Loss: 19.002288818359375
Step 200, Loss: 7.962760925292969
Step 400, Loss: 4.069424152374268
Step 600, Loss: 3.14914608001709
Step 800, Loss: 3.014554500579834
Step 1000, Loss: 3.0028884410858154
Step 1200, Loss: 3.0023036003112793
Step 1400, Loss: 3.0022873878479004
Step 1600, Loss: 3.0022873878479004
Step 1800, Loss: 3.0022873878479004
</pre>
        <p>
         The center of mass is found correctly, which either a direct
inspection of the cm-objects attribute shows:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
cm.cm
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
Parameter containing:
tensor(5.0000, requires_grad=True)
</pre>
        <p>
        </p>
        <p>
         Or as a more general inspection of "all" optimizable parameters on the
model reveals:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
for name, parameter in cm.named_parameters():
    print(name,':',parameter.data)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
cm : tensor(5.0000)
</pre>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_884">
      </div>
      <div class="comments" id="issues_884">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_885">
     <div class="col-11">
      <h3>
       3.7
       <code class="prettyprint python">
        torch.nn.Module
       </code>
       III
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Here is a 3rd example, where the optimization is: given
         <span class="matematik">
         </span>
         <script type="math/tex">
          f(x)
         </script>
         , find
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_0
         </script>
         such that:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         f(x_0)=0
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         The model class is naturally called
         <code class="prettyprint python">
          FZero
         </code>
         and
could look like:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
import torch

class FZero(torch.nn.Module):
    
    def __init__(self, f, x0=0):
        super().__init__()
        self.f = f
        self.x0 = torch.nn.Parameter(torch.tensor(float(x0)))
        
    def forward(self):
        return self.f(self.x0)
</pre>
        <p>
         The model has one trainable parameter defined by:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
self.x0 = torch.nn.Parameter(torch.tensor(float(x0)))
</pre>
        <p>
         The value for
         <code class="prettyprint python">
          x0
         </code>
         is 0 or whatever is provided
during instantiation. The
         <code class="prettyprint python">
          torch.nn.Parameter()
         </code>
         takes care of storing this variable with the
         <code class="prettyprint python">
          .requires_grad=True
         </code>
         setting that was introduced
above.
        </p>
        <p>
         The model has a
         <code class="prettyprint python">
          forward
         </code>
         -method, which is the one
that is used if the model is called. For the present model, it applies
the function it was given during instantiation, stored as
         <code class="prettyprint python">
          self.f
         </code>
         , to
         <code class="prettyprint python">
          self.x0
         </code>
         . This
means that calling the model, one gets to know
         <span class="matematik">
         </span>
         <script type="math/tex">
          f(x_0)
         </script>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
# the function for which we seek the nodes
f = lambda x: (x-8)*(x+2)

# instantiation
fzero = FZero(f)

# what is f(x0) (according to the forward-method on fzero)?
fzero(f)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
tensor(-16., grad_fn=&lt;MulBackward0&gt;)
</pre>
        <p>
         Now to have the model change the value of
         <code class="prettyprint python">
          x0
         </code>
         so
as to find a value where the function has a node (= is zero),
an optimizer is introduced, e.g. the Adam optimizer:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
optimizer = torch.optim.Adam(fzero.parameters(), lr=0.01)
</pre>
        <p>
         where
         <code class="prettyprint python">
          fzero.parameters()
         </code>
         lets the model tell what
parameters can be optimized, and where
         <code class="prettyprint python">
          lr=0.01
         </code>
         is
the learning rate.
        </p>
        <p>
         With the optimizer instantiated and attached, a loop can be conducted
in which:
         <ul>
          <p>
          </p>
          <li>
           <p>
            the optimizer prepares for a new calculation of the derivative
  (gradient with more parameters) of the loss function
           </p>
          </li>
          <li>
           <p>
            the model calculates the
            <span class="matematik">
            </span>
            <script type="math/tex">
             f(x_0)
            </script>
            for the currect
            <span class="matematik">
            </span>
            <script type="math/tex">
             x_0
            </script>
            and the
  value is used for calculating a loss function, e.g.:
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \mathcal{Loss}=\left|f(x_0)\right|^2
            </script>
           </p>
          </li>
          <li>
           <p>
            autodifferentiation is used to calculate the derivative of the loss
  with respect to the optimizable parameters (here with respect to
            <code class="prettyprint python">
             x0
            </code>
            ):
            <div class="matematik">
            </div>
            <script type="math/tex; mode=display">
             \displaystyle\frac{d}{dx_0}\mathcal{Loss}
            </script>
           </p>
          </li>
          <li>
           <p>
            the optimizer updates the optimizable parameter(s)
           </p>
          </li>
         </ul>
         It looks like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
steps = 2000
for step in range(steps):
    optimizer.zero_grad()

    loss = fzero()**2
    loss.backward()
    
    optimizer.step()

    if step % 200 == 0:
        print(f'Step {step}, Loss: {loss.item()}')
</pre>
        <p>
         and gives this output:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
Step 0, Loss: 256.0
Step 200, Loss: 10.921854972839355
Step 400, Loss: 0.003035914385691285
Step 600, Loss: 3.139174031829839e-09
Step 800, Loss: 9.094945629950502e-11
Step 1000, Loss: 9.094945629950502e-11
Step 1200, Loss: 9.094945629950502e-11
Step 1400, Loss: 9.094945629950502e-11
Step 1600, Loss: 9.094945629950502e-11
Step 1800, Loss: 6.963317422670201e-11
</pre>
        <p>
         Inspection of the optimized parameter on the model goes via its
attribute
         <code class="prettyprint python">
          x0
         </code>
         , which can be accessed directly:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
fzero.x0
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
Parameter containing:
tensor(-2.0000, requires_grad=True)
</pre>
        <p>
         Or more neatly in this way:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
for name, parameter in fzero.named_parameters():
    print(name,':',parameter.data)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
x0 : tensor(-2.0000)
</pre>
        <p>
         And we have indeed found a node of the function.
        </p>
        <p>
         The other node can also be found:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
fzero = FZero(f,x0=5.25)
optimizer = torch.optim.Adam(fzero.parameters(), lr=0.01)
steps = 2000
for step in range(steps):
    optimizer.zero_grad()

    loss = fzero()**2
    loss.backward()
    
    optimizer.step()

    if step % 200 == 0:
        print(f'Step {step}, Loss: {loss.item()}')

print('====')

for name, parameter in fzero.named_parameters():
    print(name,':',parameter.data)
</pre>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint celloutput mb-0">
Step 0, Loss: 397.50390625
Step 200, Loss: 58.134864807128906
Step 400, Loss: 0.2609196901321411
Step 600, Loss: 2.786054028547369e-05
Step 800, Loss: 2.751218364238639e-09
Step 1000, Loss: 2.751218364238639e-09
Step 1200, Loss: 2.751218364238639e-09
Step 1400, Loss: 2.751218364238639e-09
Step 1600, Loss: 2.751218364238639e-09
Step 1800, Loss: 1.8417255498448526e-09
====
x0 : tensor(8.0000)
</pre>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_885">
      </div>
      <div class="comments" id="issues_885">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Torch Oh-shit list
     </h1>
    </div>
    <div class="row spy-padding" id="block_749">
     <div class="col-11">
      <h3>
       4.1 Common errors in Torch
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         There are a number of errors that you are likely to run into in Torch. Here I have tried 
listing them and exemplifying each issue.
        </p>
        <p>
         In general you will get an error trace of some kind from Python, e.g. that looks like this
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
Cell In[3], line 5
      1 x = torch.tensor([1.0, 2.0, 3.0])
      3 y = x**2,
----&gt; 5 y.backward()
.. I 
.. deleted 
.. some lines 
    771     )  # Calls into the C++ engine to run the backward pass
    772 finally:
    773     if attach_logging_hooks:

RuntimeError: element 0 of tensors does not require grad and does not have a grad_fn
</pre>
        <p>
         The key information is the line where the error occurs, indicated by "---&gt;" near the top and 
the error message given near the bottom.
        </p>
        <p>
         I will be using these error message for each section.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_749">
      </div>
      <div class="comments" id="issues_749">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_750">
     <div class="col-11">
      <h3>
       4.2 RuntimeError: ... does not require grad and does not have a grad_fn
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         The full error message is something like,
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    RuntimeError: element 0 of tensors does not require grad and does not have a grad_fn
</pre>
        <p>
         This occurs because PyTorch has been asked to perform a backward pass on a tensor that 
was not computed in a way that enabled gradients, e.g. the code
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
x = torch.tensor([1.0])
y = x**2
y.backward()
</pre>
        <p>
         Produces this error, but if we change it to
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
x = torch.tensor([1.0], requires_grad=True)
y = x**2
y.backward()
</pre>
        <p>
         It does not.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_750">
      </div>
      <div class="comments" id="issues_750">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_751">
     <div class="col-11">
      <h3>
       4.3 RuntimeError: One of the differentiated Tensors does not require grad
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This is a cousin of the previous error, and will occur e.g. in this case
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
w = torch.tensor([1.0], requires_grad=True)
x = torch.tensor([2.0])
y = w*x
dydx = torch.autograd.grad(y, x)
</pre>
        <p>
         Unlike before torch actually can differentiate
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         but not wrt.
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         which is what 
we asked for. To fix the above example we have to change to
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    w = torch.tensor([1.0], requires_grad=True)
    x = torch.tensor([2.0], requires_grad=True)
    y = w*x
    dydx = torch.autograd.grad(y, x)
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_751">
      </div>
      <div class="comments" id="issues_751">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_752">
     <div class="col-11">
      <h3>
       4.4 RuntimeError: One of the differentiated Tensors does not require grad
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This is a cousin of the previous error, and will occur e.g. in this case
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
w = torch.tensor([1.0], requires_grad=True)
x = torch.tensor([2.0])
y = w*x
dydx = torch.autograd.grad(y, x)
</pre>
        <p>
         Unlike before torch actually can differentiate
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         but not wrt.
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         which is what 
we asked for. To fix the above example we have to change to
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    w = torch.tensor([1.0], requires_grad=True)
    x = torch.tensor([2.0], requires_grad=True)
    y = w*x
    dydx = torch.autograd.grad(y, x)
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_752">
      </div>
      <div class="comments" id="issues_752">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_753">
     <div class="col-11">
      <h3>
       4.5 RuntimeError: grad can be implicitly created only for scalar outputs
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This error usually occurs when trying to vectorize parts of a calculation. As an example
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    w = torch.tensor([1.5], requires_grad=True)
    x = torch.tensor([1.0, 2.0], requires_grad=True)
    y = w*x
    dydx = torch.autograd.grad(y, x)
</pre>
        <p>
         Here
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         will be a tensor with 2-elements one for each
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         . The error occurs, 
as the message suggests, because
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         is not a scalar it is a 1d-array containing [1.5, 3.0]. 
To avoid having to do a loop to we can call `grad' with an additional input
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    w = torch.tensor([1.5], requires_grad=True)
    x = torch.tensor([1.0, 2.0], requires_grad=True)
    y = w*x
    dydx = torch.autograd.grad(y, x, grad_outputs=torch.ones_like(x))
</pre>
        <p>
         This lets torch now how to do the calculation and it has to do with the matrix math that 
is happening behind the scenes (Vector-Jacobian products) for more details see e.g.
        </p>
        <p>
         https://pytorch.org/docs/stable/generated/torch.autograd.grad.html#torch.autograd.grad
        </p>
        <p>
         Another solution uses vmap, see
        </p>
        <p>
         https://pytorch.org/docs/stable/generated/torch.vmap.html
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_753">
      </div>
      <div class="comments" id="issues_753">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_754">
     <div class="col-11">
      <h3>
       4.6 RuntimeError: Only Tensors of floating point and complex dtype can require gradients
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         An example is
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    x = torch.tensor([1], requires_grad=True)
</pre>
        <p>
         The error message is actually quite good, and the issue is that the tensor we made
is of dtype int, we can fix that with
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    x = torch.tensor([1.0], requires_grad=True)
</pre>
        <p>
         or
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    x = torch.tensor([1.0], requires_grad=True, dtype=torch.float32)
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_754">
      </div>
      <div class="comments" id="issues_754">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_755">
     <div class="col-11">
      <h3>
       4.7 RuntimeError: mat1 and mat2 must have the same dtype, but got Double and Float
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Also: RuntimeError: expected m1 and m2 to have the same dtype, but got: float != double
        </p>
        <p>
         This error occurs because Torch is a little bit less willing to broadcast to different data types than Numpy, e.g. it occurs 
in this case
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
x = torch.tensor([[1.0]], requires_grad=True, dtype=torch.float64)
W = torch.tensor([[1.0]])

y = W @ x
</pre>
        <p>
         With this minimal example it is rather clear that we need to change the dtype of 
either x or W such that they are the same. E.g. if we want float64
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    x = torch.tensor([[1.0]], requires_grad=True, dtype=torch.float64)
    W = torch.tensor([[1.0]], dtype=torch.float64)    
    y = W @ x
</pre>
        <p>
         For a more complex model it might be necessary to do some inspection to find the 
tensors with mismatching data types, so use
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    print(x.dtype)
    print(w.dtype)
</pre>
        <p>
         in such cases.
        </p>
        <p>
         The error also occurs with neural networks
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    x = torch.tensor([1], requires_grad=True, dtype=torch.float64)
    layer = torch.nn.Linear(1, 1)
    y = layer(x)
</pre>
        <p>
         And again the solution is to find the tensors with mismatching datatypes and correct that, e.g.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    x = torch.tensor([1], requires_grad=True, dtype=torch.float64)
    layer = torch.nn.Linear(1, 1, dtype=torch.float64)
    y = layer(x)
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_755">
      </div>
      <div class="comments" id="issues_755">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_756">
     <div class="col-11">
      <h3>
       4.8 RuntimeError: mat1 and mat2 shapes cannot be multiplied (1x3 and 2x3)
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Similar to the above error, but now because shapes don't match - occurs for example with
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    model = torch.nn.Linear(2, 3)
    x = torch.tensor([1.0, 2.0, 3.0])
    model(x)
</pre>
        <p>
         Here the linear layer expects a tensor with two numbers but we give it one with three, 
so the solution is either to change the input or the change the layer - here I change the 
layer
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    model = torch.nn.Linear(3, 3)
    x = torch.tensor([1.0, 2.0, 3.0])
    model(x)
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_756">
      </div>
      <div class="comments" id="issues_756">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_757">
     <div class="col-11">
      <h3>
       4.9 RuntimeError: Expected all tensors to be on the same device, but found at least two devices, mps:0 and cpu!
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         I guarantee this error will occur if you write a complex model and want to use with an accelerator (GPU etc.).
A minimal example is
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    w = torch.tensor([1.5])
    x = torch.tensor([1.0, 2.0], device='mps')
    y = w*x 
</pre>
        <p>
         Here
         <span class="matematik">
         </span>
         <script type="math/tex">
          w
         </script>
         is created on the default device, which is the CPU, but I allocate
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         to a different device (mps, which is Apple's GPU).
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    w = torch.tensor([1.5])
    x = torch.tensor([1.0, 2.0], device='mps')
    w = w.to('mps') # Send to the specified device.
    y = w*x 
</pre>
        <p>
         It can get tricky to find the tensors that are not allocated correctly, so just like with data types printing is helpful
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    print(f"{w.device = }")
    print(f"{x.device = }")
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_757">
      </div>
      <div class="comments" id="issues_757">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_758">
     <div class="col-11">
      <h3>
       4.10 RuntimeError: Can't call numpy() on Tensor that requires grad. Use tensor.detach().numpy() instead.
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         A minimal example looks like this
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
x = torch.tensor([1.0], requires_grad=True)
x = np.array(x)
</pre>
        <p>
         Where we are asking for a tensor that has gradient calculation enabled, so it is "attached" to the computational graph, but 
we ask to convert it to numpy. Pytorch tells us that if we really want to do that we need to explicitly detach it from the 
computational graph before allowing that. 
It is a little confusing though, because we are not calling some function called "numpy()" on our tensor? But in fact 
we are, it just happens behind the scenes, our call is equivalent to
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    x = torch.tensor([1.0], requires_grad=True)
    x = x.numpy()
</pre>
        <p>
         So now the error message is starting to make sense and if we do what it tells us
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    x = torch.tensor([1.0], requires_grad=True)
    x.detach().numpy()
</pre>
        <p>
         It will work.
        </p>
        <p>
         However, this error can, and often does, occur without us explicitly calling to ".numpy()" or "np.array(x)", e.g.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    w = torch.tensor([1.0], requires_grad=True)
    x = torch.tensor([1.0, 1.5, 2.0])
    y = w*x    
    plt.plot(x, y)
</pre>
        <p>
         Here it occurs because internally matplotlib is converting the input to a numpy array, presumably because the 
internals of matplotlib use methods of numpy arrays.
        </p>
        <p>
         We can follow the error message again
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    w = torch.tensor([1.0], requires_grad=True)
    x = torch.tensor([1.0, 1.5, 2.0])
    y = w*x    
    plt.plot(x.detach().numpy(), y.detach().numpy())
</pre>
        <p>
         But this can sometimes get really clunky so another option is to disable gradient 
tracking in another way
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    w = torch.tensor([1.0], requires_grad=True)
    x = torch.tensor([1.0, 1.5, 2.0])
    y = w*x    
    with torch.no_grad():
        plt.plot(x, y)
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_758">
      </div>
      <div class="comments" id="issues_758">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_759">
     <div class="col-11">
      <h3>
       4.11 TypeError: can't convert mps:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Occurs if you try to convert a tensor not on CPU to a numpy array, e.g.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    x = torch.tensor([1, 2, 3], device='mps')
    x.numpy()
</pre>
        <p>
         In which case you need to move it to CPU first
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    x = torch.tensor([1, 2, 3], device='mps')
    x.cpu().numpy()
</pre>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_759">
      </div>
      <div class="comments" id="issues_759">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_760">
     <div class="col-11">
      <h3>
       4.12 I dont get an error but my calculation is not right.
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This obviously can be caused by many things, but one possible problem is that Torch is 
broadcasting in way that you did not intend. For example
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    y_true = torch.tensor([1.0, 2.0, 3.0])
    y_pred = torch.tensor([1.0, 2.0, 3.0]).reshape(-1, 1)

    loss = torch.sum((y_pred - y_true)**2) # --&gt; 12.0
    print(loss)    
</pre>
        <p>
         In this case you will see that the loss is 12 which is weird when both tensors contain [1, 2, 3]! 
As mentioned, it happens because of broadcasting that is somewhat hidden because of the 
sum
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
    y_true = torch.tensor([1.0, 2.0, 3.0])
    y_pred = torch.tensor([1.0, 2.0, 3.0]).reshape(-1, 1)

    print((y_pred - y_true).shape)  # --&gt; (3, 3)
</pre>
        <p>
         So the fix is to have matching shapes so broadcasting doesn't happen when not intended
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
y_true = torch.tensor([1.0, 2.0, 3.0]).reshape(-1, 1)
y_pred = torch.tensor([1.0, 2.0, 3.0]).reshape(-1, 1)

loss = torch.sum((y_pred - y_true)**2) # --&gt; 0.0
print(loss)
</pre>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_760">
      </div>
      <div class="comments" id="issues_760">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 41
     </h1>
    </div>
    <div class="row spy-padding" id="block_789">
     <div class="col-11">
      <h3>
       5.1 Polynomial
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Consider the polynomial:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         y(x) = a x^3 + b x^2 + c x +d
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         a) Choose some values for the coefficients,
         <span class="matematik">
         </span>
         <script type="math/tex">
          a
         </script>
         ,
         <span class="matematik">
         </span>
         <script type="math/tex">
          b
         </script>
         ,
         <span class="matematik">
         </span>
         <script type="math/tex">
          c
         </script>
         , and
         <span class="matematik">
         </span>
         <script type="math/tex">
          d
         </script>
         ,
and plot the function.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_41_fig1.png">
              <img class="img-fluid" src="images/66.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_789">
      </div>
      <div class="comments" id="issues_789">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_790">
     <div class="col-11">
      <h3>
       5.2 Autodifferentiation
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Use
         <code class="prettyprint python">
          pytorch
         </code>
         to obtain the first derivative of
         <span class="matematik">
         </span>
         <script type="math/tex">
          y(x)
         </script>
         and plot it.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_41_fig2.png">
              <img class="img-fluid" src="images/66.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         Explanation for variable names in hints:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
# x is an x-value
# xs are many x-values
# y is a y-value
# ys are many y-values
# yp is one y'-value ("p"=prime)
# yps are many y'-values
</pre>
        <p>
         Hint 1: You can do it for one
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -value at a time:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
# one at a time
xs = torch.linspace(-2, 2, 100)
yps = []
for x in xs:
   x.requires_grad_(True)
   y =    YOUR CODE FOR THE FORWARD CALCULATION
   y.     YOUR CODE FOR THE BACKWARD CALCULATION
   yp =   YOUR CODE TO GET THE GRADIENT AT THIS x
   yps.append(yp.detach())
</pre>
        <p>
         Hint 2: You can do it for all
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -values at the same time:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
# all at once
xs = torch.linspace(-2, 2, 100, requires_grad=True)
ys = YOUR CODE FOR GETTING ALL y-VALUES
yps = torch. YOUR CODE TO GET ALL GRADIENT IN ONE GO USING xs and ys

xs = xs.detach().numpy()
yps = yps.detach().numpy()
</pre>
        <p>
         c) Plot for a few
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         -values the analytic result that you would get
from evaluating the derivative yourself:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         y'(x) = 3 a x^2 + 2 b x + c
        </script>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_41_fig3.png">
              <img class="img-fluid" src="images/66.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_790">
      </div>
      <div class="comments" id="issues_790">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_791">
     <div class="col-11">
      <h3>
       5.3 Higher derivatives
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Repeat b) and c) for the second derivative.
        </p>
        <p>
         Hint: If you use
         <code class="prettyprint python">
          torch.autograd.grad
         </code>
         for the
first derivative, you will need to add the argument
         <code class="prettyprint python">
          create_graph=True
         </code>
         to be able to make the second derivative.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_41_fig4.png">
              <img class="img-fluid" src="images/66.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_791">
      </div>
      <div class="comments" id="issues_791">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 42
     </h1>
    </div>
    <div class="row spy-padding" id="block_776">
     <div class="col-11">
      <h3>
       6.1 Autodifferentiation
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This exercise is about performing autodifferentiation utilizing the
pytorch package.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_776">
      </div>
      <div class="comments" id="issues_776">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_777">
     <div class="col-11">
      <h3>
       6.2 Derivative of Gaussian
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Plot a Gaussian and its derivative found with autodifferentiation.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_42_fig1.png">
              <img class="img-fluid" src="images/67.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_777">
      </div>
      <div class="comments" id="issues_777">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_778">
     <div class="col-11">
      <h3>
       6.3 Derivative of Fermi function
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Plot a Fermi function and its derivative found with autodifferentiation.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_42_fig2.png">
              <img class="img-fluid" src="images/67.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_778">
      </div>
      <div class="comments" id="issues_778">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_779">
     <div class="col-11">
      <h3>
       6.4 Derivative of Lennard-Jones potential
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Complete this class implementing the Lennard-Jones-Gauss potential
for distances
         <code class="prettyprint python">
          r
         </code>
         :
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class LennardJonesGauss:
    def __init__(self,eps=1,sigma_squared=0.02,r0=1.7):
        self.eps = eps
        self.sigma_squared = sigma_squared
        self.r0 = r0
        
    def V(self,r):
        return YOUR CODE HERE
calc = LennardJonesGauss(eps=2, r0=1.9)
</pre>
        <p>
         b) Plot the potential and its derivative calculated via autodifferentiation.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_42_fig3.png">
              <img class="img-fluid" src="images/67.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_779">
      </div>
      <div class="comments" id="issues_779">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 43
     </h1>
    </div>
    <div class="row spy-padding" id="block_811">
     <div class="col-11">
      <h3>
       7.1 The real gradient
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In the previous exercises you used
         <code class="prettyprint python">
          pytorch
         </code>
         's
         <code class="prettyprint python">
          .grad
         </code>
         or
         <code class="prettyprint python">
          autograd.grad
         </code>
         to
find the derivative. In that context the term "gradient" is actually a
little misleading. What you found was:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{array}{rcl}
    \displaystyle\frac{d}{dx_1}y_1&=&f'(x_1)\\
                                  &&\\
    \displaystyle\frac{d}{dx_2}y_2&=&f'(x_2)\\
                                  &&\\
                                  &\vdots&\\
                                  &&\\
    \displaystyle\frac{d}{dx_N}y_N&=&f'(x_N),
  \end{array}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         which is not a gradient. In fact, the term "per-sample-gradients"
would be a better term if one considers
         <span class="matematik">
         </span>
         <script type="math/tex">
          \left(x_i,y_i=f(x_i)\right)
         </script>
         as "samples".
        </p>
        <p>
         In this exercise you will be working with the "real" gradient, which
is what you get when you have a scalar function of several parameters:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \mathbf{\nabla}y(x_1, x_2, \dots,
x_N)=\left(\displaystyle\frac{d}{dx_1}y,\displaystyle\frac{d}{dx_2}y,
  \dots
  \displaystyle\frac{d}{dx_N}y\right)
        </script>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_811">
      </div>
      <div class="comments" id="issues_811">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_812">
     <div class="col-11">
      <h3>
       7.2 The scalar function
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Make a contour plot for the function:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         f(x_1,x_2) = \left(x_1^2 + x_2 - 11\right)^2 + \left(x_1 + x_2^2
    -7\right)^2
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Hint: complete this code:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
vals = YOUR CODE
x1d, x2d = np.meshgrid(vals,vals)

f = YOUR CODE
yd = f(x1d, x2d)

fig, ax = plt.subplots()
levels = YOUR CODE
ax.contour(x1d, x2d, yd, levels=levels)
color_map = ax.contourf(x1d, x2d, yd, levels=levels, alpha=0.5)
fig.colorbar(color_map, ax=ax)
ax.set(xlabel='$x_1$', ylabel='$x_2$')
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_43_fig1.png">
              <img class="img-fluid" src="images/68.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_812">
      </div>
      <div class="comments" id="issues_812">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_813">
     <div class="col-11">
      <h3>
       7.3 The gradients
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Use pytorch to evaluate the gradients and plot them.
        </p>
        <p>
         Hint: Complete this code:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
for P0 in [[-2,1.5],[2,.1],[-3,-1.5]]:
    P0 = YOUR CODE
    YOUR CODE FOR FORWARD PASS
    YOUR CODE FOR BACKWARD PASS
    grad_of_y = YOUR CODE FOR GRADIENT EVALUATION
    P0 = P0.detach()
    v = grad_of_y/np.linalg.norm(grad_of_y)
    ax.scatter(*P0,s=200,c='k')
    ax.arrow(*P0,*v,width=0.2)
</pre>
        <p>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_43_fig2.png">
              <img class="img-fluid" src="images/68.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_813">
      </div>
      <div class="comments" id="issues_813">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 44
     </h1>
    </div>
    <div class="row spy-padding" id="block_816">
     <div class="col-11">
      <h3>
       8.1 Using a pytorch model
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         This exercise is about praticing using the
         <code class="prettyprint python">
          pytorch.nn.model
         </code>
         . Such models are very pratical
whenever you perform optimizations. In this exercise, only a few
parameters are optimized, but in later exercises, the many parameters
of neural networks will be optimized in the same way.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_816">
      </div>
      <div class="comments" id="issues_816">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_817">
     <div class="col-11">
      <h3>
       8.2 A parabola
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         Consider the parabola:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         y(x) = a x^2 + b x +c
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         a) Setup a pytorch model, where
         <span class="matematik">
         </span>
         <script type="math/tex">
          a
         </script>
         ,
         <span class="matematik">
         </span>
         <script type="math/tex">
          b
         </script>
         , and
         <span class="matematik">
         </span>
         <script type="math/tex">
          c
         </script>
         are parameters. Use
some arbitrary values for the parameters to begin with.
        </p>
        <p>
         b) Plot
         <span class="matematik">
         </span>
         <script type="math/tex">
          y(x)
         </script>
         . If you feel like recapping the topic of the previous
exercises, use autodifferentiation and plot
         <span class="matematik">
         </span>
         <script type="math/tex">
          y'(x)
         </script>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_44_fig1.png">
              <img class="img-fluid" src="images/69.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_817">
      </div>
      <div class="comments" id="issues_817">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_818">
     <div class="col-11">
      <h3>
       8.3 Fitting
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Consider this data:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         \begin{bmatrix}
1\\2
  \end{bmatrix},
  \begin{bmatrix}
3\\4
  \end{bmatrix},
  \begin{bmatrix}
5\\1
  \end{bmatrix}
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         Now use your pytorch model to determine
         <span class="matematik">
         </span>
         <script type="math/tex">
          a
         </script>
         ,
         <span class="matematik">
         </span>
         <script type="math/tex">
          b
         </script>
         , and
         <span class="matematik">
         </span>
         <script type="math/tex">
          c
         </script>
         , so as to
make the curve
         <span class="matematik">
         </span>
         <script type="math/tex">
          \left(x,y(x)\right)
         </script>
         fit the data best possibly.
        </p>
        <p>
         Hint 1:
Notice the similarity between obtaining the gradient for plotting it
(as in the previous exercises):
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
for x in xs:
     x.requires_grad_(True)
  
     y = f(x)      # forward calculation
     y.backward()  # backward calculation

     yp = x.grad   # use gradient = store this single component of it
</pre>
        <p>
         and obtaining the gradient for optimizing a loss function with respect
to some parameters:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
for step in range(steps):
    # reset the optimizer gradient-calculation

    loss = SOMETHING # forward calculation
    loss.backward()  # backward calculation

    # use gradient = take optimizer step
</pre>
        <p>
         The analogy is not complete. The
         <code class="prettyprint python">
          for x in xs
         </code>
         -loop
is for many separate
         <span class="matematik">
         </span>
         <script type="math/tex">
          y_i = f(x_i)
         </script>
         relations, where it calculates
each of the scalar functions,
         <span class="matematik">
         </span>
         <script type="math/tex">
          f'(x_i)
         </script>
         , that only depend on a single
input,
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_i
         </script>
         . The
         <code class="prettyprint python">
          for step in range(steps)
         </code>
         loop, on the other hand, is for a single scalar function,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \mathcal{Loss} =
g(\left\{p_i\right\})
         </script>
         , depending on all parameters,
         <span class="matematik">
         </span>
         <script type="math/tex">
          \left\{p_i\right\}
         </script>
         and hence the gradient (that the optimizer
obtains via the
         <code class="prettyprint python">
          .grad
         </code>
         attribute on
         <code class="prettyprint python">
          loss
         </code>
         ) is a vector.
        </p>
        <p>
         Hint 2: The
         <code class="prettyprint python">
          torch.optim.Adam
         </code>
         optimizer might work well with
a 0.01 learning rate. The
         <code class="prettyprint python">
          torch.optim.SGD
         </code>
         might
require a smaller learning rate.
        </p>
        <p>
         Hint 3a: You can write the mean-square-error loss function like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
loss = torch.mean((y_prediction - y_train) ** 2)
</pre>
        <p>
         Hint 3b: After having handled the loss-function yourself, you might
want to write it like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
# outside training loop:
loss_func = torch.nn.MSELoss()

# inside training loop:
  loss = loss_func(y_prediction, y_train)
</pre>
        <p>
         which will be faster for applications with much data.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_44_fig2.png">
              <img class="img-fluid" src="images/69.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_818">
      </div>
      <div class="comments" id="issues_818">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_819">
     <div class="col-11">
      <h3>
       8.4 Gaussian
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Fit instead a Gaussian,
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         f: f(x) = A\cdot\exp\left(-\displaystyle\frac{(x-x_0)^2}{2\sigma^2}\right)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         to the data using the same technique as in c).
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_44_fig3.png">
              <img class="img-fluid" src="images/69.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_819">
      </div>
      <div class="comments" id="issues_819">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_820">
     <div class="col-11">
      <h3>
       8.5 Circle
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         e) Now fit a circle through the three points.
        </p>
        <p>
         Hint: The loss-function is the hard part. Here is what it should contain:
         <ul>
          <p>
          </p>
          <li>
           <p>
            Evaluate distances of each point to the current center.
           </p>
          </li>
          <li>
           <p>
            Evaluate the mean of the squared deviations of those distances to
  the current radius.
           </p>
          </li>
         </ul>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_44_fig4.png">
              <img class="img-fluid" src="images/69.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_820">
      </div>
      <div class="comments" id="issues_820">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 45
     </h1>
    </div>
    <div class="row spy-padding" id="block_814">
     <div class="col-11">
      <h3>
       9.1 Gaussian fit
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Make a pytorch model for a Gaussian:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div class="matematik">
        </div>
        <script type="math/tex; mode=display">
         f: f(x) = A\cdot\exp\left(-\displaystyle\frac{(x-x_0)^2}{2\sigma^2}\right)
        </script>
       </div>
       <div class="i2latextext mb-2">
        <p>
         b) Assume
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_0=-1
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \sigma=0.3
         </script>
         . Fit the amplitude,
         <span class="matematik">
         </span>
         <script type="math/tex">
          A
         </script>
         , to this data:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
np.array([[-1.493,  0.048],
       [-1.25 ,  0.459],
       [-0.842,  0.731],
       [-0.676,  0.269],
       [-0.332,  0.004],
       [ 0.544,  0.   ],
       [ 1.363,  0.079],
       [ 1.621,  0.083],
       [ 1.853,  0.021],
       [ 2.892,  0.   ]])
</pre>
        <p>
         Hint: Assume your model is called
         <code class="prettyprint python">
          gaussian
         </code>
         and
has
         <code class="prettyprint python">
          A
         </code>
         ,
         <code class="prettyprint python">
          x0
         </code>
         , and
         <code class="prettyprint python">
          sigma
         </code>
         as trainable parameters. Then this
will train all parameters in the model:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
optimizer = torch.optim.SGD(gaussian.parameters(), lr=learning_rate)
</pre>
        <p>
         while this will select only the
         <code class="prettyprint python">
          A
         </code>
         -parameter:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
optimizer = torch.optim.SGD([gaussian.A], lr=learning_rate)
</pre>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_45_fig1.png">
              <img class="img-fluid" src="images/70.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
         c) Assume
         <span class="matematik">
         </span>
         <script type="math/tex">
          x_0=1.5
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \sigma=0.3
         </script>
         . Fit again the amplitude,
         <span class="matematik">
         </span>
         <script type="math/tex">
          A
         </script>
         .
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_45_fig2.png">
              <img class="img-fluid" src="images/70.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_814">
      </div>
      <div class="comments" id="issues_814">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_815">
     <div class="col-11">
      <h3>
       9.2 Full fit
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         d) Now fit all three parameters,
         <span class="matematik">
         </span>
         <script type="math/tex">
          A, x_0,
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          \sigma
         </script>
         . Play around with initializing the model with different
         <span class="matematik">
         </span>
         <script type="math/tex">
          \left(A,x_0,\sigma\right)
         </script>
         -values and see what kind of fits you get.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_45_fig3.png">
              <img class="img-fluid" src="images/70.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_815">
      </div>
      <div class="comments" id="issues_815">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 46
     </h1>
    </div>
    <div class="row spy-padding" id="block_821">
     <div class="col-11">
      <h3>
       10.1 Spring models
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In this exercise you will work with beads connected by
springs. In the first exercise, you will optimize the position of one
bead to minimize the energy of two springs. This can be programmed
with just two "optimizable" parameters,
         <span class="matematik">
         </span>
         <script type="math/tex">
          x
         </script>
         and
         <span class="matematik">
         </span>
         <script type="math/tex">
          y
         </script>
         , which can be held
in two separate one-dimensional torch-tensors. In the next
exercises you will optimize the positions of many beads, and some
higher-dimensional tensor(s) with the positions will make the code
look clearer.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_821">
      </div>
      <div class="comments" id="issues_821">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_822">
     <div class="col-11">
      <h3>
       10.2 A bead between two springs
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Optimize the position of a central bead held by two springs attached
to some fixed beads.
        </p>
        <p>
         Hint: Go through these steps when plannning:
         <ul>
          <p>
          </p>
          <li>
           <p>
            Make a
            <code class="prettyprint python">
             torch.nn.Module
            </code>
            -model where the optimizable coordinates are held.
           </p>
          </li>
          <li>
           <p>
            Make an energy function as the
            <code class="prettyprint python">
             forward
            </code>
            -function
  of the model.
           </p>
          </li>
          <li>
           <p>
            Choose an optimizer that is aware of the optimizable coordinates.
           </p>
          </li>
          <li>
           <p>
            Optimize where the energy is the loss function, which is obtained by
  calling the model without parameters. I.e. if
            <pre class="prettyprint python mb-0">
    class SpringSystem(torch.nn.Module):
        ...
        def forward(self):
            ...
            return energy
    model = SpringSystem()
</pre>
            then
            <pre class="prettyprint python mb-0">
    energy = model()
</pre>
            triggers the call of the
            <code class="prettyprint python">
             forward
            </code>
            -function due
  to how
            <code class="prettyprint python">
             torch.nn.Module
            </code>
            is defined.
           </p>
          </li>
          <li>
           <p>
            Obtain and use for plotting the optimized positions.
           </p>
          </li>
         </ul>
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_46_fig1.png">
              <img class="img-fluid" src="images/71.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_822">
      </div>
      <div class="comments" id="issues_822">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_823">
     <div class="col-11">
      <h3>
       10.3 A string of beads
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         b) Now generalize you solution to a) so as to handle a whole string of
beads connected by springs.
        </p>
        <p>
         Hint: Depending on how you implement it you may want to have a "mask"
that sets to zero the gradient on the end-beads. This is particularly
the case if you keep the positions of all beads in one single torch
tensor (which is convenient for the energy evaluation). The mask can
be implemented something like this:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
with torch.no_grad():
    model.YOUR-STATIC-PARAMETERS.grad *= 0
</pre>
        <p>
         where
         <code class="prettyprint python">
          YOUR-STATIC-PARAMETERS
         </code>
         singles out the
components of the bead-positions that should remain fixed.
        </p>
        <p>
         The above statement should appear
         <b>
          after
         </b>
         the gradients are
evaluated, and
         <b>
          before
         </b>
         the optimizer changes the
parameters. So something like:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
for step in range(steps):
    ...
    energy.backward() # now gradients are calculated
    YOUR CODE # here zero out gradients for static parameters
    optimizer.step() # now move only dynamic beads.
    ...
</pre>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_46_fig2.png">
              <img class="img-fluid" src="images/71.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_823">
      </div>
      <div class="comments" id="issues_823">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_824">
     <div class="col-11">
      <h3>
       10.4 The catenary
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Now add a gravitational force by extending the model class:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class SpringSystemWithGravity(SpringSystem):
    def forward(self):
        spring_energy = super().forward()
        gravitational_energy = YOUR CODE
        return spring_energy + gravitational_energy
</pre>
        <p>
         Hint: You may have to try different learning rates and optimizers.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_46_fig3.png">
              <img class="img-fluid" src="images/71.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_824">
      </div>
      <div class="comments" id="issues_824">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
  <div class="col-md-9 offset-md-3 book-padding">
   <div class="navbar-padding">
    <div class="spy-padding" id="chapter_None">
     <h1>
      Exercise 47
     </h1>
    </div>
    <div class="row spy-padding" id="block_852">
     <div class="col-11">
      <h3>
       11.1 Lennard-Jones-Gauss systems
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         In several previous exercises, you have worked with optimizing
clusters of atoms interacting via the Lennard-Jones or
Lennard-Jones-Gauss pair-potential. Whenever
you did relaxations or simulated annealing for those clusters, it was
based on forces for which you had derived the analytic expression
yourself. In this exercise you will be leveraging autodifferentiation
to get the forces numerically.
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_852">
      </div>
      <div class="comments" id="issues_852">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_853">
     <div class="col-11">
      <h3>
       11.2 Setup classes
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         a) Start by introducing a calculator class:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class LennardJonesGauss:
    def __init__(self,eps=1, sigma_squared=0.02, r0=1.7):
        YOUR CODE        

    def V(self,r):
        return YOUR CODE
</pre>
        <p>
         and a
         <code class="prettyprint python">
          torch.nn.Module
         </code>
         class that will hold the
atomic positions.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
class LJGSystem(torch.nn.Module):
    def __init__(self, calc, Natoms):
        super().__init__()
        self.calc = calc
        self.positions = torch.nn.Parameter( YOUR CODE
        
    def forward(self):
        return YOUR CODE TO CALCULATE THE ENERGY 

    def draw(self, ax):
        ax.scatter(self.positions.data[:, 0],
                   self.positions.data[:, 1], s=200)
</pre>
        <p>
         Hint: There is a function
         <code class="prettyprint python">
          torch.pdist
         </code>
         that does
the same as
         <code class="prettyprint python">
          scipy.spatial.distance.pdist
         </code>
         , but
supports autodifferentiation.
        </p>
        <p>
         b) To check your calculator, you can use these positions:
        </p>
       </div>
       <div class="i2latextext mb-2">
        <pre class="prettyprint python mb-0">
pos = torch.tensor([[4.065, 5.93 ],
                    [3.211, 5.465],
                    [5.711, 4.9  ],
                    [6.567, 5.374],
                    [4.113, 6.903],
                    [5.741, 5.879],
                    [5.662, 3.924],
                    [4.893, 5.411],
                    [4.844, 4.443],
                    [4.036, 4.953],
                    [6.539, 4.384],
                    [4.931, 6.382]])
</pre>
        <p>
         and should expect
         <span class="matematik">
         </span>
         <script type="math/tex">
          -40.667
         </script>
         .
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_853">
      </div>
      <div class="comments" id="issues_853">
      </div>
     </div>
    </div>
    <div class="row spy-padding" id="block_854">
     <div class="col-11">
      <h3>
       11.3 Search
      </h3>
      <div class="text-justify">
       <div class="i2latextext mb-2">
        <p>
         c) Now initiate the atoms at random positions, and perform
optimization with respect to the atomic positions using the energy as
the loss function.
        </p>
        <p>
         d) Do it a number of times and enjoy that you get relaxed structures
without having had to derive a force-expression analytically.
        </p>
       </div>
       <div class="i2latextext mb-2">
        <div>
         <p>
          <div class="text-center">
           <p>
            <p>
             <a href="/media/9/img/exercise_47_fig1.png">
              <img class="img-fluid" src="images/72.png" style="max-width: 85.0%"/>
             </a>
            </p>
           </p>
          </div>
         </p>
        </div>
        <p>
        </p>
       </div>
      </div>
      <hr/>
      <div class="comments" id="private_comments_854">
      </div>
      <div class="comments" id="issues_854">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="frameworkModalLabel" class="modal fade" id="frameworkModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="frameworkModalContent">
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="sci2uModalLabel" class="modal fade" id="sci2uModal" role="dialog" style="padding-right: 0" tabindex="-1">
     <div class="modal-dialog modal-lg" role="document">
      <div id="sci2uModalQuiz">
      </div>
      <div class="d-none" id="sci2uModalBoard">
       <script src="/static//book/js/game.js">
       </script>
       <script src="/static//book/js/board.js">
       </script>
      </div>
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="deleteModalLabel" class="modal fade" id="deleteModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="blockOptionsModal" role="dialog" tabindex="-1">
     <div class="modal-dialog" role="document">
     </div>
    </div>
    <footer class="text-center mt-5">
     <p>
      © 2019-2024 Uniblender ApS
     </p>
    </footer>
   </div>
  </div>
 </body>
 <head>
  <script src="render_katex.js">
  </script>
  <head>
   <meta charset="utf-8"/>
   <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
   <meta content="width=device-width, initial-scale=1" name="viewport"/>
   <title>
    comp24.sci2u.dk
   </title>
   <!-- Font Awesome Icons -->
   <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet"/>
   <!-- Bootstrap Core CSS -->
   <link href="/static//book/css/bootstrap.min.css" rel="stylesheet"/>
   <!-- Custom CSS -->
   <!-- Custom CSS -->
   <style>
    .landing-padding {
        padding: 8rem 0 0;
    }

    .hero-padding {
        padding: 8rem 0;
    }

    .book-padding {
        padding: 0 7rem 0 4rem;
    }

    .navbar-padding {
        padding-top: 56px;
    }

    .spy-padding {
        padding-top: 68px;
    }

    .move-up {
      top: 0;
      -webkit-transition: top .25s ease;
      -moz-transition: top .25s ease;
      -ms-transition: top .25s ease;
      -o-transition: top .25s ease;
      transition: top .25s ease;
    }

    .move-up:hover {
        top: -10px;
    }

    #sidebar {
        position: fixed;
        height: calc(100% - 56px);
        overflow-y: auto;
        background-color: #F7F7F7;
        border-right: 1px solid #eee;
        display: block;
        -webkit-transition: 0.4s;
        -moz-transition: 0.4s;
        -ms-transition: 0.4s;
        -o-transition: 0.4s;
        transition: 0.4s;
    }

    #sidebar-button {
        bottom: 15px;
        right: 15px;
        display: none;
    }

    @media (max-width: 767.98px) {
        .landing-padding {
            padding: 2rem 0 0;
        }

        #sidebar {
            display: none;
            height: 0;
            width: 100%;
            position: fixed;
            z-index: 1000;
            left: 0;
            bottom: 0;
            background-color: #F7F7F7;
            overflow-x: hidden;
            -webkit-transition: 0.4s;
            -moz-transition: 0.4s;
            -ms-transition: 0.4s;
            -o-transition: 0.4s;
            transition: 0.4s;
        }

        #sidebar-button {
            display: block;
        }

        .toast-position {
            z-index: 1100;
        }

        #navbarNavAltMarkup {
            margin-top: 1rem;
        }
    }

    .navbar-custom-parent, .navbar-custom-children {
        width: 100%;
    }

    @media (min-width: 768px) {
        #sidebar {
            display: block;
        }
    }

    @media (max-width: 991.98px) {
        .book-padding {
            padding: 0 2rem 0 2rem;
        }
    }

    .jumbo-color {
        background-color: #ECECEC;
    }

    .l-block::after {
        content: none !important;
    }

    .dropdown-toggle::after {
        content: none;
    }

    .navbar-custom-parent > .navbar-nav > a {
        -webkit-transition: color .1s ease;
        -moz-transition: color .1s ease;
        -ms-transition: color .1s ease;
        -o-transition: color .1s ease;
        transition: color .1s ease;
    }

    .navbar-custom-parent > .navbar-nav > a.active-custom {
    }

    .navbar-custom-parent > .navbar-nav > a:hover {
    }

    .navbar-custom-children > .navbar-nav > a {
        -webkit-transition: color .1s ease;
        -moz-transition: color .1s ease;
        -ms-transition: color .1s ease;
        -o-transition: color .1s ease;
        transition: color .1s ease;
    }

    .navbar-custom-children > .navbar-nav > a:hover,
    .navbar-custom-children > .navbar-nav > a.active {
	font-weight: 700 !important;
    }

    .font-weight-bold {
        font-weight: 700 !important;
    }

    .border-right {
        border-width: 2px !important;
    }

    .border-right:hover, .border-right:focus, a.active, .border-active {
        border-width: 4px !important;
    }

    .form-width {
        margin: 0 0 0 auto;
        -webkit-transition: 0.4s;
        -moz-transition: 0.4s;
        -ms-transition: 0.4s;
        -o-transition: 0.4s;
        transition: 0.4s;
    }

    .nav-color, .upvote-color, .downvote-color {
        color: rgba(0, 0, 0, 0.5);
    }

    .nav-color:hover, .nav-color:focus {
        color: rgba(0, 0, 0, 0.7);
    }

    .upvote-color:hover, .upvote-color:focus {
        color: #5cb85c;
    }

    .downvote-color:hover, .downvote-color:focus {
        color: #d9534f;
    }

    /* Footnote in text blocks */
    span.footnote {
        color: #ca0020;
    }

    span.footnote span.footnotetext {
        z-index: -1;
        opacity: 0;
        position: fixed;
        right: 15px;
        bottom: 20px;
        margin-left: 18px;
        margin-right: 18px;
        padding: 14px 20px;
        border-radius: 4px;
        border:1px solid #DCA;
        color: black;
        background-color: #FEF6BB;
        display: none;
    }

    span.footnote:hover span.footnotetext {
        z-index: 9;
        opacity: 1;
        display: block;
    }

    .notes, .comments {
        display: none;
    }

    #addChapter {
        text-align: left !important;
        display: none;
    }

    textarea {
        resize: none;
    }

    .toast-position {
        position: fixed;
        top: 68px;
        right: 10px;
    }

    .modal-backdrop {
        opacity: 0.7 !important;
    }

    /* bjorks new stuff */
    code.prettyprint {
        background-color: #f8f8f8;
        border: 1px solid #888;
        padding-left: 2px;
        padding-right: 2px;
    }

    pre.prettyprint {
        background-color: #f8f8f8;
    }

    .prettyprint.celloutput {
        background-color: #fff;
    }

    .i2latextext {}

    .exercise {
        padding: 10px;
        border-style: solid;
        border-color: #ccc;
    }

    .exercise > .row {
        display: block;
    }

    .sci2uanswer, .sci2uquestion, .sci2uquestionbtn, .sci2ureviewborder {
        border-width: 3px;
    }

    .sci2udefaultborder {
        border: 3px solid rgba(0,0,0,.125);
    }

    .sci2ubadge {
        font-size: 1.75em;
        vertical-align: middle
    }
    /* if code is a link, make the border blue */
    a > .prettyprint {
        border-color: #007bff;
    }
    a > code > .pln, .pun {
        color: #007bff;
    }
   </style>
   <!-- jQuery -->
   <script src="/static//book/js/jquery.min.js">
   </script>
   <!-- Bootstrap JavaScript -->
   <script src="/static//book/js/bootstrap.bundle.min.js">
   </script>
   <!-- IE10 viewport bug workaround -->
   <script src="/static//book/js/ie10-viewport-bug-workaround.js">
   </script>
   <!-- Notifactions -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js">
   </script>
   <!-- Placeholder Images -->
   <script src="/static//book/js/holder.min.js">
   </script>
   <!-- Code environment -->
   <!-- https://github.com/google/code-prettify/blob/master/docs/getting_started.md -->
   <!-- autoloads css and runs when page finished loading - i.e. no need for PR.prettyPrint() -->
   <!-- obsolete: <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script> -->
   <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js">
   </script>
   <!-- KaTeX -->
   <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css" integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw" rel="stylesheet"/>
   <!-- The loading of KaTeX is deferred to speed up page rendering -->
   <script crossorigin="anonymous" defer="" integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH" src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js">
   </script>
   <script>
    var refreshRender = function() {
                var tex = document.querySelectorAll('script[type^="math/tex"]');
                for (var i = 0; i < tex.length; ++i) {
                    var display = tex[i].getAttribute('type').indexOf('mode=display') > -1;
                    var math = tex[i].previousSibling;
                    //alert(math.className);
                    //math = math.previousSibling;

                    math.className = 'katex-render';
                    var content = tex[i].textContent;
                    katex.render(content, math, {
                        displayMode: display,
                        throwOnError: false
                    });
                    tex[i].parentNode.removeChild(tex[i]);
                }
            };

            var refreshLocal = function(element) {
	        var element = $(element)
                var tex = element.find('script[type^="math/tex"]');
                for (var i = 0; i < tex.length; ++i) {
                    var display = tex[i].getAttribute('type').indexOf('mode=display') > -1;
                    var math = tex[i].previousSibling;
                    //alert(math.className);
                    //math = math.previousSibling;

                    math.className = 'katex-render';
                    var content = tex[i].textContent;
                    katex.render(content, math, {
                        displayMode: display,
                        throwOnError: false
                    });
                    tex[i].parentNode.removeChild(tex[i]);
                }
	      return element;
            };

            $(document).ready(function() {
                // koer prettyfy
                //PR.prettyPrint();
                // koer KaTeX
                refreshRender();
            });
   </script>
   <!-- end KaTeX -->
   <script type="text/javascript">
    var csrf_token = 'uWqbaC6WWqZTEzZ8giNmTEqN4TdYc5Ab603GFdXoEal09oB7jrwvqgFO0C6lND3r';
   </script>
   <script type="text/javascript">
    what_options_for_this_block = function(block_id) {
            $.ajax({
                url: '/book/block/' + block_id + '/',
                type: 'POST',
                data: {
                    action: 'what_options_for_this_block',
                    latest_collection_id: localStorage.getItem('latest_collection'),
                    csrfmiddlewaretoken: csrf_token,
                },
                dataType : "json"
            }).done(function (result) {
                if (result.ok) {
                    $("#frameworkModal").modal('hide');
                    if (result.url) {
                        window.location.href = result.url;
                    } else if (result.html) {
                        if ($.trim($('#booklet_options').html()) == '') {
                            $('#booklet_options').html(result.html);
                        }
                        $("#blockOptionsModal").modal('show');
			} else {
			    alert('problem' + result.msg);
			}
                };
            });
        }

        modal_set_prefer = function() {
            $('#default_latest_icon').removeClass('fa-circle').addClass('fa-check-circle');
            set_prefer_latest_collection(true);
        }
   </script>
   <script type="text/javascript">
    var csrf_token = 'uWqbaC6WWqZTEzZ8giNmTEqN4TdYc5Ab603GFdXoEal09oB7jrwvqgFO0C6lND3r';
    var color_class = {1: 'bg-success', 2: 'bg-primary', 3: 'bg-warning', 4: 'bg-danger'};
    var color_sidebar_class = {1: 'border-success', 2: 'border-primary', 3: 'border-warning', 4: 'border-danger'};

    toggle_latex_help = function(block, index) {
        if ($('#tip_' + block).hasClass("d-none")) {
            $('#tip_' + block).removeClass("d-none");
            if ($('#help_' + index).length == 0) {
                latex_help(block, index, "next");
            }
        }
        else {
            $('#tip_' + block).addClass("d-none");
        }
    }

    latex_help = function(block, index, type) {
        $('#help_' + index).remove();
        help_index = (type == "next" ? help_index + 1 : help_index - 1);
console.log('INDEX',index)
    	if (index % 4 == 0) {
            $('#tip_' + block).append(`<div id="help_${help_index}"><div class="i2latextext mb-2">Write your private notes (that can only be seen by you) and issues (that can be seen by everyone) using LaTeX. Write, for instance:</div><pre class="prettyprint celloutput">\\begin{itemize}\n\\item\nRead the chapter\n\\item\nMake the exercise\n\\end{itemize}</pre><div class="i2latextext mb-2">to get this:</div><div class="i2latextext mb-2"><ul><p></p><li><p>Read the chapter</p></li><li><p>Make the exercise</p></li></ul></div></div>`);
        } else if (index % 4 == 1) {
            $('#tip_' + block).append(`<div id="help_${help_index}"><div class="i2latextext mb-2">Code snippets are written like this:</div><pre class="prettyprint celloutput">\\mintinline{python}{text}</pre><div class="i2latextext mb-2">that gives: <code class="prettyprint python">text</code>. If your code snippet contains any of the curly parentheses, <code class="prettyprint python">{</code> and <code class="prettyprint python">}</code>, the syntax involves the pipe, <code class="prettyprint python">|</code> as in:</div><pre class="prettyprint celloutput">\\mintinline{python}|empty_dict = {}|</pre><div class="i2latextext mb-2">to get: <code class="prettyprint python">empty_dict = {}</code></div></div>`);
        } else if (index % 4 == 2) {
            $('#tip_' + block).append(`<div id="help_${help_index}"><div class="i2latextext mb-2">Bigger code segments are written:</div><pre class="prettyprint celloutput">\\begin{minted}{python}\nimport numpy as np\nempty_dict = {}\n\\end{minted}</pre><div class="i2latextext mb-2">that gives: <pre class="prettyprint python">import numpy as np\nempty_dict = {}</pre></div></div>`);
        } else if (index % 4 == 3) {
            $('#tip_' + block).append(`<div id="help_${help_index}"><div class="i2latextext mb-2">To write some math, use LaTeX syntax inside <code class="prettyprint python">$</code>\'s:</div><pre class="prettyprint celloutput">$\\frac{\\pi}{2}\\int_0^1x\\,dx$</pre><div class="i2latextext mb-2">To get: <span class="matematik"></span><script type="math/tex">\\frac{\\pi}{2}\\int_0^1x\\,dx<\/script>. Add <code class="prettyprint python">\\displaystyle</code> to get a larger font:</div><pre class="prettyprint celloutput">$\\displaystyle\\frac{\\pi}{2}\\int_0^1x\\,dx$</pre><div class="i2latextext mb-2">like this: <span class="matematik"></span><script type="math/tex">\\displaystyle\\frac{\\pi}{2}\\int_0^1x\\,dx<\/script></div></div>`);
        }
        // koer KaTeX
        refreshRender();
    }


    $(document).ready(function() {
// color the sci2u buttons
var badge_class = {
  3 : 'btn-success',
  2 : 'btn-warning',
  1 : 'btn-danger',
};
var quiz_badge = {



}
        $('[data-tile-number]').each(function( index ) {
          var myclass = badge_class[quiz_badge[$(this).data('tile-number')]];
          if (myclass) {
            $(this).removeClass('btn-outline-secondary').addClass(myclass);
          }
        });
// test af framework
        call_framework = function(command,args) {
	    $.ajax({
		url: '/framework/',
	 	type: 'POST',
		data: {
		    csrfmiddlewaretoken: csrf_token,
		    command: command,
		    args: JSON.stringify(args),
		},
		dataType : "json"
	    }).done(function (result) {
                if (result.ok) {
		    $('#frameworkModalHTMLheader').html(result.header)
		    $('#frameworkModalHTMLbody').html(result.msg)
		    $('#frameworkModal').modal('show');
                } else {
		    $('#frameworkModalHTMLheader').html('BUMMER: ' + result.msg)
		    $('#frameworkModal').modal('show');
                }
	    })
	}
        // Use Bootstrap's popover to trigger the hover event and take care of the content fetching
        function getPopoverContent() {
            const anchor = $(this);
            // Rm equation tags and widen the popover for equations
            function sanitize(element) {
                // Remove the equation number/tag from the equation (if any)
                element.find('.tag').remove();
                const is_an_equation = element.children('.katex-render').length > 0;
                if (is_an_equation) {
                    // If it's an equation the width must be as large as nessesary
                    const popover = anchor.data('bs.popover');
                    popover.tip.style.maxWidth = '100%';
                }
            }

            const label = anchor.data('poload');
            let element = $('#' + label).clone();  // Must clone when we remove the tag (and it's on the same page)
            const is_link_pointing_to_something_already_loaded = element.length > 0;

            if (is_link_pointing_to_something_already_loaded) {
                sanitize(element);
                return element;
            } else {  // If the content on another page
                $.ajax({
                    url: '/book/peek/',
                    type: 'POST',
                    data: {
                        label: label,
                        csrfmiddlewaretoken: csrf_token,
                    },
                    dataType : "json"
                }).done(function (result) {
                    if (result.ok) {
                        element = refreshLocal(result.html);
			if (result.block) {
                        anchor.attr("href","/book/block/" + result.block + "/?frag=" + label);  // Make the href te the content
			} else {
			anchor.attr("href","/book/booklet/" + result.booklet + "/" + result.collection + "/?frag=" + label);
			}
                        const popover = anchor.data('bs.popover');

                        // Remove the equation number/tag from the equation, and widen the popover for equations
                        sanitize(element);

                        // Update the content of the popover whet it has loaded
                        popover.config.content = element;
                        popover.setContent();
                        popover.update();  // Must update the position of the popover to accmedate the size of the new content

                        // uncomment this to see that the katex looks right in the text but not in the popover
                        // $('<div class="col-11">' + element.html() + '</div>').insertAfter(anchor);
                    } else {
                        const popover = anchor.data('bs.popover');
			if (result.msg == 'User not authenticated') {
			    popover.config.content = 'Not logged in?';
			} else {
			    popover.config.content = 'Broken link!';
			}    
			popover.setContent();
			popover.update();
                        console.log(result);
                    }
                });
                return 'Lost internet connection? ';  // Show this till the ajax-call is done
            }
        }

        // Make all popovers once the page has loaded
        $('[data-poload]').popover({
            content: getPopoverContent,  // popover calls this when it's triggered
            sanitize: false,
            html: true,
            placement: 'top',
            container: 'body',
            toggle: 'popover',
            trigger: 'hover', // set to 'click' to debug
            boundary: 'viewport'
        });

        // jQuery smooth scroll to href id with respect of the navbar height (with extraOffset for popovers)
        let extraOffset = 20;
        const navHeight = $('nav').height();
        $('a').on('click', function(e) {
            const href = $(this).attr('href');
            if (href.slice(0, 6) == '#block') {
                e.preventDefault();
                $('html, body').animate({
                    scrollTop: $(href).offset().top,
                },
                450,
                'linear'
                );
            }
            else if (href.slice(0, 1) == '#') {
                e.preventDefault();
                $('html, body').animate({
                    scrollTop: $(href).offset().top - navHeight - extraOffset,
                },
                450,
                'linear'
                );
            }
        });

        // Fix for completion dropdown not showing when clicking (use this until better solution is made)
        scrollToDropdown = function(block_pk) {
            $('html, body').animate({
                scrollTop: $('#pg_' + block_pk).offset().top - navHeight - extraOffset,
            },
            450,
            'linear'
            );
        }

        // If we have been directed here and it has an id at the and, scroll to it
        const href = window.location.href;
        const id = href.substring(href.lastIndexOf('#'));
        if (href.includes('#block')) {
            $('html, body').animate({
                scrollTop: $(id).offset().top,
            },
            0,
            'linear'
            );
        }
        else if (href.includes('#')) {
            $('html, body').animate({
                scrollTop: $(id).offset().top - navHeight - extraOffset,
            },
            0,
            'linear'
            );
        }
        // koer KaTeX
        refreshRender();
    });

    set_label_name = function(block_pk,collection_pk,label_name) {
        $.ajax({
            url: '/book/block/' + block_pk + '/',
            type: "POST",
            data: {
                action: 'set_label_name',
                label_name: label_name,
                collection_pk: collection_pk,
                csrfmiddlewaretoken: csrf_token,
            },
            dataType : "json"
        }).done(function (result) {
            if (result.ok) {
                console.log(result);
                $('#pg_' + block_pk).removeClass('bg-success bg-primary bg-warning bg-danger');
                $('#pgSidebar_' + block_pk).removeClass('border-success border-primary border-warning border-danger border-right');

                if (result.label > 0) {
                    $('#pg_' +   block_pk).addClass(color_class[result.label]);
                    $('#pgSidebar_' + block_pk).addClass(color_sidebar_class[result.label] + ' border-right');
                }

                if (result.collection_new_label > -1) {
	                $('#sidebar_collection_title_' + collection_pk).removeClass('border-success border-primary border-warning border-danger border-right').addClass(color_sidebar_class[result.collection_new_label]);
                    if (result.collection_new_label > 0) {
                        $('#sidebar_collection_title_' + collection_pk).addClass('border-right');
                    }
                }
            } else {
                alert(result.msg);
            }
        });
	may_send_autocolor_message[block_pk] = false;
    }

    set_booklet_title = function(booklet_pk,booklet_title) {
        $.ajax({
            url: '/book/booklet/' + booklet_pk + '/',
            type: "POST",
            data: {
                action: 'set_booklet_title',
                booklet_title: booklet_title,
                csrfmiddlewaretoken: csrf_token,
            },
            dataType : "json"
        }).done(function (result) {
            if (result.ok) {
                console.log(result);
                $('#sidebar_booklet_title_' + booklet_pk).html(result.new_title.trim());
                $('#deleteModalLabel').html("Delete \"" + result.new_title.trim() + "\"?");
            }
        });
    }

    set_collection_title = function(booklet_pk,collection_pk,collection_title) {
        $.ajax({
            url: '/book/booklet/' + booklet_pk + '/',
            type: "POST",
            data: {
                action: 'set_collection_title',
                collection_pk: collection_pk,
                collection_title: collection_title,
                csrfmiddlewaretoken: csrf_token,
            },
            dataType : "json"
        }).done(function (result) {
            if (result.ok) {
                console.log(result);
                $('#sidebar_collection_title_' + collection_pk).html(result.new_title);
                $('#collection_title_' + collection_pk).html(result.new_title);
            }
        });
    }

    select_block = function(block_pk) {
        let chosen_storage = localStorage.getItem('storage_booklet');
        if (!chosen_storage) {
            alert('You have to choose where to store selected blocks');
            return;
        }
        $.ajax({
            url: '/book/block/' + block_pk + '/',
            type: "POST",
            data: {
                action: 'select',
                chosen_storage: chosen_storage,
                csrfmiddlewaretoken: csrf_token,
            },
            dataType : "json"
        }).done(function (result) {
            if (result.ok) {
                console.log(result);
                $('#fav_' + block_pk).removeClass('fas far');

                if (result.selected) {
                    $('#fav_' + block_pk).addClass('fas');
                    $('#saved_to_booklet').toast('show');
                    $('#removed_from_booklet').toast('hide');
                } else {
                    $('#fav_' + block_pk).addClass('far');
                    $('#removed_from_booklet').toast('show');
                    $('#saved_to_booklet').toast('hide');
                }
            } else {
                if (result.msg == 'You cannot use that booklet for storage') {
                    localStorage.setItem('storage_booklet','');
                    $('i.fa-bookmark').parent().addClass('d-none');
		        }
            }
        });
    }

    booklet_delete = function(booklet_pk) {
        $.ajax({
            url: '/book/booklet/delete/' + booklet_pk + '/',
            type: "POST",
            data: {
                csrfmiddlewaretoken: csrf_token,
            },
            dataType : "json"
        }).done(function (result) {
            if (result.ok) {
                window.location.replace('/book/');
            } else {
                alert(result.msg);
            }
        });
    }

    $(document).ready(function() {
        if (window.location.hash == "#newbooklet") {
            str = window.location.pathname.slice(14);
            booklet_edit(Number(str.substring(0, str.length - 1)), []);
        }
    });

    booklet_edit = function(booklet_pk, collections_pk) {
        var title = $('#sidebar_booklet_title_' + booklet_pk);
        var chapters = [];
        for (var i = 0; i < collections_pk.length; i++) {
            chapters.push($('#sidebar_collection_title_' + collections_pk[i]));
        }
        var value = title.attr('contenteditable');

        // Enter/exit editmode
        if (value == 'true') {
            // Exited editmode
            title.attr('contenteditable', 'false');
            for (var i = 0; i < chapters.length; i++) {
                chapters[i].attr('contenteditable', 'false');
            }
            $('#editMode').addClass('d-none');
            document.getElementById("addChapter").style.display = "none";

            $('#sidebar').removeClass('border border-info');

            $('#edit_off').toast('show');
            $('#edit_on').toast('hide');
        }
        else {
            // Entered editmode
            title.attr('contenteditable', 'true');
            for (var i = 0; i < chapters.length; i++) {
                chapters[i].attr('contenteditable', 'true');
            }
            $('#editMode').removeClass('d-none');
            document.getElementById("addChapter").style.display = "inline-block";

            $('#sidebar').addClass('border border-info');

            $('#edit_on').toast('show');
            $('#edit_off').toast('hide');
        }

        // Check for change in titles & send to server
        var editable = $("[contentEditable]");

        // Unfocus editing title on enter
        editable.keydown(function(e) {
            if (e.which == 13) {
                console.log("enter pressed");
                $(this).blur().next().focus();
                return false;
            }
        });

        for (var i = 0; i < editable.length; i++) {
            editable[i].setAttribute('data-orig', editable[i].innerHTML);

            editable[i].onblur = function() {
                if (this.innerHTML == this.getAttribute('data-orig')) {
                    // No change to element
                }
                else {
                    // Change has happened, store new value

                    // Check whether the booklet title or a chapter was edited
                    str = 'sidebar_booklet_title_';
                    if (this.id === str.concat(booklet_pk)) {
                        set_booklet_title(booklet_pk, this.innerHTML);
                    }
                    else {
                        set_collection_title(booklet_pk, this.id.split("_").pop(), this.innerHTML);
                    }
                }
            };
        }
    }

    collected_blocks = function(booklet_pk,chosen_storage) {
        console.log('collected_blocks ' + booklet_pk + ' ' + chosen_storage);
        if (chosen_storage == '') {
            $('i.fa-bookmark.fas').removeClass('fas').addClass('far');
            $('i.fa-bookmark').parent().addClass('d-none');
            return;
        }
        $('i.fa-bookmark').parent().removeClass('d-none');
        $.ajax({
            url: '/book/booklet/' + booklet_pk + '/',
            type: "POST",
            data: {
                action: 'collected_blocks',
                chosen_storage: chosen_storage,
                csrfmiddlewaretoken: csrf_token,
            },
            dataType : "json"
        }).done(function (result) {
            if (result.ok) {
                $('i.fa-bookmark.fas').removeClass('fas').addClass('far');
                for (i = 0; i < result.blocks.length; i++) {
                    $('#fav_' + result.blocks[i]).removeClass('far').addClass('fas');
                }
            }
        });
    }

    navbar_enable_storage = function(booklet_pk) {
        if ($('#storage' + booklet_pk).hasClass('fa-square')) {
            select_as_storage(booklet_pk);
        }
        else {
            unselect_as_storage(booklet_pk);
        }
    }

    select_as_storage = function(booklet_pk) {
        $('#capture_on').toast('show');
        $('#capture_off').toast('hide');
        console.log(booklet_pk);
        localStorage.setItem('storage_booklet',booklet_pk);
        indicate_chosen_storage(booklet_pk);
    }

    unselect_as_storage = function(booklet_pk) {
        $('#capture_off').toast('show');
        $('#capture_on').toast('hide');
        console.log('unselecting');
        localStorage.setItem('storage_booklet','');
        indicate_chosen_storage(booklet_pk);
        console.log('unselect done');
    }

    indicate_chosen_storage_inner = function(booklet_pk) {
        console.log('indicate 1');
        let chosen_storage = localStorage.getItem('storage_booklet');
        console.log('indicate 2 ' + chosen_storage);
        for (storage_pk of private_booklets) {
            if (chosen_storage == storage_pk) {
                $('#storage' + storage_pk).removeClass('fa-square').addClass('fa-edit');
                $('#start_capture' + storage_pk).css('display','none');
                $('#stop_capture' + storage_pk).css('display','list-item');
            } else {
                $('#storage' + storage_pk).removeClass('fa-edit').addClass('fa-square');
                $('#start_capture' + storage_pk).css('display','list-item');
                $('#stop_capture' + storage_pk).css('display','none');
            }
        }
    }

    indicate_chosen_storage = function(booklet_pk) {
        indicate_chosen_storage_inner();
        console.log('indicate 3');
        let chosen_storage = localStorage.getItem('storage_booklet');
        collected_blocks(booklet_pk,chosen_storage);
        console.log('indicate 4');
    }

    let private_booklets = [
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    ];

    store_booklet_collection_combination = function(booklet_pk, collection_pk) {
        var booklet_collection_dict = JSON.parse(localStorage.getItem("booklet_collection_dict"));
      	if (booklet_collection_dict) {
            booklet_collection_dict[booklet_pk] = collection_pk;
	} else {
	    var booklet_collection_dict = {booklet_pk: collection_pk};
	}
	localStorage.setItem("booklet_collection_dict", JSON.stringify(booklet_collection_dict))
    }
    


    $(document).ready(function() {
    	
    	  localStorage.setItem('latest_collection',16);
    	
	
	
	    store_booklet_collection_combination(4,16);
	
        indicate_chosen_storage(4);
    });

    hideNotesAndComments = function(block_pk) {
        document.getElementById("open_private_comments_" + block_pk).style.display = "inline-block";
        document.getElementById("comments_" + block_pk).style.display = "inline-block";
        $('#private_comments_' + block_pk).addClass("comments");
        $('#issues_' + block_pk).addClass("comments");
        document.getElementById("hide-comments_" + block_pk).style.display = "none";
        document.getElementById("reload-comments_" + block_pk).style.display = "none";
        document.getElementById("issues_help_" + block_pk).style.display = "none";
        $('#tip_' + block_pk).addClass("d-none");
    }

    showComments = function(block_pk) {
        document.getElementById("open_private_comments_" + block_pk).style.display = "none";
        document.getElementById("comments_" + block_pk).style.display = "none";
        $('#issues_' + block_pk).removeClass("comments");
        document.getElementById("hide-comments_" + block_pk).style.display = "inline-block";
        document.getElementById("reload-comments_" + block_pk).style.display = "inline-block";
        document.getElementById("issues_help_" + block_pk).style.display = "inline-block";

        // Only show scrollbar if comments are longer than 300px
        var comments = $('#forum_' + block_pk);
        var commentsHeight = $('#forum_' + block_pk).height();
        if (commentsHeight >= 300 && comments.css("overflow-y") != "scroll") {
            comments.css("max-height", "300px");
            comments.css("overflow-y", "scroll");
        }

        // Choose which caption above comments to show
        if ($.trim($('#list_of_comments_' + block_pk).html()) == '') {
            $('#no_comments_' + block_pk).removeClass("d-none");
            $('#is_comments_' + block_pk).addClass("d-none");
        }
        else {
            $('#no_comments_' + block_pk).addClass("d-none");
            $('#is_comments_' + block_pk).removeClass("d-none");
        }
    }

    showPrivateComments = function(block_pk) {
        document.getElementById("open_private_comments_" + block_pk).style.display = "none";
        document.getElementById("comments_" + block_pk).style.display = "none";
        $('#private_comments_' + block_pk).removeClass("comments");
        document.getElementById("hide-comments_" + block_pk).style.display = "inline-block";
        document.getElementById("issues_help_" + block_pk).style.display = "inline-block";

        // Only show scrollbar if comments are longer than 300px
        var notes = $('#notes_' + block_pk);
        var notesHeight = $('#notes_' + block_pk).height();
        if (notesHeight >= 300 && notes.css("overflow-y") != "scroll") {
            notes.css("max-height", "300px");
            notes.css("overflow-y", "scroll");
        }

        // Choose which caption above comments to show
        if ($.trim($('#list_of_notes_' + block_pk).html()) == '') {
            $('#no_notes_' + block_pk).removeClass("d-none");
            $('#is_notes_' + block_pk).addClass("d-none");
        }
        else {
            $('#no_notes_' + block_pk).addClass("d-none");
            $('#is_notes_' + block_pk).removeClass("d-none");
        }
    }

    commentCounter = function(block_pk, type) {
        if (type == 'comment') {
            var length = $('#commentArea_' + block_pk).val().length;
            var counter = $('#commentCounter_' + block_pk);
            var submit = $('#make_new_issue_' + block_pk);
            var preview = $('#preview_issue_' + block_pk);
        }
        else if (type == 'reply') {
            var length = $('#replyArea_' + block_pk).val().length;
            var counter = $('#replyCounter_' + block_pk);
            var submit = $('#make_new_reply_' + block_pk);
            var preview = $('#preview_reply_' + block_pk);
        }
        else if (type == 'private') {
            var length = $('#privateCommentArea_' + block_pk).val().length;
            var counter = $('#privateCommentCounter_' + block_pk);
            var submit = $('#make_new_private_comment_' + block_pk);
            var preview = $('#preview_private_comment_' + block_pk);
        }

        var maxLength = 250;
        var length = maxLength - length;

        if (length < 250) {
            counter.removeClass("d-none");
            submit.prop("disabled", false);
            preview.prop("disabled", false);
        }
        else if (!counter.hasClass("d-none")) {
            counter.addClass("d-none");
            submit.prop("disabled", true);
            preview.prop("disabled", true);
        }

        counter.text(length);

        if (length > 25 && length <= 75) {
            counter.removeClass("text-danger").addClass("text-warning");
        }
        else if (length <= 25) {
            counter.removeClass("text-warning").addClass("text-danger");
        }
        else if (counter.hasClass("text-danger") || counter.hasClass("text-warning")) {
            counter.removeClass("text-danger text-warning");
        }
    }

    toggleReplyField = function(issue_pk, issues) {
        $('#reply_' + issue_pk).toggleClass('comments');

        // Hide other reply textareas previously opened as well as previews
        issues.forEach(function(issue) {
            if (!$('#reply_' + issue).hasClass('comments') && issue != issue_pk) {
                $('#reply_' + issue).addClass('comments');
            }
            $('#preview_new_reply_issue_' + issue).html("");
        });
    }

    addChapter = function(booklet_pk) {
        $.ajax({
            url: '/book/booklet/' + booklet_pk + '/',
            type: "POST",
            data: {
                action: 'add_collection',
                csrfmiddlewaretoken: csrf_token,
            },
            dataType : "json"
        }).done(function (result) {
            if (result.ok) {
                location.reload();
            }
        });
    }

    toastShared = function() {
        $("#share_booklet").toast('show');

        var dummy = document.createElement('input');
        text = window.location.href;

        document.body.appendChild(dummy);
        dummy.value = text;
        dummy.select();
        document.execCommand('copy');
        document.body.removeChild(dummy);
    }

    reload_issues = function(block) {
        console.log('reload_issues:' + block);
    	$.ajax({
            url: '/book/issue_api/',
            type: 'POST',
            data: {
                command: 'get_issues',
                block_list: '[' + block + ']',
                csrfmiddlewaretoken: csrf_token,
            },
            dataType : "json"
        }).done(function (result) {
    	    console.log('result:' + result)
            if (result.ok) {
                $('#issues_' + block).html(result.stuffed_jinjas[block]);
                showComments(block);
                refreshRender();
            } else {
                console.log(result);
            }
        });
    }

    reload_private_comments = function(block) {
        console.log('reload_private_comments:' + block);
    	$.ajax({
            url: '/book/issue_api/',
            type: 'POST',
            data: {
                command: 'get_private_comments',
                block_list: '[' + block + ']',
                csrfmiddlewaretoken: csrf_token,
            },
            dataType : "json"
        }).done(function (result) {
    	    console.log('result:' + result)
            if (result.ok) {
                $('#private_comments_' + block).html(result.stuffed_jinjas[block]);
                showPrivateComments(block);
                refreshRender();
            } else {
                console.log(result)
            }
        });
    }

    var help_index = 0;

    
        console.log('setting collection id: ' + 16);
        localStorage.setItem('pref_coll_4',16);
    

    // Global variables for active sci2u
    let storedVal, storedState, storedDetail, visible = undefined;

    $(document).ready(function() {
        update_active_sci2u([], 'fetch');
    });

    update_active_sci2u = function(sci2u, command) {
        switch (command) {
            case 'fetch':
                console.log("fetching active sci2u..");
                visible = JSON.parse(localStorage.getItem('sci2u_visible'));
                console.log("visible? " + visible);

                if (visible) {
                    storedVal = localStorage.getItem('sci2u_active_val');
                    storedState = localStorage.getItem('sci2u_active_state');
                    storedDetail = localStorage.getItem('sci2u_active_detail');
                    $('#sci2uActiveNav').removeClass('d-none');
                }
                break;
            case 'update':
                console.log("updating active sci2u..");
                store_active_sci2u(sci2u[0], sci2u[1], sci2u[2], sci2u[3]);
                update_active_sci2u([sci2u[0], sci2u[1], sci2u[2], sci2u[3]], 'fetch');
                break;
            case 'done':
                console.log("done with active sci2u..");
                store_active_sci2u(storedVal, storedState, storedDetail, false);
                $('#sci2uActiveNav').addClass('d-none');
                break;
        }
    }

    store_active_sci2u = function(val, state, detail, visible) {
        localStorage.setItem('sci2u_visible', JSON.stringify(visible));
        localStorage.setItem('sci2u_active_val', val);
        localStorage.setItem('sci2u_active_state', state);
        localStorage.setItem('sci2u_active_detail', detail);
    }

    open_active_sci2u = function() {
        showTileMixModal(storedVal, storedState, storedDetail);
    }

    // Time for sci2u quiz timer
    var countdownTimer, secs;

    function sci2u_countdown(time) {
        var countdownTime = Math.round(time);
        secs = countdownTime;

        clearInterval(countdownTimer); // Clear timer to avoid speeding it up
        countdownTimer = setInterval('timer()', 1000);
        timer(); // Start timer immediately
    }

    function timer() {
        // Recalculate units
        var days = Math.floor(secs/24/60/60);
        var hoursLeft = Math.floor((secs) - (days*86400));
        var hours = Math.floor(hoursLeft/3600);
        var minsLeft = Math.floor((hoursLeft) - (hours*3600));
        var mins = Math.floor(minsLeft/60);
        var remainingSecs = secs % 60;

        // Yellow timer when >1h and red when >1m
        if (days <= 0 && hours <= 0 && mins < 1) {
            $('#sci2uTimer').addClass('text-danger');
        }
        else if (days <= 0 && hours < 1) {
            $('#sci2uTimer').addClass('text-warning');
        }

        // Only display necessary units
        if (days <= 0 && hours <= 0 && mins <= 0) {
            $('#sci2uTimer').text(remainingSecs + "s ");
        }
        else if (days <= 0 && hours <= 0) {
            $('#sci2uTimer').text(mins + "m ");
        }
        else if (days <= 0) {
            if (mins <= 0) {
                $('#sci2uTimer').text(hours + "h ");
            }
            else {
                $('#sci2uTimer').text(hours + "h " + mins + "m ");
            }

        }
        else {
            if (hours <= 0) {
                $('#sci2uTimer').text(days + "d ");
            }
            else {
                $('#sci2uTimer').text(days + "d " + hours + "h ");
            }
        }

        // Decrement time and check if passed
        if (secs <= 0) {
            clearInterval(countdownTimer);

            if (secs < 0) {
                $('#sci2uTimer').addClass('text-danger');
            }
            $('#sci2uTimer').text("has passed");
	    $('#question .card').html('<h3>Your deadline has expired.</h3>');
	    $('#answers .row').html('');
	    $('#stepModalHTMLfooter ul').remove();
	    $('#stepModalHTMLfooter button').remove();
        }
        else {
            secs--;
        }
    }

    // Clear timer when modal is closed
    $(function() {
        $('#sci2uModal').on('hide.bs.modal', function (e) {
            clearInterval(countdownTimer);
        });
    });
   </script>
   <script type="text/javascript">
    console.log('loading sci2u_quiz.js');

var modal_content_generation = 0;
function update_modal_content_generation(){
    modal_content_generation += 1;
}
function are_we_still_in_same_modal_content_generation(generation_when_submitted) {
    return (generation_when_submitted == modal_content_generation)
}

var help_sheet_pks = []; //obsolete?

var getTileMixModalContent = function(val,_callback,state,detail) {
    var data = {id: val,
		csrfmiddlewaretoken: csrf_token,
		command: 'get',
    }
    if(state) {
        data.sm = state;
        data.di = detail;
    }
$.ajax({
	url: "/tile/",
	data: data,
	type: "POST",
	dataType : "json"
    }).done(function ( result ) {
        if (result.ok) {
            _callback(result);
	    } else {
            alert(result.msg);
        }
	});
};

// Bool to check if the sci2u is done
let doneWithSci2u = false;
// [[function0,[short_delay0,med_delay0,long_delay0]],[function1,[short_delay1,med_delay1,long_delay1]], ...]
var postStepModalCallbacks = [
    //0
    [function() {}, [0,0,0]],
    //1
    [function(val) {
        $('#rate_value').html(val);
    }, [0,0,0]],
    //2 UPDATE_PRESENT_INDEX
    [function(val) {
        $('#index_value').html(val);
        doneWithSci2u = false;
    }, [0,0,0]],
    //3 ANSWER_WRONG
    [function(val) {
        $('#answer'+val).find('a').addClass('border-warning');
    }, [0,0,0]],
    //4 ANSWER_RIGHT
    [function(val) {
        $('#answer'+val).find('a').addClass('border-success');
    }, [0,0,0]],
    //5 STUDENT_HAS_READ_SLIDE_SHOW
    [function(val) {
        $('#note_boolean').html('Yes!');
    }, [0,100,500]],
    //6 LAST_EXERCISE_FINISHED
    [function(val) {
        $('.questionContainer').html('You are done!');
    }, [0,0,0]],
    //7 SHOW_QUESTION_IMAGE
    [function(val) {
        $('#question').children('img').attr('src', val);
    }, [0,0,0]],
    //8 SHOW_ANSWER_IMAGE
    [function(val) {
        $('#answer'+val[0]).css("background-image", "url("+val[1]+")");
    }, [0,0,0]],
    //9 UPDATE_MODAL
    [function(val) {
        showTileModal(val);
    }, [0,0,0]],
    //10 CONGRATULATE
    [function(val) {
        console.log("congratulations!");
    }, [0,1000,3000]],
    //11 CLOSE_MODAL
    [function(val) {
        $("#StepModal").modal("hide");
    }, [0,0,0]],
    //12 ADVANCE_GAME
    [function(val) {
        var user_animation_time = 1500;
        var user_wait = 1500;
        advanceGame[val[0]](val[1],user_animation_time,user_wait);
    }, [0,0,0]],
    //13 COLOR_FEEDBACK_IN_TILE_HEADER
    [function(val) {
        $('#feedback'+val[0]).addClass(val[1]);
        doneWithSci2u = true;
    }, [0,0,0]],
    //14 UPDATE_LTI
    [function(val) {
        var score = val[0];
        var passed = val[1];
        console.log('LTI: '+val);
        if (passed) {
            $("#lti_box span").text('Passed');
            $("#lti_box").addClass("blackboardpassed");
        } else if (score == '') {
            $("#lti_box span").text('No mark in Grade Center');
        } else {
            $("#lti_box span").text('Score: '+score);
        }
    }, [0,0,0]],
    //15 EXPECT_MORE_ANSWERS
    [function(val,generation_when_submitted) {
        setTimeout(function() {
            if (are_we_still_in_same_modal_content_generation(generation_when_submitted)) {
                $('#expect_more_answers').html('You have to find more correct answers');
        }},10000);
    }, [0,0,0]],
    //16 MARK_CHOSEN_FEEDBACK
    [function(val) {
        for (var v = 1; v < 4; v++) {
    	    if (v == val) {
	            $('#agentfeedback'+val).addClass('chosen').removeClass('not_chosen');
    	    } else {
	            $('#agentfeedback'+v).addClass('not_chosen').removeClass('chosen');
    	    }
        }
    }, [0,0,0]],
    //17 ADMINISTER_HELP_OPTION
    [function(val) {
        $('#loophelp').addClass('highlight');
        $('#choosehelp').addClass('highlight');
    }, [0,0,0]],
    //18 SHOW_HELP_SHEETS
    [function(val) {
        // $('#gethelp').css("display","none");
        $('#helpsheet').css("display","inline-block");
        $('#helpsheet').children('img').attr('src', val);
    }, [0,0,0]],
    //19 UPDATE_TILE_MIX_MODAL
    [function(val) {
        showTileMixModal(val);
    }, [0,0,0]],
    //20 UPDATE_HELP_BUTTONS
    [function(val) {
        //console.log('UPDATE_HELP_BUTTONS '+val)
    	loop_possible = val[0];
    	new_help = val[1];
    	//console.log('loop_possible: '+loop_possible);
    	//console.log('new_help: '+new_help);
    	$('#loophelp').removeClass('highlight');
    	$('#choosehelp').removeClass('highlight');
    	$('#loophelp').parent().removeClass('alone');
    	$('#choosehelp').parent().removeClass('alone');

        if (loop_possible) {
    	    $('#loophelp').parent().removeClass('unavail');
    	} else {
    	    $('#loophelp').parent().addClass('unavail');
    	    $('#choosehelp').parent().addClass('alone');
    	}

    	if (new_help) {
    	    $('#choosehelp').parent().removeClass('unavail');
    	} else {
    	    $('#choosehelp').parent().addClass('unavail');
    	    $('#loophelp').parent().addClass('alone');
    	}
    }, [0,3000,5000]],
    //21 DEADLINE_EXPIRED not sure if this is ever in action or if the code in booklet_js.jinja does it
    [function(val) {
	$('#question .card').html('<h3>Your deadline has expired ...</h3>')
        $('#stepModalHTMLfooter ul').remove();
	$('#stepModalHTMLfooter button').remove();
    }, [0,0,0]],
    //22 UPDATE_BUTTON_IN_BLOCK
    [function(val) {
	console.log('22: ' + val);
var badge_class = {
  3 : 'btn-success',
  2 : 'btn-warning',
  1 : 'btn-danger',
};
	if (badge_class[val[1]]){
            $('[data-tile-number="'+val[0]+'"]').removeClass('btn-outline-secondary').removeClass('btn-danger').removeClass('btn-warning').addClass(badge_class[val[1]]).removeClass('btn-secondary')
	};
    }, [0,0,0]],
];

function processItem(callback_no,data,waittime,generation_when_submitted) {
    console.log('callback_no:' + callback_no);
    var callback_function = postStepModalCallbacks[callback_no][0];
    if (waittime == "short") {
        var timedelay = postStepModalCallbacks[callback_no][1][0];
    } else if (waittime=="medium") {
        var timedelay = postStepModalCallbacks[callback_no][1][1];
    } else if (waittime == "long") {
        var timedelay = postStepModalCallbacks[callback_no][1][2];
    } else {
        var timedelay = 0;
    }
    callback_function(data,generation_when_submitted);
    var dfd = $.Deferred();
    setTimeout(function() { dfd.resolve() }, timedelay);
    //console.log('C: '+callback_no+' D: '+data+' T: '+waittime+' delay: '+timedelay)
    return dfd.promise();
}

var postTileModalContent = function(val,command,data) {
    update_modal_content_generation();
    $.ajax({
        url: "/tile/",
        data: {
        id: val,
        csrfmiddlewaretoken: csrf_token,
        command: command,
        data: data,
        },
        type: "POST",
        dataType : "json"
	}).done(function ( result ) {
        if (result.ok) {
            // flip the list
            reverse_command_list = []
            while (result.callback_no_data.length > 0) {
                reverse_command_list.push(result.callback_no_data.pop());
            }

            var processItemsDeferred_list = [];
            var j = -1;
            function run_through_commands(d,generation_when_submitted) {
                if (!are_we_still_in_same_modal_content_generation(generation_when_submitted)) {
	                return;
                }
                j += 1;
                if (d.length > 0) {
                    processItemsDeferred_list[j] = [];
                    do {
                        var next_command = d.pop();
                        var command_no = next_command[0];
                        var data = next_command[1];
                        var timedelay = next_command[2];
                        processItemsDeferred_list[j].push(processItem(command_no,data,timedelay,generation_when_submitted));
                    } while (timedelay < 10 && d.length > 0);
                    // submit
                    $.when.apply($, processItemsDeferred_list[j]).then(function(){run_through_commands(d,generation_when_submitted)});
                }
            };
            run_through_commands(reverse_command_list,modal_content_generation);
        } else {
            alert(result.msg);
        }
    }).fail(function( xhr, status, errorThrown ) {
        move_allowed = false;
        alert( "Your session does not appear to be operative. Please reload the page for it to work again." );
        console.log( "Error: " + errorThrown );
        console.log( "Status: " + status );
        console.dir( xhr );
	});
};

function showTileMixModal(val,state,detail) {
    console.log("entering showTileMixModal");
    if (val.length == 2) {
        var valout = val[0];
        var pastdeadline = val[1];
    } else {
        var valout = val;
    }
    update_modal_content_generation();

    if (doneWithSci2u) {
        update_active_sci2u([], 'done');
    }
    else {
        update_active_sci2u([valout, state, detail, true], 'update');
    }

    var callback = function(result) {
    	if (result.ok) {
    	    console.log('in callback');
        	$('#sci2uModal').modal('show');
            $("#stepModalHTMLbody").html(result.html_body);
            $("#stepModalHTMLheader").html(result.html_header);
            $("#stepModalHTMLfooter").html(result.html_footer);
        	if (pastdeadline) {
        	    $("#pastdeadline").html(pastdeadline).css('padding','5px');
        	}
    	}
    }
    getTileMixModalContent(valout,callback,state,detail);
}

var closeHelp = function(val) {
    console.log('closeHelp 1');
    $('#helpsheet').css("display","none");
    console.log('closeHelp 2');
    $("#gethelp").attr("onclick","postTileModalContent("+val+",'get help','[]')");
    console.log('closeHelp 3');
    $('#gethelp').html("Want help?");
    console.log('closeHelp 4');
    help_sheet_pks = [];
    console.log('closeHelp 5');
};
   </script>
   <script type="text/javascript">
    var may_send_autocolor_message = {

   
250:  false ,
   
251:  false ,
   
252:  false ,
   

}
var the_collection_id = 16;
   </script>
   <script type="text/javascript">
    $(document).ready(function() {

$(window).scroll(function(){
    // This is then function used to detect if the element is scrolled into view
    function elementScrolledTop(elem)
    {
        var docViewTop = $(window).scrollTop();
        var docViewBottom = docViewTop + $(window).height();
        var elemTop = elem.offset().top;
        return ((elemTop <= docViewBottom) && (elemTop >= docViewTop));
    }
    function elementScrolledBot(elem)
    {
        var docViewTop = $(window).scrollTop();
        var docViewBottom = docViewTop + $(window).height();
        var elemBot = elem.offset().top + elem.outerHeight();
        return ((elemBot <= docViewBottom) && (elemBot >= docViewTop));
    }
     
    // This is where we use the function to detect if ".dropright" is scrolled into view
    $('.dropright').each(function() {
        if(elementScrolledTop($(this))) {
	    var id = $(this).parent().attr('id');
	    var idx = parseInt(id.split('_')[1]);
	    // console.log('start reading block: ' + idx);
        }
        if(elementScrolledBot($(this))) {
	    var id = $(this).parent().attr('id');
	    var idx = parseInt(id.split('_')[1]);
	    if (may_send_autocolor_message[idx]) {
	      set_label_name(idx,the_collection_id,'done');
	    }
	    may_send_autocolor_message[idx] = false;
	    // console.log('done reading block: ' + idx);
        }
    });
});

});
   </script>
  </head>
 </head>
</html>
